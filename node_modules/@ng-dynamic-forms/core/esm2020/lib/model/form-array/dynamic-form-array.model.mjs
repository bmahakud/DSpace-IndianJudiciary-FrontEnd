import { __decorate } from "tslib";
import { DynamicFormControlModel } from "../dynamic-form-control.model";
import { serializable, serialize } from "../../decorator/serializable.decorator";
import { isFunction, isNumber } from "../../utils/core.utils";
export class DynamicFormArrayGroupModel {
    constructor(context, group = [], index = -1) {
        this.$implicit = this;
        this.context = context;
        this.group = group;
        this.index = index;
    }
    get parent() {
        return this.context;
    }
    get(index) {
        return this.group[index];
    }
    toJSON() {
        return serialize(this);
    }
}
__decorate([
    serializable()
], DynamicFormArrayGroupModel.prototype, "group", void 0);
__decorate([
    serializable()
], DynamicFormArrayGroupModel.prototype, "index", void 0);
export const DYNAMIC_FORM_CONTROL_TYPE_ARRAY = "ARRAY";
export class DynamicFormArrayModel extends DynamicFormControlModel {
    constructor(config, layout) {
        super(config, layout);
        this.groups = [];
        this.type = DYNAMIC_FORM_CONTROL_TYPE_ARRAY;
        if (isFunction(config.groupFactory)) {
            this.groupFactory = config.groupFactory;
        }
        else {
            throw new Error("group factory function must be specified for DynamicFormArrayModel");
        }
        this.groupAsyncValidators = config.groupAsyncValidators ?? null;
        this.groupPrototype = this.groupFactory();
        this.groupValidators = config.groupValidators ?? null;
        this.initialCount = isNumber(config.initialCount) ? config.initialCount : 1;
        if (Array.isArray(config.groups)) {
            config.groups.forEach((arrayGroup, index) => {
                this.groups.push(new DynamicFormArrayGroupModel(this, arrayGroup.group, arrayGroup.index ?? index));
            });
        }
        else {
            for (let index = 0; index < this.initialCount; index++) {
                this.addGroup();
            }
        }
    }
    updateGroupIndex() {
        this.groups.forEach((group, index) => group.index = index);
    }
    get size() {
        return this.groups.length;
    }
    get(index) {
        return this.groups[index];
    }
    addGroup() {
        return this.insertGroup(this.groups.length);
    }
    insertGroup(index) {
        const group = new DynamicFormArrayGroupModel(this, this.groupFactory());
        this.groups.splice(index, 0, group);
        this.updateGroupIndex();
        return group;
    }
    moveGroup(index, step) {
        this.groups.splice(index + step, 0, ...this.groups.splice(index, 1));
        this.updateGroupIndex();
    }
    removeGroup(index) {
        this.groups.splice(index, 1);
        this.updateGroupIndex();
    }
    clear() {
        this.groups.splice(0);
        this.updateGroupIndex();
    }
}
__decorate([
    serializable()
], DynamicFormArrayModel.prototype, "groupAsyncValidators", void 0);
__decorate([
    serializable()
], DynamicFormArrayModel.prototype, "groupValidators", void 0);
__decorate([
    serializable()
], DynamicFormArrayModel.prototype, "groups", void 0);
__decorate([
    serializable()
], DynamicFormArrayModel.prototype, "initialCount", void 0);
__decorate([
    serializable()
], DynamicFormArrayModel.prototype, "groupPrototype", void 0);
__decorate([
    serializable()
], DynamicFormArrayModel.prototype, "type", void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1mb3JtLWFycmF5Lm1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmctZHluYW1pYy1mb3Jtcy9jb3JlL3NyYy9saWIvbW9kZWwvZm9ybS1hcnJheS9keW5hbWljLWZvcm0tYXJyYXkubW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSx1QkFBdUIsRUFBaUMsTUFBTSwrQkFBK0IsQ0FBQztBQUt2RyxPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ2pGLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFOUQsTUFBTSxPQUFPLDBCQUEwQjtJQU1uQyxZQUFZLE9BQThCLEVBQUUsUUFBMEIsRUFBRSxFQUFFLFFBQWdCLENBQUMsQ0FBQztRQUN4RixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUN0QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUN2QixDQUFDO0lBRUQsSUFBSSxNQUFNO1FBQ04sT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3hCLENBQUM7SUFFRCxHQUFHLENBQUMsS0FBYTtRQUNiLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRUQsTUFBTTtRQUNGLE9BQU8sU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNCLENBQUM7Q0FDSjtBQXJCbUI7SUFBZixZQUFZLEVBQUU7eURBQXlCO0FBQ3hCO0lBQWYsWUFBWSxFQUFFO3lEQUFlO0FBc0JsQyxNQUFNLENBQUMsTUFBTSwrQkFBK0IsR0FBRyxPQUFPLENBQUM7QUFVdkQsTUFBTSxPQUFP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ckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzdCLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFRCxLQUFLO1FBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEIsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDNUIsQ0FBQztDQUNKO0FBMUVtQjtJQUFmLFlBQVksRUFBRTttRUFBc0Q7QUFFckQ7SUFBZixZQUFZLEVBQUU7OERBQWlEO0FBQ2hEO0lBQWYsWUFBWSxFQUFFO3FEQUEyQztBQUMxQztJQUFmLFlBQVksRUFBRTsyREFBc0I7QUFFckI7SUFBZixZQUFZLEVBQUU7NkRBQTJDO0FBQzFDO0lBQWYsWUFBWSxFQUFFO21EQUF5RCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IER5bmFtaWNGb3JtQ29udHJvbE1vZGVsLCBEeW5hbWljRm9ybUNvbnRyb2xNb2RlbENvbmZpZyB9IGZyb20gXCIuLi9keW5hbWljLWZvcm0tY29udHJvbC5tb2RlbFwiO1xuaW1wb3J0IHsgRHluYW1pY0Zvcm1Nb2RlbCB9IGZyb20gXCIuLi9keW5hbWljLWZvcm0ubW9kZWxcIjtcbmltcG9ydCB7IER5bmFtaWNGb3JtQ29udHJvbExheW91dCB9IGZyb20gXCIuLi9taXNjL2R5bmFtaWMtZm9ybS1jb250cm9sLWxheW91dC5tb2RlbFwiO1xuaW1wb3J0IHsgRHluYW1pY1BhdGhhYmxlIH0gZnJvbSBcIi4uL21pc2MvZHluYW1pYy1mb3JtLWNvbnRyb2wtcGF0aC5tb2RlbFwiO1xuaW1wb3J0IHsgRHluYW1pY1ZhbGlkYXRvcnNDb25maWcgfSBmcm9tIFwiLi4vbWlzYy9keW5hbWljLWZvcm0tY29udHJvbC12YWxpZGF0aW9uLm1vZGVsXCI7XG5pbXBvcnQgeyBzZXJpYWxpemFibGUsIHNlcmlhbGl6ZSB9IGZyb20gXCIuLi8uLi9kZWNvcmF0b3Ivc2VyaWFsaXphYmxlLmRlY29yYXRvclwiO1xuaW1wb3J0IHsgaXNGdW5jdGlvbiwgaXNOdW1iZXIgfSBmcm9tIFwiLi4vLi4vdXRpbHMvY29yZS51dGlsc1wiO1xuXG5leHBvcnQgY2xhc3MgRHluYW1pY0Zvcm1BcnJheUdyb3VwTW9kZWwgaW1wbGVtZW50cyBEeW5hbWljUGF0aGFibGUge1xuICAgICRpbXBsaWNpdDogRHluYW1pY0Zvcm1BcnJheUdyb3VwTW9kZWw7XG4gICAgY29udGV4dDogRHluYW1pY0Zvcm1BcnJheU1vZGVsO1xuICAgIEBzZXJpYWxpemFibGUoKSBncm91cDogRHluYW1pY0Zvcm1Nb2RlbDtcbiAgICBAc2VyaWFsaXphYmxlKCkgaW5kZXg6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKGNvbnRleHQ6IER5bmFtaWNGb3JtQXJyYXlNb2RlbCwgZ3JvdXA6IER5bmFtaWNGb3JtTW9kZWwgPSBbXSwgaW5kZXg6IG51bWJlciA9IC0xKSB7XG4gICAgICAgIHRoaXMuJGltcGxpY2l0ID0gdGhpcztcbiAgICAgICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgICAgICAgdGhpcy5ncm91cCA9IGdyb3VwO1xuICAgICAgICB0aGlzLmluZGV4ID0gaW5kZXg7XG4gICAgfVxuXG4gICAgZ2V0IHBhcmVudCgpOiBEeW5hbWljRm9ybUFycmF5TW9kZWwge1xuICAgICAgICByZXR1cm4gdGhpcy5jb250ZXh0O1xuICAgIH1cblxuICAgIGdldChpbmRleDogbnVtYmVyKTogRHluYW1pY0Zvcm1Db250cm9sTW9kZWwge1xuICAgICAgICByZXR1cm4gdGhpcy5ncm91cFtpbmRleF07XG4gICAgfVxuXG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4gc2VyaWFsaXplKHRoaXMpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfQVJSQVkgPSBcIkFSUkFZXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRHluYW1pY0Zvcm1BcnJheU1vZGVsQ29uZmlnIGV4dGVuZHMgRHluYW1pY0Zvcm1Db250cm9sTW9kZWxDb25maWcge1xuICAgIGdyb3VwQXN5bmNWYWxpZGF0b3JzPzogRHluYW1pY1ZhbGlkYXRvcnNDb25maWc7XG4gICAgZ3JvdXBGYWN0b3J5PzogKCkgPT4gRHluYW1pY0Zvcm1Nb2RlbDtcbiAgICBncm91cFZhbGlkYXRvcnM/OiBEeW5hbWljVmFsaWRhdG9yc0NvbmZpZztcbiAgICBncm91cHM/OiBEeW5hbWljRm9ybUFycmF5R3JvdXBNb2RlbFtdIHwgbnVsbDtcbiAgICBpbml0aWFsQ291bnQ/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBEeW5hbWljRm9ybUFycmF5TW9kZWwgZXh0ZW5kcyBEeW5hbWljRm9ybUNvbnRyb2xNb2RlbCB7XG4gICAgQHNlcmlhbGl6YWJsZSgpIGdyb3VwQXN5bmNWYWxpZGF0b3JzOiBEeW5hbWljVmFsaWRhdG9yc0NvbmZpZyB8IG51bGw7XG4gICAgZ3JvdXBGYWN0b3J5OiAoKSA9PiBEeW5hbWljRm9ybU1vZGVsO1xuICAgIEBzZXJpYWxpemFibGUoKSBncm91cFZhbGlkYXRvcnM6IER5bmFtaWNWYWxpZGF0b3JzQ29uZmlnIHwgbnVsbDtcbiAgICBAc2VyaWFsaXphYmxlKCkgZ3JvdXBzOiBEeW5hbWljRm9ybUFycmF5R3JvdXBNb2RlbFtdID0gW107XG4gICAgQHNlcmlhbGl6YWJsZSgpIGluaXRpYWxDb3VudDogbnVtYmVyO1xuXG4gICAgQHNlcmlhbGl6YWJsZSgpIHJlYWRvbmx5IGdyb3VwUHJvdG90eXBlOiBEeW5hbWljRm9ybU1vZGVsOyAvLyBvbmx5IHRvIHJlY3JlYXRlIG1vZGVsIGZyb20gSlNPTlxuICAgIEBzZXJpYWxpemFibGUoKSByZWFkb25seSB0eXBlOiBzdHJpbmcgPSBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9UWVBFX0FSUkFZO1xuXG4gICAgY29uc3RydWN0b3IoY29uZmlnOiBEeW5hbWljRm9ybUFycmF5TW9kZWxDb25maWcsIGxheW91dD86IER5bmFtaWNGb3JtQ29udHJvbExheW91dCkge1xuICAgICAgICBzdXBlcihjb25maWcsIGxheW91dCk7XG5cbiAgICAgICAgaWYgKGlzRnVuY3Rpb24oY29uZmlnLmdyb3VwRmFjdG9yeSkpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBGYWN0b3J5ID0gY29uZmlnLmdyb3VwRmFjdG9yeTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImdyb3VwIGZhY3RvcnkgZnVuY3Rpb24gbXVzdCBiZSBzcGVjaWZpZWQgZm9yIER5bmFtaWNGb3JtQXJyYXlNb2RlbFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ3JvdXBBc3luY1ZhbGlkYXRvcnMgPSBjb25maWcuZ3JvdXBBc3luY1ZhbGlkYXRvcnMgPz8gbnVsbDtcbiAgICAgICAgdGhpcy5ncm91cFByb3RvdHlwZSA9IHRoaXMuZ3JvdXBGYWN0b3J5KCk7XG4gICAgICAgIHRoaXMuZ3JvdXBWYWxpZGF0b3JzID0gY29uZmlnLmdyb3VwVmFsaWRhdG9ycyA/PyBudWxsO1xuICAgICAgICB0aGlzLmluaXRpYWxDb3VudCA9IGlzTnVtYmVyKGNvbmZpZy5pbml0aWFsQ291bnQpID8gY29uZmlnLmluaXRpYWxDb3VudCA6IDE7XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnLmdyb3VwcykpIHtcbiAgICAgICAgICAgIGNvbmZpZy5ncm91cHMuZm9yRWFjaCgoYXJyYXlHcm91cCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwcy5wdXNoKG5ldyBEeW5hbWljRm9ybUFycmF5R3JvdXBNb2RlbCh0aGlzLCBhcnJheUdyb3VwLmdyb3VwLCBhcnJheUdyb3VwLmluZGV4ID8/IGluZGV4KSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMuaW5pdGlhbENvdW50OyBpbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRHcm91cCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVHcm91cEluZGV4KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmdyb3Vwcy5mb3JFYWNoKChncm91cCwgaW5kZXgpID0+IGdyb3VwLmluZGV4ID0gaW5kZXgpO1xuICAgIH1cblxuICAgIGdldCBzaXplKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyb3Vwcy5sZW5ndGg7XG4gICAgfVxuXG4gICAgZ2V0KGluZGV4OiBudW1iZXIpOiBEeW5hbWljRm9ybUFycmF5R3JvdXBNb2RlbCB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyb3Vwc1tpbmRleF07XG4gICAgfVxuXG4gICAgYWRkR3JvdXAoKTogRHluYW1pY0Zvcm1BcnJheUdyb3VwTW9kZWwge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnNlcnRHcm91cCh0aGlzLmdyb3Vwcy5sZW5ndGgpO1xuICAgIH1cblxuICAgIGluc2VydEdyb3VwKGluZGV4OiBudW1iZXIpOiBEeW5hbWljRm9ybUFycmF5R3JvdXBNb2RlbCB7XG4gICAgICAgIGNvbnN0IGdyb3VwID0gbmV3IER5bmFtaWNGb3JtQXJyYXlHcm91cE1vZGVsKHRoaXMsIHRoaXMuZ3JvdXBGYWN0b3J5KCkpO1xuXG4gICAgICAgIHRoaXMuZ3JvdXBzLnNwbGljZShpbmRleCwgMCwgZ3JvdXApO1xuICAgICAgICB0aGlzLnVwZGF0ZUdyb3VwSW5kZXgoKTtcblxuICAgICAgICByZXR1cm4gZ3JvdXA7XG4gICAgfVxuXG4gICAgbW92ZUdyb3VwKGluZGV4OiBudW1iZXIsIHN0ZXA6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB0aGlzLmdyb3Vwcy5zcGxpY2UoaW5kZXggKyBzdGVwLCAwLCAuLi50aGlzLmdyb3Vwcy5zcGxpY2UoaW5kZXgsIDEpKTtcbiAgICAgICAgdGhpcy51cGRhdGVHcm91cEluZGV4KCk7XG4gICAgfVxuXG4gICAgcmVtb3ZlR3JvdXAoaW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB0aGlzLmdyb3Vwcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB0aGlzLnVwZGF0ZUdyb3VwSW5kZXgoKTtcbiAgICB9XG5cbiAgICBjbGVhcigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ncm91cHMuc3BsaWNlKDApO1xuICAgICAgICB0aGlzLnVwZGF0ZUdyb3VwSW5kZXgoKTtcbiAgICB9XG59XG4iXX0=