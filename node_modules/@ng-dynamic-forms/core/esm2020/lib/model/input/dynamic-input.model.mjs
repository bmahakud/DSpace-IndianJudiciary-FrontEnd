import { __decorate } from "tslib";
import { DynamicInputControlModel } from "../dynamic-input-control.model";
import { serializable } from "../../decorator/serializable.decorator";
import { isBoolean, isNumber } from "../../utils/core.utils";
import { isObservable, of } from "rxjs";
import { tap } from "rxjs/operators";
import { initialConfig } from "ngx-mask";
export const DYNAMIC_FORM_CONTROL_TYPE_INPUT = "INPUT";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_COLOR = "color";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_DATE = "date";
// export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_DATETIME = "datetime";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_DATETIME_LOCAL = "datetime-local";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_EMAIL = "email";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_FILE = "file";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_MONTH = "month";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_NUMBER = "number";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_PASSWORD = "password";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_RANGE = "range";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_SEARCH = "search";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_TEL = "tel";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_TEXT = "text";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_TIME = "time";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_URL = "url";
export const DYNAMIC_FORM_CONTROL_INPUT_TYPE_WEEK = "week";
export class DynamicInputModel extends DynamicInputControlModel {
    constructor(config, layout) {
        super(config, layout);
        this.files = null;
        this.list$ = null;
        this._list = null;
        this._listId = null;
        this.type = DYNAMIC_FORM_CONTROL_TYPE_INPUT;
        this.accept = config.accept ?? null;
        this.inputType = config.inputType ?? DYNAMIC_FORM_CONTROL_INPUT_TYPE_TEXT;
        this.mask = config.mask ?? "";
        this.maskConfig = config.maskConfig ? { ...initialConfig, ...config.maskConfig } : initialConfig;
        this.max = config.max !== undefined ? config.max : null;
        this.min = config.min !== undefined ? config.min : null;
        this.multiple = isBoolean(config.multiple) ? config.multiple : null;
        this.pattern = config.pattern ?? null;
        this.step = isNumber(config.step) ? config.step : null;
        if (config.list !== undefined) {
            this.list = config.list;
            this._listId = `${this.id}List`;
        }
    }
    get listId() {
        return this._listId;
    }
    get hasList() {
        return isObservable(this.list$);
    }
    set list(list) {
        if (Array.isArray(list)) {
            this._list = list;
            this.list$ = of(this._list);
        }
        else if (isObservable(list)) {
            this.list$ = list.pipe(tap(_list => this._list = _list));
        }
        else {
            this._list = null;
            this.list$ = null;
        }
    }
}
__decorate([
    serializable()
], DynamicInputModel.prototype, "accept", void 0);
__decorate([
    serializable()
], DynamicInputModel.prototype, "inputType", void 0);
__decorate([
    serializable()
], DynamicInputModel.prototype, "mask", void 0);
__decorate([
    serializable()
], DynamicInputModel.prototype, "maskConfig", void 0);
__decorate([
    serializable()
], DynamicInputModel.prototype, "max", void 0);
__decorate([
    serializable()
], DynamicInputModel.prototype, "min", void 0);
__decorate([
    serializable()
], DynamicInputModel.prototype, "multiple", void 0);
__decorate([
    serializable()
], DynamicInputModel.prototype, "pattern", void 0);
__decorate([
    serializable()
], DynamicInputModel.prototype, "step", void 0);
__decorate([
    serializable("list")
], DynamicInputModel.prototype, "_list", void 0);
__decorate([
    serializable()
], DynamicInputModel.prototype, "type", void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1pbnB1dC5tb2RlbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWR5bmFtaWMtZm9ybXMvY29yZS9zcmMvbGliL21vZGVsL2lucHV0L2R5bmFtaWMtaW5wdXQubW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSx3QkFBd0IsRUFBa0MsTUFBTSxnQ0FBZ0MsQ0FBQztBQUUxRyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDdEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM3RCxPQUFPLEVBQWMsWUFBWSxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwRCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUFXLGFBQWEsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUVsRCxNQUFNLENBQUMsTUFBTSwrQkFBK0IsR0FBRyxPQUFPLENBQUM7QUFFdkQsTUFBTSxDQUFDLE1BQU0scUNBQXFDLEdBQUcsT0FBTyxDQUFDO0FBQzdELE1BQU0sQ0FBQyxNQUFNLG9DQUFvQyxHQUFHLE1BQU0sQ0FBQztBQUMzRCxzRUFBc0U7QUFDdEUsTUFBTSxDQUFDLE1BQU0sOENBQThDLEdBQUcsZ0JBQWdCLENBQUM7QUFDL0UsTUFBTSxDQUFDLE1BQU0scUNBQXFDLEdBQUcsT0FBTyxDQUFDO0FBQzdELE1BQU0sQ0FBQyxNQUFNLG9DQUFvQyxHQUFHLE1BQU0sQ0FBQztBQUMzRCxNQUFNLENBQUMsTUFBTSxxQ0FBcUMsR0FBRyxPQUFPLENBQUM7QUFDN0QsTUFBTSxDQUFDLE1BQU0sc0NBQXNDLEdBQUcsUUFBUSxDQUFDO0FBQy9ELE1BQU0sQ0FBQyxNQUFNLHdDQUF3QyxHQUFHLFVBQVUsQ0FBQztBQUNuRSxNQUFNLENBQUMsTUFBTSxxQ0FBcUMs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QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQ2xCLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLENBQ25DLENBQUM7U0FFTDthQUFNO1lBQ0gsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7WUFDbEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7U0FDckI7SUFDTCxDQUFDO0NBQ0o7QUEzRG1CO0lBQWYsWUFBWSxFQUFFO2lEQUF1QjtBQUN0QjtJQUFmLFlBQVksRUFBRTtvREFBbUI7QUFHbEI7SUFBZixZQUFZLEVBQUU7K0NBQWM7QUFDYjtJQUFmLFlBQVksRUFBRTtxREFBcUI7QUFDcEI7SUFBZixZQUFZLEVBQUU7OENBQW9DO0FBQ25DO0lBQWYsWUFBWSxFQUFFOzhDQUFvQztBQUNuQztJQUFmLFlBQVksRUFBRTttREFBMEI7QUFDekI7SUFBZixZQUFZLEVBQUU7a0RBQXdCO0FBQ3ZCO0lBQWYsWUFBWSxFQUFFOytDQUFxQjtBQUVkO0lBQXJCLFlBQVksQ0FBQyxNQUFNLENBQUM7Z0RBQW9DO0FBR3pDO0lBQWYsWUFBWSxFQUFFOytDQUF5RCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IER5bmFtaWNJbnB1dENvbnRyb2xNb2RlbCwgRHluYW1pY0lucHV0Q29udHJvbE1vZGVsQ29uZmlnIH0gZnJvbSBcIi4uL2R5bmFtaWMtaW5wdXQtY29udHJvbC5tb2RlbFwiO1xuaW1wb3J0IHsgRHluYW1pY0Zvcm1Db250cm9sTGF5b3V0IH0gZnJvbSBcIi4uL21pc2MvZHluYW1pYy1mb3JtLWNvbnRyb2wtbGF5b3V0Lm1vZGVsXCI7XG5pbXBvcnQgeyBzZXJpYWxpemFibGUgfSBmcm9tIFwiLi4vLi4vZGVjb3JhdG9yL3NlcmlhbGl6YWJsZS5kZWNvcmF0b3JcIjtcbmltcG9ydCB7IGlzQm9vbGVhbiwgaXNOdW1iZXIgfSBmcm9tIFwiLi4vLi4vdXRpbHMvY29yZS51dGlsc1wiO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgaXNPYnNlcnZhYmxlLCBvZiB9IGZyb20gXCJyeGpzXCI7XG5pbXBvcnQgeyB0YXAgfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcbmltcG9ydCB7IElDb25maWcsIGluaXRpYWxDb25maWcgfSBmcm9tIFwibmd4LW1hc2tcIjtcblxuZXhwb3J0IGNvbnN0IERZTkFNSUNfRk9STV9DT05UUk9MX1RZUEVfSU5QVVQgPSBcIklOUFVUXCI7XG5cbmV4cG9ydCBjb25zdCBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9JTlBVVF9UWVBFX0NPTE9SID0gXCJjb2xvclwiO1xuZXhwb3J0IGNvbnN0IERZTkFNSUNfRk9STV9DT05UUk9MX0lOUFVUX1RZUEVfREFURSA9IFwiZGF0ZVwiO1xuLy8gZXhwb3J0IGNvbnN0IERZTkFNSUNfRk9STV9DT05UUk9MX0lOUFVUX1RZUEVfREFURVRJTUUgPSBcImRhdGV0aW1lXCI7XG5leHBvcnQgY29uc3QgRFlOQU1JQ19GT1JNX0NPTlRST0xfSU5QVVRfVFlQRV9EQVRFVElNRV9MT0NBTCA9IFwiZGF0ZXRpbWUtbG9jYWxcIjtcbmV4cG9ydCBjb25zdCBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9JTlBVVF9UWVBFX0VNQUlMID0gXCJlbWFpbFwiO1xuZXhwb3J0IGNvbnN0IERZTkFNSUNfRk9STV9DT05UUk9MX0lOUFVUX1RZUEVfRklMRSA9IFwiZmlsZVwiO1xuZXhwb3J0IGNvbnN0IERZTkFNSUNfRk9STV9DT05UUk9MX0lOUFVUX1RZUEVfTU9OVEggPSBcIm1vbnRoXCI7XG5leHBvcnQgY29uc3QgRFlOQU1JQ19GT1JNX0NPTlRST0xfSU5QVVRfVFlQRV9OVU1CRVIgPSBcIm51bWJlclwiO1xuZXhwb3J0IGNvbnN0IERZTkFNSUNfRk9STV9DT05UUk9MX0lOUFVUX1RZUEVfUEFTU1dPUkQgPSBcInBhc3N3b3JkXCI7XG5leHBvcnQgY29uc3QgRFlOQU1JQ19GT1JNX0NPTlRST0xfSU5QVVRfVFlQRV9SQU5HRSA9IFwicmFuZ2VcIjtcbmV4cG9ydCBjb25zdCBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9JTlBVVF9UWVBFX1NFQVJDSCA9IFwic2VhcmNoXCI7XG5leHBvcnQgY29uc3QgRFlOQU1JQ19GT1JNX0NPTlRST0xfSU5QVVRfVFlQRV9URUwgPSBcInRlbFwiO1xuZXhwb3J0IGNvbnN0IERZTkFNSUNfRk9STV9DT05UUk9MX0lOUFVUX1RZUEVfVEVYVCA9IFwidGV4dFwiO1xuZXhwb3J0IGNvbnN0IERZTkFNSUNfRk9STV9DT05UUk9MX0lOUFVUX1RZUEVfVElNRSA9IFwidGltZVwiO1xuZXhwb3J0IGNvbnN0IERZTkFNSUNfRk9STV9DT05UUk9MX0lOUFVUX1RZUEVfVVJMID0gXCJ1cmxcIjtcbmV4cG9ydCBjb25zdCBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9JTlBVVF9UWVBFX1dFRUsgPSBcIndlZWtcIjtcblxuZXhwb3J0IGludGVyZmFjZSBEeW5hbWljSW5wdXRNb2RlbENvbmZpZyBleHRlbmRzIER5bmFtaWNJbnB1dENvbnRyb2xNb2RlbENvbmZpZzxzdHJpbmcgfCBudW1iZXIgfCBEYXRlIHwgc3RyaW5nW10+IHtcbiAgICBhY2NlcHQ/OiBzdHJpbmc7XG4gICAgaW5wdXRUeXBlPzogc3RyaW5nO1xuICAgIGxpc3Q/OiBhbnlbXSB8IE9ic2VydmFibGU8YW55W10+O1xuICAgIG1hc2s/OiBzdHJpbmc7XG4gICAgbWFza0NvbmZpZz86IFBhcnRpYWw8SUNvbmZpZz47XG4gICAgbWF4PzogbnVtYmVyIHwgc3RyaW5nIHwgRGF0ZTtcbiAgICBtaW4/OiBudW1iZXIgfCBzdHJpbmcgfCBEYXRlO1xuICAgIG11bHRpcGxlPzogYm9vbGVhbjtcbiAgICBwYXR0ZXJuPzogc3RyaW5nO1xuICAgIHN0ZXA/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBEeW5hbWljSW5wdXRNb2RlbCBleHRlbmRzIER5bmFtaWNJbnB1dENvbnRyb2xNb2RlbDxzdHJpbmcgfCBudW1iZXIgfCBEYXRlIHwgc3RyaW5nW10+IHtcbiAgICBAc2VyaWFsaXphYmxlKCkgYWNjZXB0OiBzdHJpbmcgfCBudWxsO1xuICAgIEBzZXJpYWxpemFibGUoKSBpbnB1dFR5cGU6IHN0cmluZztcbiAgICBmaWxlczogRmlsZUxpc3QgfCBudWxsID0gbnVsbDtcbiAgICBsaXN0JDogT2JzZXJ2YWJsZTxhbnlbXT4gfCBudWxsID0gbnVsbDtcbiAgICBAc2VyaWFsaXphYmxlKCkgbWFzazogc3RyaW5nO1xuICAgIEBzZXJpYWxpemFibGUoKSBtYXNrQ29uZmlnOiBJQ29uZmlnO1xuICAgIEBzZXJpYWxpemFibGUoKSBtYXg6IG51bWJlciB8IHN0cmluZyB8IERhdGUgfCBudWxsO1xuICAgIEBzZXJpYWxpemFibGUoKSBtaW46IG51bWJlciB8IHN0cmluZyB8IERhdGUgfCBudWxsO1xuICAgIEBzZXJpYWxpemFibGUoKSBtdWx0aXBsZTogYm9vbGVhbiB8IG51bGw7XG4gICAgQHNlcmlhbGl6YWJsZSgpIHBhdHRlcm46IHN0cmluZyB8IG51bGw7XG4gICAgQHNlcmlhbGl6YWJsZSgpIHN0ZXA6IG51bWJlciB8IG51bGw7XG5cbiAgICBAc2VyaWFsaXphYmxlKFwibGlzdFwiKSBwcml2YXRlIF9saXN0OiBhbnlbXSB8IG51bGwgPSBudWxsO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX2xpc3RJZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgICBAc2VyaWFsaXphYmxlKCkgcmVhZG9ubHkgdHlwZTogc3RyaW5nID0gRFlOQU1JQ19GT1JNX0NPTlRST0xfVFlQRV9JTlBVVDtcblxuICAgIGNvbnN0cnVjdG9yKGNvbmZpZzogRHluYW1pY0lucHV0TW9kZWxDb25maWcsIGxheW91dD86IER5bmFtaWNGb3JtQ29udHJvbExheW91dCkge1xuICAgICAgICBzdXBlcihjb25maWcsIGxheW91dCk7XG5cbiAgICAgICAgdGhpcy5hY2NlcHQgPSBjb25maWcuYWNjZXB0ID8/IG51bGw7XG4gICAgICAgIHRoaXMuaW5wdXRUeXBlID0gY29uZmlnLmlucHV0VHlwZSA/PyBEWU5BTUlDX0ZPUk1fQ09OVFJPTF9JTlBVVF9UWVBFX1RFWFQ7XG4gICAgICAgIHRoaXMubWFzayA9IGNvbmZpZy5tYXNrID8/IFwiXCI7XG4gICAgICAgIHRoaXMubWFza0NvbmZpZyA9IGNvbmZpZy5tYXNrQ29uZmlnID8gey4uLmluaXRpYWxDb25maWcsIC4uLmNvbmZpZy5tYXNrQ29uZmlnfSA6IGluaXRpYWxDb25maWc7XG4gICAgICAgIHRoaXMubWF4ID0gY29uZmlnLm1heCAhPT0gdW5kZWZpbmVkID8gY29uZmlnLm1heCA6IG51bGw7XG4gICAgICAgIHRoaXMubWluID0gY29uZmlnLm1pbiAhPT0gdW5kZWZpbmVkID8gY29uZmlnLm1pbiA6IG51bGw7XG4gICAgICAgIHRoaXMubXVsdGlwbGUgPSBpc0Jvb2xlYW4oY29uZmlnLm11bHRpcGxlKSA/IGNvbmZpZy5tdWx0aXBsZSA6IG51bGw7XG4gICAgICAgIHRoaXMucGF0dGVybiA9IGNvbmZpZy5wYXR0ZXJuID8/IG51bGw7XG4gICAgICAgIHRoaXMuc3RlcCA9IGlzTnVtYmVyKGNvbmZpZy5zdGVwKSA/IGNvbmZpZy5zdGVwIDogbnVsbDtcblxuICAgICAgICBpZiAoY29uZmlnLmxpc3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5saXN0ID0gY29uZmlnLmxpc3Q7XG4gICAgICAgICAgICB0aGlzLl9saXN0SWQgPSBgJHt0aGlzLmlkfUxpc3RgO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGxpc3RJZCgpOiBzdHJpbmcgfCBudWxsIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpc3RJZDtcbiAgICB9XG5cbiAgICBnZXQgaGFzTGlzdCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGlzT2JzZXJ2YWJsZSh0aGlzLmxpc3QkKTtcbiAgICB9XG5cbiAgICBzZXQgbGlzdChsaXN0OiBhbnlbXSB8IE9ic2VydmFibGU8YW55W10+IHwgbnVsbCkge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShsaXN0KSkge1xuICAgICAgICAgICAgdGhpcy5fbGlzdCA9IGxpc3Q7XG4gICAgICAgICAgICB0aGlzLmxpc3QkID0gb2YodGhpcy5fbGlzdCk7XG5cbiAgICAgICAgfSBlbHNlIGlmIChpc09ic2VydmFibGUobGlzdCkpIHtcbiAgICAgICAgICAgIHRoaXMubGlzdCQgPSBsaXN0LnBpcGUoXG4gICAgICAgICAgICAgICAgdGFwKF9saXN0ID0+IHRoaXMuX2xpc3QgPSBfbGlzdClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2xpc3QgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5saXN0JCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=