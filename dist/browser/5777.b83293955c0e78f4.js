"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[5777],{90839:(R,m,r)=>{r.d(m,{Q:()=>g});class g{constructor(f,p){this.text=f,this.url=p}}},75777:(R,m,r)=>{r.r(m),r.d(m,{ROUTES:()=>X});var g=r(70379),u=r(7673),f=r(96354),p=r(99437),h=r(10887),e=r(54438),b=r(21626),C=r(7901),a=r(60177);const y=o=>({nodes:o});function _(o,c){1&o&&(e.j41(0,"div",9)(1,"div",10)(2,"span",11),e.EFF(3,"Loading..."),e.k0s()(),e.j41(4,"span",12),e.EFF(5,"Loading repository structure..."),e.k0s()())}function l(o,c){if(1&o&&(e.j41(0,"div",13),e.EFF(1),e.k0s()),2&o){const n=e.XpG();e.R7$(),e.SpI(" ",n.error," ")}}function x(o,c){if(1&o){const n=e.RV6();e.j41(0,"span",24),e.bIt("click",function(i){e.eBV(n);const s=e.XpG().$implicit,d=e.XpG();return e.Njj(d.toggleNode(s,i))}),e.nrm(1,"i",19),e.k0s()}if(2&o){const n=e.XpG().$implicit;e.R7$(),e.Y8G("ngClass",n.expanded?"fa-chevron-down":"fa-chevron-right")}}function T(o,c){1&o&&(e.j41(0,"span",25),e.nrm(1,"i",26),e.k0s())}function v(o,c){1&o&&(e.j41(0,"span",27)(1,"div",28)(2,"span",11),e.EFF(3,"Loading..."),e.k0s()()())}function $(o,c){if(1&o&&(e.j41(0,"div",29)(1,"small",30),e.EFF(2),e.k0s()()),2&o){const n=e.XpG().$implicit,t=e.XpG();e.R7$(2),e.JRh(t.getPaginationInfo(n))}}function O(o,c){1&o&&e.eu8(0)}function k(o,c){if(1&o&&(e.j41(0,"ul",31),e.DNE(1,O,1,0,"ng-container",32),e.k0s()),2&o){const n=e.XpG().$implicit;e.XpG();const t=e.sdS(12);e.R7$(),e.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",e.eq3(2,y,n.children))}}function P(o,c){if(1&o){const n=e.RV6();e.qex(0),e.j41(1,"li",14)(2,"div",15),e.DNE(3,x,2,1,"span",16)(4,T,2,0,"span",17),e.j41(5,"span",18),e.nrm(6,"i",19),e.k0s(),e.j41(7,"span",20),e.bIt("click",function(i){const s=e.eBV(n).$implicit,d=e.XpG();return e.Njj(d.navigateToNode(s,i))}),e.EFF(8),e.k0s(),e.DNE(9,v,4,0,"span",21),e.k0s(),e.DNE(10,$,3,1,"div",22)(11,k,2,4,"ul",23),e.k0s(),e.bVm()}if(2&o){const n=c.$implicit,t=e.XpG();e.R7$(2),e.HbH(t.getNodeClass(n)),e.R7$(),e.Y8G("ngIf","facet"!==n.type||n.children.length>0),e.R7$(),e.Y8G("ngIf","facet"===n.type&&0===n.children.length),e.R7$(2),e.Y8G("ngClass",t.getNodeIcon(n)),e.R7$(2),e.JRh(n.name),e.R7$(),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",n.expanded&&"collection"===n.type),e.R7$(),e.Y8G("ngIf",n.expanded&&n.children.length>0)}}function F(o,c){if(1&o){const n=e.RV6();e.j41(0,"span",24),e.bIt("click",function(i){e.eBV(n);const s=e.XpG().$implicit,d=e.XpG(2);return e.Njj(d.toggleNode(s,i))}),e.nrm(1,"i",19),e.k0s()}if(2&o){const n=e.XpG().$implicit;e.R7$(),e.Y8G("ngClass",n.expanded?"fa-chevron-down":"fa-chevron-right")}}function G(o,c){1&o&&(e.j41(0,"span",25),e.nrm(1,"i",34),e.k0s())}function I(o,c){1&o&&(e.j41(0,"span",27)(1,"div",28)(2,"span",11),e.EFF(3,"Loading..."),e.k0s()()())}function M(o,c){1&o&&e.eu8(0)}function N(o,c){if(1&o&&(e.j41(0,"ul",31),e.DNE(1,M,1,0,"ng-container",32),e.k0s()),2&o){const n=e.XpG().$implicit;e.XpG(2);const t=e.sdS(12);e.R7$(),e.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",e.eq3(2,y,n.children))}}function j(o,c){if(1&o){const n=e.RV6();e.j41(0,"li",14)(1,"div",15),e.DNE(2,F,2,1,"span",16)(3,G,2,0,"span",17),e.j41(4,"span",18),e.nrm(5,"i",19),e.k0s(),e.j41(6,"span",20),e.bIt("click",function(i){const s=e.eBV(n).$implicit,d=e.XpG(2);return e.Njj(d.navigateToNode(s,i))}),e.EFF(7),e.k0s(),e.DNE(8,I,4,0,"span",21),e.k0s(),e.DNE(9,N,2,4,"ul",23),e.k0s()}if(2&o){const n=c.$implicit,t=e.XpG(2);e.R7$(),e.HbH(t.getNodeClass(n)),e.R7$(),e.Y8G("ngIf","facet"!==n.type||n.children.length>0),e.R7$(),e.Y8G("ngIf","facet"===n.type&&0===n.children.length),e.R7$(2),e.Y8G("ngClass",t.getNodeIcon(n)),e.R7$(2),e.JRh(n.name),e.R7$(),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",n.expanded&&n.children.length>0)}}function E(o,c){if(1&o&&e.DNE(0,j,10,8,"li",33),2&o){const n=c.nodes,t=e.XpG();e.Y8G("ngForOf",n)("ngForTrackBy",t.trackByNodeId)}}const X=[{path:"",component:(()=>{class o{constructor(n,t,i){this.http=n,this.cdr=t,this.router=i,this.treeNodes=[],this.loading=!0,this.error=null,this.baseUrl=`${h.$}/server/api`,this.defaultPageSize=20}ngOnInit(){this.loadRepositoryStructure()}loadRepositoryStructure(){this.loading=!0,this.cdr.detectChanges(),this.http.get(`${this.baseUrl}/core/communities/search/top?page=0&size=20&sort=dc.title,ASC&embed.size=subcommunities=20&embed=subcommunities&embed.size=collections=20&embed=collections`).pipe((0,f.T)(t=>t._embedded&&t._embedded.communities?this.parseCommunitiesResponse(t._embedded.communities):[]),(0,p.W)(t=>(this.error=`Error loading repository structure: ${t.message}`,this.loading=!1,this.cdr.detectChanges(),(0,u.of)([])))).subscribe(t=>{this.treeNodes=t,this.loading=!1,this.cdr.detectChanges()})}parseCommunitiesResponse(n){return n.map(t=>{const i={id:t.id,uuid:t.uuid,name:t.name,handle:t.handle,type:"community",expanded:!1,loading:!1,children:[]};return t._embedded&&t._embedded.subcommunities&&t._embedded.subcommunities._embedded&&t._embedded.subcommunities._embedded.subcommunities&&i.children.push(...this.parseSubcommunitiesResponse(t._embedded.subcommunities._embedded.subcommunities)),t._embedded&&t._embedded.collections&&t._embedded.collections._embedded&&t._embedded.collections._embedded.collections&&i.children.push(...this.parseCollectionsResponse(t._embedded.collections._embedded.collections)),i})}parseSubcommunitiesResponse(n){return n.map(t=>({id:t.id,uuid:t.uuid,name:t.name,handle:t.handle,type:"subcommunity",expanded:!1,loading:!1,children:[]}))}parseCollectionsResponse(n){return n.map(t=>({id:t.id,uuid:t.uuid,name:t.name,handle:t.handle,type:"collection",expanded:!1,loading:!1,children:[],currentPage:0,totalPages:0,totalElements:0,pageSize:this.defaultPageSize,hasMoreItems:!1}))}toggleNode(n,t){t.stopPropagation(),n.expanded=!n.expanded,"subcommunity"===n.type&&n.expanded&&0===n.children.length&&this.loadSubcommunityChildren(n),"collection"===n.type&&n.expanded&&0===n.children.length&&this.loadCollectionFacets(n)}loadSubcommunityChildren(n){n.loading=!0,this.cdr.detectChanges(),this.http.get(`${this.baseUrl}/core/communities/${n.id}?embed.size=collections=20&embed=collections&embed.size=subcommunities=20&embed=subcommunities`).pipe((0,p.W)(i=>(console.error(`Error loading subcommunity children: ${i.message}`),n.loading=!1,this.cdr.detectChanges(),(0,u.of)(null)))).subscribe(i=>{i&&i._embedded&&(i._embedded.subcommunities&&i._embedded.subcommunities._embedded&&i._embedded.subcommunities._embedded.subcommunities&&n.children.push(...this.parseSubcommunitiesResponse(i._embedded.subcommunities._embedded.subcommunities)),i._embedded.collections&&i._embedded.collections._embedded&&i._embedded.collections._embedded.collections&&n.children.push(...this.parseCollectionsResponse(i._embedded.collections._embedded.collections))),n.loading=!1,this.cdr.detectChanges()})}loadCollectionFacets(n){n.loading=!0,this.cdr.detectChanges(),this.http.get(`${this.baseUrl}/discover/search/objects?dsoType=item&scope=${n.uuid}`).pipe((0,p.W)(i=>(console.error(`Error loading collection facets: ${i.message}`),n.loading=!1,this.cdr.detectChanges(),(0,u.of)(null)))).subscribe(i=>{i&&i._embedded&&i._embedded.facets&&this.parseFacetsResponse(i._embedded.facets,n),n.loading=!1,this.cdr.detectChanges()})}parseFacetsResponse(n,t){const i=n.find(s=>"dc_case_type"===s.name);i&&i._embedded&&i._embedded.values&&i._embedded.values.length>0&&i._embedded.values.forEach((s,d)=>{t.children.push({id:`${t.id}_case_type_${d}`,uuid:`${t.uuid}_case_type_${d}`,name:`${s.label} (${s.count})`,handle:t.uuid,type:"facet",expanded:!1,loading:!1,children:[],count:s.count,facetType:"dc_case_type",searchLink:s._links?.search?.href})})}getNodeIcon(n){switch(n.type){case"community":case"subcommunity":return n.expanded?"fa-folder-open":"fa-folder";case"collection":return"fa-archive";case"facet":return"fa-tag";default:return"fa-circle"}}getNodeClass(n){return`node-${n.type}`}getPaginationInfo(n){return"collection"===n.type&&n.children.length>0?`Case types: ${n.children.length}`:""}trackByNodeId(n,t){return t.id}refreshView(){this.cdr.detectChanges()}navigateToNode(n,t){switch(t.stopPropagation(),n.type){case"community":case"subcommunity":this.router.navigate(["/communities",n.uuid]);break;case"collection":this.router.navigate(["/collections",n.uuid]);break;case"facet":if("dc_case_type"===n.facetType){const i=n.name.split(" (")[0],s=n.handle;if(s){const d=`http://localhost:4000/collections/${s}?f.dc_case_type=${encodeURIComponent(i)},equals&spc.page=1`;window.location.href=d}}}}static{this.\u0275fac=function(t){return new(t||o)(e.rXU(b.Qq),e.rXU(e.gRc),e.rXU(C.Ix))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-tree-view"]],decls:13,vars:4,consts:[["recursiveTreeNode",""],[1,"repository-tree-container","container"],[1,"header-section"],[1,"btn","btn-sm","btn-secondary",3,"click"],["class","loading-indicator",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"tree-view"],[1,"tree-root"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"loading-indicator"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"loading-text"],[1,"alert","alert-danger"],[1,"tree-node"],[1,"node-content"],["class","toggle-icon",3,"click",4,"ngIf"],["class","toggle-icon",4,"ngIf"],[1,"node-icon"],[1,"fa",3,"ngClass"],[1,"node-name",3,"click"],["class","node-loading-inline",4,"ngIf"],["class","pagination-info",4,"ngIf"],["class","tree-children",4,"ngIf"],[1,"toggle-icon",3,"click"],[1,"toggle-icon"],[1,"fa","fa-circle-o"],[1,"node-loading-inline"],["role","status",1,"spinner-border","spinner-border-sm"],[1,"pagination-info"],[1,"text-muted"],[1,"tree-children"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","tree-node",4,"ngFor","ngForOf","ngForTrackBy"],[1,"fa","fa-tag"]],template:function(t,i){if(1&t){const s=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"h2"),e.EFF(3,"List of Communities"),e.k0s(),e.j41(4,"button",3),e.bIt("click",function(){return e.eBV(s),e.Njj(i.refreshView())}),e.EFF(5,"Refresh View"),e.k0s()(),e.DNE(6,_,6,0,"div",4)(7,l,2,1,"div",5),e.j41(8,"div",6)(9,"ul",7),e.DNE(10,P,12,9,"ng-container",8),e.k0s()()(),e.DNE(11,E,1,2,"ng-template",null,0,e.C5r)}2&t&&(e.R7$(6),e.Y8G("ngIf",i.loading),e.R7$(),e.Y8G("ngIf",i.error),e.R7$(3),e.Y8G("ngForOf",i.treeNodes)("ngForTrackBy",i.trackByNodeId))},dependencies:[a.YU,a.Sq,a.bT,a.T3],styles:[".repository-tree-container[_ngcontent-%COMP%]{padding:20px 0;font-family:Arial,sans-serif;max-width:1200px;margin:0 auto}.repository-tree-container[_ngcontent-%COMP%]{margin-left:15px;margin-right:15px}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.tree-view[_ngcontent-%COMP%]{margin-top:20px}.tree-root[_ngcontent-%COMP%], .tree-children[_ngcontent-%COMP%]{list-style-type:none;padding-left:0}.tree-children[_ngcontent-%COMP%]{padding-left:20px;margin-top:5px}.tree-node[_ngcontent-%COMP%]{margin:5px 0}.node-content[_ngcontent-%COMP%]{display:flex;align-items:center;padding:5px;border-radius:4px}.node-content[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.toggle-icon[_ngcontent-%COMP%]{width:20px;text-align:center;cursor:pointer}.node-icon[_ngcontent-%COMP%]{margin-right:8px;width:20px;text-align:center}.node-name[_ngcontent-%COMP%]{flex-grow:1;cursor:pointer;color:#0056b3}.node-name[_ngcontent-%COMP%]:hover{text-decoration:underline}.node-loading-inline[_ngcontent-%COMP%]{margin-left:10px}.node-community[_ngcontent-%COMP%]{font-weight:700}.node-subcommunity[_ngcontent-%COMP%]{font-weight:700;color:#2c5282}.node-collection[_ngcontent-%COMP%]{color:#2b6cb0}.node-item[_ngcontent-%COMP%]{color:#4a5568;font-size:.95em}.loading-indicator[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:40px 0}.loading-indicator[_ngcontent-%COMP%]   .loading-text[_ngcontent-%COMP%]{margin-top:10px;color:#6c757d}.pagination-info[_ngcontent-%COMP%]{margin-left:40px;margin-top:5px;margin-bottom:10px}.load-more-container[_ngcontent-%COMP%]{margin:10px 0;padding-left:40px}.load-more-btn[_ngcontent-%COMP%]{display:flex;align-items:center}.load-more-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.spinner-border[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spinner-border .75s linear infinite}@keyframes _ngcontent-%COMP%_spinner-border{to{transform:rotate(360deg)}}@media (max-width: 768px){.repository-tree-container[_ngcontent-%COMP%]{padding:10px}.tree-children[_ngcontent-%COMP%]{padding-left:15px}.pagination-info[_ngcontent-%COMP%]{margin-left:30px}.load-more-container[_ngcontent-%COMP%]{padding-left:30px}}"]})}}return o})(),pathMatch:"full",resolve:{breadcrumb:g.S},data:{title:"communityList.tabTitle",breadcrumbKey:"communityList"}}]},70379:(R,m,r)=>{r.d(m,{S:()=>C});var g=r(54438),u=r(82777),f=r(30506),p=r(7673),h=r(90839);let b=(()=>{class a{getBreadcrumbs(_,l){return(0,p.of)([new h.Q(_+".breadcrumbs",l)])}static{this.\u0275fac=function(l){return new(l||a)}}static{this.\u0275prov=g.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();const C=(a,y,_=(0,g.WQX)(b))=>{const l=a.data.breadcrumbKey;if((0,u.Tn)(l))throw new Error('You provided an i18nBreadcrumbResolver for url "'+a.url+"\" but no breadcrumbKey in the route's data");return{provider:_,key:l,url:(0,f.F)(a)}}}}]);