"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[5535],{89147:(Q,P,r)=>{r.d(P,{r:()=>c});var C=r(84572),R=r(96354),e=r(25558),$=r(82777),E=r(8917),A=r(98926),B=r(1676),S=r(80183),k=r(45663),F=r(54438),u=r(7901);let c=(()=>{class f{constructor(d,m,h,y){this._window=d,this.configurationService=m,this.researcherProfileService=h,this.router=y}isLinkedToOrcid(d){return d.hasMetadata("dspace.orcid.authenticated")}onlyAdminCanDisconnectProfileFromOrcid(){return this.getOrcidDisconnectionAllowedUsersConfiguration().pipe((0,R.T)(d=>d.hasSucceeded&&d.payload.values.map(m=>m.toLowerCase()).includes("only_admin")))}ownerCanDisconnectProfileFromOrcid(){return this.getOrcidDisconnectionAllowedUsersConfiguration().pipe((0,R.T)(d=>d.hasSucceeded&&d.payload.values.map(m=>m.toLowerCase()).includes("admin_and_owner")))}linkOrcidByItem(d,m){const h=[{path:"/orcid",op:"add",value:m}];return this.researcherProfileService.findById(d.firstMetadata("dspace.object.owner").authority).pipe((0,S.qD)(),(0,e.n)(y=>this.researcherProfileService.patch(y.payload,h)))}unlinkOrcidByItem(d){const m=[{path:"/orcid",op:"remove"}];return this.researcherProfileService.findById(d.firstMetadata("dspace.object.owner").authority).pipe((0,S.qD)(),(0,e.n)(h=>this.researcherProfileService.patch(h.payload,m)))}getOrcidAuthorizeUrl(d){return(0,C.z)([this.configurationService.findByPropertyName("orcid.authorize-url").pipe((0,S.ak)()),this.configurationService.findByPropertyName("orcid.application-client-id").pipe((0,S.ak)()),this.configurationService.findByPropertyName("orcid.scope").pipe((0,S.ak)())]).pipe((0,R.T)(([m,h,y])=>{const _=new k.t(this._window.nativeWindow.origin,encodeURIComponent(this.router.url.split("?")[0]));return m.values[0]+"?client_id="+h.values[0]+"&redirect_uri="+_+"&response_type=code&scope="+y.values.join(" ")}))}getOrcidAuthorizationScopesByItem(d){return(0,$.hj)(d)?d.allMetadataValues("dspace.orcid.scope"):[]}getOrcidAuthorizationScopes(){return this.configurationService.findByPropertyName("orcid.scope").pipe((0,S.qD)(),(0,R.T)(d=>d.hasSucceeded?d.payload.values:[]))}getOrcidDisconnectionAllowedUsersConfiguration(){return this.configurationService.findByPropertyName("orcid.disconnection.allowed-users").pipe((0,S.qD)())}static{this.\u0275fac=function(m){return new(m||f)(F.KVO(B.lc),F.KVO(E.ConfigurationDataService),F.KVO(A.ResearcherProfileDataService),F.KVO(u.Ix))}}static{this.\u0275prov=F.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})()},95535:(Q,P,r)=>{r.r(P),r.d(P,{ROUTES:()=>Kt});var C=r(69799),R=r(49347),e=r(54438),$=r(56273),E=r(29326),A=r(70025),B=r(67045),k=r(85021),F=r(34237),u=r(60177),c=r(89417),f=r(7901),g=r(41780),d=r(84572),m=r(7673),h=r(96354),y=r(5964),_=r(25558),T=r(96697),O=r(67116),M=r(96526),X=r(42578),z=r(65007),x=r(3970),oe=r(11122),ae=r(52920),v=r(80183),H=r(60456),b=r(82777),U=r(39806),D=r(90887);function ce(s,a){if(1&s&&(e.j41(0,"div",28)(1,"span"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"a",3),e.EFF(5),e.nI1(6,"translate"),e.k0s()()),2&s){const t=e.XpG();e.R7$(2),e.JRh(e.bMT(3,3,"bitstream-request-a-copy.alert.canDownload1")),e.R7$(2),e.Y8G("routerLink",t.getBitstreamLink()),e.R7$(),e.JRh(e.bMT(6,5,"bitstream-request-a-copy.alert.canDownload2"))}}function le(s,a){if(1&s&&(e.j41(0,"p"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Lme("",e.bMT(2,2,"bitstream-request-a-copy.intro.bitstream.one")," ",t.bitstreamName,"")}}function de(s,a){1&s&&(e.j41(0,"p"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"bitstream-request-a-copy.intro.bitstream.all")))}function ue(s,a){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"bitstream-request-a-copy.name.error")," "))}function pe(s,a){if(1&s&&(e.j41(0,"div",29),e.DNE(1,ue,3,3,"span",4),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.name.errors&&t.name.errors.required)}}function me(s,a){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"bitstream-request-a-copy.email.error")," "))}function he(s,a){if(1&s&&(e.j41(0,"div",29),e.DNE(1,me,3,3,"span",4),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.email.errors)}}let ge=(()=>{class s{constructor(t,n,i,o,l,p,G,W,K,Qt,Ht){this.location=t,this.translateService=n,this.route=i,this.router=o,this.authorizationService=l,this.auth=p,this.formBuilder=G,this.itemRequestDataService=W,this.notificationsService=K,this.dsoNameService=Qt,this.bitstreamService=Ht,this.subs=[]}ngOnInit(){this.requestCopyForm=this.formBuilder.group({name:new c.hs("",{validators:[c.k0.required]}),email:new c.hs("",{validators:[c.k0.required,c.k0.pattern("^[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$")]}),allfiles:new c.hs(""),message:new c.hs("")}),this.item$=this.route.data.pipe((0,h.T)(n=>n.dso),(0,v.ak)()),this.subs.push(this.item$.subscribe(n=>{this.item=n,this.itemName=this.dsoNameService.getName(n)})),this.bitstream$=this.route.queryParams.pipe((0,y.p)(n=>(0,b.a4)(n)&&(0,b.a4)(n.bitstream)),(0,_.n)(n=>this.bitstreamService.findById(n.bitstream)),(0,v.ak)()),this.subs.push(this.bitstream$.subscribe(n=>{this.bitstream=n,this.bitstreamName=this.dsoNameService.getName(n)})),this.canDownload$=this.bitstream$.pipe((0,_.n)(n=>this.authorizationService.isAuthorized(x._.CanDownload,(0,b.hj)(n)?n.self:void 0)));const t=this.bitstream$.pipe((0,_.n)(n=>this.authorizationService.isAuthorized(x._.CanRequestACopy,(0,b.hj)(n)?n.self:void 0)));this.subs.push((0,d.z)([this.canDownload$,t]).subscribe(([n,i])=>{!n&&!i&&this.router.navigateByUrl((0,C.bZ)(),{skipLocationChange:!0})})),this.initValues()}get name(){return this.requestCopyForm.get("name")}get email(){return this.requestCopyForm.get("email")}get message(){return this.requestCopyForm.get("message")}get allfiles(){return this.requestCopyForm.get("allfiles")}initValues(){this.getCurrentUser().pipe((0,T.s)(1)).subscribe(t=>{this.requestCopyForm.patchValue({allfiles:"true"}),(0,b.a4)(t)&&this.requestCopyForm.patchValue({name:t.name,email:t.email})}),this.bitstream$.pipe((0,T.s)(1)).subscribe(t=>{this.requestCopyForm.patchValue({allfiles:"false"})})}getCurrentUser(){return this.auth.isAuthenticated().pipe((0,_.n)(t=>t?this.auth.getAuthenticatedUserFromStore():(0,m.of)(void 0)))}onSubmit(){const t=new ae.b;(0,b.a4)(this.bitstream)&&(t.bitstreamId=this.bitstream.uuid),t.itemId=this.item.uuid,t.allfiles=this.allfiles.value,t.requestEmail=this.email.value,t.requestName=this.name.value,t.requestMessage=this.message.value,this.itemRequestDataService.requestACopy(t).pipe((0,v.qD)()).subscribe(n=>{n.hasSucceeded?(this.notificationsService.success(this.translateService.get("bitstream-request-a-copy.submit.success")),this.navigateBack()):this.notificationsService.error(this.translateService.get("bitstream-request-a-copy.submit.error"))})}ngOnDestroy(){(0,b.a4)(this.subs)&&this.subs.forEach(t=>{(0,b.a4)(t)&&t.unsubscribe()})}navigateBack(){this.location.back()}getItemPath(){return[(0,D._o)(this.item)]}getBitstreamLink(){return[(0,C.hV)(this.bitstream)]}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(u.aZ),e.rXU(g.c$),e.rXU(f.nX),e.rXU(f.Ix),e.rXU(z.AuthorizationDataService),e.rXU(O.uR),e.rXU(c.ze),e.rXU(oe.W),e.rXU(U.I),e.rXU(M.f),e.rXU(X.BitstreamDataService))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-bitstream-request-a-copy-page"]],standalone:!0,features:[e.aNF],decls:64,vars:52,consts:[[1,"container"],[1,"mb-4"],["class","alert alert-success",4,"ngIf"],[3,"routerLink"],[4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"row","mb-4"],[1,"col-12"],["for","name",1,"form-label"],["type","text","id","name","formControlName","name",3,"className"],["class","invalid-feedback show-feedback",4,"ngIf"],["for","email",1,"form-label"],["id","email","formControlName","email",3,"className"],[1,"text-muted","ds-hint"],[1,"ms-4","form-check"],["type","radio","id","allfiles-true","formControlName","allfiles","value","true",3,"className"],["for","allfiles-true",1,"form-check-label"],[1,"ms-4"],["type","radio","id","allfiles-false","formControlName","allfiles","value","false",3,"className"],["for","allfiles-false",1,"form-check-label"],["for","message",1,"form-label"],["rows","5","id","message","formControlName","message",3,"className"],[1,"row"],[1,"col-12","text-end"],["role","button",1,"btn","btn-outline-secondary","me-1",3,"click"],[1,"fas","fa-arrow-left"],[1,"btn","btn-default","btn-primary",3,"click","dsBtnDisabled"],[1,"alert","alert-success"],[1,"invalid-feedback","show-feedback"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"h1",1),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,ce,7,7,"div",2),e.nI1(5,"async"),e.j41(6,"div")(7,"p"),e.EFF(8),e.nI1(9,"translate"),e.j41(10,"a",3),e.EFF(11),e.k0s()(),e.DNE(12,le,3,4,"p",4)(13,de,3,3,"p",4),e.k0s(),e.j41(14,"form",5),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.j41(15,"div",6)(16,"div",7)(17,"div",8)(18,"label",9),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.nrm(21,"input",10),e.DNE(22,pe,2,1,"div",11),e.k0s()(),e.j41(23,"div",7)(24,"div",8)(25,"label",12),e.EFF(26),e.nI1(27,"translate"),e.k0s(),e.nrm(28,"input",13),e.DNE(29,he,2,1,"div",11),e.j41(30,"small",14),e.EFF(31),e.nI1(32,"translate"),e.k0s()()(),e.j41(33,"div",7)(34,"div",8)(35,"div"),e.EFF(36),e.nI1(37,"translate"),e.k0s(),e.j41(38,"div",15),e.nrm(39,"input",16),e.j41(40,"label",17),e.EFF(41),e.nI1(42,"translate"),e.k0s()(),e.j41(43,"div",18),e.nrm(44,"input",19),e.j41(45,"label",20),e.EFF(46),e.nI1(47,"translate"),e.k0s()()()(),e.j41(48,"div",7)(49,"div",8)(50,"label",21),e.EFF(51),e.nI1(52,"translate"),e.k0s(),e.nrm(53,"textarea",22),e.k0s()()()(),e.nrm(54,"hr"),e.j41(55,"div",23)(56,"div",24)(57,"a",25),e.bIt("click",function(){return i.navigateBack()}),e.nrm(58,"i",26),e.EFF(59),e.nI1(60,"translate"),e.k0s(),e.j41(61,"button",27),e.bIt("click",function(){return i.onSubmit()}),e.EFF(62),e.nI1(63,"translate"),e.k0s()()()()),2&n&&(e.R7$(2),e.JRh(e.bMT(3,28,"bitstream-request-a-copy.header")),e.R7$(2),e.Y8G("ngIf",e.bMT(5,30,i.canDownload$)),e.R7$(4),e.SpI("",e.bMT(9,32,"bitstream-request-a-copy.intro")," "),e.R7$(2),e.Y8G("routerLink",i.getItemPath()),e.R7$(),e.JRh(i.itemName),e.R7$(),e.Y8G("ngIf",void 0!==i.bitstream&&"false"===i.allfiles.value),e.R7$(),e.Y8G("ngIf","true"===i.allfiles.value),e.R7$(),e.HbH("ng-invalid"),e.Y8G("formGroup",i.requestCopyForm),e.R7$(5),e.JRh(e.bMT(20,34,"bitstream-request-a-copy.name.label")),e.R7$(2),e.Y8G("className",i.name.invalid&&(i.name.dirty||i.name.touched)?"form-control is-invalid":"form-control"),e.R7$(),e.Y8G("ngIf",i.name.invalid&&(i.name.dirty||i.name.touched)),e.R7$(4),e.JRh(e.bMT(27,36,"bitstream-request-a-copy.email.label")),e.R7$(2),e.Y8G("className",i.email.invalid&&(i.email.dirty||i.email.touched)?"form-control is-invalid":"form-control"),e.R7$(),e.Y8G("ngIf",i.email.invalid&&(i.email.dirty||i.email.touched)),e.R7$(2),e.JRh(e.bMT(32,38,"bitstream-request-a-copy.email.hint")),e.R7$(5),e.JRh(e.bMT(37,40,"bitstream-request-a-copy.allfiles.label")),e.R7$(3),e.Y8G("className","form-check-input"),e.R7$(2),e.JRh(e.bMT(42,42,"bitstream-request-a-copy.files-all-true.label")),e.R7$(3),e.Y8G("className","form-check-input"),e.BMQ("disabled",void 0===i.bitstream||null),e.R7$(2),e.JRh(e.bMT(47,44,"bitstream-request-a-copy.files-all-false.label")),e.R7$(5),e.JRh(e.bMT(52,46,"bitstream-request-a-copy.message.label")),e.R7$(2),e.Y8G("className","form-control"),e.R7$(6),e.SpI(" ",e.bMT(60,48,"bitstream-request-a-copy.return")," "),e.R7$(2),e.Y8G("dsBtnDisabled",i.requestCopyForm.invalid),e.R7$(),e.JRh(e.bMT(63,50,"bitstream-request-a-copy.submit")))},dependencies:[g.h,g.D9,f.Wk,u.Jj,c.X1,c.qT,c.me,c.Fm,c.BC,c.cb,c.j4,c.JD,u.bT,H.A],encapsulation:2})}}return s})();var q=r(88280),fe=r(81443),ve=r(32473),Z=r(70673),be=r(78448),_e=r(7581),ye=r(17191),Ie=r(46301),Ce=r(56386),Oe=r(14412);const Se=s=>({"is-invalid":s}),Te=()=>({standalone:!0}),Re=s=>({show:s});function Fe(s,a){if(1&s){const t=e.RV6();e.j41(0,"div")(1,"button",9,2),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.onClickSuggestion(i))}),e.nrm(3,"ds-listable-object-component-loader",10),e.k0s()()}if(2&s){const t=a.$implicit,n=e.XpG();e.R7$(3),e.Y8G("object",t)("viewMode",n.viewMode)("linkType",n.linkTypes.None)}}let Me=(()=>{class s extends Oe.t{constructor(t){super(),this.dsoNameService=t,this.viewMode=be.n.ListElement,this.linkTypes=_e.n,this.suggestions=[]}onSubmit(t){(0,b.a4)(t)&&(this.value=this.dsoNameService.getName(t),this.currentObject=t,this.submitSuggestion.emit(t))}onClickSuggestion(t){return this.value=this.dsoNameService.getName(t),this.currentObject=t,this.clickSuggestion.emit(t),this.close(),this.blockReopen=!0,this.queryInput.nativeElement.focus(),!1}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(M.f))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-dso-input-suggestions"]],inputs:{suggestions:"suggestions"},standalone:!0,features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3,e.aNF],decls:11,vars:19,consts:[["form","ngForm"],["inputField",""],["suggestion",""],[3,"ngSubmit","keydown.arrowdown","keydown.arrowup","keydown.esc","dsClickOutside","action"],["type","text","autocomplete","off",1,"form-control","suggestion_input","mb-2",3,"ngModelChange","onDebounce","ngModel","name","ngClass","dsDebounce","placeholder","ngModelOptions"],["type","submit",1,"sr-only"],[1,"autocomplete","dropdown-menu",3,"ngClass"],[1,"dropdown-list"],[4,"ngFor","ngForOf"],[1,"d-block","dropdown-item",3,"click"],[3,"object","viewMode","linkType"]],template:function(n,i){if(1&n){const o=e.RV6();e.j41(0,"form",3,0),e.bIt("ngSubmit",function(){return e.eBV(o),e.Njj(i.onSubmit(i.currentObject))})("keydown.arrowdown",function(p){return e.eBV(o),e.Njj(i.shiftFocusDown(p))})("keydown.arrowup",function(p){return e.eBV(o),e.Njj(i.shiftFocusUp(p))})("keydown.esc",function(){return e.eBV(o),e.Njj(i.close())})("dsClickOutside",function(){return e.eBV(o),e.Njj(i.close())}),e.j41(2,"input",4,1),e.mxI("ngModelChange",function(p){return e.eBV(o),e.DH7(i.value,p)||(i.value=p),e.Njj(p)}),e.bIt("onDebounce",function(p){return e.eBV(o),e.Njj(i.find(p))}),e.k0s(),e.j41(4,"button",5),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"div",6),e.nI1(8,"async"),e.j41(9,"div",7),e.DNE(10,Fe,4,3,"div",8),e.k0s()()()}2&n&&(e.Y8G("action",i.action,e.B4B),e.R7$(2),e.R50("ngModel",i.value),e.Y8G("name",i.name)("ngClass",e.eq3(14,Se,!i.valid))("dsDebounce",i.debounceTime)("placeholder",i.placeholder)("ngModelOptions",e.lJ4(16,Te)),e.R7$(3),e.SpI(" ",e.bMT(6,10,"search.filters.search.submit")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(17,Re,e.bMT(8,12,i.show)&&i.isNotEmpty(i.suggestions))),e.R7$(3),e.Y8G("ngForOf",i.suggestions))},dependencies:[c.YN,c.qT,c.me,c.BC,c.cb,c.vS,c.cV,Ie.z,Ce.R,u.YU,u.pM,ye.v,u.Jj,g.h,g.D9],styles:[".autocomplete[_ngcontent-%COMP%]{width:100%}.autocomplete[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]{white-space:normal;word-break:break-word;padding:var(--bs-input-padding-y) var(--bs-input-padding-x)}.autocomplete[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]:focus{outline:none}form[_ngcontent-%COMP%]{position:relative}"]})}}return s})();var ee=r(43095),Ee=r(32979),De=r(18226);function Pe(s,a){if(1&s&&(e.j41(0,"div")(1,"span",12),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&s){const t=e.XpG().ngVar,n=e.XpG(2);e.R7$(2),e.JRh(e.bMT(3,2,"item.bitstreams.upload.item")),e.R7$(3),e.JRh(n.dsoNameService.getName(t))}}function ke(s,a){if(1&s&&(e.qex(0),e.DNE(1,Pe,6,4,"div",2),e.bVm()),2&s){const t=a.ngVar;e.R7$(),e.Y8G("ngIf",t)}}function je(s,a){if(1&s){const t=e.RV6();e.j41(0,"button",13),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.createBundle())}),e.nrm(1,"i",14),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"item.bitstreams.upload.bundle.new")," "))}function $e(s,a){if(1&s){const t=e.RV6();e.j41(0,"ds-uploader",15),e.bIt("onCompleteItem",function(i){e.eBV(t);const o=e.XpG(2);return e.Njj(o.onCompleteItem(i))})("onUploadError",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onUploadError())}),e.k0s()}if(2&s){const t=e.XpG(2);e.Y8G("dropMsg","item.bitstreams.upload.drop-message")("dropOverDocumentMsg","item.bitstreams.upload.drop-message")("enableDragOverDocument",!0)("uploadFilesOptions",t.uploadFilesOptions)}}function Ae(s,a){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"div",3)(2,"div",4)(3,"h1"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.DNE(6,ke,2,1,"ng-container",5),e.nI1(7,"async"),e.k0s(),e.j41(8,"div",6)(9,"label",7),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"ds-dso-input-suggestions",8,0),e.nI1(14,"translate"),e.mxI("ngModelChange",function(i){e.eBV(t);const o=e.XpG();return e.DH7(o.selectedBundleName,i)||(o.selectedBundleName=i),e.Njj(i)}),e.bIt("typeSuggestion",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.bundleNameChange())})("clickSuggestion",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.onClick(i))})("click",function(){e.eBV(t);const i=e.sdS(13);return e.Njj(i.open())}),e.k0s(),e.DNE(15,je,4,3,"button",9)(16,$e,1,4,"ds-uploader",10),e.j41(17,"button",11),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onCancel())}),e.EFF(18),e.nI1(19,"translate"),e.k0s()()(),e.bVm()}if(2&s){let t;const n=e.XpG();e.R7$(4),e.JRh(e.bMT(5,12,"item.bitstreams.upload.title")),e.R7$(2),e.Y8G("ngVar",null==(t=e.bMT(7,14,n.itemRD$))?null:t.payload),e.R7$(4),e.JRh(e.bMT(11,16,"item.bitstreams.upload.bundle")),e.R7$(2),e.Y8G("suggestions",n.bundles)("placeholder",e.bMT(14,18,"item.bitstreams.upload.bundle.placeholder"))("action",n.getCurrentUrl())("name","bundle-select")("debounceTime",50),e.R50("ngModel",n.selectedBundleName),e.R7$(3),e.Y8G("ngIf",!n.selectedBundleId&&(null==n.selectedBundleName?null:n.selectedBundleName.length)>0),e.R7$(),e.Y8G("ngIf",n.selectedBundleId),e.R7$(2),e.JRh(e.bMT(19,20,"item.bitstreams.upload.cancel"))}}let Be=(()=>{class s{constructor(t,n,i,o,l,p,G,W,K){this.route=t,this.router=n,this.itemService=i,this.bundleService=o,this.authService=l,this.notificationsService=p,this.translate=G,this.requestService=W,this.dsoNameService=K,this.bundles=[],this.uploadFilesOptions=Object.assign(new Ee.H,{url:"placeholder",authToken:null,disableMultipart:!1,itemAlias:null}),this.NOTIFICATIONS_PREFIX="item.bitstreams.upload.notifications.",this.subs=[]}ngOnInit(){this.itemId=this.route.snapshot.params.id,this.entityType=this.route.snapshot.params["entity-type"],this.itemRD$=this.route.data.pipe((0,h.T)(n=>n.dso));const t=this.itemService.getBundles(this.itemId).pipe((0,v.qD)(),(0,_.n)(n=>{if(n.hasSucceeded){if(n.payload.page){this.bundles=n.payload.page;for(const i of q.c.bundle.standardBundles){let o=!0;n.payload.page.forEach(l=>{i===l.name&&(o=!1)}),o&&this.bundles.push(Object.assign(new Z.N,{_name:i,type:"bundle"}))}}else this.bundles=q.c.bundle.standardBundles.map(i=>Object.assign(new Z.N,{_name:i,type:"bundle"}));return(0,m.of)(n.payload.page)}}));this.selectedBundleId=this.route.snapshot.queryParams.bundle,(0,b.hj)(this.selectedBundleId)&&(this.subs.push(this.bundleService.findById(this.selectedBundleId).pipe((0,v.ak)()).subscribe(n=>{this.selectedBundleName=n.name})),this.setUploadUrl()),this.subs.push(t.subscribe())}createBundle(){this.itemService.createBundle(this.itemId,this.selectedBundleName).pipe((0,v.ak)()).subscribe(t=>{this.selectedBundleId=t.id,this.notificationsService.success(this.translate.instant(this.NOTIFICATIONS_PREFIX+"bundle.created.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"bundle.created.content")),this.setUploadUrl()})}bundleNameChange(){this.selectedBundleId=void 0;for(const t of this.bundles)if(this.selectedBundleName===t.name){this.selectedBundleId=t.id;break}}setUploadUrl(){this.bundleService.getBitstreamsEndpoint(this.selectedBundleId).pipe((0,T.s)(1)).subscribe(t=>{this.uploadFilesOptions.url=t,(0,b.Im)(this.uploadFilesOptions.authToken)&&(this.uploadFilesOptions.authToken=this.authService.buildAuthHeader()),this.uploaderComponent&&(this.uploaderComponent.ngOnInit(),this.uploaderComponent.ngAfterViewInit())})}onCompleteItem(t){this.bundleService.getBitstreamsEndpoint(this.selectedBundleId).pipe((0,T.s)(1)).subscribe(i=>{this.requestService.removeByHrefSubstring(i)});const n={itemId:this.itemId,entityType:this.entityType};this.router.navigate([(0,C.dF)(),t.id,"edit"],{queryParams:n})}onUploadError(){this.notificationsService.error(null,this.translate.get(this.NOTIFICATIONS_PREFIX+"upload.failed"))}onClick(t){this.selectedBundleId=t.id,this.selectedBundleName=t.name,t.id&&this.setUploadUrl()}onCancel(){this.router.navigate([(0,D.DL)(this.entityType,this.itemId),"bitstreams"])}getCurrentUrl(){return this.router.url}ngOnDestroy(){this.subs.filter(t=>(0,b.a4)(t)).forEach(t=>t.unsubscribe())}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(f.nX),e.rXU(f.Ix),e.rXU(E.ItemDataService),e.rXU(fe.BundleDataService),e.rXU(O.uR),e.rXU(U.I),e.rXU(g.c$),e.rXU(ve.B),e.rXU(M.f))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-upload-bitstream"]],viewQuery:function(n,i){if(1&n&&e.GBs(ee.y,5),2&n){let o;e.mGM(o=e.lsd())&&(i.uploaderComponent=o.first)}},standalone:!0,features:[e.aNF],decls:2,vars:1,consts:[["f",""],[1,"container"],[4,"ngIf"],[1,"row"],[1,"col-12","mb-2"],[4,"ngVar"],[1,"col-12"],[1,"fw-bold","form-label"],["id","search-form","ngDefaultControl","",3,"ngModelChange","typeSuggestion","clickSuggestion","click","suggestions","placeholder","action","name","debounceTime","ngModel"],["class","btn btn-success me-2",3,"click",4,"ngIf"],["class","w-100",3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","uploadFilesOptions","onCompleteItem","onUploadError",4,"ngIf"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fw-bold"],[1,"btn","btn-success","me-2",3,"click"],[1,"fa","fa-plus"],[1,"w-100",3,"onCompleteItem","onUploadError","dropMsg","dropOverDocumentMsg","enableDragOverDocument","uploadFilesOptions"]],template:function(n,i){1&n&&(e.j41(0,"div",1),e.DNE(1,Ae,20,22,"ng-container",2),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngIf",i.bundles))},dependencies:[g.h,g.D9,u.Jj,De.r,u.bT,Me,c.YN,c.me,c.BC,c.vS,ee.y],encapsulation:2})}}return s})();var xe=r(10870),te=r(35925),I=r(84412),L=r(89147),w=r(308),V=r(16292),Y=r(47978),ne=r(82394),j=r(99437),Ue=r(1676),J=(r(88318),r(43404));function Ne(s,a){1&s&&e.eu8(0)}function Ge(s,a){if(1&s&&(e.j41(0,"li",19),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=a.$implicit,n=e.XpG(3);e.R7$(),e.SpI(" ",e.bMT(2,1,n.getAuthorizationDescription(t))," ")}}function Xe(s,a){if(1&s&&(e.j41(0,"div",16)(1,"div",8)(2,"div",9),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"div",10)(6,"div",17)(7,"ul"),e.DNE(8,Ge,3,3,"li",18),e.nI1(9,"async"),e.k0s()()()()()),2&s){const t=e.XpG(2);e.R7$(3),e.JRh(e.bMT(4,2,"person.page.orcid.granted-authorizations")),e.R7$(5),e.Y8G("ngForOf",e.bMT(9,4,t.getOrcidAuthorizations()))}}function ze(s,a){1&s&&(e.j41(0,"ds-alert",20),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.Y8G("type","alert-success"),e.R7$(),e.SpI(" ",e.bMT(2,2,"person.page.orcid.no-missing-authorizations-message")," "))}function Ve(s,a){if(1&s&&(e.j41(0,"li",23),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=a.$implicit,n=e.XpG(3);e.R7$(),e.SpI(" ",e.bMT(2,1,n.getAuthorizationDescription(t))," ")}}function Le(s,a){if(1&s&&(e.j41(0,"ds-alert",21),e.EFF(1),e.nI1(2,"translate"),e.j41(3,"ul"),e.DNE(4,Ve,3,3,"li",22),e.nI1(5,"async"),e.k0s()()),2&s){const t=e.XpG(2);e.Y8G("type","alert-warning"),e.R7$(),e.SpI(" ",e.bMT(2,3,"person.page.orcid.missing-authorizations-message")," "),e.R7$(3),e.Y8G("ngForOf",e.bMT(5,5,t.getMissingOrcidAuthorizations()))}}function we(s,a){1&s&&(e.j41(0,"ds-alert",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.Y8G("type","alert-warning"),e.R7$(),e.SpI(" ",e.bMT(2,2,"person.page.orcid.remove-orcid-message")," "))}function Ye(s,a){1&s&&(e.j41(0,"span"),e.nrm(1,"i",30),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"person.page.orcid.unlink"),""))}function Je(s,a){1&s&&(e.j41(0,"span"),e.nrm(1,"i",31),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"person.page.orcid.unlink.processing"),""))}function We(s,a){if(1&s){const t=e.RV6();e.j41(0,"button",32),e.bIt("click",function(){e.eBV(t);const i=e.XpG(3);return e.Njj(i.linkOrcid())}),e.j41(1,"span"),e.nrm(2,"i",33),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}2&s&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"person.page.orcid.grant-authorizations"),""))}function Ke(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",25)(1,"div",26)(2,"button",27),e.nI1(3,"async"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.unlinkOrcid())}),e.DNE(4,Ye,4,3,"span",28),e.nI1(5,"async"),e.DNE(6,Je,4,3,"span",28),e.nI1(7,"async"),e.k0s(),e.DNE(8,We,5,3,"button",29),e.nI1(9,"async"),e.k0s()()}if(2&s){const t=e.XpG(2);e.R7$(2),e.Y8G("dsBtnDisabled",e.bMT(3,4,t.unlinkProcessing)),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(5,6,t.unlinkProcessing)),e.R7$(2),e.Y8G("ngIf",e.bMT(7,8,t.unlinkProcessing)),e.R7$(2),e.Y8G("ngIf",e.bMT(9,10,t.hasMissingOrcidAuthorizations()))}}function Qe(s,a){if(1&s&&(e.j41(0,"div",4)(1,"div",5),e.DNE(2,Xe,10,6,"div",6),e.nI1(3,"async"),e.j41(4,"div",7)(5,"div",8)(6,"div",9),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"div",10)(10,"div",11),e.DNE(11,ze,3,4,"ds-alert",12),e.nI1(12,"async"),e.DNE(13,Le,6,7,"ds-alert",13),e.nI1(14,"async"),e.k0s()()()()(),e.DNE(15,we,3,4,"ds-alert",14),e.nI1(16,"async"),e.nI1(17,"async"),e.DNE(18,Ke,10,12,"div",15),e.nI1(19,"async"),e.k0s()),2&s){const t=e.XpG();e.R7$(2),e.Y8G("ngIf",e.bMT(3,6,t.hasOrcidAuthorizations())),e.R7$(5),e.JRh(e.bMT(8,8,"person.page.orcid.missing-authorizations")),e.R7$(4),e.Y8G("ngIf",!0!==e.bMT(12,10,t.hasMissingOrcidAuthorizations())),e.R7$(2),e.Y8G("ngIf",e.bMT(14,12,t.hasMissingOrcidAuthorizations())),e.R7$(2),e.Y8G("ngIf",e.bMT(16,14,t.onlyAdminCanDisconnectProfileFromOrcid())&&!0!==e.bMT(17,16,t.ownerCanDisconnectProfileFromOrcid())),e.R7$(3),e.Y8G("ngIf",e.bMT(19,18,t.ownerCanDisconnectProfileFromOrcid()))}}function He(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",34)(1,"div",5)(2,"div",35),e.nrm(3,"img",36),e.k0s(),e.j41(4,"div",26)(5,"ds-alert",37),e.EFF(6),e.nI1(7,"async"),e.k0s()()(),e.j41(8,"div",5)(9,"div",26)(10,"button",38),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.linkOrcid())}),e.nrm(11,"i",39),e.EFF(12),e.nI1(13,"translate"),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(5),e.Y8G("type","alert-info"),e.R7$(),e.JRh(e.bMT(7,3,t.getOrcidNotLinkedMessage())),e.R7$(6),e.SpI(" ",e.bMT(13,5,"person.page.orcid.link")," ")}}let qe=(()=>{class s{constructor(t,n,i,o){this.orcidAuthService=t,this.translateService=n,this.notificationsService=i,this._window=o,this.profileAuthorizationScopes=new I.t([]),this.missingAuthorizationScopes=new I.t([]),this.orcidAuthorizationScopes=new I.t([]),this.unlinkProcessing=new I.t(!1),this.isOrcidLinked$=new I.t(!1),this.onlyAdminCanDisconnectProfileFromOrcid$=new I.t(!1),this.ownerCanDisconnectProfileFromOrcid$=new I.t(!1),this.unlink=new e.bkB}ngOnInit(){this.orcidAuthService.getOrcidAuthorizationScopes().subscribe(t=>{this.orcidAuthorizationScopes.next(t),this.initOrcidAuthSettings()})}ngOnChanges(t){!t.item.isFirstChange()&&t.item.currentValue!==t.item.previousValue&&this.initOrcidAuthSettings()}hasOrcidAuthorizations(){return this.profileAuthorizationScopes.asObservable().pipe((0,h.T)(t=>t.length>0))}getOrcidAuthorizations(){return this.profileAuthorizationScopes.asObservable()}hasMissingOrcidAuthorizations(){return this.missingAuthorizationScopes.asObservable().pipe((0,h.T)(t=>t.length>0))}getMissingOrcidAuthorizations(){return this.profileAuthorizationScopes.asObservable()}isLinkedToOrcid(){return this.isOrcidLinked$.asObservable()}getOrcidNotLinkedMessage(){const t=this.item.firstMetadataValue("person.identifier.orcid");return t?this.translateService.get("person.page.orcid.orcid-not-linked-message",{orcid:t}):this.translateService.get("person.page.orcid.no-orcid-message")}getAuthorizationDescription(t){return"person.page.orcid.scope."+t.substring(1).replace("/","-")}onlyAdminCanDisconnectProfileFromOrcid(){return this.onlyAdminCanDisconnectProfileFromOrcid$.asObservable()}ownerCanDisconnectProfileFromOrcid(){return this.ownerCanDisconnectProfileFromOrcid$.asObservable()}linkOrcid(){this.orcidAuthService.getOrcidAuthorizeUrl(this.item).subscribe(t=>{this._window.nativeWindow.location.href=t})}unlinkOrcid(){this.unlinkProcessing.next(!0),this.orcidAuthService.unlinkOrcidByItem(this.item).pipe((0,v.qD)(),(0,j.W)(J.V7)).subscribe(t=>{this.unlinkProcessing.next(!1),t.hasFailed?this.notificationsService.error(this.translateService.get("person.page.orcid.unlink.error")):(this.notificationsService.success(this.translateService.get("person.page.orcid.unlink.success")),this.unlink.emit())})}initOrcidAuthSettings(){this.setOrcidAuthorizationsFromItem(),this.setMissingOrcidAuthorizations(),this.orcidAuthService.onlyAdminCanDisconnectProfileFromOrcid().subscribe(t=>{this.onlyAdminCanDisconnectProfileFromOrcid$.next(t)}),this.orcidAuthService.ownerCanDisconnectProfileFromOrcid().subscribe(t=>{this.ownerCanDisconnectProfileFromOrcid$.next(t)}),this.isOrcidLinked$.next(this.orcidAuthService.isLinkedToOrcid(this.item))}setMissingOrcidAuthorizations(){const t=this.orcidAuthService.getOrcidAuthorizationScopesByItem(this.item),i=this.orcidAuthorizationScopes.value.filter(o=>!t.includes(o));this.missingAuthorizationScopes.next(i)}setOrcidAuthorizationsFromItem(){this.profileAuthorizationScopes.next(this.orcidAuthService.getOrcidAuthorizationScopesByItem(this.item))}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(L.r),e.rXU(g.c$),e.rXU(U.I),e.rXU(Ue.lc))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-auth"]],inputs:{item:"item"},outputs:{unlink:"unlink"},standalone:!0,features:[e.OA$,e.aNF],decls:10,vars:8,consts:[["orcidLinked",""],["orcidNotLinked",""],[1,"container","mb-5"],[4,"ngIf","ngIfThen","ngIfElse"],["data-test","orcidLinked"],[1,"row"],["class","col-sm-6 mb-3","data-test","hasOrcidAuthorizations",4,"ngIf"],[1,"col-sm-6","mb-3"],[1,"card","h-100"],[1,"card-header"],[1,"card-body"],[1,"container"],["data-test","noMissingOrcidAuthorizations",3,"type",4,"ngIf"],["data-test","missingOrcidAuthorizations",3,"type",4,"ngIf"],["data-test","unlinkOnlyAdmin",3,"type",4,"ngIf"],["class","row","data-test","unlinkOwner",4,"ngIf"],["data-test","hasOrcidAuthorizations",1,"col-sm-6","mb-3"],[1,"container","p-0"],["data-test","orcidAuthorization",4,"ngFor","ngForOf"],["data-test","orcidAuthorization"],["data-test","noMissingOrcidAuthorizations",3,"type"],["data-test","missingOrcidAuthorizations",3,"type"],["data-test","missingOrcidAuthorization",4,"ngFor","ngForOf"],["data-test","missingOrcidAuthorization"],["data-test","unlinkOnlyAdmin",3,"type"],["data-test","unlinkOwner",1,"row"],[1,"col"],["type","submit",1,"btn","btn-danger","float-end",3,"click","dsBtnDisabled"],[4,"ngIf"],["type","submit","class","btn btn-primary float-end",3,"click",4,"ngIf"],[1,"fas","fa-unlink"],[1,"fas","fa-circle-notch","fa-spin"],["type","submit",1,"btn","btn-primary","float-end",3,"click"],[1,"fas","fa-check"],["data-test","orcidNotLinked"],[1,"col-2"],["alt","orcid-logo","src","../../../../assets/images/orcid.logo.icon.svg"],[3,"type"],[1,"btn","btn-primary","float-end",3,"click"],[1,"fas","fa-link"]],template:function(n,i){if(1&n&&(e.j41(0,"div",2)(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,Ne,1,0,"ng-container",3),e.nI1(5,"async"),e.k0s(),e.DNE(6,Qe,20,20,"ng-template",null,0,e.C5r)(8,He,14,7,"ng-template",null,1,e.C5r)),2&n){const o=e.sdS(7),l=e.sdS(9);e.R7$(2),e.JRh(e.bMT(3,4,"person.orcid.registry.auth")),e.R7$(2),e.Y8G("ngIf",e.bMT(5,6,i.isLinkedToOrcid()))("ngIfThen",o)("ngIfElse",l)}},dependencies:[g.h,g.D9,u.Jj,u.bT,u.Sq,V.C,H.A]})}}return s})();var ie=r(58003),Ze=r(70152),et=r(23294),tt=r(88141),nt=r(52326),it=r(53067),st=r(22978),rt=r(5682),ot=r(23401);function at(s,a){1&s&&e.nrm(0,"ds-loading")}function ct(s,a){if(1&s&&(e.j41(0,"ds-alert",4),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=e.XpG();e.Y8G("type",t.AlertTypeEnum.Info),e.R7$(),e.SpI(" ",e.bMT(2,2,"person.page.orcid.sync-queue.empty-message")," ")}}function lt(s,a){if(1&s){const t=e.RV6();e.j41(0,"tr",10)(1,"td",11),e.nrm(2,"i",12),e.nI1(3,"translate"),e.k0s(),e.j41(4,"td",8),e.EFF(5),e.k0s(),e.j41(6,"td",13)(7,"div",14)(8,"button",15),e.nI1(9,"translate"),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.send(i))}),e.nrm(10,"span",16),e.j41(11,"span",17),e.EFF(12),e.nI1(13,"translate"),e.k0s()(),e.j41(14,"button",18),e.nI1(15,"translate"),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.discardEntry(i))}),e.nrm(16,"span",19),e.j41(17,"span",17),e.EFF(18),e.nI1(19,"translate"),e.k0s()()()()()}if(2&s){const t=a.$implicit,n=e.XpG(2);e.R7$(2),e.Y8G("ngClass",n.getIconClass(t))("ngbTooltip",e.bMT(3,8,n.getIconTooltip(t))),e.R7$(3),e.SpI(" ",t.description," "),e.R7$(3),e.Y8G("ngbTooltip",e.bMT(9,10,n.getOperationTooltip(t))),e.R7$(2),e.Y8G("ngClass",n.getOperationClass(t)),e.R7$(2),e.JRh(e.bMT(13,12,n.getOperationTooltip(t))),e.R7$(2),e.Y8G("ngbTooltip",e.bMT(15,14,"person.page.orcid.sync-queue.discard")),e.R7$(4),e.JRh(e.bMT(19,16,"person.page.orcid.sync-queue.discard"))}}function dt(s,a){if(1&s){const t=e.RV6();e.j41(0,"ds-pagination",5),e.nI1(1,"async"),e.bIt("paginationChange",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.updateList())}),e.j41(2,"div",6)(3,"table",7)(4,"thead")(5,"tr",8)(6,"th"),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th"),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th"),e.EFF(13),e.nI1(14,"translate"),e.k0s()()(),e.j41(15,"tbody"),e.DNE(16,lt,20,18,"tr",9),e.nI1(17,"async"),e.k0s()()()()}if(2&s){let t,n;const i=e.XpG();e.Y8G("paginationOptions",i.paginationOptions)("collectionSize",null==(t=e.bMT(1,8,i.getList()))||null==t.payload?null:t.payload.totalElements)("retainScrollPosition",!1)("hideGear",!0),e.R7$(7),e.JRh(e.bMT(8,10,"person.page.orcid.sync-queue.table.header.type")),e.R7$(3),e.JRh(e.bMT(11,12,"person.page.orcid.sync-queue.table.header.description")),e.R7$(3),e.JRh(e.bMT(14,14,"person.page.orcid.sync-queue.table.header.action")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(17,16,i.getList()))||null==n.payload?null:n.payload.page)}}let ut=(()=>{class s{constructor(t,n,i,o,l,p){this.orcidAuthService=t,this.orcidQueueService=n,this.translateService=i,this.paginationService=o,this.notificationsService=l,this.orcidHistoryService=p,this.paginationOptions=Object.assign(new ot.W,{id:"oqp",pageSize:5}),this.processing$=new I.t(!1),this.list$=new I.t({}),this.AlertTypeEnum=Y.v,this.subs=[]}ngOnInit(){this.updateList()}ngOnChanges(t){!t.item.isFirstChange()&&t.item.currentValue!==t.item.previousValue&&this.updateList()}updateList(){this.subs.push(this.paginationService.getCurrentPagination(this.paginationOptions.id,this.paginationOptions).pipe((0,Ze.B)(100),(0,et.F)(),(0,tt.M)(()=>this.processing$.next(!0)),(0,_.n)(t=>this.orcidQueueService.searchByProfileItemId(this.item.id,t,!1)),(0,v.qD)()).subscribe(t=>{this.processing$.next(!1),this.list$.next(t),this.orcidQueueService.clearFindByProfileItemRequests()}))}getList(){return this.list$.asObservable()}getIconClass(t){if(!t.recordType)return"fa fa-user";switch(t.recordType.toLowerCase()){case"publication":return"fas fa-book";case"project":return"fas fa-wallet";case"education":return"fas fa-school";case"affiliation":return"fas fa-university";case"country":return"fas fa-globe-europe";case"external_ids":case"researcher_urls":return"fas fa-external-link-alt";default:return"fa fa-user"}}getIconTooltip(t){return t.recordType?"person.page.orcid.sync-queue.tooltip."+t.recordType.toLowerCase():""}getOperationTooltip(t){return t.operation?"person.page.orcid.sync-queue.tooltip."+t.operation.toLowerCase():""}getOperationClass(t){if(!t.operation)return"";switch(t.operation.toLowerCase()){case"insert":return"fas fa-plus";case"update":return"fas fa-edit";case"delete":return"fas fa-trash-alt";default:return""}}discardEntry(t){this.processing$.next(!0),this.subs.push(this.orcidQueueService.deleteById(t.id).pipe((0,v.qD)()).subscribe(n=>{this.processing$.next(!1),n.isSuccess?(this.notificationsService.success(this.translateService.get("person.page.orcid.sync-queue.discard.success")),this.updateList()):this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.discard.error"))}))}send(t){this.processing$.next(!0),this.subs.push(this.orcidHistoryService.sendToORCID(t).pipe((0,v.qD)()).subscribe(n=>{this.processing$.next(!1),n.isSuccess?this.handleOrcidHistoryRecordCreation(n.payload):422===n.statusCode?this.handleValidationErrors(n):this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.error"))}))}getUnauthorizedErrorContent(){return this.orcidAuthService.getOrcidAuthorizeUrl(this.item).pipe((0,_.n)(t=>this.translateService.get("person.page.orcid.sync-queue.send.unauthorized-error.content",{orcid:t})))}handleOrcidHistoryRecordCreation(t){switch(t.status){case 200:case 201:case 204:this.notificationsService.success(this.translateService.get("person.page.orcid.sync-queue.send.success")),this.updateList();break;case 400:this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.bad-request-error"),null,{timeOut:0});break;case 401:(0,d.z)([this.translateService.get("person.page.orcid.sync-queue.send.unauthorized-error.title"),this.getUnauthorizedErrorContent()]).subscribe(([n,i])=>{this.notificationsService.error(n,i,{timeOut:0},!0)});break;case 404:this.notificationsService.warning(this.translateService.get("person.page.orcid.sync-queue.send.not-found-warning"));break;case 409:this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.conflict-error"),null,{timeOut:0});break;default:this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.error"),null,{timeOut:0})}}handleValidationErrors(t){const n=[this.translateService.get("person.page.orcid.sync-queue.send.validation-error")],i=t.errorMessage;i&&i.indexOf("Error codes:")>0&&i.substring(i.indexOf(":")+1).trim().split(",").forEach(o=>n.push(this.translateService.get("person.page.orcid.sync-queue.send.validation-error."+o))),(0,d.z)(n).subscribe(o=>{const l=o.shift(),p="<ul>"+o.map(G=>`<li>${G}</li>`).join("")+"</ul>";this.notificationsService.error(l,p,{timeOut:0},!0)})}ngOnDestroy(){this.list$=null,this.subs.filter(t=>(0,b.a4)(t)).forEach(t=>t.unsubscribe())}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(L.r),e.rXU(it.OrcidQueueDataService),e.rXU(g.c$),e.rXU(st.m),e.rXU(U.I),e.rXU(nt.OrcidHistoryDataService))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-queue"]],inputs:{item:"item"},standalone:!0,features:[e.OA$,e.aNF],decls:13,vars:16,consts:[[4,"ngIf"],[1,"container"],[3,"type",4,"ngIf"],[3,"paginationOptions","collectionSize","retainScrollPosition","hideGear","paginationChange",4,"ngIf"],[3,"type"],[3,"paginationChange","paginationOptions","collectionSize","retainScrollPosition","hideGear"],[1,"table-responsive"],["id","groups",1,"table","table-sm","table-striped","table-hover","table-bordered"],[1,"text-center","align-middle"],["data-test","orcidQueueElementRow",4,"ngFor","ngForOf"],["data-test","orcidQueueElementRow"],[1,"text-center","align-middle",2,"width","15%"],["aria-hidden","true",1,"fa-2x",3,"ngClass","ngbTooltip"],[1,"text-center",2,"width","20%"],[1,"btn-group","edit-field"],["container","body",1,"btn","btn-outline-primary","my-1","col-md",3,"click","ngbTooltip"],[3,"ngClass"],[1,"sr-only"],["container","body",1,"btn","btn-outline-danger","my-1","col-md",3,"click","ngbTooltip"],[1,"fas","fa-unlink"]],template:function(n,i){if(1&n&&(e.j41(0,"div"),e.DNE(1,at,1,0,"ds-loading",0),e.nI1(2,"async"),e.j41(3,"div",1)(4,"h2"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.DNE(7,ct,3,4,"ds-alert",2),e.nI1(8,"async"),e.nI1(9,"async"),e.DNE(10,dt,18,18,"ds-pagination",3),e.nI1(11,"async"),e.nI1(12,"async"),e.k0s()()),2&n){let o,l;e.R7$(),e.Y8G("ngIf",e.bMT(2,4,i.processing$)),e.R7$(4),e.JRh(e.bMT(6,6,"person.orcid.registry.queue")),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(8,8,i.processing$)&&0===(null==(o=e.bMT(9,10,i.getList()))||null==o.payload?null:o.payload.totalElements)),e.R7$(3),e.Y8G("ngIf",!0!==e.bMT(11,12,i.processing$)&&(null==(l=e.bMT(12,14,i.getList()))||null==l.payload?null:l.payload.totalElements)>0)}},dependencies:[u.MD,u.YU,u.Sq,u.bT,u.Jj,ie.n8,ie.md,g.h,g.D9,ne.v,V.C,rt.e]})}}return s})();var N=r(56977),pt=r(98926);function mt(s,a){if(1&s&&(e.j41(0,"option",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=a.$implicit;e.Y8G("value",t.value),e.R7$(),e.JRh(e.bMT(2,2,t.label))}}function ht(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",25)(1,"input",26),e.mxI("ngModelChange",function(i){e.eBV(t);const o=e.XpG();return e.DH7(o.currentSyncPublications,i)||(o.currentSyncPublications=i),e.Njj(i)}),e.k0s(),e.j41(2,"label",27),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&s){const t=a.$implicit,n=e.XpG();e.R7$(),e.Mz_("id","publicationOption_",t.value,""),e.R50("ngModel",n.currentSyncPublications),e.Y8G("value",t.value),e.R7$(),e.Mz_("for","publicationOption_",t.value,""),e.R7$(),e.JRh(e.bMT(4,7,t.label))}}function gt(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",25)(1,"input",28),e.mxI("ngModelChange",function(i){e.eBV(t);const o=e.XpG();return e.DH7(o.currentSyncFunding,i)||(o.currentSyncFunding=i),e.Njj(i)}),e.k0s(),e.j41(2,"label",27),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&s){const t=a.$implicit,n=e.XpG();e.R7$(),e.Mz_("id","fundingOption_",t.value,""),e.R50("ngModel",n.currentSyncFunding),e.Y8G("value",t.value),e.R7$(),e.Mz_("for","fundingOption_",t.value,""),e.R7$(),e.JRh(e.bMT(4,7,t.label))}}function ft(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",25)(1,"input",29),e.mxI("ngModelChange",function(i){const o=e.eBV(t).$implicit;return e.DH7(o.checked,i)||(o.checked=i),e.Njj(i)}),e.k0s(),e.j41(2,"label",27),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&s){const t=a.$implicit;e.R7$(),e.Mz_("name","syncProfile_",t.value,""),e.Mz_("id","profileOption_",t.value,""),e.R50("ngModel",t.checked),e.Y8G("value",t.value),e.R7$(),e.Mz_("for","profileOption_",t.value,""),e.R7$(),e.JRh(e.bMT(4,9,t.label))}}let vt=(()=>{class s{#e;#t;#n;constructor(t,n,i){this.researcherProfileService=t,this.notificationsService=n,this.translateService=i,this.AlertType=Y.v,this.messagePrefix="person.page.orcid",this.settingsUpdated=new e.bkB,this.#e=new e.bkB,this.#t=new I.t(null)}set item(t){this.#t.next(t)}ngOnDestroy(){this.#e.next()}ngOnInit(){this.syncModes=[{label:this.messagePrefix+".synchronization-mode.batch",value:"BATCH"},{label:this.messagePrefix+".synchronization-mode.manual",value:"MANUAL"}],this.syncPublicationOptions=["DISABLED","ALL"].map(t=>({label:this.messagePrefix+".sync-publications."+t.toLowerCase(),value:t})),this.syncFundingOptions=["DISABLED","ALL"].map(t=>({label:this.messagePrefix+".sync-fundings."+t.toLowerCase(),value:t})),this.updateSyncProfileOptions(this.#t.asObservable()),this.updateSyncPreferences(this.#t.asObservable()),this.#n=this.#t.pipe((0,_.n)(t=>this.researcherProfileService.findByRelatedItem(t).pipe((0,v.qD)(),(0,j.W)(J.V7),(0,v.Bo)())),(0,N.Q)(this.#e))}onSubmit(t){const n=[];this.fillOperationsFor(n,"/orcid/mode",t.value.syncMode),this.fillOperationsFor(n,"/orcid/publications",t.value.syncPublications),this.fillOperationsFor(n,"/orcid/fundings",t.value.syncFundings);const i=this.syncProfileOptions.map(o=>o.value).filter(o=>t.value["syncProfile_"+o]).join(",");this.fillOperationsFor(n,"/orcid/profile",i),0!==n.length&&this.#n.pipe((0,_.n)(o=>this.researcherProfileService.patch(o,n)),(0,v.qD)(),(0,j.W)(J.V7),(0,T.s)(1)).subscribe(o=>{o.hasFailed?this.notificationsService.error(this.translateService.get(this.messagePrefix+".synchronization-settings-update.error")):(this.notificationsService.success(this.translateService.get(this.messagePrefix+".synchronization-settings-update.success")),this.settingsUpdated.emit())})}updateSyncPreferences(t){t.pipe((0,y.p)(b.a4),(0,h.T)(n=>this.getCurrentPreference(n,"dspace.orcid.sync-mode",["BATCH","MANUAL"],"MANUAL")),(0,N.Q)(this.#e)).subscribe(n=>this.currentSyncMode=n),t.pipe((0,y.p)(b.a4),(0,h.T)(n=>this.getCurrentPreference(n,"dspace.orcid.sync-publications",["DISABLED","ALL"],"DISABLED")),(0,N.Q)(this.#e)).subscribe(n=>this.currentSyncPublications=n),t.pipe((0,y.p)(b.a4),(0,h.T)(n=>this.getCurrentPreference(n,"dspace.orcid.sync-fundings",["DISABLED","ALL"],"DISABLED")),(0,N.Q)(this.#e)).subscribe(n=>this.currentSyncFunding=n)}updateSyncProfileOptions(t){t.pipe((0,y.p)(b.a4),(0,h.T)(n=>n.allMetadataValues("dspace.orcid.sync-profile")),(0,h.T)(n=>["BIOGRAPHICAL","IDENTIFIERS"].map(i=>({label:this.messagePrefix+".sync-profile."+i.toLowerCase(),value:i,checked:n.includes(i)}))),(0,N.Q)(this.#e)).subscribe(n=>this.syncProfileOptions=n)}getCurrentPreference(t,n,i,o){const l=t.firstMetadataValue(n);return l&&i.includes(l)?l:o}fillOperationsFor(t,n,i){t.push({path:n,op:"replace",value:i})}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(pt.ResearcherProfileDataService),e.rXU(U.I),e.rXU(g.c$))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-sync-setting"]],inputs:{item:"item"},outputs:{settingsUpdated:"settingsUpdated"},standalone:!0,features:[e.aNF],decls:70,vars:42,consts:[["f","ngForm"],[1,"container","mb-5"],[3,"ngSubmit"],[1,"row","mb-3"],[1,"col-md"],["data-test","sync-mode",1,"card"],[1,"card-header"],[1,"card-body"],[1,"container"],[1,"row"],[3,"type"],[1,"mb-3","row"],["for","syncMode",1,"form-label"],["name","syncMode","id","syncMode","required","",1,"form-select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md","mb-3"],["data-test","sync-mode-publication",1,"card","h-100"],[1,"mb-3"],["class","row form-check",4,"ngFor","ngForOf"],["data-test","sync-mode-funding",1,"card","h-100"],["data-test","profile-preferences",1,"card","h-100"],[1,"col"],["type","submit",1,"btn","btn-primary","float-end"],[1,"fas","fa-edit"],[3,"value"],[1,"row","form-check"],["type","radio","name","syncPublications","required","",3,"ngModelChange","ngModel","id","value"],[1,"ms-2","form-label",3,"for"],["type","radio","name","syncFundings","required","",3,"ngModelChange","ngModel","id","value"],["type","checkbox",3,"ngModelChange","ngModel","name","id","value"]],template:function(n,i){if(1&n){const o=e.RV6();e.j41(0,"div",1)(1,"h2"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"form",2,0),e.bIt("ngSubmit",function(){e.eBV(o);const p=e.sdS(5);return e.Njj(i.onSubmit(p.form))}),e.j41(6,"div",3)(7,"div",4)(8,"div",5)(9,"div",6),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"div",7)(13,"div",8)(14,"div",9)(15,"ds-alert",10),e.EFF(16),e.nI1(17,"translate"),e.k0s()(),e.j41(18,"div",11)(19,"label",12),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"select",13),e.mxI("ngModelChange",function(p){return e.eBV(o),e.DH7(i.currentSyncMode,p)||(i.currentSyncMode=p),e.Njj(p)}),e.DNE(23,mt,3,4,"option",14),e.k0s()()()()()()(),e.j41(24,"div",9)(25,"div",15)(26,"div",16)(27,"div",6),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.j41(30,"div",7)(31,"div",8)(32,"div",9)(33,"ds-alert",10),e.EFF(34),e.nI1(35,"translate"),e.k0s()(),e.j41(36,"div",17),e.DNE(37,ht,5,9,"div",18),e.k0s()()()()(),e.j41(38,"div",15)(39,"div",19)(40,"div",6),e.EFF(41),e.nI1(42,"translate"),e.k0s(),e.j41(43,"div",7)(44,"div",8)(45,"div",9)(46,"ds-alert",10),e.EFF(47),e.nI1(48,"translate"),e.k0s()(),e.j41(49,"div",17),e.DNE(50,gt,5,9,"div",18),e.k0s()()()()(),e.j41(51,"div",15)(52,"div",20)(53,"div",6),e.EFF(54),e.nI1(55,"translate"),e.k0s(),e.j41(56,"div",7)(57,"div",8)(58,"div",9)(59,"ds-alert",10),e.EFF(60),e.nI1(61,"translate"),e.k0s()(),e.j41(62,"div",17),e.DNE(63,ft,5,11,"div",18),e.k0s()()()()()(),e.j41(64,"div",9)(65,"div",21)(66,"button",22),e.nrm(67,"i",23),e.EFF(68),e.nI1(69,"translate"),e.k0s()()()()()}2&n&&(e.R7$(2),e.JRh(e.bMT(3,20,"person.orcid.sync.setting")),e.R7$(8),e.JRh(e.bMT(11,22,"person.page.orcid.synchronization-mode")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(17,24,"person.page.orcid.synchronization-mode-message")," "),e.R7$(4),e.JRh(e.bMT(21,26,"person.page.orcid.synchronization-mode.label")),e.R7$(2),e.R50("ngModel",i.currentSyncMode),e.R7$(),e.Y8G("ngForOf",i.syncModes),e.R7$(5),e.JRh(e.bMT(29,28,"person.page.orcid.publications-preferences")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(35,30,"person.page.orcid.synchronization-mode-publication-message")," "),e.R7$(3),e.Y8G("ngForOf",i.syncPublicationOptions),e.R7$(4),e.JRh(e.bMT(42,32,"person.page.orcid.funding-preferences")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(48,34,"person.page.orcid.synchronization-mode-funding-message")," "),e.R7$(3),e.Y8G("ngForOf",i.syncFundingOptions),e.R7$(4),e.JRh(e.bMT(55,36,"person.page.orcid.profile-preferences")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(61,38,"person.page.orcid.synchronization-mode-profile-message")," "),e.R7$(3),e.Y8G("ngForOf",i.syncProfileOptions),e.R7$(5),e.SpI(" ",e.bMT(69,40,"person.page.orcid.save.preference.changes")," "))},dependencies:[V.C,c.YN,c.qT,c.xH,c.y7,c.me,c.Zm,c.wz,c.Fm,c.BC,c.cb,c.YS,c.vS,c.cV,g.h,g.D9,u.Sq]})}}return s})();function bt(s,a){1&s&&(e.nrm(0,"ds-loading",4),e.nI1(1,"translate")),2&s&&e.Y8G("message",e.bMT(1,1,"person.page.orcid.link.processing"))}function _t(s,a){if(1&s&&(e.j41(0,"div",5)(1,"ds-alert",6),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&s){const t=e.XpG();e.R7$(),e.Y8G("type",t.AlertType.Error),e.R7$(),e.JRh(e.bMT(3,2,"person.page.orcid.link.error.message"))}}function yt(s,a){if(1&s){const t=e.RV6();e.j41(0,"ds-orcid-sync-setting",10),e.nI1(1,"async"),e.bIt("settingsUpdated",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.updateItem())}),e.k0s()}if(2&s){const t=e.XpG(2);e.Y8G("item",e.bMT(1,1,t.item))}}function It(s,a){if(1&s&&(e.nrm(0,"ds-orcid-queue",11),e.nI1(1,"async")),2&s){const t=e.XpG(2);e.Y8G("item",e.bMT(1,1,t.item))}}function Ct(s,a){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"ds-orcid-auth",7),e.nI1(2,"async"),e.bIt("unlink",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.updateItem())}),e.k0s(),e.DNE(3,yt,2,3,"ds-orcid-sync-setting",8)(4,It,2,3,"ds-orcid-queue",9),e.bVm()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("item",e.bMT(2,3,t.item)),e.R7$(2),e.Y8G("ngIf",t.isLinkedToOrcid()),e.R7$(),e.Y8G("ngIf",t.isLinkedToOrcid())}}function Ot(s,a){if(1&s&&(e.j41(0,"div",12)(1,"div",13)(2,"div",14)(3,"a",15),e.nrm(4,"i",16),e.EFF(5),e.nI1(6,"translate"),e.k0s()()()()),2&s){const t=e.XpG();e.R7$(3),e.Y8G("routerLink",t.getItemPage()),e.R7$(2),e.SpI(" ",e.bMT(6,2,"item.orcid.return")," ")}}let St=(()=>{class s{constructor(t,n,i,o,l,p){this.platformId=t,this.authService=n,this.itemService=i,this.orcidAuthService=o,this.route=l,this.router=p,this.AlertType=Y.v,this.connectionStatus=new I.t(!1),this.item=new I.t(null),this.processingConnection=new I.t(!0)}ngOnInit(){if((0,u.UE)(this.platformId)){const t=this.route.queryParamMap.pipe((0,T.s)(1),(0,h.T)(i=>i.get("code"))),n=this.route.data.pipe((0,h.T)(i=>i.dso),(0,w.QD)(this.router,this.authService),(0,v.ak)());(0,d.z)([t,n]).subscribe(([i,o])=>{this.itemId=o.id,(0,b.hj)(i)?this.linkProfileToOrcid(o,i):(this.item.next(o),this.processingConnection.next(!1),this.connectionStatus.next(!0))})}}isLinkedToOrcid(){return this.orcidAuthService.isLinkedToOrcid(this.item.value)}getItemPage(){return(0,D._o)(this.item.value)}updateItem(){this.clearRouteParams(),this.itemService.findById(this.itemId,!1).pipe((0,v.qD)()).subscribe(t=>{t.hasSucceeded&&this.item.next(t.payload)})}linkProfileToOrcid(t,n){this.orcidAuthService.linkOrcidByItem(t,n).pipe((0,v.qD)()).subscribe(i=>{this.processingConnection.next(!1),i.hasSucceeded?(this.connectionStatus.next(!0),this.updateItem()):(this.item.next(t),this.connectionStatus.next(!1),this.clearRouteParams())})}clearRouteParams(){this.route.queryParamMap.pipe((0,y.p)(t=>(0,b.hj)(t.keys)),(0,h.T)(t=>Object.assign({})),(0,T.s)(1)).subscribe(t=>this.router.navigate([],{relativeTo:this.route,queryParams:t}))}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(e.Agw),e.rXU(O.uR),e.rXU(E.ItemDataService),e.rXU(L.r),e.rXU(f.nX),e.rXU(f.Ix))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-page"]],standalone:!0,features:[e.aNF],decls:12,vars:20,consts:[[3,"message",4,"ngIf"],["class","container","data-test","error-box",4,"ngIf"],[4,"ngIf"],["class","container",4,"ngIf"],[3,"message"],["data-test","error-box",1,"container"],[3,"type"],["data-test","orcid-auth",3,"unlink","item"],["data-test","orcid-sync-setting",3,"item","settingsUpdated",4,"ngIf"],[3,"item",4,"ngIf"],["data-test","orcid-sync-setting",3,"settingsUpdated","item"],[3,"item"],[1,"container"],[1,"button-row","bottom","mb-3"],[1,"text-end"],["role","button","data-test","back-button",1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"]],template:function(n,i){1&n&&(e.DNE(0,bt,2,3,"ds-loading",0),e.nI1(1,"async"),e.DNE(2,_t,4,4,"div",1),e.nI1(3,"async"),e.nI1(4,"async"),e.DNE(5,Ct,5,5,"ng-container",2),e.nI1(6,"async"),e.nI1(7,"async"),e.nI1(8,"async"),e.DNE(9,Ot,7,4,"div",3),e.nI1(10,"async"),e.nI1(11,"async")),2&n&&(e.Y8G("ngIf",e.bMT(1,4,i.processingConnection)),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(3,6,i.processingConnection)&&!0!==e.bMT(4,8,i.connectionStatus)),e.R7$(3),e.Y8G("ngIf",!0!==e.bMT(6,10,i.processingConnection)&&e.bMT(7,12,i.item)&&e.bMT(8,14,i.connectionStatus)),e.R7$(4),e.Y8G("ngIf",!0!==e.bMT(10,16,i.processingConnection)&&e.bMT(11,18,i.item)))},dependencies:[u.MD,u.bT,u.Jj,ne.v,V.C,qe,vt,ut,g.h,g.D9,f.Wk]})}}return s})();const Rt=(0,r(6056).L)(()=>te.Z,()=>(0,m.of)(x._.CanSynchronizeWithORCID));var Ft=r(25499),se=r(81783),Mt=r(81225);const Dt=[(0,r(67600).s)("item")];let kt=(()=>{class s{constructor(t,n,i,o){this.route=t,this.router=n,this.versionService=i,this.authService=o}ngOnInit(){this.versionRD$=this.route.data.pipe((0,h.T)(t=>t.dso),(0,w.QD)(this.router,this.authService)),this.versionRD$.pipe((0,v.ak)(),(0,_.n)(t=>t.item),(0,w.QD)(this.router,this.authService),(0,v.qD)()).subscribe(t=>{if(t.hasNoContent)this.router.navigateByUrl((0,C.EX)(),{skipLocationChange:!0});else{const n=(0,D._o)(t.payload);this.router.navigateByUrl(n)}})}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(f.nX),e.rXU(f.Ix),e.rXU(se.VersionDataService),e.rXU(O.uR))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-version-page"]],standalone:!0,features:[e.aNF],decls:0,vars:0,template:function(n,i){}})}}return s})();var re=r(27468),jt=r(10887),$t=r(21626);let At=(()=>{class s{constructor(t){this.http=t,this.baseUrl=`${jt.$}/server/api/core/items`}getItemDetails(t){return this.http.get(`${this.baseUrl}/${t}`)}getBitstreams(t){return this.http.get(`${this.baseUrl}/${t}/bundles`).pipe((0,_.n)(i=>{const o=i._embedded?.bundles?.find(l=>"ORIGINAL"===l.name);if(o){const l=o._links?.bitstreams?.href;return this.http.get(l).pipe((0,h.T)(p=>p._embedded?.bitstreams||[]),(0,j.W)(()=>(0,m.of)([])))}return(0,m.of)([])}),(0,j.W)(()=>(0,m.of)([])))}getCaseDataWithAttachments(t){return(0,re.p)({metadata:this.getItemDetails(t),attachments:this.getBitstreams(t)})}static{this.\u0275fac=function(n){return new(n||s)(e.KVO($t.Qq))}}static{this.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var Bt=r(70980),xt=r(33435);function Ut(s,a){1&s&&(e.j41(0,"div",2)(1,"p",3),e.EFF(2,"Loading case details..."),e.k0s(),e.j41(3,"div",4)(4,"span",5),e.EFF(5,"Loading..."),e.k0s()()())}function Nt(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",2)(1,"p",3),e.EFF(2,"Failed to load case details. Please try again."),e.k0s(),e.j41(3,"button",6),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.reloadData())}),e.EFF(4," Reload "),e.k0s()()}}function Gt(s,a){if(1&s&&(e.j41(0,"div",18)(1,"strong"),e.EFF(2),e.k0s(),e.EFF(3),e.k0s()),2&s){const t=a.$implicit,n=e.XpG(2);e.R7$(2),e.SpI("",n.customMetadataLabels[t]||t,":"),e.R7$(),e.SpI(" ",n.getMetadataValue(t)," ")}}function Xt(s,a){if(1&s&&(e.j41(0,"div",20)(1,"div",18)(2,"strong"),e.EFF(3),e.k0s(),e.EFF(4),e.k0s()()),2&s){const t=a.$implicit;e.R7$(3),e.SpI("",t.label,":"),e.R7$(),e.SpI(" ",t.value,"")}}function zt(s,a){if(1&s&&(e.j41(0,"div"),e.DNE(1,Xt,5,2,"div",19),e.k0s()),2&s){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.extraMetadata)}}function Vt(s,a){1&s&&(e.j41(0,"div",21)(1,"p"),e.EFF(2,"Checking file permissions..."),e.k0s(),e.j41(3,"div",22)(4,"span",5),e.EFF(5,"Loading..."),e.k0s()()())}function Lt(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",23)(1,"div",24)(2,"strong"),e.EFF(3),e.k0s()(),e.j41(4,"div",25),e.EFF(5),e.nI1(6,"number"),e.k0s(),e.j41(7,"div",25),e.EFF(8),e.k0s(),e.j41(9,"div",24)(10,"a",26),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.viewFile(i))}),e.EFF(11,"View"),e.k0s()()()}if(2&s){const t=a.$implicit;e.R7$(3),e.JRh(t.name),e.R7$(2),e.JRh(t.sizeBytes?e.i5U(6,3,t.sizeBytes/1024,"1.0-2")+" KB":"Size Unknown"),e.R7$(3),e.JRh(t.format)}}function wt(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",27)(1,"button",28),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.prevPage())}),e.EFF(2,"Previous"),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s(),e.j41(5,"button",28),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.nextPage())}),e.EFF(6,"Next"),e.k0s()()}if(2&s){const t=e.XpG(2);e.R7$(),e.Y8G("disabled",1===t.currentPage),e.R7$(3),e.Lme("Page ",t.currentPage," of ",t.totalPages,""),e.R7$(),e.Y8G("disabled",t.currentPage===t.totalPages)}}function Yt(s,a){1&s&&(e.j41(0,"div",29),e.EFF(1," No accessible files available for this case. "),e.k0s())}function Jt(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",7)(1,"h3",8),e.EFF(2),e.k0s(),e.j41(3,"button",9),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.navigateToEdit())}),e.nrm(4,"i",10),e.EFF(5," Edit Metadata "),e.k0s(),e.DNE(6,Gt,4,2,"div",11),e.j41(7,"button",12),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.showMore=!i.showMore)}),e.EFF(8),e.k0s(),e.DNE(9,zt,2,1,"div",13),e.nrm(10,"hr"),e.j41(11,"h4"),e.EFF(12,"Files"),e.k0s(),e.DNE(13,Vt,6,0,"div",14)(14,Lt,12,6,"div",15)(15,wt,7,4,"div",16)(16,Yt,2,0,"div",17),e.k0s()}if(2&s){const t=e.XpG();e.R7$(2),e.JRh(t.getMetadataValue("dc.casetype")),e.R7$(4),e.Y8G("ngForOf",t.visibleKeys),e.R7$(2),e.SpI(" ",t.showMore?"Collapse":"Expand"," "),e.R7$(),e.Y8G("ngIf",t.showMore),e.R7$(4),e.Y8G("ngIf",t.checkingPermissions),e.R7$(),e.Y8G("ngForOf",t.paginatedAttachments()),e.R7$(),e.Y8G("ngIf",t.filteredAttachments.length>0),e.R7$(),e.Y8G("ngIf",0===t.filteredAttachments.length&&!t.checkingPermissions)}}const Kt=[{path:":id",resolve:{dso:te.Z,breadcrumb:(s,a,t=(0,e.WQX)(B.U),n=(0,e.WQX)(E.ItemDataService))=>{const i=(0,$.U)();return(0,A.G)(s,a,t,n,...i)}},runGuardsAndResolvers:"always",children:[{path:"",component:(()=>{class s{constructor(t,n,i,o,l){this.route=t,this.router=n,this.caseDetailsService=i,this.bitstreamPermissionsService=o,this.cdr=l,this.metadata={},this.attachments=[],this.filteredAttachments=[],this.itemUuid="",this.showMore=!1,this.currentPage=1,this.pageSize=3,this.loading=!0,this.loadError=!1,this.checkingPermissions=!1,this.excludedFields=["dc.description.provenance","dc.identifier.uri","dc.date.accessioned"],this.customMetadataLabels={"dc.caseyear":"Case Year","dc.casetype":"Case Type","dc.title":"Case Number","dc.case.district":"District","dc.district":"District","dc.pname":"Petitioner Name","dc.rname":"Respondent Name","dc.paname":"Petitioner's Advocate Name","dc.raname":"Respondent's Advocate Name","dc.contributor.author":"Judge Name","dc.date.accessioned":"Access Date","dc.date.issued":"Issued Year","dc.date.disposal":"Disposal Date","dc.identifier.uri":"Handle URL","dc.title.alternative":"Alternative Title","dc.type":"Document Type","dc.barcode":"Barcode Number","dc.batch-number":"Batch Number","dc.char-count":"Character Count","dc.date.scan":"Scan Date","dc.date.verification":"Date Verification","dc.pages":"No of Pages of the Main File","dc.size":"File Size","dc.verified-by":"Verified By"},this.visibleKeys=["dc.casetype","dc.title","dc.caseyear","dc.date.disposal","dc.contributor.author","dc.pname","dc.rname","dc.paname","dc.raname","dc.district","dc.date.scan","dc.verified-by","dc.date.verification","dc.barcode","dc.batch-number","dc.size","dc.char-count","dc.pages"]}ngOnInit(){this.route.paramMap.subscribe(t=>{const n=t.get("id");n?(this.itemUuid=n,this.fetchData(n)):(this.loading=!1,this.loadError=!0,console.error("\u274c UUID missing in route"),this.cdr.detectChanges())})}get metadataOnly(){return this.metadata?.metadata??{}}fetchData(t){this.loading=!0,this.loadError=!1,this.cdr.detectChanges(),this.caseDetailsService.getCaseDataWithAttachments(t).subscribe({next:n=>{this.metadata=n.metadata,this.attachments=n.attachments,this.checkPermissionsForAttachments()},error:n=>{console.error("\u274c Error fetching case details:",n),this.loading=!1,this.loadError=!0,this.cdr.detectChanges()}})}checkPermissionsForAttachments(){if(!this.attachments||0===this.attachments.length)return this.filteredAttachments=[],this.loading=!1,void this.cdr.detectChanges();this.checkingPermissions=!0;const t=this.attachments.map(n=>{const i=this.extractUuidFromBitstream(n);return i?this.bitstreamPermissionsService.getBitstreamPermissions(i).pipe((0,h.T)(o=>({file:n,hasPermission:!0===o.isAdmin||o.policies&&o.policies.length>0,isAdmin:!0===o.isAdmin})),(0,j.W)(o=>(console.error(`Error checking permissions for ${n.name}:`,o),(0,m.of)({file:n,hasPermission:!1,isAdmin:!1})))):(0,m.of)({file:n,hasPermission:!1,isAdmin:!1})});(0,re.p)(t).pipe((0,Bt.j)(()=>{this.loading=!1,this.checkingPermissions=!1,this.cdr.detectChanges()})).subscribe({next:n=>{this.filteredAttachments=n.filter(i=>i.hasPermission).map(i=>i.file),console.log(`Filtered ${this.attachments.length} files to ${this.filteredAttachments.length} with permissions`),console.log("Permission results:",n),this.currentPage=1,this.cdr.detectChanges()},error:n=>{console.error("\u274c Error checking file permissions:",n),this.filteredAttachments=[],this.cdr.detectChanges()}})}reloadData(){this.itemUuid&&this.fetchData(this.itemUuid)}getMetadataValue(t){return this.metadata?.metadata?.[t]?.[0]?.value??"-"}get extraMetadata(){return Object.keys(this.metadata?.metadata||{}).filter(t=>!this.visibleKeys.includes(t)&&!this.excludedFields.includes(t)).map(t=>({key:t,label:this.customMetadataLabels[t]||t,value:this.getMetadataValue(t)}))}navigateToEdit(){this.itemUuid&&this.router.navigate(["edit/metadata"],{relativeTo:this.route})}paginatedAttachments(){const t=(this.currentPage-1)*this.pageSize;return this.filteredAttachments.slice(t,t+this.pageSize)}get totalPages(){return Math.ceil(this.filteredAttachments.length/this.pageSize)}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}extractUuidFromBitstream(t){const i=(t._links?.content?.href||"").split("/");return i.length>2?i[i.length-2]:""}viewFile(t){const n=this.extractUuidFromBitstream(t);n&&this.itemUuid&&this.router.navigate([`/viewer/i/${this.itemUuid}/f/${n}`])}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(f.nX),e.rXU(f.Ix),e.rXU(At),e.rXU(xt.l),e.rXU(e.gRc))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-case-details"]],decls:3,vars:3,consts:[["class","text-center my-5",4,"ngIf"],["class","case-details container",4,"ngIf"],[1,"text-center","my-5"],[1,"h5"],["role","status",1,"spinner-border","text-primary","my-3"],[1,"visually-hidden"],[1,"btn","btn-outline-secondary","mt-3",3,"click"],[1,"case-details","container"],[1,"text-center"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-edit"],["class","col",4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-outline-primary","my-3",3,"click"],[4,"ngIf"],["class","text-center my-3",4,"ngIf"],["class","file-row row mb-2",4,"ngFor","ngForOf"],["class","d-flex justify-content-between mt-3",4,"ngIf"],["class","alert alert-info mt-3",4,"ngIf"],[1,"col"],["class","row mb-2",4,"ngFor","ngForOf"],[1,"row","mb-2"],[1,"text-center","my-3"],["role","status",1,"spinner-border","spinner-border-sm","text-secondary"],[1,"file-row","row","mb-2"],[1,"col-md-4"],[1,"col-md-2"],[2,"cursor","pointer",3,"click"],[1,"d-flex","justify-content-between","mt-3"],[1,"btn","btn-sm","btn-secondary",3,"click","disabled"],[1,"alert","alert-info","mt-3"]],template:function(n,i){1&n&&e.DNE(0,Ut,6,0,"div",0)(1,Nt,5,0,"div",0)(2,Jt,17,8,"div",1),2&n&&(e.Y8G("ngIf",i.loading),e.R7$(),e.Y8G("ngIf",i.loadError),e.R7$(),e.Y8G("ngIf",!i.loading&&!i.loadError))},dependencies:[u.Sq,u.bT,u.QX],styles:[".case-details[_ngcontent-%COMP%]{background-color:#fff;margin:24px auto;font-family:Segoe UI,sans-serif;box-shadow:0 2px 8px #0000000f;max-width:1000px}.case-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:24px;font-weight:600;margin-bottom:28px;color:#343a40;text-align:center}.case-details[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;margin-bottom:14px}.case-details[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]{flex:0 0 50%;padding:6px 0;font-size:16px;color:#212529;display:flex;align-items:baseline}.case-details[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{width:160px;display:inline-block;color:#495057;font-weight:500;margin-right:8px}.case-details[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{margin:32px 0 20px;border:none;border-top:1px solid #e0e0e0}.case-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:18px;font-weight:500;margin-bottom:16px;color:#495057}.file-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;padding:12px 16px;border:1px solid #e4e4e4;border-radius:6px;background-color:#f8f9fa;margin-bottom:10px}.file-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1 1 25%;font-size:15px;padding:4px 8px;word-break:break-word}.file-row[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#007bff;font-weight:500}.file-row[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.expand-toggle[_ngcontent-%COMP%]{margin:12px 0;text-align:center}button.btn-outline-primary[_ngcontent-%COMP%]{padding:4px 12px;font-size:14px}.pagination-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:20px}.pagination-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;font-size:14px;background-color:#e9ecef;border:1px solid #ccc;border-radius:6px;cursor:pointer}.pagination-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.pagination-controls[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;font-weight:500}@media (max-width: 768px){.case-details[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]{flex:0 0 100%}.file-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 100%;margin-bottom:6px}}"]})}}return s})(),pathMatch:"full",resolve:{menu:k.c}},{path:"full",component:xe.i,resolve:{menu:k.c}},{path:D.jU,loadChildren:()=>Promise.all([r.e(5355),r.e(9366),r.e(7558),r.e(2073),r.e(3534),r.e(2076),r.e(2418)]).then(r.bind(r,52418)).then(s=>s.ROUTES)},{path:D.aX,component:Be,canActivate:[R.t]},{path:C.RZ,component:ge},{path:D._z,component:St,canActivate:[R.t,Rt]}],data:{menu:{public:[{id:"statistics_item_:id",active:!0,visible:!0,index:2,model:{type:F.x.LINK,text:"menu.section.statistics",link:"statistics/items/:id/"}}]}}},{path:"version",children:[{path:":id",component:kt,resolve:{dso:(s,a,t=(0,e.WQX)(se.VersionDataService),n=(0,e.WQX)(Ft.il))=>{const i=t.findById(s.params.id,!0,!1,...Dt).pipe((0,v.qD)());return i.subscribe(o=>{n.dispatch(new Mt.j(a.url,o.payload))}),i}}}]}]},35925:(Q,P,r)=>{r.d(P,{Z:()=>f});var C=r(54438),R=r(7901),e=r(25499),$=r(96354),E=r(67116),A=r(29326),B=r(81225),S=r(308),k=r(80183),F=r(82777),u=r(56273),c=r(90887);const f=(g,d,m=(0,C.WQX)(R.Ix),h=(0,C.WQX)(A.ItemDataService),y=(0,C.WQX)(e.il),_=(0,C.WQX)(E.uR))=>{const T=h.findById(g.params.id,!0,!1,...(0,u.U)()).pipe((0,k.qD)(),(0,S.QD)(m,_));return T.subscribe(O=>{y.dispatch(new B.j(d.url,O.payload))}),T.pipe((0,$.T)(O=>{if(O.hasSucceeded&&(0,F.a4)(O.payload)){const M=d.url,X=m.parseUrl((0,c._o)(O.payload)).toString();if(!M.startsWith(X)){const z=O.payload.uuid,x=M.substring(M.indexOf(z)+z.length,M.length);m.navigateByUrl(X+x)}}return O}))}}}]);