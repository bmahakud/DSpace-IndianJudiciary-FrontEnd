(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[1717,1345,4319,9914,3138,5521,9184,3928],{70379:(W,j,o)=>{"use strict";o.d(j,{S:()=>R});var u=o(54438),T=o(82777),S=o(30506),I=o(7673),y=o(90839);let E=(()=>{class G{getBreadcrumbs(b,m){return(0,I.of)([new y.Q(b+".breadcrumbs",m)])}static{this.\u0275fac=function(m){return new(m||G)}}static{this.\u0275prov=u.jDH({token:G,factory:G.\u0275fac,providedIn:"root"})}}return G})();const R=(G,x,b=(0,u.WQX)(E))=>{const m=G.data.breadcrumbKey;if((0,T.Tn)(m))throw new Error('You provided an i18nBreadcrumbResolver for url "'+G.url+"\" but no breadcrumbKey in the route's data");return{provider:b,key:m,url:(0,S.F)(G)}}},78971:(W,j,o)=>{"use strict";o.d(j,{O:()=>I});var u=o(96354),T=o(63897),S=o(80183);class I extends T.W{findByHref(a,E=!0,R=!0,...G){return super.findByHref(a,E,R,...G).pipe((0,S.qD)(),(0,u.T)(x=>{if(x.hasFailed)throw new Error("Couldn't retrieve the config");return x}))}findByName(a,E=!0,R=!0,...G){return super.findById(a,E,R,...G)}}},4319:(W,j,o)=>{"use strict";o.r(j),o.d(j,{SubmissionAccessesConfigDataService:()=>E});var u=o(72734),T=o(41684),S=o(32473),I=o(4910),y=o(78971),a=o(54438);let E=(()=>{class R extends y.O{constructor(x,b,m,c){super("submissionaccessoptions",x,b,m,c),this.requestService=x,this.rdbService=b,this.objectCache=m,this.halService=c}findByHref(x,b=!0,m=!0,...c){return super.findByHref(x,b,m,...c)}static{this.\u0275fac=function(b){return new(b||R)(a.KVO(S.B),a.KVO(u.o),a.KVO(T.$),a.KVO(I.Y))}}static{this.\u0275prov=a.jDH({token:R,factory:R.\u0275fac,providedIn:"root"})}}return R})()},43928:(W,j,o)=>{"use strict";o.r(j),o.d(j,{SubmissionFormsConfigDataService:()=>E});var u=o(72734),T=o(41684),S=o(32473),I=o(4910),y=o(78971),a=o(54438);let E=(()=>{class R extends y.O{constructor(x,b,m,c){super("submissionforms",x,b,m,c),this.requestService=x,this.rdbService=b,this.objectCache=m,this.halService=c}findByHref(x,b=!0,m=!0,...c){return super.findByHref(x,b,m,...c)}static{this.\u0275fac=function(b){return new(b||R)(a.KVO(S.B),a.KVO(u.o),a.KVO(T.$),a.KVO(I.Y))}}static{this.\u0275prov=a.jDH({token:R,factory:R.\u0275fac,providedIn:"root"})}}return R})()},51345:(W,j,o)=>{"use strict";o.r(j),o.d(j,{SubmissionUploadsConfigDataService:()=>E});var u=o(72734),T=o(41684),S=o(32473),I=o(4910),y=o(78971),a=o(54438);let E=(()=>{class R extends y.O{constructor(x,b,m,c){super("submissionuploads",x,b,m,c),this.requestService=x,this.rdbService=b,this.objectCache=m,this.halService=c}findByHref(x,b=!0,m=!0,...c){return super.findByHref(x,b,m,...c)}static{this.\u0275fac=function(b){return new(b||R)(a.KVO(S.B),a.KVO(u.o),a.KVO(T.$),a.KVO(I.Y))}}static{this.\u0275prov=a.jDH({token:R,factory:R.\u0275fac,providedIn:"root"})}}return R})()},17184:(W,j,o)=>{"use strict";o.d(j,{C:()=>G});var u=o(12866),T=o(82777),S=o(43903),I=o(61280),y=o(43235),a=o(98107),E=o(54438),R=o(25499);let G=(()=>{class x{constructor(m){this.store=m}add(m,c,g=!1,_=!1){this.store.dispatch(new a.X2(m.rootElement,m.subRootElement,m.path,this.prepareValue(c,_,g)))}replace(m,c,g=!1){(0,T.Tn)(c)||"object"==typeof c&&(0,T.Tn)(c.value)?this.remove(m):this.store.dispatch(new a.kM(m.rootElement,m.subRootElement,m.path,this.prepareValue(c,g,!1)))}move(m,c){this.store.dispatch(new a.td(m.rootElement,m.subRootElement,c,m.path))}remove(m){this.store.dispatch(new a.QZ(m.rootElement,m.subRootElement,m.path))}flushOperation(m){this.store.dispatch(new a.qy(m.rootElement,m.subRootElement,m.path))}prepareValue(m,c,g){let _=null;return(0,T.a4)(m)&&(c?_=m:Array.isArray(m)?(_=[],m.forEach(t=>{_.push("object"==typeof t?this.prepareObjectValue(t):new I.e(t))})):_="object"==typeof m?this.prepareObjectValue(m):new I.e(m)),g&&!Array.isArray(_)?[_]:_}prepareObjectValue(m){let c=Object.create({});return(0,T.Im)(m)||m instanceof I.e?c=m:m instanceof Date?c=new I.e((0,u.Sd)(m)):m instanceof y.b?c=this.prepareAuthorityValue(m):m instanceof S.r?c=new I.e(m.value,m.language):m.hasOwnProperty("authority")?c=new I.e(m.value,m.language,m.authority):(0,u.z5)(m)?c=new I.e((0,u.$T)(m)):m.hasOwnProperty("value")?c=new I.e(m.value):Object.keys(m).forEach(g=>{c[g]="object"==typeof m[g]?this.prepareObjectValue(m[g]):m[g]}),c}prepareAuthorityValue(m){let c;return c=(0,T.hj)(m.authority)?new I.e(m.value,m.language,m.authority):new I.e(m.value,m.language),c}static{this.\u0275fac=function(c){return new(c||x)(E.KVO(R.il))}}static{this.\u0275prov=E.jDH({token:x,factory:x.\u0275fac,providedIn:"root"})}}return x})()},25521:(W,j,o)=>{"use strict";o.r(j),o.d(j,{ResourcePolicyDataService:()=>J});var u=o(21626),T=o(96354),S=o(61594),I=o(82777),y=o(39806),a=o(72734),E=o(53954),R=o(41684),G=o(39280),x=o(13617),b=o(63897),m=o(87158),c=o(35108),g=o(37419),_=o(41023),t=o(43052),D=o(32473),B=o(14410),C=o(74449),L=o(44494),A=o(4910),k=o(80183),f=o(54438);let J=(()=>{class M extends b.W{constructor(Y,U,Q,H,Z,q,rt,ot){super("resourcepolicies",Y,U,Q,H),this.requestService=Y,this.rdbService=U,this.objectCache=Q,this.halService=H,this.notificationsService=Z,this.comparator=q,this.ePersonService=rt,this.groupService=ot,this.searchByEPersonMethod="eperson",this.searchByGroupMethod="group",this.searchByResourceMethod="resource",this.createData=new G.V(this.linkPath,Y,U,Q,H,Z,this.responseMsToLive),this.searchData=new c.X(this.linkPath,Y,U,Q,H,this.responseMsToLive),this.patchData=new m.n(this.linkPath,Y,U,Q,H,q,this.responseMsToLive,this.constructIdEndpoint),this.deleteData=new x.I(this.linkPath,Y,U,Q,H,Z,this.responseMsToLive,this.constructIdEndpoint)}create(Y,U,Q,H){const Z=[];return Z.push(new E.x("resource",U)),(0,I.hj)(Q)?Z.push(new E.x("eperson",Q)):(0,I.hj)(H)&&Z.push(new E.x("group",H)),this.createData.create(Y,...Z)}delete(Y){return this.deleteData.delete(Y).pipe((0,k.qD)(),(0,T.T)(U=>U.hasSucceeded))}update(Y){return this.patchData.update(Y)}getDefaultAccessConditionsFor(Y,U){return this.findListByHref(Y._links.defaultAccessConditions.href,U)}searchByEPerson(Y,U,Q=!0,H=!0,...Z){const q=new _._;return q.searchParams=[new E.x("uuid",Y)],(0,I.hj)(U)&&q.searchParams.push(new E.x("resource",U)),this.searchData.searchBy(this.searchByEPersonMethod,q,Q,H,...Z)}searchByGroup(Y,U,Q=!0,H=!0,...Z){const q=new _._;return q.searchParams=[new E.x("uuid",Y)],(0,I.hj)(U)&&q.searchParams.push(new E.x("resource",U)),this.searchData.searchBy(this.searchByGroupMethod,q,Q,H,...Z)}searchByResource(Y,U,Q=!0,H=!0,...Z){const q=new _._;return q.searchParams=[new E.x("uuid",Y)],(0,I.hj)(U)&&q.searchParams.push(new E.x("action",U)),this.searchData.searchBy(this.searchByResourceMethod,q,Q,H,...Z)}updateTarget(Y,U,Q,H){const q=("eperson"===H?this.ePersonService:this.groupService).getIDHrefObs(Q),rt=Object.create({});let ot=new u.Lr;ot=ot.append("Content-Type","text/uri-list"),rt.headers=ot;const et=this.requestService.generateRequestId();return q.pipe((0,S.$)()).subscribe(gt=>{const ht=new t.v_(et,U+"/"+H,gt,rt);Object.assign(ht,{getResponseParser:()=>B.M}),this.requestService.send(ht)}),this.rdbService.buildFromRequestUUIDAndAwait(et,()=>this.invalidateByHref(U))}static{this.\u0275fac=function(U){return new(U||M)(f.KVO(D.B),f.KVO(a.o),f.KVO(R.$),f.KVO(A.Y),f.KVO(y.I),f.KVO(g.Y),f.KVO(C.EPersonDataService),f.KVO(L.GroupDataService))}}static{this.\u0275prov=f.jDH({token:M,factory:M.\u0275fac,providedIn:"root"})}}return M})()},27482:(W,j,o)=>{"use strict";o.d(j,{X:()=>T});var u=o(67600);const T=[(0,u.s)("item"),(0,u.s)("collection")]},86098:(W,j,o)=>{"use strict";o.d(j,{S:()=>I});var u=o(25558),T=o(80183),S=o(27482);const I=(y,a,E)=>E.findById(y.params.id,!0,!1,...S.X).pipe((0,T.qD)(),(0,u.n)(R=>R.payload.item),(0,T.qD)())},26373:(W,j,o)=>{"use strict";o.d(j,{q:()=>I});var u=o(96354),T=o(80183),S=o(27482);class I{constructor(a,E){this.dataService=a,this.breadcrumbService=E}resolve(a,E){return this.dataService.findById(a.params.id,!0,!1,...S.X).pipe((0,T.qD)(),(0,T.Bo)(),(0,u.T)(R=>({provider:this.breadcrumbService,key:R})))}}},73138:(W,j,o)=>{"use strict";o.r(j),o.d(j,{SubmissionCcLicenseDataService:()=>R});var u=o(72734),T=o(41684),S=o(49802),I=o(46787),y=o(32473),a=o(4910),E=o(54438);let R=(()=>{class G extends S.L{constructor(b,m,c,g){super("submissioncclicenses",b,m,c,g),this.requestService=b,this.rdbService=m,this.objectCache=c,this.halService=g,this.linkPath="submissioncclicenses",this.findAllData=new I.H(this.linkPath,b,m,c,g,this.responseMsToLive)}findAll(b,m,c,...g){return this.findAllData.findAll(b,m,c,...g)}static{this.\u0275fac=function(m){return new(m||G)(E.KVO(y.B),E.KVO(u.o),E.KVO(T.$),E.KVO(a.Y))}}static{this.\u0275prov=E.jDH({token:G,factory:G.\u0275fac,providedIn:"root"})}}return G})()},79914:(W,j,o)=>{"use strict";o.r(j),o.d(j,{SubmissionCcLicenseUrlDataService:()=>m});var u=o(25558),T=o(96354),S=o(72734),I=o(53954),y=o(41684),a=o(49802),E=o(35108),R=o(32473),G=o(4910),x=o(80183),b=o(54438);let m=(()=>{class c extends a.L{constructor(_,t,D,B){super("submissioncclicenseUrls-search",_,t,D,B),this.requestService=_,this.rdbService=t,this.objectCache=D,this.halService=B,this.searchData=new E.X(this.linkPath,_,t,D,B,this.responseMsToLive,(C,L)=>`${C}/${L}`)}getCcLicenseLink(_,t){return this.searchData.getSearchByHref("rightsByQuestions",{searchParams:[new I.x("license",_.id),..._.fields.map(D=>new I.x(`answer_${D.id}`,t.get(D).id))]}).pipe((0,u.n)(D=>this.findByHref(D)),(0,x.yd)(),(0,x.Bo)(),(0,T.T)(D=>D.url))}searchBy(_,t,D,B,...C){return this.searchData.searchBy(_,t,D,B,...C)}static{this.\u0275fac=function(t){return new(t||c)(b.KVO(R.B),b.KVO(S.o),b.KVO(y.$),b.KVO(G.Y))}}static{this.\u0275prov=b.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})()},44855:(W,j,o)=>{"use strict";o.d(j,{i:()=>m});var u=o(7673),T=o(84572),S=o(25558),I=o(69799),y=o(82777),a=o(61010),E=o(67045),R=o(96526),G=o(6983),x=o(80183),b=o(54438);let m=(()=>{class c{constructor(_,t,D,B){this.dsoNameService=_,this.dsoBreadcrumbsService=t,this.submissionService=D,this.collectionService=B}getBreadcrumbs(_){return(0,y.Im)(_)?(0,u.of)([]):(0,T.z)([_.collection.pipe((0,x.qD)(),(0,x.Bo)()),this.submissionService.getSubmissionCollectionId(_.id)]).pipe((0,S.n)(([t,D])=>(0,y.a4)(D)?this.collectionService.findById(D).pipe((0,x.qD)(),(0,x.Bo)()):(0,u.of)(t)),(0,S.n)(t=>this.dsoBreadcrumbsService.getBreadcrumbs(t,(0,I.wN)(t))))}static{this.\u0275fac=function(t){return new(t||c)(b.KVO(R.f),b.KVO(E.U),b.KVO(a.E),b.KVO(G.CollectionDataService))}}static{this.\u0275prov=b.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})()},43903:(W,j,o)=>{"use strict";o.d(j,{r:()=>u});class u{constructor(S,I){this.value=S,this.language=I}}},67026:(W,j,o)=>{"use strict";o.r(j),o.d(j,{SubmissionEditComponent:()=>t});var u=o(84412),T=o(25558),S=o(5964),I=o(70152),y=o(29326),a=o(80183),E=o(83203),R=o(82777),G=o(39806),x=o(31608),b=o(61010),m=o(7020),c=o(54438),g=o(7901),_=o(41780);let t=(()=>{class D{constructor(C,L,A,k,f,J,M,V){this.changeDetectorRef=C,this.notificationsService=L,this.route=A,this.router=k,this.itemDataService=f,this.submissionService=J,this.translate=M,this.submissionJsonPatchOperationsService=V,this.collectionModifiable=null,this.subs=[],this.itemLink$=new u.t(void 0)}ngOnInit(){this.collectionModifiable=this.route.snapshot.data?.collectionModifiable??null,this.subs.push(this.route.paramMap.pipe((0,T.n)(C=>this.submissionService.retrieveSubmission(C.get("id"))),(0,S.p)(C=>(0,R.Pe)(C))).subscribe(C=>{if(C.hasSucceeded)if((0,R.Im)(C.payload))this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"]);else{const{errors:L}=C.payload;this.submissionErrors=(0,m.A)(L),this.submissionId=C.payload.id.toString(),this.collectionId=C.payload.collection.id,this.selfUrl=C.payload._links.self.href,this.sections=C.payload.sections,this.itemLink$.next(C.payload._links.item.href),this.item=C.payload.item,this.submissionDefinition=C.payload.submissionDefinition}else 404===C.statusCode&&this.router.navigate(["/404"],{skipLocationChange:!0})}),this.itemLink$.pipe((0,R.VT)(),(0,T.n)(C=>this.itemDataService.findByHref(C)),(0,a.v7)(),(0,I.B)(300)).subscribe(C=>{this.item=C.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(C=>(0,R.a4)(C)).forEach(C=>C.unsubscribe()),this.submissionJsonPatchOperationsService.deletePendingJsonPatchOperations()}static{this.\u0275fac=function(L){return new(L||D)(c.rXU(c.gRc),c.rXU(G.I),c.rXU(g.nX),c.rXU(g.Ix),c.rXU(y.ItemDataService),c.rXU(b.E),c.rXU(_.c$),c.rXU(E.U))}}static{this.\u0275cmp=c.VBU({type:D,selectors:[["ds-base-submission-edit"]],standalone:!0,features:[c.aNF],decls:2,vars:8,consts:[[1,"submission-submit-container"],[3,"collectionId","sections","selfUrl","submissionDefinition","submissionErrors","item","collectionModifiable","submissionId"]],template:function(L,A){1&L&&(c.j41(0,"div",0),c.nrm(1,"ds-submission-form",1),c.k0s()),2&L&&(c.R7$(),c.Y8G("collectionId",A.collectionId)("sections",A.sections)("selfUrl",A.selfUrl)("submissionDefinition",A.submissionDefinition)("submissionErrors",A.submissionErrors)("item",A.item)("collectionModifiable",A.collectionModifiable)("submissionId",A.submissionId))},dependencies:[x.a]})}}return D})()},83558:(W,j,o)=>{"use strict";o.d(j,{r:()=>a});var u=o(8886),S=(o(67026),o(54438));const I=["*"];function y(E,R){}let a=(()=>{class E extends u.J{getComponentName(){return"SubmissionEditComponent"}importThemedComponent(G){return o(9048)(`./${G}/app/submission/edit/submission-edit.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,67026))}static{this.\u0275fac=(()=>{let G;return function(b){return(G||(G=S.xGo(E)))(b||E)}})()}static{this.\u0275cmp=S.VBU({type:E,selectors:[["ds-submission-edit"]],standalone:!0,features:[S.Vt3,S.aNF],ngContentSelectors:I,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(x,b){1&x&&(S.NAR(),S.DNE(0,y,0,0,"ng-template",null,0,S.C5r),S.j41(2,"div",null,1),S.SdG(4),S.k0s())},encapsulation:2})}}return E})()},31608:(W,j,o)=>{"use strict";o.d(j,{a:()=>ws});var u=o(60177),T=o(48125),S=o.n(T),I=o(7673),y=o(5964),a=o(96354),E=o(23294),R=o(25558),G=o(67116),b=(o(25168),o(4910)),c=(o(88318),o(82777)),g=o(82394),_=o(32979),t=o(54438),D=o(58003),B=o(41780),C=o(16292),L=o(47978),A=o(89488),k=o.n(A),f=o(61010),J=o(90049),M=o(72147),V=o(88643);let Y=(()=>{class n{constructor(e,i,s){this.changeDetectorRef=e,this.submissionService=i,this.sectionService=s,this.mandatory=!0,this.genericSectionErrors=[],this.allSectionErrors=[],this.active=!0,this.sectionState=this.mandatory,this.subs=[]}ngOnInit(){this.valid=this.sectionService.isSectionValid(this.submissionId,this.sectionId).pipe((0,a.T)(e=>(e&&this.resetErrors(),e))),this.subs.push(this.sectionService.getShownSectionErrors(this.submissionId,this.sectionId,this.sectionType).subscribe(e=>{(0,c.hj)(e)?e.forEach(i=>{(0,J.A)(i.path).forEach(r=>{r.fieldId?this.allSectionErrors.push(i.message):this.genericSectionErrors=k()(this.genericSectionErrors.concat(i.message))})}):this.resetErrors()}),this.submissionService.getActiveSectionId(this.submissionId).subscribe(e=>{const i=this.active;this.active=e===this.sectionId,i!==this.active&&(this.changeDetectorRef.detectChanges(),!this.active&&(0,c.Pe)(e)&&this.submissionService.dispatchSave(this.submissionId))})),this.enabled=this.sectionService.isSectionEnabled(this.submissionId,this.sectionId)}ngOnDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}sectionChange(e){this.sectionState=e.nextState}isOpen(){return this.sectionState}isMandatory(){return this.mandatory}isSectionActive(){return this.active}isEnabled(){return this.enabled}isValid(){return this.valid}removeSection(e,i){this.sectionService.removeSection(e,i)}hasGenericErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0}hasErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0||this.allSectionErrors&&this.allSectionErrors.length>0}getErrors(){return this.genericSectionErrors}setFocus(e){this.active||this.submissionService.setActiveSection(this.submissionId,this.sectionId)}isInfo(){return this.sectionService.getIsInformational(this.sectionType)}removeError(e){this.genericSectionErrors.splice(e)}resetErrors(){(0,c.hj)(this.genericSectionErrors)&&this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionId),this.genericSectionErrors=[],this.allSectionErrors=[]}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(t.gRc),t.rXU(f.E),t.rXU(M.c))}}static{this.\u0275dir=t.FsC({type:n,selectors:[["","dsSection",""]],inputs:{mandatory:"mandatory",sectionId:"sectionId",sectionType:"sectionType",submissionId:"submissionId"},exportAs:["sectionRef"],standalone:!0})}}return n})();var U=o(1473),Q=o(84572),H=o(96697),Z=o(73028),q=o(4319),rt=o(92409),ot=o(17184),et=o(80183),gt=o(83203),ft=o(12866),ht=o(33126),l=o(13143),vt=o(54002),$t=o(93583),At=o(83278),Ft=o.n(At),Dt=o(43235),Rt=o(36599),Gt=o(43903),St=o(61280);let Tt=(()=>{class n{constructor(e,i){this.formBuilder=e,this.operationsBuilder=i}dispatchOperationsFromEvent(e,i,s,r){switch(i.type){case"remove":this.dispatchOperationsFromRemoveEvent(e,i,s);break;case"change":this.dispatchOperationsFromChangeEvent(e,i,s,r);break;case"move":this.dispatchOperationsFromMoveEvent(e,i,s)}}getArrayIndexFromEvent(e){let i;return(0,c.hj)(e)&&((0,U.hDs)(e)?(0,c.kZ)(e.context)?this.isPartOfArrayOfGroup(e.model)&&(i=e.model.parent.parent.index):i=e.context.index:i=e?.index),(0,c.EA)(i)?i:0}isPartOfArrayOfGroup(e){return(0,c.Pe)(e.parent)&&e.parent.type===U.wnr&&e.parent.parent&&e.parent.parent.context&&e.parent.parent.context.type===U.WlY}getQualdropValueMap(e){const i=new Map;return(this.formBuilder.isQualdropGroup(e.model)?e.model.parent.context:e.model.parent.parent.context).groups.forEach(r=>{const p=r.group[0],h=i.get(p.qualdropId)?i.get(p.qualdropId):[];p.value&&(h.push(p.value),i.set(p.qualdropId,h))}),i}getFieldPathFromEvent(e){const i=this.getArrayIndexFromEvent(e),s=this.getFieldPathSegmentedFromChangeEvent(e);return(0,c.EA)(i)?s+"/"+i:s}getQualdropItemPathFromEvent(e){const i=this.getArrayIndexFromEvent(e),s=new Map;let r=null;return(this.formBuilder.isQualdropGroup(e.model)?e.model.parent.context:e.model.parent.parent.context).groups.forEach((h,P)=>{const N=h.group[0],tt=s.get(N.qualdropId)?s.get(N.qualdropId):[];N.value&&(tt.push(N.value),s.set(N.qualdropId,tt)),P===i&&(r=N.qualdropId+"/"+(tt.length-1))}),r}getFieldPathSegmentedFromChangeEvent(e){let i;return i=this.formBuilder.isQualdropGroup(e.model)?e.model.qualdropId:this.formBuilder.isQualdropGroup(e.model.parent)?e.model.parent.qualdropId:this.formBuilder.getId(e.model),i}getFieldValueFromChangeEvent(e){let i;const s=e.model.value;if(this.formBuilder.isModelInCustomGroup(e.model))i=e.model.parent.value;else if(this.formBuilder.isRelationGroup(e.model))i=e.model.getGroupValue();else if(e.model.hasLanguages){const r=e.model.language;e.model.hasAuthority?Array.isArray(s)?(s.forEach((p,h)=>{p=Object.assign(new Dt.b,p,{language:r}),s[h]=p}),i=s):i=Object.assign(new Dt.b,s,{language:r}):i=new St.e(s,r)}else i=(0,ft.z5)(s)?new St.e((0,ft.$T)(s)):s instanceof Gt.r||s instanceof Dt.b||s instanceof Rt.M||Ft()(s)?s:new St.e(s);return i}getValueMap(e){const i=new Map;return e.forEach(s=>{Object.keys(s).forEach(r=>{const p=i.get(r)?i.get(r):[];p.push(s[r]),i.set(r,p)})}),i}dispatchOperationsFromRemoveEvent(e,i,s){const r=this.getFieldPathFromEvent(i),p=this.getFieldValueFromChangeEvent(i);this.formBuilder.isQualdropGroup(i.model)?this.dispatchOperationsFromMap(this.getQualdropValueMap(i),e,i,s):i.context&&i.context instanceof U.fHx?this.handleArrayGroupPatch(e,i,i.context.context,s):((0,c.hj)(p)&&"string"==typeof p||(0,c.hj)(p)&&p instanceof St.e&&p.hasValue())&&this.operationsBuilder.remove(e.getPath(r))}dispatchOperationsFromAddEvent(e,i){const s=this.getFieldPathSegmentedFromChangeEvent(i),r=(0,$t.Go)(this.getFieldValueFromChangeEvent(i));(0,c.hj)(r)&&(r.place=this.getArrayIndexFromEvent(i),(0,c.a4)(i.group)&&(0,c.a4)(i.group.value)&&(1===i.group.value.map(h=>Object.values(h)).reduce((h,P)=>h.concat(P)).filter(h=>(0,c.hj)(h)).length?this.operationsBuilder.add(e.getPath([s]),[r],!1):this.operationsBuilder.add(e.getPath([s,"-"]),r,!1)))}dispatchOperationsFromChangeEvent(e,i,s,r){if(i.context&&i.context instanceof U.fHx)return void this.handleArrayGroupPatch(e,i,i.context.context,s);const p=this.getFieldPathFromEvent(i),h=this.getFieldPathSegmentedFromChangeEvent(i),P=this.getFieldValueFromChangeEvent(i);if(this.formBuilder.isQualdropGroup(i.model.parent)||this.formBuilder.isQualdropGroup(i.model))this.dispatchOperationsFromMap(this.getQualdropValueMap(i),e,i,s);else if(this.formBuilder.isRelationGroup(i.model))this.dispatchOperationsFromMap(this.getValueMap(P),e,i,s);else if(this.formBuilder.hasArrayGroupValue(i.model))this.operationsBuilder.add(e.getPath(h),P,!0);else if(s.isPathEqual(this.formBuilder.getPath(i.model))||r&&(0,c.hj)(s.value)){if((0,c.a4)(i.$event)&&(0,c.a4)(i.$event.previousIndex))if(i.$event.previousIndex<0)this.operationsBuilder.add(e.getPath(h),P,!0);else{const N=e.getPath(p),tt=e.getPath(h+"/"+i.$event.previousIndex);(0,c.hj)(tt.path)&&(0,c.hj)(N.path)&&tt.path!==N.path&&this.operationsBuilder.move(N,tt.path)}else P.hasValue()?this.operationsBuilder.replace(e.getPath(p),P):0===this.getArrayIndexFromEvent(i)?this.operationsBuilder.remove(e.getPath(h)):this.operationsBuilder.remove(e.getPath(p));s.delete()}else P.hasValue()&&((0,c.b0)(this.getArrayIndexFromEvent(i))||0===this.getArrayIndexFromEvent(i)?this.operationsBuilder.add(e.getPath(h),P,!0):this.operationsBuilder.add(e.getPath(p),P))}dispatchOperationsFromMap(e,i,s,r){const p=e;if("remove"===s.type){const h=this.getQualdropItemPathFromEvent(s);this.operationsBuilder.remove(i.getPath(h))}else r.isPathEqual(this.formBuilder.getPath(s.model))&&r.value.forEach((h,P)=>{const N=p.get(P);N?(S()(h,N)||this.operationsBuilder.add(i.getPath(P),N,!0),p.delete(P)):N||this.operationsBuilder.remove(i.getPath(P))}),p.forEach((h,P)=>{1===h.length&&(0,c.kZ)(h[0])?this.operationsBuilder.remove(i.getPath(P)):this.operationsBuilder.add(i.getPath(P),h,!0)});r.delete()}dispatchOperationsFromMoveEvent(e,i,s){return this.handleArrayGroupPatch(e,i.$event,i.$event.arrayModel,s)}handleArrayGroupPatch(e,i,s,r){const p=this.formBuilder.getValueFromModel([s]),h=this.getFieldPathSegmentedFromChangeEvent(i);(0,c.hj)(p)?this.operationsBuilder.add(e.getPath(h),p[h],!1):r.isPathEqual(this.formBuilder.getPath(i.model))&&this.operationsBuilder.remove(e.getPath(h))}static{this.\u0275fac=function(i){return new(i||n)(t.KVO(ht.j),t.KVO(ot.C))}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Mt=o(99172);let mt=(()=>{class n{constructor(e,i,s){this.injectedCollectionId=e,this.injectedSectionData=i,this.injectedSubmissionId=s,this.collectionId=e,this.sectionData=i,this.submissionId=s}ngOnInit(){this.onSectionInit(),this.updateSectionStatus()}updateSectionStatus(){this.sectionStatusSub=this.getSectionStatus().pipe((0,y.p)(e=>(0,c.EA)(e)),(0,Mt.Z)(!0)).subscribe(e=>{this.sectionService.setSectionStatus(this.submissionId,this.sectionData.id,e)})}ngOnDestroy(){(0,c.a4)(this.sectionStatusSub)&&this.sectionStatusSub.unsubscribe(),this.onSectionDestroy()}static{this.\u0275fac=function(i){return new(i||n)(t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-section-model"]],decls:0,vars:0,template:function(i,s){},encapsulation:2})}}return n})();const Lt={id:"discoverable",name:"discoverable"},Nt={element:{container:"custom-control custom-checkbox ps-1",control:"custom-control-input",label:"custom-control-label pt-1"}},K={id:"accessConditionGroup",group:[]},bt={element:{host:"mb-3 access-condition-group col",container:"ps-1 pe-1",control:"row "}},v={id:"accessCondition",groupFactory:null},O={grid:{group:"row pt-4"}},F={id:"name",label:"submission.sections.accesses.form.access-condition-label",hint:"submission.sections.accesses.form.access-condition-hint",options:[]},X={element:{host:"col-12",label:"col-form-label name-label"}},$={id:"startDate",label:"submission.sections.accesses.form.from-label",hint:"submission.sections.accesses.form.from-hint",placeholder:"submission.sections.accesses.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:U.AjF,operator:U.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-from"}},w={element:{label:"col-form-label"},grid:{host:"col-6"}},z={id:"endDate",label:"submission.sections.accesses.form.until-label",hint:"submission.sections.accesses.form.until-hint",placeholder:"submission.sections.accesses.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:U.AjF,operator:U.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-until"}},ut={element:{label:"col-form-label"},grid:{host:"col-6"}};var ct=o(645),pt=o(25499);let Ot=(()=>{class n{constructor(e){this.store=e}getAccessesData(e,i){return this.store.select((0,ct.on)(e,i)).pipe((0,y.p)(s=>(0,c.EA)(s)),(0,E.F)())}static{this.\u0275fac=function(i){return new(i||n)(t.KVO(pt.il))}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();const Vt=["formRef"];function Xt(n,d){if(1&n){const e=t.RV6();t.j41(0,"ds-form",2,0),t.bIt("dfChange",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onChange(s))})("removeArrayItem",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onRemove(s))}),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("formId",e.formId)("formModel",e.formModel)("displaySubmit",!1)("displayCancel",!1)}}let Yt=(()=>{class n extends mt{constructor(e,i,s,r,p,h,P,N,tt,at,dt){super(void 0,at,dt),this.sectionService=e,this.formBuilderService=i,this.accessesConfigService=s,this.accessesService=r,this.formOperationsService=p,this.operationsBuilder=h,this.formService=P,this.translate=N,this.operationsService=tt,this.injectedSectionData=at,this.injectedSubmissionId=dt,this.subs=[]}initModelData(e){this.accessesData.accessConditions.forEach((i,s)=>{Array.of("name","startDate","endDate").filter(r=>i.hasOwnProperty(r)&&(0,c.hj)(i[r])).forEach(r=>{const p=this.formBuilderService.findById(r,e,s);if(p)if(p.type===U.fQD){const h=new Date(i[r]);p.value={year:h.getUTCFullYear(),month:h.getUTCMonth()+1,day:h.getUTCDate()}}else p.value=i[r]})})}onChange(e){if(e.model.type===U.eU4){const i=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),s=this.formOperationsService.getFieldValueFromChangeEvent(e);this.operationsBuilder.replace(this.pathCombiner.getPath(i),s.value,!0)}else{if(e.model.id===F.id){const i=e.control.parent.get("startDate"),s=e.control.parent.get("endDate");i?.markAsUntouched(),s?.markAsUntouched(),i?.setValue(null),s?.setValue(null),e.control.parent.markAsDirty()}this.formService.validateAllFormFields(this.formRef.formGroup),this.formService.isValid(this.formId).pipe((0,H.s)(1),(0,y.p)(i=>i),(0,Z.Z)(()=>this.formService.getFormData(this.formId)),(0,H.s)(1)).subscribe(i=>{const s=[];i.accessCondition.map(r=>r.accessConditionGroup).filter(r=>(0,c.hj)(r)).forEach(r=>{let p;if(this.availableAccessConditionOptions.filter(h=>(0,c.Pe)(r.name)&&h.name===r.name[0].value).forEach(h=>p=h),p){const h=Object.assign({},r);if(h.name=this.retrieveValueFromField(r.name),p.hasStartDate){if(r.startDate){const P=this.retrieveValueFromField(r.startDate);h.startDate=(0,ft.Sd)(P)}}else delete h.startDate;if(p.hasEndDate){if(r.endDate){const P=this.retrieveValueFromField(r.endDate);h.endDate=(0,ft.Sd)(P)}}else delete h.endDate;s.push(h)}}),this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),s,!0)})}}onRemove(e){const s="accessConditions/"+this.formOperationsService.getArrayIndexFromEvent(e);this.operationsBuilder.remove(this.pathCombiner.getPath(s))}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}onSectionInit(){this.pathCombiner=new rt.S("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id);const e=this.accessesConfigService.findByHref(this.sectionData.config,!0,!1).pipe((0,et.yd)(),(0,a.T)(s=>s.payload)),i=this.accessesService.getAccessesData(this.submissionId,this.sectionData.id);(0,Q.z)([e,i]).subscribe(([s,r])=>{this.availableAccessConditionOptions=(0,c.hj)(s.accessConditionOptions)?s.accessConditionOptions:[],this.canChangeDiscoverable=!!s.canChangeDiscoverable,this.accessesData=r,this.formModel=this.buildFileEditForm()})}getSectionStatus(){return(0,I.of)(!0)}buildFileEditForm(){const e=[];if(this.canChangeDiscoverable){const nt=Object.assign({},Lt,{label:this.translate.instant("submission.sections.accesses.form.discoverable-label"),hint:this.translate.instant("submission.sections.accesses.form.discoverable-description"),value:this.accessesData.discoverable});e.push(new U.M7d(nt,Nt))}const i=Object.assign({},F),s=Object.assign({},v),r=[];for(const nt of this.availableAccessConditionOptions)r.push({label:nt.name,value:nt.name});i.options=r;const p=[],h=[];let P,N;this.availableAccessConditionOptions.forEach(nt=>{if(nt.hasStartDate&&(p.push({id:"name",value:nt.name}),nt.maxStartDate)){const lt=new Date(nt.maxStartDate);P={year:lt.getUTCFullYear(),month:lt.getUTCMonth()+1,day:lt.getUTCDate()}}if(nt.hasEndDate&&(h.push({id:"name",value:nt.name}),nt.maxEndDate)){const lt=new Date(nt.maxEndDate);N={year:lt.getUTCFullYear(),month:lt.getUTCMonth()+1,day:lt.getUTCDate()}}});const tt={relations:[{match:U.AjF,operator:U.fXj,when:p}]},at={relations:[{match:U.AjF,operator:U.fXj,when:h}]},dt=p.length>0,Et=h.length>0;return s.groupFactory=()=>{const nt=new U.z4z(i,X),lt=Object.assign({},$,tt);P&&(lt.max=P);const yt=Object.assign({},z,at);N&&(yt.max=N);const Js=new U.dku(lt,w),Hs=new U.dku(yt,ut),Ut=Object.assign({},K);return Ut.group=[nt],dt&&Ut.group.push(Js),Et&&Ut.group.push(Hs),[new U.iO5(Ut,bt)]},s.initialCount=(0,c.hj)(this.accessesData.accessConditions)?this.accessesData.accessConditions.length:1,e.push(new U.UqU(s,O)),this.initModelData(e),e}retrieveValueFromField(e){const i=Array.isArray(e)?e[0]:e;return i?i.value:void 0}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(M.c),t.rXU(ht.j),t.rXU(q.SubmissionAccessesConfigDataService),t.rXU(Ot),t.rXU(Tt),t.rXU(ot.C),t.rXU(vt.u),t.rXU(B.c$),t.rXU(gt.U),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-section-accesses"]],viewQuery:function(i,s){if(1&i&&t.GBs(Vt,5),2&i){let r;t.mGM(r=t.lsd())&&(s.formRef=r.first)}},standalone:!0,features:[t.Vt3,t.aNF],decls:1,vars:1,consts:[["formRef","formComponent"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem",4,"ngIf"],[3,"dfChange","removeArrayItem","formId","formModel","displaySubmit","displayCancel"]],template:function(i,s){1&i&&t.DNE(0,Xt,2,4,"ds-form",1),2&i&&t.Y8G("ngIf",!!s.formModel)},dependencies:[l.s,u.bT],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]})}}return n})();var It=o(89417),it=o(86820),st=o(88141),Pt=o(8917),kt=o(62572),Kt=o(73138),Ct=o(79914),jt=o(60456);const ne=[[["",8,"selection"]],[["",8,"menu"]]],se=[".selection",".menu"];function oe(n,d){if(1&n&&(t.j41(0,"span",4),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,1,e.label)," ")}}let ae=(()=>{class n{constructor(){this.toggled=new t.bkB,this.close=new t.bkB}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-select"]],inputs:{label:"label",disabled:"disabled"},outputs:{toggled:"toggled",close:"close"},standalone:!0,features:[t.aNF],ngContentSelectors:se,decls:8,vars:2,consts:[["ngbDropdown","",1,"btn-group",3,"openChange"],["id","dsSelectMenuLabel","class","input-group-text",4,"ngIf"],["aria-describedby","dsSelectMenuLabel","id","dsSelectMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary","selection",3,"blur","click","dsBtnDisabled"],["ngbDropdownMenu","","id","dsSelectDropdownMenu","aria-labelledby","dsSelectMenuButton",1,"dropdown-menu"],["id","dsSelectMenuLabel",1,"input-group-text"]],template:function(i,s){1&i&&(t.NAR(ne),t.j41(0,"div")(1,"div",0),t.bIt("openChange",function(p){return s.toggled.emit(p)}),t.DNE(2,oe,3,3,"span",1),t.j41(3,"button",2),t.bIt("blur",function(p){return s.close.emit(p)})("click",function(p){return s.close.emit(p)}),t.SdG(4),t.k0s(),t.j41(5,"div",3)(6,"div"),t.SdG(7,1),t.k0s()()()()),2&i&&(t.R7$(2),t.Y8G("ngIf",s.label),t.R7$(),t.Y8G("dsBtnDisabled",s.disabled))},dependencies:[D.zH,D.tg,D.do,D.U0,u.bT,B.h,B.D9,jt.A]})}}return n})();var Bt=o(18226);const re=(n,d)=>d.id,ce=()=>({standalone:!0});function le(n,d){1&n&&(t.j41(0,"button",7),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections.ccLicense.none")," "))}function de(n,d){if(1&n){const e=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG(3);return t.Njj(r.selectCcLicense(s))}),t.EFF(1),t.k0s()}if(2&n){const e=d.$implicit;t.R7$(),t.SpI(" ",e.name," ")}}function me(n,d){if(1&n&&t.Z7z(0,de,2,1,"button",8,re),2&n){const e=t.XpG(2);t.Dyx(e.submissionCcLicenses)}}function ue(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",2)(1,"div",4)(2,"input",5,0),t.nI1(4,"translate"),t.nI1(5,"translate"),t.mxI("ngModelChange",function(s){t.eBV(e);const r=t.XpG();return t.DH7(r.selectedCcLicense.name,s)||(r.selectedCcLicense.name=s),t.Njj(s)}),t.k0s(),t.j41(6,"div",6),t.bIt("scroll",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onScroll(s))}),t.DNE(7,le,3,3,"button",7)(8,me,2,0),t.k0s()()()}if(2&n){const e=t.XpG();t.R7$(2),t.FS9("placeholder",e.storedCcLicenseLink?t.bMT(5,11,"submission.sections.ccLicense.change"):t.bMT(4,9,"submission.sections.ccLicense.select")),t.R50("ngModel",e.selectedCcLicense.name),t.Y8G("ngModelOptions",t.lJ4(13,ce)),t.R7$(4),t.Y8G("infiniteScrollDistance",5)("infiniteScrollThrottle",300)("infiniteScrollUpDistance",1.5)("fromRoot",!0)("scrollWindow",!1),t.R7$(),t.vxM(7,0===(null==e.submissionCcLicenses?null:e.submissionCcLicenses.length)?7:8)}}function pe(n,d){if(1&n&&(t.j41(0,"div",11)(1,"h5"),t.EFF(2),t.k0s(),t.nrm(3,"div",20),t.k0s()),2&n){const e=d.$implicit;t.R7$(2),t.SpI(" ",e.label," "),t.R7$(),t.Y8G("innerHTML",e.description,t.npT)}}function _e(n,d){if(1&n){const e=t.RV6();t.j41(0,"div")(1,"div",16)(2,"div")(3,"h4"),t.EFF(4),t.k0s(),t.nrm(5,"div",17),t.k0s(),t.j41(6,"button",18),t.bIt("click",function(){t.eBV(e);const s=t.XpG(3);return t.Njj(s.closeInfoModal())}),t.k0s()(),t.j41(7,"div",19),t.DNE(8,pe,4,2,"div",10),t.k0s()()}if(2&n){const e=t.XpG().$implicit;t.R7$(4),t.SpI(" ",e.label," "),t.R7$(),t.Y8G("innerHTML",e.description,t.npT),t.R7$(3),t.Y8G("ngForOf",e.enums)}}function he(n,d){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const e=t.XpG().ngVar;t.R7$(),t.SpI(" ",e.label," ")}}function fe(n,d){1&n&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections.ccLicense.option.select")," "))}function be(n,d){if(1&n&&(t.qex(0,26),t.DNE(1,he,2,1,"span",3)(2,fe,3,3,"span",3),t.bVm()),2&n){const e=d.ngVar;t.R7$(),t.Y8G("ngIf",e),t.R7$(),t.Y8G("ngIf",!e)}}function ge(n,d){if(1&n){const e=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG(2).$implicit,p=t.XpG(2);return t.Njj(p.selectOption(p.getSelectedCcLicense(),r,s))}),t.EFF(1),t.k0s()}if(2&n){const e=d.$implicit;t.R7$(),t.SpI(" ",e.label," ")}}function ve(n,d){if(1&n&&(t.j41(0,"ds-select",21),t.DNE(1,be,3,2,"ng-container",22),t.qex(2,23),t.j41(3,"div",24),t.DNE(4,ge,2,1,"button",25),t.k0s(),t.bVm(),t.k0s()),2&n){const e=t.XpG().$implicit,i=t.XpG(2);t.Y8G("disabled","jurisdiction"===e.id&&void 0!==i.defaultJurisdiction&&"none"!==i.defaultJurisdiction),t.R7$(),t.Y8G("ngVar",i.getSelectedOption(i.getSelectedCcLicense(),e)),t.R7$(3),t.Y8G("ngForOf",e.enums)}}function Se(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",28)(1,"div",29),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG(2).$implicit,p=t.XpG(2);return t.Njj(p.selectOption(p.getSelectedCcLicense(),r,s))}),t.nrm(2,"input",30),t.j41(3,"span"),t.EFF(4),t.k0s()()()}if(2&n){const e=d.$implicit,i=t.XpG(2).$implicit,s=t.XpG(2);t.R7$(2),t.FS9("title",e.label),t.Y8G("checked",s.isSelectedOption(s.getSelectedCcLicense(),i,e)),t.R7$(2),t.JRh(e.label)}}function Ie(n,d){if(1&n&&(t.qex(0),t.DNE(1,Se,5,3,"div",27),t.bVm()),2&n){const e=t.XpG().$implicit;t.R7$(),t.Y8G("ngForOf",e.enums)}}function Ce(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",11)(1,"div",12)(2,"div"),t.EFF(3),t.k0s(),t.j41(4,"button",13),t.bIt("click",function(){t.eBV(e);const s=t.sdS(7),r=t.XpG(2);return t.Njj(r.openInfoModal(s))}),t.nrm(5,"i",14),t.k0s()(),t.DNE(6,_e,9,3,"ng-template",null,1,t.C5r)(8,ve,5,3,"ds-select",15)(9,Ie,2,1,"ng-container",3),t.k0s()}if(2&n){const e=d.$implicit;t.R7$(2),t.ZvI("fw-bold ",e.id,""),t.R7$(),t.SpI(" ",e.label," "),t.R7$(5),t.Y8G("ngIf",(null==e.enums?null:e.enums.length)>5),t.R7$(),t.Y8G("ngIf",(null==e.enums?null:e.enums.length)<=5)}}function Ee(n,d){if(1&n&&(t.qex(0),t.DNE(1,Ce,10,6,"div",10),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.getSelectedCcLicense().fields)}}function De(n,d){1&n&&(t.j41(0,"div"),t.nrm(1,"ds-loading"),t.k0s())}function Te(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",33)(1,"div"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"a",34),t.EFF(5),t.k0s(),t.j41(6,"div",35)(7,"div",29),t.bIt("click",function(){t.eBV(e);const s=t.XpG(3);return t.Njj(s.setAccepted(!s.accepted))}),t.nrm(8,"input",36),t.j41(9,"span"),t.EFF(10),t.nI1(11,"translate"),t.k0s()()()()}if(2&n){const e=t.XpG().ngVar,i=t.XpG(2);t.R7$(2),t.SpI(" ",t.bMT(3,5,"submission.sections.ccLicense.link")," "),t.R7$(2),t.FS9("href",e,t.B4B),t.R7$(),t.SpI(" ",e," "),t.R7$(3),t.Y8G("checked",i.accepted),t.R7$(2),t.SpI(" ",t.bMT(11,7,"submission.sections.ccLicense.confirmation"),"")}}function Me(n,d){if(1&n&&(t.qex(0),t.DNE(1,De,2,0,"div",3)(2,Te,12,9,"div",32),t.bVm()),2&n){const e=d.ngVar;t.R7$(),t.Y8G("ngIf",!e),t.R7$(),t.Y8G("ngIf",e)}}function Oe(n,d){if(1&n&&(t.qex(0),t.DNE(1,Me,3,2,"ng-container",31),t.nI1(2,"async"),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngVar",t.bMT(2,1,e.getCcLicenseLink$()))}}let ye=(()=>{class n extends mt{get storedCcLicenseLink(){return this.data.uri}get accepted(){return void 0===this.data.accepted?!!this.data.uri:this.data.accepted}constructor(e,i,s,r,p,h,P,N,tt,at){super(N,tt,at),this.modalService=e,this.sectionService=i,this.submissionCcLicensesDataService=s,this.submissionCcLicenseUrlDataService=r,this.operationsBuilder=p,this.configService=h,this.ref=P,this.injectedCollectionId=N,this.injectedSectionData=tt,this.injectedSubmissionId=at,this.isLoading=!0,this.subscriptions=[],this.submissionCcLicenses=[],this.selectedCcLicense=new kt.C,this.ccLicenceOptions={elementsPerPage:20,currentPage:1}}get data(){return this.sectionData.data}selectCcLicense(e){this.selectedCcLicense.id!==e.id&&(this.selectedCcLicense=e,this.setAccepted(!1),this.updateSectionData({ccLicense:{id:e.id,fields:{}},uri:void 0}))}getSelectedCcLicense(){return this.submissionCcLicenses&&this.data.ccLicense?this.submissionCcLicenses.filter(e=>e.id===this.data.ccLicense.id)[0]:null}selectOption(e,i,s){this.isSelectedOption(e,i,s)||this.updateSectionData({ccLicense:{id:e.id,fields:Object.assign({},this.data.ccLicense.fields,{[i.id]:s})},accepted:!1})}getSelectedOption(e,i){return"jurisdiction"===i.id&&void 0!==this.defaultJurisdiction&&"none"!==this.defaultJurisdiction?i.enums.find(s=>s.id===this.defaultJurisdiction):this.data.ccLicense.fields[i.id]}isSelectedOption(e,i,s){return this.getSelectedOption(e,i)&&this.getSelectedOption(e,i).id===s.id}getCcLicenseLink$(){if(this.storedCcLicenseLink)return(0,I.of)(this.storedCcLicenseLink);if(!this.getSelectedCcLicense()||this.getSelectedCcLicense().fields.some(i=>!this.getSelectedOption(this.getSelectedCcLicense(),i)))return;const e=this.getSelectedCcLicense();return this.submissionCcLicenseUrlDataService.getCcLicenseLink(e,new Map(e.fields.map(i=>[i,this.getSelectedOption(e,i)])))}openInfoModal(e){this.modalRef=this.modalService.open(e)}closeInfoModal(){this.modalRef.close()}getSectionStatus(){return(0,I.of)(this.accepted)}onSectionDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}onSectionInit(){this.pathCombiner=new rt.S("sections",this.sectionData.id),this.subscriptions.push(this.sectionService.getSectionState(this.submissionId,this.sectionData.id,V.l.CcLicense).pipe((0,y.p)(e=>(0,c.hj)(e)&&((0,c.hj)(e.data)||(0,c.hj)(e.errorsToShow))),(0,E.F)(),(0,a.T)(e=>e.data)).subscribe(e=>{if(this.data.accepted!==e.accepted){const i=this.pathCombiner.getPath("uri");e.accepted?this.getCcLicenseLink$().pipe((0,H.s)(1)).subscribe(s=>{this.operationsBuilder.add(i,s.toString(),!1,!0)}):this.data.uri&&this.operationsBuilder.remove(i)}this.sectionData.data=e}),this.configService.findByPropertyName("cc.license.jurisdiction").pipe((0,et.qD)(),(0,et.Bo)()).subscribe(e=>{this.defaultJurisdiction=void 0===e||0===e.values.length?"":e.values[0]})),this.loadCcLicences()}setAccepted(e){this.updateSectionData({accepted:e}),this.updateSectionStatus()}updateSectionData(e){this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,Object.assign({},this.data,e))}onScroll(e){e.target.scrollTop+e.target.clientHeight>=e.target.scrollHeight&&!this.isLoading&&!this._isLastPage&&(this.ccLicenceOptions.currentPage++,this.loadCcLicences())}loadCcLicences(){this.isLoading=!0,this.subscriptions.push(this.submissionCcLicensesDataService.findAll(this.ccLicenceOptions).pipe((0,et.ak)(),(0,st.M)(e=>this._isLastPage=e.pageInfo.currentPage===e.pageInfo.totalPages),(0,a.T)(e=>e.page)).subscribe(e=>{this.submissionCcLicenses=[...this.submissionCcLicenses,...e],this.isLoading=!1,this.ref.detectChanges()}))}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(D.Bq),t.rXU(M.c),t.rXU(Kt.SubmissionCcLicenseDataService),t.rXU(Ct.SubmissionCcLicenseUrlDataService),t.rXU(ot.C),t.rXU(Pt.ConfigurationDataService),t.rXU(t.gRc),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-cc-licenses"]],standalone:!0,features:[t.Vt3,t.aNF],decls:3,vars:3,consts:[["script","ngModel"],["infoModal",""],[1,"mb-4","ccLicense-select"],[4,"ngIf"],["ngbDropdown",""],["id","cc-license-dropdown","ngbDropdownToggle","","role","combobox",1,"form-control",3,"ngModelChange","ngModel","placeholder","ngModelOptions"],["ngbDropdownMenu","","aria-labelledby","cc-license-dropdown","role","menu","infiniteScroll","",1,"w-100","scrollable-menu",3,"scroll","infiniteScrollDistance","infiniteScrollThrottle","infiniteScrollUpDistance","fromRoot","scrollWindow"],[1,"dropdown-item","disabled"],[1,"dropdown-item"],[1,"dropdown-item",3,"click"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"d-flex","flex-row"],[1,"btn","btn-outline-info","btn-sm","ms-2",3,"click"],[1,"fas","fa-question"],[3,"disabled",4,"ngIf"],[1,"modal-header","mb-4"],[3,"innerHTML"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"fw-light",3,"innerHTML"],[3,"disabled"],["class","selection",4,"ngVar"],[1,"menu"],[1,"options-select-menu","overflow-auto"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"selection"],["class","d-flex flex-row m-1",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","m-1"],[3,"click"],["type","radio",1,"me-1",3,"title","checked"],[4,"ngVar"],["class","mt-2 p-4 bg-light text-dark",4,"ngIf"],[1,"mt-2","p-4","bg-light","text-dark"],["target","_blank","rel","noopener noreferrer",1,"license-link",3,"href"],[1,"m-2"],["type","checkbox","title","accepted",1,"me-2",3,"checked"]],template:function(i,s){1&i&&t.DNE(0,ue,9,14,"div",2)(1,Ee,2,1,"ng-container",3)(2,Oe,3,3,"ng-container",3),2&i&&(t.vxM(0,s.submissionCcLicenses?0:-1),t.R7$(),t.Y8G("ngIf",s.getSelectedCcLicense()),t.R7$(),t.Y8G("ngIf",s.getCcLicenseLink$()))},dependencies:[B.h,B.D9,u.bT,g.v,u.Jj,Bt.r,u.Sq,ae,D.zH,D.tg,D.do,D.U0,It.YN,It.me,It.BC,It.vS,it.eO,it.DP],styles:[".options-select-menu[_ngcontent-%COMP%]{max-height:25vh}.ccLicense-select[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content}.scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}"]})}}return n})();var Fe=o(39552),Re=o(45663),Pe=o(90887);function je(n,d){1&n&&(t.qex(0),t.j41(1,"div",3),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.bVm()),2&n&&(t.R7$(2),t.JRh(t.bMT(3,1,"submission.sections.duplicates.none")))}function Be(n,d){if(1&n&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=d.$implicit;t.R7$(),t.Lme(" ",t.bMT(2,2,"item.preview."+e.key)," ",e.value," ")}}function xe(n,d){1&n&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.duplicates.in-workspace")))}function Ue(n,d){1&n&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.duplicates.in-workflow")))}function $e(n,d){if(1&n&&(t.j41(0,"div",6)(1,"a",7),t.EFF(2),t.k0s(),t.DNE(3,Be,3,4,"div",8)(4,xe,3,3,"p",2)(5,Ue,3,3,"p",2),t.k0s()),2&n){const e=d.$implicit,i=t.XpG(3);t.R7$(),t.Y8G("href",i.getItemLink(e.uuid),t.B4B),t.R7$(),t.JRh(e.title),t.R7$(),t.Y8G("ngForOf",i.Metadata.toViewModelList(e.metadata)),t.R7$(),t.Y8G("ngIf",e.workspaceItemId),t.R7$(),t.Y8G("ngIf",e.workflowItemId)}}function Ae(n,d){if(1&n&&(t.qex(0),t.j41(1,"div",4),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.DNE(4,$e,6,5,"div",5),t.bVm()),2&n){const e=t.XpG().ngVar;t.R7$(2),t.JRh(t.bMT(3,2,"submission.sections.duplicates.detected")),t.R7$(2),t.Y8G("ngForOf",null==e?null:e.potentialDuplicates)}}function Ge(n,d){if(1&n&&(t.j41(0,"div",1),t.DNE(1,je,4,3,"ng-container",2)(2,Ae,5,4,"ng-container",2),t.k0s()),2&n){const e=d.ngVar;t.R7$(),t.Y8G("ngIf",0===(null==e?null:e.potentialDuplicates.length)),t.R7$(),t.Y8G("ngIf",(null==e?null:e.potentialDuplicates.length)>0)}}let Le=(()=>{class n extends mt{constructor(e,i,s,r,p,h){super(r,p,h),this.translate=e,this.sectionService=i,this.submissionService=s,this.injectedCollectionId=r,this.injectedSectionData=p,this.injectedSubmissionId=h,this.Metadata=Fe.O,this.AlertTypeEnum=L.v,this.isLoading=!0,this.subs=[]}ngOnInit(){super.ngOnInit()}onSectionInit(){this.isLoading=!1}isReadOnly(){return!0}onSectionDestroy(){}getSectionStatus(){return(0,I.of)(!this.isLoading)}getDuplicateData(){return this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType)}getItemLink(e){return new Re.t((0,Pe.Fy)(),e).toString()}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(B.c$),t.rXU(M.c),t.rXU(f.E),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-duplicates"]],standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[["class","text-sm-left",4,"ngVar"],[1,"text-sm-left"],[4,"ngIf"],[1,"alert","alert-success","w-100"],[1,"alert","alert-warning","w-100"],["class","ds-duplicate",4,"ngFor","ngForOf"],[1,"ds-duplicate"],["target","_blank",3,"href"],[4,"ngFor","ngForOf"]],template:function(i,s){1&i&&(t.DNE(0,Ge,3,2,"div",0),t.nI1(1,"async")),2&i&&t.Y8G("ngVar",t.bMT(1,1,s.getDuplicateData()))},dependencies:[Bt.r,u.bT,u.Jj,B.h,B.D9,u.Sq],encapsulation:2})}}return n})();var Ne=o(48376),Zt=o.n(Ne),Wt=o(47677),qt=o(88280),Ve=o(41684),Xe=o(43928),Ye=o(32473),ke=o(25567),Ke=o(91581),We=o(49903),wt=o(83085);class we{constructor(d=null,e=null){this._path=d,this._value=e}get path(){return this._path}set path(d){this._path=d}get value(){return this._value}set value(d){this._value=d}delete(){this._value=null,this._path=null}isPathEqual(d){return this._path&&S()(this._path,d)}}var Je=o(39806),He=o(80597),Jt=o(67600);const Qe=["formRef"];function ze(n,d){1&n&&t.nrm(0,"ds-loading",3)}function Ze(n,d){if(1&n){const e=t.RV6();t.j41(0,"ds-form",4,0),t.bIt("dfChange",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onChange(s))})("dfFocus",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onFocus(s))})("remove",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onRemove(s))})("ngbEvent",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onCustomEvent(s))})("removeArrayItem",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onRemove(s))}),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("formId",e.formId)("formModel",e.formModel)("displaySubmit",!1)("displayCancel",!1)}}let qe=(()=>{class n extends mt{constructor(e,i,s,r,p,h,P,N,tt,at,dt,Et,nt,lt,yt){super(nt,lt,yt),this.cdr=e,this.formBuilderService=i,this.formOperationsService=s,this.formService=r,this.formConfigService=p,this.notificationsService=h,this.sectionService=P,this.submissionService=N,this.translate=tt,this.submissionObjectService=at,this.objectCache=dt,this.requestService=Et,this.injectedCollectionId=nt,this.injectedSectionData=lt,this.injectedSubmissionId=yt,this.isUpdating=!1,this.isLoading=!0,this.fieldsOnTheirWayToBeRemoved=new Map,this.formData=Object.create({}),this.previousValue=new we,this.subs=[],this.isSectionReadonly=!1}onSectionInit(){this.pathCombiner=new rt.S("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.sectionService.dispatchSetSectionFormId(this.submissionId,this.sectionData.id,this.formId),this.formConfigService.findByHref(this.sectionData.config).pipe((0,a.T)(e=>e.payload),(0,st.M)(e=>this.formConfig=e),(0,Z.Z)(()=>(0,Q.z)([this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType),this.submissionObjectService.findById(this.submissionId,!0,!1,(0,Jt.s)("item")).pipe((0,et.yd)(),(0,et.Bo)()),this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope())])),(0,H.s)(1)).subscribe(([e,i,s])=>{(0,c.b0)(this.formModel)&&(this.submissionObject=i,this.isSectionReadonly=s,this.initForm(e,this.sectionData.errorsToShow,this.sectionData.serverValidationErrors),this.sectionData.data=e,this.subscriptions(),this.isLoading=!1,this.cdr.detectChanges())})}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}getSectionStatus(){const e=this.formService.isValid(this.formId),i=this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,a.T)(s=>(0,c.Im)(s)));return(0,Q.z)([e,i]).pipe((0,a.T)(([s,r])=>s&&r))}hasMetadataEnrichment(e){const i={};Object.keys(e).forEach(p=>{this.inCurrentSubmissionScope(p)&&(i[p]=e[p])});const s=[],r=(0,He.iv)(i,this.formData);return Object.keys(r).forEach(p=>{r[p].forEach(h=>{h.hasOwnProperty("value")&&Zt()(this.formData[p],{value:h.value})<0&&s.push(h)})}),(0,c.hj)(s)}inCurrentSubmissionScope(e){switch(this.formConfig?.rows.find(s=>s.fields?.[0]?.selectableMetadata?s.fields?.[0]?.selectableMetadata?.[0]?.metadata===e:!!s.fields?.[0]?.selectableRelationship&&s.fields?.[0]?.selectableRelationship.relationshipType===e.replace(/^relationship\./g,""))?.fields?.[0]?.scope){case wt.L.WorkspaceItem.valueOf():return this.submissionObject.type===Ke.F.type.value;case wt.L.WorkflowItem.valueOf():return this.submissionObject.type===ke.t.type.value;default:return!0}}initForm(e,i,s){try{this.formModel=this.formBuilderService.modelFromConfiguration(this.submissionId,this.formConfig,this.collectionId,e,this.submissionService.getSubmissionScope(),this.isSectionReadonly);const r=this.sectionService.computeSectionConfiguredMetadata(this.formConfig);this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,e,i,s,r)}catch(r){const h={message:this.translate.instant("error.submission.sections.init-form-error")+r.toString(),path:"/sections/"+this.sectionData.id};r instanceof Error&&console.error(r.stack),this.sectionService.setSectionError(this.submissionId,this.sectionData.id,h)}}updateForm(e){const i=e.data,s=e.errorsToShow;(0,c.hj)(i)&&!S()(i,this.sectionData.data)?(this.sectionData.data=i,this.hasMetadataEnrichment(i)?(this.isUpdating=!0,this.formModel=null,this.cdr.detectChanges(),this.initForm(i,s,e.serverValidationErrors),this.checksForErrors(s),this.isUpdating=!1,this.cdr.detectChanges()):((0,c.hj)(s)||(0,c.hj)(this.sectionData.errorsToShow))&&this.checksForErrors(s)):((0,c.hj)(s)||(0,c.hj)(this.sectionData.errorsToShow))&&this.checksForErrors(s)}checksForErrors(e){this.formService.isFormInitialized(this.formId).pipe((0,Wt.I)(i=>!0===i&&!this.isUpdating)).subscribe(()=>{this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,e,this.sectionData.errorsToShow),this.sectionData.errorsToShow=e,this.cdr.detectChanges()})}subscriptions(){this.subs.push(this.formService.getFormData(this.formId).pipe((0,E.F)()).subscribe(e=>{this.formData=e}),this.sectionService.getSectionState(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe((0,y.p)(e=>(0,c.hj)(e)&&((0,c.hj)(e.data)||(0,c.hj)(e.errorsToShow))),(0,E.F)()).subscribe(e=>{this.fieldsOnTheirWayToBeRemoved=new Map,this.sectionMetadata=e.metadata,this.updateForm(e)}))}onChange(e){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,this.hasStoredValue(this.formBuilderService.getId(e.model),this.formOperationsService.getArrayIndexFromEvent(e)));const i=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),s=this.formOperationsService.getFieldValueFromChangeEvent(e);(-1!==qt.c.submission.autosave.metadata.indexOf(i)&&(0,c.hj)(s)||this.hasRelatedCustomError(i))&&this.submissionService.dispatchSave(this.submissionId)}hasRelatedCustomError(e){const i=Zt()(this.sectionData.errorsToShow,{path:this.pathCombiner.getPath(e).path});if(-1!==i){const r=this.sectionData.errorsToShow[i].message.replace("error.validation.","");return!qt.c.form.validatorMap.hasOwnProperty(r)}return!1}onFocus(e){const i=this.formOperationsService.getFieldValueFromChangeEvent(e),s=this.formBuilderService.getPath(e.model);this.formBuilderService.hasMappedGroupValue(e.model)?(this.previousValue.path=s,this.previousValue.value=this.formOperationsService.getQualdropValueMap(e)):(0,c.hj)(i)&&("object"==typeof i&&(0,c.hj)(i.value)||"string"==typeof i)&&(this.previousValue.path=s,this.previousValue.value=i)}onRemove(e){const i=this.formBuilderService.getId(e.model),s=this.formOperationsService.getArrayIndexFromEvent(e);if(this.fieldsOnTheirWayToBeRemoved.has(i)){const r=this.fieldsOnTheirWayToBeRemoved.get(i);r.push(s),this.fieldsOnTheirWayToBeRemoved.set(i,r)}else this.fieldsOnTheirWayToBeRemoved.set(i,[s]);this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,this.hasStoredValue(i,s))}hasStoredValue(e,i){return!!(0,c.hj)(this.sectionData.data)&&this.sectionData.data.hasOwnProperty(e)&&(0,c.hj)(this.sectionData.data[e][i])&&!this.isFieldToRemove(e,i)}isFieldToRemove(e,i){return this.fieldsOnTheirWayToBeRemoved.has(e)&&this.fieldsOnTheirWayToBeRemoved.get(e).includes(i)}onCustomEvent(e){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,null)}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(t.gRc),t.rXU(ht.j),t.rXU(Tt),t.rXU(vt.u),t.rXU(Xe.SubmissionFormsConfigDataService),t.rXU(Je.I),t.rXU(M.c),t.rXU(f.E),t.rXU(B.c$),t.rXU(We.$),t.rXU(Ve.$),t.rXU(Ye.B),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-form"]],viewQuery:function(i,s){if(1&i&&t.GBs(Qe,5),2&i){let r;t.mGM(r=t.lsd())&&(s.formRef=r.first)}},standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:2,consts:[["formRef","formComponent"],["message","Loading...",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem",4,"ngIf"],["message","Loading..."],[3,"dfChange","dfFocus","remove","ngbEvent","removeArrayItem","formId","formModel","displaySubmit","displayCancel"]],template:function(i,s){1&i&&t.DNE(0,ze,1,0,"ds-loading",1)(1,Ze,2,4,"ds-form",2),2&i&&(t.Y8G("ngIf",s.isLoading),t.R7$(),t.Y8G("ngIf",!s.isLoading&&s.formModel))},dependencies:[l.s,g.v,u.bT]})}}return n})();var ti=o(71985);function ei(n,d){if(1&n&&(t.qex(0),t.j41(1,"li"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.bVm()),2&n){const e=t.XpG().$implicit;t.R7$(2),t.Lme("",t.bMT(3,2,"submission.sections.identifiers."+e.identifierType+"_label")," ",e.value,"")}}function ii(n,d){if(1&n&&(t.qex(0),t.DNE(1,ei,4,4,"ng-container",1),t.bVm()),2&n){const e=d.$implicit,i=t.XpG(2).ngVar;t.R7$(),t.Y8G("ngIf",i.displayTypes.includes(e.identifierType)&&e.value)}}function ni(n,d){if(1&n&&(t.qex(0),t.j41(1,"div")(2,"span"),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"ul"),t.DNE(6,ii,2,1,"ng-container",2),t.k0s()(),t.bVm()),2&n){const e=t.XpG().ngVar;t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.identifiers.info")),t.R7$(3),t.Y8G("ngForOf",e.identifiers)}}function si(n,d){if(1&n&&(t.qex(0),t.DNE(1,ni,7,4,"ng-container",1),t.bVm()),2&n){const e=d.ngVar;t.R7$(),t.Y8G("ngIf",e&&e.identifiers)}}let oi=(()=>{class n extends mt{constructor(e,i,s,r,p,h){super(r,p,h),this.translate=e,this.sectionService=i,this.submissionService=s,this.injectedCollectionId=r,this.injectedSectionData=p,this.injectedSubmissionId=h,this.AlertTypeEnum=L.v,this.isLoading=!0,this.identifierData$=new ti.c,this.subs=[]}ngOnInit(){super.ngOnInit()}onSectionInit(){this.isLoading=!1,this.identifierData$=this.getIdentifierData()}isReadOnly(){return!0}onSectionDestroy(){}getSectionStatus(){return(0,I.of)(!this.isLoading)}getIdentifierData(){return this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType)}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(B.c$),t.rXU(M.c),t.rXU(f.E),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-identifiers"]],standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[[4,"ngVar"],[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(i,s){1&i&&(t.DNE(0,si,2,1,"ng-container",0),t.nI1(1,"async")),2&i&&t.Y8G("ngVar",t.bMT(1,1,s.getIdentifierData()))},dependencies:[B.h,B.D9,u.Sq,u.bT,u.Jj,Bt.r],encapsulation:2})}}return n})();var Ht=o(6983);const ai={granted:{element:{container:"custom-control custom-checkbox ps-1",control:"custom-control-input",label:"custom-control-label pt-1"}}},ri=[{id:"granted",label:"submission.sections.license.granted-label",required:!0,value:!1,validators:{required:null},errorMessages:{required:"submission.sections.license.required",notgranted:"submission.sections.license.notgranted"},type:"CHECKBOX"}],ci=["formRef"];function li(n,d){if(1&n){const e=t.RV6();t.j41(0,"ds-form",3,0),t.bIt("dfChange",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onChange(s))}),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("formId",e.formId)("formModel",e.formModel)("formLayout",e.formLayout)("displaySubmit",e.displaySubmit)("displayCancel",!1)}}let di=(()=>{class n extends mt{constructor(e,i,s,r,p,h,P,N,tt,at,dt,Et){super(at,dt,Et),this.changeDetectorRef=e,this.collectionDataService=i,this.formBuilderService=s,this.formOperationsService=r,this.formService=p,this.operationsBuilder=h,this.sectionService=P,this.submissionService=N,this.translateService=tt,this.injectedCollectionId=at,this.injectedSectionData=dt,this.injectedSubmissionId=Et,this.formLayout=ai,this.displaySubmit=!1,this.subs=[]}onSectionInit(){this.pathCombiner=new rt.S("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.formModel=this.formBuilderService.fromJSON(ri);const e=this.formBuilderService.findById("granted",this.formModel);e.label&&(e.label=this.translateService.instant(e.label)),e.value=this.sectionData.data.granted,this.licenseText$=this.collectionDataService.findById(this.collectionId,!0,!0,(0,Jt.s)("license")).pipe((0,y.p)(i=>(0,c.EA)(i.payload)),(0,Z.Z)(i=>i.payload.license),(0,Wt.I)(i=>(0,c.EA)(i.payload)),(0,a.T)(i=>i.payload.text),(0,Mt.Z)("")),this.subs.push(this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope()).pipe((0,H.s)(1),(0,y.p)(i=>i)).subscribe(()=>{e.disabled=!0}),this.sectionService.getSectionErrors(this.submissionId,this.sectionData.id).pipe((0,y.p)(i=>(0,c.hj)(i)),(0,E.F)()).subscribe(i=>{const s=i.map(r=>"/sections/license"===r.path?e.checked?null:Object.assign({},r,{path:"/sections/license/granted"}):r).filter(r=>(0,c.Pe)(r));(0,c.hj)(s)?(this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,s),this.sectionData.errors=i):this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)}))}ngAfterViewChecked(){this.changeDetectorRef.detectChanges()}getSectionStatus(){const e=this.formBuilderService.findById("granted",this.formModel);return e.valueChanges.pipe((0,a.T)(i=>!0===i),(0,Mt.Z)(e.value))}onChange(e){const i=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),s=this.formOperationsService.getFieldValueFromChangeEvent(e);s?(this.operationsBuilder.add(this.pathCombiner.getPath(i),s.value.toString(),!1,!0),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)):this.operationsBuilder.remove(this.pathCombiner.getPath(i)),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionData.id)}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(t.gRc),t.rXU(Ht.CollectionDataService),t.rXU(ht.j),t.rXU(Tt),t.rXU(vt.u),t.rXU(ot.C),t.rXU(M.c),t.rXU(f.E),t.rXU(B.c$),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-license"]],viewQuery:function(i,s){if(1&i&&t.GBs(ci,5),2&i){let r;t.mGM(r=t.lsd())&&(s.formRef=r.first)}},standalone:!0,features:[t.Jv_([]),t.Vt3,t.aNF],decls:5,vars:4,consts:[["formRef","formComponent"],[1,"mb-5","preserve-line-breaks",3,"innerHTML"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange",4,"ngIf"],[3,"dfChange","formId","formModel","formLayout","displaySubmit","displayCancel"]],template:function(i,s){1&i&&(t.nrm(0,"span",1),t.nI1(1,"async"),t.nrm(2,"br")(3,"br"),t.DNE(4,li,2,5,"ds-form",2)),2&i&&(t.Y8G("innerHTML",t.bMT(1,2,s.licenseText$),t.npT),t.R7$(4),t.Y8G("ngIf",s.formModel))},dependencies:[l.s,u.bT,u.Jj]})}}return n})();var mi=o(68630),ui=o(69184);const pi=n=>({"border-danger":n}),_i=n=>({"bg-light":n}),hi=n=>({pattern:n});function fi(n,d){1&n&&(t.j41(0,"button",23),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.section.section-coar-notify.dropdown.no-data")," "))}function bi(n,d){if(1&n){const e=t.RV6();t.j41(0,"button",24),t.bIt("click",function(){t.eBV(e);const s=t.XpG().index,r=t.XpG(3).$implicit,p=t.XpG(2);return t.Njj(p.onChange(r.pattern,s,null))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.section.section-coar-notify.dropdown.select-none")," "))}function gi(n,d){if(1&n){const e=t.RV6();t.j41(0,"button",25),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG().index,p=t.XpG(3).$implicit,h=t.XpG(2);return t.Njj(h.onChange(p.pattern,r,s))}),t.j41(1,"b"),t.EFF(2),t.k0s(),t.nrm(3,"br"),t.EFF(4),t.k0s()}if(2&n){const e=d.$implicit,i=t.XpG().index,s=t.XpG(3).$implicit,r=t.XpG(2);t.Y8G("ngClass",t.eq3(3,_i,(null==r.ldnServiceByPattern[s.pattern].services[i]?null:r.ldnServiceByPattern[s.pattern].services[i].id)===e.id)),t.R7$(2),t.SpI(" ",e.name," "),t.R7$(2),t.SpI(" ",e.description," ")}}function vi(n,d){if(1&n){const e=t.RV6();t.j41(0,"button",26),t.nI1(1,"translate"),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG().index,r=t.XpG(3).$implicit,p=t.XpG(2);return t.Njj(p.removeService(r,s))}),t.j41(3,"span"),t.nrm(4,"i",27),t.k0s()()}if(2&n){const e=t.XpG().index;t.AVh("mt-2",e>0),t.FS9("title",t.bMT(1,4,"form.remove")),t.BMQ("aria-label",t.bMT(2,6,"form.remove"))}}function Si(n,d){if(1&n&&(t.j41(0,"small",28),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=t.XpG(4).$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,"submission.section.section-coar-notify.small.notification",t.eq3(4,hi,e.pattern))," ")}}function Ii(n,d){if(1&n&&(t.j41(0,"small",30),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=d.$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,e.message)," ")}}function Ci(n,d){if(1&n&&(t.qex(0),t.DNE(1,Ii,3,3,"small",29),t.nI1(2,"async"),t.bVm()),2&n){const e=t.XpG().index,i=t.XpG(3).$implicit,s=t.XpG(2);t.R7$(),t.Y8G("ngForOf",t.bMT(2,1,s.getShownSectionErrors$(i.pattern,e)))}}function Ei(n,d){if(1&n&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2).index,i=t.XpG(3).$implicit,s=t.XpG(2);t.R7$(),t.SpI(" ",s.ldnServiceByPattern[i.pattern].services[e].description," ")}}function Di(n,d){1&n&&(t.j41(0,"span",36),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.section.section-coar-notify.selection.no-description")," "))}function Ti(n,d){if(1&n&&(t.j41(0,"div",31)(1,"div",32),t.nrm(2,"i",33),t.j41(3,"div",34)(4,"div"),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.DNE(7,Ei,2,1,"div",35)(8,Di,3,3,"ng-template",null,1,t.C5r),t.k0s()()()),2&n){const e=t.sdS(9),i=t.XpG().index,s=t.XpG(3).$implicit,r=t.XpG(2);t.R7$(5),t.JRh(t.bMT(6,3,"submission.section.section-coar-notify.selection.description")),t.R7$(2),t.Y8G("ngIf",null==r.ldnServiceByPattern[s.pattern].services[i]?null:r.ldnServiceByPattern[s.pattern].services[i].description)("ngIfElse",e)}}function Mi(n,d){1&n&&(t.j41(0,"div",8)(1,"div",37)(2,"div",34)(3,"span"),t.EFF(4),t.nI1(5,"translate"),t.k0s()()()()),2&n&&(t.R7$(4),t.SpI(" ",t.bMT(5,1,"submission.section.section-coar-notify.notification.error")," "))}function Oi(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",38),t.bIt("click",function(){t.eBV(e);const s=t.XpG(4).$implicit,r=t.XpG(2);return t.Njj(r.addNewService(s))}),t.nrm(1,"i",39),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.sections.general.add-more")," "))}function yi(n,d){if(1&n){const e=t.RV6();t.j41(0,"div")(1,"div",8)(2,"div",9,0)(4,"div",10),t.nrm(5,"i",11),t.j41(6,"input",12),t.nI1(7,"async"),t.bIt("click",function(){t.eBV(e);const s=t.sdS(3);return t.Njj(s.open())}),t.k0s()(),t.j41(8,"div",13)(9,"div",14),t.DNE(10,fi,3,3,"button",15),t.nI1(11,"async"),t.DNE(12,bi,3,3,"button",16),t.nI1(13,"async"),t.DNE(14,gi,5,5,"button",17),t.nI1(15,"async"),t.k0s()()(),t.DNE(16,vi,5,8,"button",18),t.k0s(),t.DNE(17,Si,3,6,"small",19)(18,Ci,3,3,"ng-container",3),t.nI1(19,"async"),t.DNE(20,Ti,10,5,"div",20)(21,Mi,6,3,"div",21),t.nI1(22,"async"),t.j41(23,"div",8),t.DNE(24,Oi,4,3,"div",22),t.k0s()()}if(2&n){let e,i,s,r,p;const h=d.index,P=t.XpG(3).$implicit,N=t.XpG(2);t.R7$(2),t.AVh("mt-2",h>0),t.R7$(2),t.BMQ("aria-label",P.pattern+".dropdown"),t.R7$(2),t.Y8G("readonly",!0)("ngClass",t.eq3(31,pi,(null==(e=t.bMT(7,19,N.getShownSectionErrors$(P.pattern,h)))?null:e.length)>0))("value",null==N.ldnServiceByPattern[P.pattern].services[h]?null:N.ldnServiceByPattern[P.pattern].services[h].name),t.BMQ("aria-label",P.pattern+".dropdownanchor"),t.R7$(3),t.Y8G("infiniteScrollDistance",2)("infiniteScrollThrottle",50)("scrollWindow",!1),t.R7$(),t.Y8G("ngIf",0===(null==(i=t.bMT(11,21,N.filterServices(P.pattern)))?null:i.length)),t.R7$(2),t.Y8G("ngIf",(null==(s=t.bMT(13,23,N.filterServices(P.pattern)))?null:s.length)>0),t.R7$(2),t.Y8G("ngForOf",t.bMT(15,25,N.filterServices(P.pattern))),t.R7$(2),t.Y8G("ngIf",N.ldnServiceByPattern[P.pattern].services.length>1),t.R7$(),t.Y8G("ngIf",!N.ldnServiceByPattern[P.pattern].services[h]&&h===N.ldnServiceByPattern[P.pattern].services.length-1),t.R7$(),t.Y8G("ngIf",(null==(r=t.bMT(19,27,N.getShownSectionErrors$(P.pattern,h)))?null:r.length)>0),t.R7$(2),t.Y8G("ngIf",N.ldnServiceByPattern[P.pattern].services[h]),t.R7$(),t.Y8G("ngIf",(null==(p=t.bMT(22,29,N.getShownSectionErrors$(P.pattern,h)))?null:p.length)>0),t.R7$(3),t.Y8G("ngIf",P.multipleRequest&&h===N.ldnServiceByPattern[P.pattern].services.length-1)}}function Fi(n,d){if(1&n&&(t.j41(0,"div"),t.DNE(1,yi,25,33,"div",7),t.k0s()),2&n){const e=t.XpG(2).$implicit,i=t.XpG(2);t.R7$(),t.Y8G("ngForOf",i.ldnServiceByPattern[e.pattern].services)}}function Ri(n,d){if(1&n&&(t.j41(0,"div")(1,"label",6),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.DNE(4,Fi,2,1,"div",3),t.k0s()),2&n){const e=t.XpG().$implicit,i=t.XpG(2);t.R7$(2),t.SpI(" ",t.bMT(3,2,"submission.section.section-coar-notify.control."+e.pattern+".label")," "),t.R7$(2),t.Y8G("ngIf",null==i.ldnServiceByPattern[e.pattern]?null:i.ldnServiceByPattern[e.pattern].services.length)}}function Pi(n,d){if(1&n&&(t.j41(0,"div",5),t.DNE(1,Ri,5,4,"div",3),t.nI1(2,"async"),t.k0s()),2&n){let e;const i=d.$implicit,s=t.XpG(2);t.R7$(),t.Y8G("ngIf",(null==(e=t.bMT(2,1,s.filterServices(i.pattern)))?null:e.length)>0)}}function ji(n,d){if(1&n&&(t.qex(0),t.DNE(1,Pi,3,3,"div",4),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.patterns)}}function Bi(n,d){1&n&&(t.qex(0),t.j41(1,"p"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.bVm()),2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.section.section-coar-notify.info.no-pattern")," "))}let xi=(()=>{class n extends mt{constructor(e,i,s,r,p,h,P,N){super(h,P,N),this.ldnServicesService=e,this.operationsBuilder=i,this.sectionService=s,this.coarNotifyConfigDataService=r,this.chd=p,this.injectedCollectionId=h,this.injectedSectionData=P,this.injectedSubmissionId=N,this.hasSectionData=!1,this.patterns=[],this.ldnServiceByPattern={},this.previousServices={},this.fieldsOnTheirWayToBeRemoved=new Map,this.subs=[],this.filteredServicesByPattern={}}onSectionInit(){this.setCoarNotifyConfig(),this.getSectionServerErrorsAndSetErrorsToDisplay(),this.pathCombiner=new rt.S("sections",this.sectionData.id)}setCoarNotifyConfig(){this.subs.push(this.coarNotifyConfigDataService.findAll().pipe((0,et.qD)()).subscribe(e=>{e.hasSucceeded&&(this.patterns=e.payload.page[0].patterns,this.initSelectedServicesByPattern())}))}onChange(e,i,s){if(this.ldnServiceByPattern[e].services[i]?.id===s?.id)return;this.previousServices[e]||(this.previousServices[e]={services:[],allowsMultipleRequests:this.patterns.find(p=>p.pattern===e)?.multipleRequest}),this.previousServices[e].services[i]=this.ldnServiceByPattern[e].services[i],this.ldnServiceByPattern[e].services[i]=s;const r=(0,c.a4)(this.previousServices[e].services[i])&&this.previousServices[e].services[i].id!==s?.id;r&&(this.operationsBuilder.flushOperation(this.pathCombiner.getPath([e,"-"])),this.filteredServicesByPattern[e]?.includes(this.previousServices[e].services[i])&&this.operationsBuilder.remove(this.pathCombiner.getPath([e,i.toString()]))),(!r||s?.id&&r)&&this.operationsBuilder.add(this.pathCombiner.getPath([e,"-"]),[s.id],!1,!0),this.previousServices[e].services[i]=this.ldnServiceByPattern[e].services[i],this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id),this.chd.detectChanges()}initSelectedServicesByPattern(){this.patterns.forEach(e=>{(0,c.a4)(this.sectionData.data[e.pattern])?this.subs.push(this.filterServices(e.pattern).subscribe(i=>{this.ldnServiceByPattern[e.pattern]||(this.ldnServiceByPattern[e.pattern]={services:[],allowsMultipleRequests:e.multipleRequest}),this.ldnServiceByPattern[e.pattern].services=i.filter(s=>{const r=this.sectionData.data[e.pattern].find(p=>p.id===s.id);return this.addService(e,r),this.sectionData.data[e.pattern].includes(s.uuid)})})):(this.ldnServiceByPattern[e.pattern]={services:[],allowsMultipleRequests:e.multipleRequest},this.addService(e,null))})}addService(e,i){this.ldnServiceByPattern[e.pattern]||(this.ldnServiceByPattern[e.pattern]={services:[],allowsMultipleRequests:e.multipleRequest}),this.ldnServiceByPattern[e.pattern].services.push(i)}removeService(e,i){this.ldnServiceByPattern[e.pattern]&&(this.ldnServiceByPattern[e.pattern].services.splice(i,1),this.previousServices[e.pattern]?.services.splice(i,1),this.operationsBuilder.flushOperation(this.pathCombiner.getPath([e.pattern,"-"])),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)),this.ldnServiceByPattern[e.pattern].services.length||this.addNewService(e)}filterServices(e){return this.ldnServicesService.findByInboundPattern(e).pipe((0,et.qD)(),(0,st.M)(i=>{if(i.hasFailed)throw new Error(`Failed to retrieve services for pattern ${e}`)}),(0,y.p)(i=>i.hasSucceeded),(0,et.Bo)(),(0,et.W8)(),(0,st.M)(i=>{this.filteredServicesByPattern[e]||(this.filteredServicesByPattern[e]=[]),0===this.filteredServicesByPattern[e].length&&this.filteredServicesByPattern[e].push(...i)}),(0,a.T)(i=>i.filter(s=>(this.hasSectionData||(this.hasSectionData=this.hasInboundPattern(s,e)),this.hasInboundPattern(s,e)))))}hasInboundPattern(e,i){return e.notifyServiceInboundPatterns.some(s=>s.pattern===i)}getSectionServerErrorsAndSetErrorsToDisplay(){this.subs.push(this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,H.s)(1),(0,y.p)(e=>(0,c.hj)(e))).subscribe(e=>{(0,c.hj)(e)&&e.forEach(i=>{this.sectionService.setSectionError(this.submissionId,this.sectionData.id,i)})}))}getShownSectionErrors$(e,i){return this.sectionService.getShownSectionErrors(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe((0,H.s)(1),(0,y.p)(s=>(0,c.hj)(s)),(0,a.T)(s=>s.filter(r=>r.path.includes(`${e}/${i}`))))}getSectionStatus(){return this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,a.T)(e=>(0,c.Im)(e)))}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}addNewService(e){this.ldnServiceByPattern[e.pattern].services.push(null)}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(mi.LdnServicesService),t.rXU(ot.C),t.rXU(M.c),t.rXU(ui.CoarNotifyConfigDataService),t.rXU(t.gRc),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-coar-notify"]],standalone:!0,features:[t.Jv_([D.tg]),t.Vt3,t.aNF],decls:3,vars:2,consts:[["myDropdown","ngbDropdown"],["noDesc",""],[1,"container-fluid"],[4,"ngIf"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"row","col-form-label"],[4,"ngFor","ngForOf"],[1,"row"],["ngbDropdown","",1,"flex-grow-1"],[1,"position-relative","right-addon"],["ngbDropdownToggle","","aria-hidden","true",1,"position-absolute","scrollable-dropdown-toggle"],["type","text",1,"form-control","w-100","scrollable-dropdown-input",3,"click","readonly","ngClass","value"],["ngbDropdownMenu","","aria-haspopup","true","aria-expanded","false",1,"dropdown-menu","scrollable-dropdown-menu","w-100"],["role","listbox","infiniteScroll","",1,"scrollable-menu",3,"infiniteScrollDistance","infiniteScrollThrottle","scrollWindow"],["class","dropdown-item collection-item text-truncate w-100",4,"ngIf"],["class","dropdown-item collection-item text-truncate w-100",3,"click",4,"ngIf"],["class","dropdown-item collection-item text-truncate w-100",3,"ngClass","click",4,"ngFor","ngForOf"],["type","button","class","btn btn-secondary ms-2","role","button",3,"mt-2","title","click",4,"ngIf"],["class","row text-muted",4,"ngIf"],["class","row mt-1",4,"ngIf"],["class","row",4,"ngIf"],["class","btn btn-link mt-2 ps-0",3,"click",4,"ngIf"],[1,"dropdown-item","collection-item","text-truncate","w-100"],[1,"dropdown-item","collection-item","text-truncate","w-100",3,"click"],[1,"dropdown-item","collection-item","text-truncate","w-100",3,"click","ngClass"],["type","button","role","button",1,"btn","btn-secondary","ms-2",3,"click","title"],["aria-hidden","true",1,"fas","fa-trash"],[1,"row","text-muted"],["class","row text-danger",4,"ngFor","ngForOf"],[1,"row","text-danger"],[1,"row","mt-1"],[1,"alert","alert-info","w-100","d-flex","align-items-center","flex-row"],[1,"fa-solid","fa-circle-info","fa-xl","ms-2"],[1,"ms-4"],[4,"ngIf","ngIfElse"],[1,"text-muted"],[1,"alert","alert-danger","w-100","d-flex","align-items-center","flex-row"],[1,"btn","btn-link","mt-2","ps-0",3,"click"],[1,"fas","fa-plus"]],template:function(i,s){1&i&&(t.j41(0,"div",2),t.DNE(1,ji,2,1,"ng-container",3)(2,Bi,4,3,"ng-container",3),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",(null==s.patterns?null:s.patterns.length)>0),t.R7$(),t.Y8G("ngIf",!s.hasSectionData))},dependencies:[u.bT,u.Sq,u.Jj,B.h,B.D9,D.zH,D.tg,D.do,D.U0,u.YU,it.eO,it.DP],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}.scrollable-dropdown-loading[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;height:calc(var(--bs-spacer) * 2)!important;line-height:calc(var(--bs-spacer) * 2);position:sticky;bottom:0}.scrollable-dropdown-menu[_ngcontent-%COMP%]{left:0!important;margin-bottom:var(--bs-spacer);z-index:1000}.scrollable-dropdown-toggle[_ngcontent-%COMP%]{padding:.7rem .7rem 0}.scrollable-dropdown-input[readonly][_ngcontent-%COMP%]{background-color:#fff}.toggle-icon[_ngcontent-%COMP%]{padding:.7rem .7rem 0}.ds-form-input-addon[_ngcontent-%COMP%]{border-top-right-radius:0!important;border-bottom-right-radius:0!important;border-right:0!important}.ds-form-input-btn[_ngcontent-%COMP%]{border:var(--bs-input-btn-border-width) solid var(--bs-input-border-color);border-top-left-radius:0;border-bottom-left-radius:0;border-left:0}.ds-form-input-btn[_ngcontent-%COMP%]:focus{box-shadow:none!important}button.ds-form-add-more[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none!important}.ds-form-input-value[_ngcontent-%COMP%]{border-top-left-radius:0!important;border-bottom-left-radius:0!important}.fa-spin[_ngcontent-%COMP%]{pointer-events:none}.left-addon[_ngcontent-%COMP%]   .far[_ngcontent-%COMP%], .left-addon[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%], .left-addon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{left:0}.right-addon[_ngcontent-%COMP%]   .far[_ngcontent-%COMP%], .right-addon[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%], .right-addon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{right:0}.left-addon[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-left:calc(var(--bs-spacer) * 2.25)}.right-addon[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:calc(var(--bs-spacer) * 2.25)}select.form-control[_ngcontent-%COMP%]{appearance:auto}.col-sm-6[_ngcontent-%COMP%], .col-sm-12[_ngcontent-%COMP%]{padding-left:15px;padding-right:15px}"]})}}return n})();var Qt=o(84412);function Ui(n,d){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",5)(6,"p",4),t.EFF(7),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.record.information.id")),t.R7$(4),t.SpI("",e.metadata.id," ")}}function $i(n,d){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",5)(6,"p",4),t.EFF(7),t.nI1(8,"date"),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.record.information.date.created")),t.R7$(4),t.SpI("",t.i5U(8,4,e.metadata.dateCreated,"d MMMM Y H:mm:ss zzzz")," ")}}function Ai(n,d){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",5)(6,"p",4),t.EFF(7),t.nI1(8,"date"),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.record.information.date.modified")),t.R7$(4),t.SpI("",t.i5U(8,4,e.metadata.dateModified,"d MMMM Y H:mm:ss zzzz")," ")}}function Gi(n,d){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",5)(6,"p",4)(7,"a",6),t.EFF(8),t.k0s()()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,3,"submission.sections.sherpa.record.information.uri")),t.R7$(4),t.Y8G("href",e.metadata.uri,t.B4B),t.R7$(),t.JRh(e.metadata.uri)}}let Li=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-metadata-information"]],inputs:{metadata:"metadata"},standalone:!0,features:[t.aNF],decls:5,vars:4,consts:[[1,"ms-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-8"],["target","_blank",3,"href"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,Ui,8,4,"div",1)(2,$i,9,7,"div",1)(3,Ai,9,7,"div",1)(4,Gi,9,5,"div",1),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",!(null==s.metadata||!s.metadata.id)),t.R7$(),t.Y8G("ngIf",!(null==s.metadata||!s.metadata.dateCreated)),t.R7$(),t.Y8G("ngIf",!(null==s.metadata||!s.metadata.dateModified)),t.R7$(),t.Y8G("ngIf",!(null==s.metadata||!s.metadata.uri)))},dependencies:[u.bT,B.h,B.D9,u.vh]})}}return n})();function Ni(n,d){if(1&n&&(t.j41(0,"p",4),t.EFF(1),t.k0s()),2&n){const e=d.$implicit;t.R7$(),t.SpI("",e," ")}}function Vi(n,d){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3),t.DNE(6,Ni,2,1,"p",5),t.k0s()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.title")),t.R7$(3),t.Y8G("ngForOf",e.journal.titles)}}function Xi(n,d){if(1&n&&(t.j41(0,"p",4),t.EFF(1),t.k0s()),2&n){const e=d.$implicit;t.R7$(),t.SpI("",e," ")}}function Yi(n,d){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3),t.DNE(6,Xi,2,1,"p",5),t.k0s()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.issns")),t.R7$(3),t.Y8G("ngForOf",e.journal.issns)}}function ki(n,d){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3)(6,"p",4)(7,"a",6),t.EFF(8),t.k0s()()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,3,"submission.sections.sherpa.publication.information.url")),t.R7$(4),t.FS9("href",e.journal.url,t.B4B),t.R7$(),t.SpI(" ",e.journal.url," ")}}function Ki(n,d){if(1&n&&(t.j41(0,"div",3)(1,"p",4)(2,"a",6),t.EFF(3),t.k0s()()()),2&n){const e=d.$implicit;t.R7$(2),t.FS9("href",e.uri,t.B4B),t.R7$(),t.SpI(" ",e.name," ")}}function Wi(n,d){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.DNE(5,Ki,4,2,"div",7),t.k0s()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.publishers")),t.R7$(2),t.Y8G("ngForOf",e.journal.publishers)}}function wi(n,d){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3)(6,"p",4),t.EFF(7),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.romeoPub")),t.R7$(4),t.SpI(" ",e.journal.romeoPub," ")}}function Ji(n,d){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3)(6,"p",4),t.EFF(7),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.zetoPub")),t.R7$(4),t.SpI(" ",e.journal.zetoPub," ")}}let Hi=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-publication-information"]],inputs:{journal:"journal"},standalone:!0,features:[t.aNF],decls:7,vars:6,consts:[[1,"ms-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],["class","m-1",4,"ngFor","ngForOf"],["target","_blank","rel","noopener noreferrer",3,"href"],["class","col-4",4,"ngFor","ngForOf"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,Vi,7,4,"div",1)(2,Yi,7,4,"div",1)(3,ki,9,5,"div",1)(4,Wi,6,4,"div",1)(5,wi,8,4,"div",1)(6,Ji,8,4,"div",1),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.titles)&&s.journal.titles.length>0),t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.issns)&&s.journal.issns.length>0),t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.url)),t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.publishers)&&s.journal.publishers.length>0),t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.romeoPub)),t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.zetoPub)))},dependencies:[u.bT,B.h,B.D9,u.Sq]})}}return n})();function Qi(n,d){if(1&n&&(t.j41(0,"span"),t.nrm(1,"i",16),t.EFF(2),t.k0s()),2&n){const e=t.XpG();t.R7$(2),t.Lme(" ",e.version.embargo.amount," ",null==e.version.embargo?null:e.version.embargo.units[0],"")}}function zi(n,d){1&n&&(t.j41(0,"span"),t.nrm(1,"i",16),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.sections.sherpa.publisher.policy.noembargo"),""))}function Zi(n,d){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.SpI("+",e.version.locations.length-1,"")}}function qi(n,d){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.DNE(2,Zi,2,1,"span",17),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.version.locations[0]," "),t.R7$(),t.Y8G("ngIf",e.version.locations.length>1)}}function tn(n,d){1&n&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.sherpa.publisher.policy.nolocation")))}function en(n,d){1&n&&t.nrm(0,"span",18)}function nn(n,d){1&n&&t.nrm(0,"span",19)}function sn(n,d){if(1&n&&(t.j41(0,"p",24),t.EFF(1),t.k0s()),2&n){const e=t.XpG(3);t.R7$(),t.Lme("",e.version.embargo.amount," ",e.version.embargo.units,"")}}function on(n,d){1&n&&(t.j41(0,"p",24),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.sherpa.publisher.policy.noembargo")))}function an(n,d){if(1&n&&(t.j41(0,"div",22)(1,"div",23)(2,"p",24),t.nrm(3,"i",16),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",25),t.DNE(7,sn,2,2,"p",26)(8,on,3,3,"ng-template",null,3,t.C5r),t.k0s()()),2&n){const e=t.sdS(9),i=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,3,"submission.sections.sherpa.publisher.policy.embargo"),""),t.R7$(3),t.Y8G("ngIf",!!i.version.embargo)("ngIfElse",e)}}function rn(n,d){if(1&n&&(t.j41(0,"p",24),t.EFF(1),t.k0s()),2&n){const e=d.$implicit;t.R7$(),t.JRh(e)}}function cn(n,d){if(1&n&&(t.j41(0,"div",22)(1,"div",23)(2,"p",24),t.nrm(3,"i",27),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",25),t.DNE(7,rn,2,1,"p",28),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,2,"submission.sections.sherpa.publisher.policy.license"),""),t.R7$(3),t.Y8G("ngForOf",e.version.licenses)}}function ln(n,d){if(1&n&&(t.j41(0,"p",24),t.EFF(1),t.k0s()),2&n){const e=d.$implicit;t.R7$(),t.JRh(e)}}function dn(n,d){if(1&n&&(t.j41(0,"div",22)(1,"div",23)(2,"p",24),t.nrm(3,"i",29),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",25),t.DNE(7,ln,2,1,"p",28),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,2,"submission.sections.sherpa.publisher.policy.prerequisites"),""),t.R7$(3),t.Y8G("ngForOf",e.version.prerequisites)}}function mn(n,d){if(1&n&&(t.j41(0,"p",24),t.EFF(1),t.k0s()),2&n){const e=d.$implicit;t.R7$(),t.JRh(e)}}function un(n,d){if(1&n&&(t.j41(0,"div",22)(1,"div",23)(2,"p",24),t.nrm(3,"i",10),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",25),t.DNE(7,mn,2,1,"p",28),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,2,"submission.sections.sherpa.publisher.policy.location"),""),t.R7$(3),t.Y8G("ngForOf",e.version.locations)}}function pn(n,d){if(1&n&&(t.j41(0,"p",24),t.EFF(1),t.k0s()),2&n){const e=d.$implicit;t.R7$(),t.JRh(e)}}function _n(n,d){if(1&n&&(t.j41(0,"div",22)(1,"div",23)(2,"p",24),t.nrm(3,"i",30),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",25),t.DNE(7,pn,2,1,"p",28),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,2,"submission.sections.sherpa.publisher.policy.conditions"),""),t.R7$(3),t.Y8G("ngForOf",e.version.conditions)}}function hn(n,d){if(1&n&&(t.j41(0,"div",20),t.DNE(1,an,10,5,"div",21)(2,cn,8,4,"div",21)(3,dn,8,4,"div",21)(4,un,8,4,"div",21)(5,_n,8,4,"div",21),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngIf",!(null==e.version||!e.version.embargo||null==e.version||!e.version.embargo.amount)),t.R7$(),t.Y8G("ngIf",!(null==e.version||!e.version.licenses)&&e.version.licenses.length>0),t.R7$(),t.Y8G("ngIf",!(null==e.version||!e.version.prerequisites)&&e.version.prerequisites.length>0),t.R7$(),t.Y8G("ngIf",!(null==e.version||!e.version.locations)&&e.version.locations.length>0),t.R7$(),t.Y8G("ngIf",!(null==e.version||!e.version.conditions)&&e.version.conditions.length>0)}}let fn=(()=>{class n{constructor(){this.isCollapsed=!0}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-content-accordion"]],inputs:{version:"version"},standalone:!0,features:[t.aNF],decls:22,vars:15,consts:[["noEmbargoTitle",""],["noLocations",""],["collapse","ngbCollapse"],["noEmbargo",""],["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle",3,"click"],[1,"d-flex"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0","me-4",3,"click"],[4,"ngIf","ngIfElse"],[1,"m-1","ms-4"],[1,"far","fa-folder-open"],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],["class","ms-4",4,"ngIf"],[1,"fas","fa-hourglass-half"],[4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[1,"ms-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-6"],["class","m-1",4,"ngIf","ngIfElse"],[1,"fas","fa-certificate"],["class","m-1",4,"ngFor","ngForOf"],[1,"fas","fa-exclamation-circle"],[1,"fas","fa-tasks"]],template:function(i,s){if(1&i){const r=t.RV6();t.j41(0,"div",4)(1,"div",5),t.bIt("click",function(){t.eBV(r);const h=t.sdS(20);return t.Njj(h.toggle())}),t.j41(2,"div",6)(3,"button",7),t.bIt("click",function(h){return t.eBV(r),t.Njj(h.preventDefault())}),t.EFF(4),t.nI1(5,"titlecase"),t.nI1(6,"translate"),t.k0s(),t.j41(7,"div"),t.DNE(8,Qi,3,2,"span",8)(9,zi,4,3,"ng-template",null,0,t.C5r),t.j41(11,"span",9),t.nrm(12,"i",10),t.DNE(13,qi,3,2,"span",8)(14,tn,3,3,"ng-template",null,1,t.C5r),t.k0s()()(),t.j41(16,"div",11),t.DNE(17,en,1,0,"span",12)(18,nn,1,0,"span",13),t.k0s()(),t.j41(19,"div",14,2),t.DNE(21,hn,6,5,"div",15),t.k0s()()}if(2&i){const r=t.sdS(10),p=t.sdS(15),h=t.sdS(20);t.R7$(3),t.BMQ("aria-expanded",!h.collapsed),t.R7$(),t.Lme(" ",t.bMT(5,11,s.version.articleVersion)," ",t.bMT(6,13,"submission.sections.sherpa.publisher.policy.version")," "),t.R7$(4),t.Y8G("ngIf",!(null==s.version||!s.version.embargo||null==s.version||!s.version.embargo.amount))("ngIfElse",r),t.R7$(5),t.Y8G("ngIf",!(null==s.version||!s.version.locations)&&s.version.locations.length>0)("ngIfElse",p),t.R7$(4),t.Y8G("ngIf",h.collapsed),t.R7$(),t.Y8G("ngIf",!h.collapsed),t.R7$(),t.Y8G("ngbCollapse",s.isCollapsed),t.R7$(2),t.Y8G("ngIf",!!s.version)}},dependencies:[u.Sq,B.h,B.D9,u.bT,D.HC,D.$G,u.PV]})}}return n})();function bn(n,d){1&n&&t.nrm(0,"ds-content-accordion",3),2&n&&t.Y8G("version",d.$implicit)}function gn(n,d){if(1&n&&(t.j41(0,"li")(1,"a",8),t.EFF(2),t.k0s()()),2&n){const e=d.$implicit;t.R7$(),t.FS9("href",e.key,t.B4B),t.R7$(),t.JRh(e.value)}}function vn(n,d){if(1&n&&(t.j41(0,"div",4)(1,"div",5)(2,"p",6),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"ul"),t.DNE(6,gn,3,2,"li",7),t.nI1(7,"keyvalue"),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.SpI(" ",t.bMT(4,2,"submission.sections.sherpa.publisher.policy.more.information")," "),t.R7$(3),t.Y8G("ngForOf",t.bMT(7,4,e.policy.urls))}}let Sn=(()=>{class n{constructor(){this.AlertTypeEnum=L.v}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-publisher-policy"]],inputs:{policy:"policy"},standalone:!0,features:[t.aNF],decls:3,vars:2,consts:[[1,"ms-4"],[3,"version",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],[3,"version"],[1,"row"],[1,"col-12"],[1,"m-1"],[4,"ngFor","ngForOf"],["target","_blank","rel","noopener noreferrer",3,"href"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,bn,1,1,"ds-content-accordion",1)(2,vn,8,6,"div",2),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngForOf",s.policy.permittedVersions),t.R7$(),t.Y8G("ngIf",!(null==s.policy||!s.policy.urls)))},dependencies:[fn,B.h,B.D9,u.lG,u.Sq,u.bT]})}}return n})();function In(n,d){1&n&&t.nrm(0,"ds-alert",4),2&n&&t.Y8G("type","alert-info")("content","submission.sections.sherpa-policy.title-empty")}function Cn(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",5)(1,"ds-alert",6),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div")(5,"button",7),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.refresh())}),t.j41(6,"span"),t.nrm(7,"i",8),t.EFF(8),t.nI1(9,"translate"),t.k0s()()()()}2&n&&(t.R7$(),t.Y8G("type","alert-info"),t.R7$(),t.SpI(" ",t.bMT(3,3,"submission.sections.sherpa.publisher.policy.description")," "),t.R7$(6),t.SpI(" ",t.bMT(9,5,"submission.sections.sherpa.publisher.policy.refresh")," "))}function En(n,d){1&n&&t.nrm(0,"span",21)}function Dn(n,d){1&n&&t.nrm(0,"span",22)}function Tn(n,d){1&n&&t.nrm(0,"span",21)}function Mn(n,d){1&n&&t.nrm(0,"span",22)}function On(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",11)(1,"div",12),t.bIt("click",function(){t.eBV(e);const s=t.sdS(9);return t.Njj(s.toggle())}),t.j41(2,"button",13),t.bIt("click",function(s){return t.eBV(e),t.Njj(s.preventDefault())}),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"div",14),t.DNE(6,Tn,1,0,"span",15)(7,Mn,1,0,"span",16),t.k0s()(),t.j41(8,"div",17,0),t.nrm(10,"ds-publisher-policy",23),t.k0s()()}if(2&n){const e=d.$implicit,i=t.sdS(9),s=t.XpG(4);t.R7$(2),t.BMQ("aria-expanded",!i.collapsed),t.R7$(),t.SpI(" ",t.bMT(4,6,"submission.sections.sherpa.publisher.policy")," "),t.R7$(3),t.Y8G("ngIf",i.collapsed),t.R7$(),t.Y8G("ngIf",!i.collapsed),t.R7$(),t.Y8G("ngbCollapse",s.isCollapsed),t.R7$(2),t.Y8G("policy",e)}}function yn(n,d){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"div",11)(2,"div",12),t.bIt("click",function(){t.eBV(e);const s=t.sdS(10);return t.Njj(s.toggle())}),t.j41(3,"button",13),t.bIt("click",function(s){return t.eBV(e),t.Njj(s.preventDefault())}),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"div",14),t.DNE(7,En,1,0,"span",15)(8,Dn,1,0,"span",16),t.k0s()(),t.j41(9,"div",17,0),t.nrm(11,"ds-publication-information",19),t.k0s()(),t.DNE(12,On,11,8,"div",20),t.bVm()}if(2&n){const e=d.$implicit,i=t.sdS(10),s=t.XpG(3);t.R7$(3),t.BMQ("aria-expanded",!i.collapsed),t.R7$(),t.SpI(" ",t.bMT(5,7,"submission.sections.sherpa.publication.information")," "),t.R7$(3),t.Y8G("ngIf",i.collapsed),t.R7$(),t.Y8G("ngIf",!i.collapsed),t.R7$(),t.Y8G("ngbCollapse",s.isCollapsed),t.R7$(2),t.Y8G("journal",e),t.R7$(),t.Y8G("ngForOf",e.policies)}}function Fn(n,d){1&n&&t.nrm(0,"span",21)}function Rn(n,d){1&n&&t.nrm(0,"span",22)}function Pn(n,d){if(1&n){const e=t.RV6();t.qex(0),t.DNE(1,yn,13,9,"ng-container",10),t.j41(2,"div",11)(3,"div",12),t.bIt("click",function(){t.eBV(e);const s=t.sdS(11);return t.Njj(s.toggle())}),t.j41(4,"button",13),t.bIt("click",function(s){return t.eBV(e),t.Njj(s.preventDefault())}),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"div",14),t.DNE(8,Fn,1,0,"span",15)(9,Rn,1,0,"span",16),t.k0s()(),t.j41(10,"div",17,0),t.nrm(12,"ds-metadata-information",18),t.k0s()(),t.bVm()}if(2&n){const e=t.sdS(11),i=t.XpG().ngVar,s=t.XpG();t.R7$(),t.Y8G("ngForOf",i.journals),t.R7$(3),t.BMQ("aria-expanded",!e.collapsed),t.R7$(),t.SpI(" ",t.bMT(6,7,"submission.sections.sherpa.record.information")," "),t.R7$(3),t.Y8G("ngIf",e.collapsed),t.R7$(),t.Y8G("ngIf",!e.collapsed),t.R7$(),t.Y8G("ngbCollapse",s.isCollapsed),t.R7$(2),t.Y8G("metadata",i.metadata)}}function jn(n,d){if(1&n&&(t.qex(0),t.nrm(1,"ds-alert",4),t.nI1(2,"translate"),t.bVm()),2&n){const e=t.XpG().ngVar,i=t.XpG();t.R7$(),t.Y8G("type",i.AlertTypeEnum.Error)("content",e.message?e.message:t.bMT(2,2,"submission.sections.sherpa.error.message"))}}function Bn(n,d){if(1&n&&(t.qex(0),t.DNE(1,Pn,13,9,"ng-container",9)(2,jn,3,4,"ng-container",9),t.bVm()),2&n){const e=d.ngVar,i=t.XpG();t.R7$(),t.Y8G("ngIf",!i.hasNoData()&&!!e&&!e.error),t.R7$(),t.Y8G("ngIf",!!e&&e.error)}}let xn=(()=>{class n extends mt{constructor(e,i,s,r,p){super(void 0,r,p),this.sectionService=e,this.operationsBuilder=i,this.submissionService=s,this.injectedSectionData=r,this.injectedSubmissionId=p,this.sherpaPoliciesData$=new Qt.t(null),this.subs=[],this.isCollapsed=!1,this.AlertTypeEnum=L.v}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}onSectionInit(){this.pathCombiner=new rt.S("sections",this.sectionData.id),this.subs.push(this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType).subscribe(e=>{this.sherpaPoliciesData$.next(e)}))}getSectionStatus(){return(0,I.of)(!0)}hasNoData(){return(0,c.Im)(this.sherpaPoliciesData$.value)}refresh(){this.operationsBuilder.remove(this.pathCombiner.getPath("retrievalTime")),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionData.id)}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(M.c),t.rXU(ot.C),t.rXU(f.E),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-section-sherpa-policies"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:5,consts:[["collapse","ngbCollapse"],[3,"type","content",4,"ngIf"],["class","d-flex flex-column flex-nowrap mt-2 mb-4",4,"ngIf"],[4,"ngVar"],[3,"type","content"],[1,"d-flex","flex-column","flex-nowrap","mt-2","mb-4"],[3,"type"],["type","button","data-test","refresh-btn",1,"btn","btn-secondary","float-end",3,"click"],[1,"fas","fa-sync"],[4,"ngIf"],[4,"ngFor","ngForOf"],["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle","mb-3",3,"click"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0",3,"click"],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],[3,"metadata"],[3,"journal"],["class","mb-3 border-bottom","data-test","collapse",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[3,"policy"]],template:function(i,s){if(1&i&&(t.DNE(0,In,1,2,"ds-alert",1)(1,Cn,10,7,"div",2)(2,Bn,3,2,"ng-container",3),t.nI1(3,"async")),2&i){let r;t.Y8G("ngIf",s.hasNoData()),t.R7$(),t.Y8G("ngIf",!s.hasNoData()),t.R7$(),t.Y8G("ngVar",null==(r=t.bMT(3,3,s.sherpaPoliciesData$))?null:r.sherpaResponse)}},dependencies:[Li,D.HC,D.$G,C.C,B.h,B.D9,Sn,u.bT,Hi,u.Jj,Bt.r,u.Sq]})}}return n})();var te=o(96526),Un=o(51345),$n=o(44494),An=o(25521),Gn=o(94338),ee=(o(7232),o(8886));o(9034);const Ln=["*"];function Nn(n,d){}let Vn=(()=>{class n extends ee.J{constructor(){super(...arguments),this.inAndOutputNames=["availableAccessConditionOptions","isPrimary","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"]}getComponentName(){return"SubmissionSectionUploadFileComponent"}importThemedComponent(e){return o(96682)(`./${e}/app/submission/sections/upload/file/section-upload-file.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,9034))}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=t.xGo(n)))(s||n)}})()}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-upload-section-file"]],inputs:{availableAccessConditionOptions:"availableAccessConditionOptions",isPrimary:"isPrimary",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},standalone:!0,features:[t.Vt3,t.aNF],ngContentSelectors:Ln,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(i,s){1&i&&(t.NAR(),t.DNE(0,Nn,0,0,"ng-template",null,0,t.C5r),t.j41(2,"div",null,1),t.SdG(4),t.k0s())},encapsulation:2})}}return n})();var Xn=o(84580);const ie=n=>({collectionName:n});function Yn(n,d){if(1&n&&(t.qex(0),t.EFF(1),t.nI1(2,"translate"),t.bVm()),2&n){const e=t.XpG(3);t.R7$(),t.SpI(" ",t.i5U(2,1,"submission.sections.upload.header.policy.default.nolist",t.eq3(4,ie,e.collectionName))," ")}}function kn(n,d){if(1&n&&(t.qex(0),t.EFF(1),t.nI1(2,"translate"),t.bVm()),2&n){const e=t.XpG(3);t.R7$(),t.SpI(" ",t.i5U(2,1,"submission.sections.upload.header.policy.default.withlist",t.eq3(4,ie,e.collectionName))," ")}}function Kn(n,d){if(1&n&&(t.j41(0,"div",4)(1,"div",9)(2,"ds-alert",10),t.DNE(3,Yn,3,6,"ng-container",11)(4,kn,3,6,"ng-container",11),t.nrm(5,"span",12)(6,"ds-submission-section-upload-access-conditions",13),t.k0s()()()),2&n){const e=t.XpG(2);t.R7$(2),t.Y8G("type",e.AlertTypeEnum.Warning),t.R7$(),t.Y8G("ngIf",1===e.collectionPolicyType),t.R7$(),t.Y8G("ngIf",2===e.collectionPolicyType),t.R7$(2),t.Y8G("accessConditions",e.collectionDefaultAccessConditions)}}function Wn(n,d){if(1&n&&(t.qex(0),t.nrm(1,"ds-submission-upload-section-file",14),t.nI1(2,"async"),t.j41(3,"div",4)(4,"div",7),t.nrm(5,"hr"),t.k0s()(),t.bVm()),2&n){const e=d.$implicit,i=d.index,s=t.XpG(2);t.R7$(),t.Y8G("isPrimary",s.primaryBitstreamUUID?s.primaryBitstreamUUID===e.uuid:null)("availableAccessConditionOptions",s.availableAccessConditionOptions)("collectionId",s.collectionId)("collectionPolicyType",s.collectionPolicyType)("configMetadataForm",t.bMT(2,10,s.configMetadataForm$))("fileId",e.uuid)("fileIndex",i)("fileName",s.fileNames[i])("sectionId",s.sectionData.id)("submissionId",s.submissionId)}}function wn(n,d){if(1&n&&(t.qex(0),t.DNE(1,Kn,7,4,"div",3),t.j41(2,"div",4)(3,"div",5)(4,"span",6),t.EFF(5),t.nI1(6,"translate"),t.k0s()()(),t.j41(7,"div",4)(8,"div",7),t.nrm(9,"hr"),t.k0s()(),t.DNE(10,Wn,6,12,"ng-container",8),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngIf",e.collectionDefaultAccessConditions.length>0),t.R7$(4),t.JRh(t.bMT(6,3,"bitstream.edit.form.primaryBitstream.label")),t.R7$(5),t.Y8G("ngForOf",e.fileList)}}function Jn(n,d){1&n&&(t.j41(0,"div",4)(1,"div",7)(2,"div",15)(3,"span",16),t.EFF(4),t.nI1(5,"translate"),t.k0s()()()()),2&n&&(t.R7$(4),t.JRh(t.bMT(5,1,"submission.sections.upload.no-file-uploaded")))}let zn=(()=>{class n extends mt{constructor(e,i,s,r,p,h,P,N,tt,at,dt){super(void 0,at,dt),this.bitstreamService=e,this.changeDetectorRef=i,this.collectionDataService=s,this.groupService=r,this.resourcePolicyService=p,this.sectionService=h,this.submissionService=P,this.uploadsConfigService=N,this.dsoNameService=tt,this.injectedSectionData=at,this.injectedSubmissionId=dt,this.AlertTypeEnum=L.v,this.primaryBitstreamUUID=null,this.fileList=[],this.fileNames=[],this.collectionDefaultAccessConditions=[],this.required$=new Qt.t(!0),this.subs=[]}onSectionInit(){const e=this.uploadsConfigService.findByHref(this.sectionData.config,!0,!1,(0,Jt.s)("metadata")).pipe((0,et.yd)(),(0,a.T)(i=>i.payload));this.configMetadataForm$=e.pipe((0,R.n)(i=>i.metadata.pipe((0,et.yd)(),(0,a.T)(s=>s.payload)))),this.subs.push(this.submissionService.getSubmissionObject(this.submissionId).pipe((0,y.p)(i=>(0,c.EA)(i)&&!i.isLoading),(0,y.p)(i=>(0,c.b0)(this.collectionId)||this.collectionId!==i.collection),(0,st.M)(i=>this.collectionId=i.collection),(0,Z.Z)(i=>this.collectionDataService.findById(i.collection)),(0,y.p)(i=>(0,c.EA)(i.payload)),(0,st.M)(i=>this.collectionName=this.dsoNameService.getName(i.payload)),(0,Z.Z)(()=>e)).subscribe(i=>{this.required$.next(i.required),this.availableAccessConditionOptions=(0,c.hj)(i.accessConditionOptions)?i.accessConditionOptions:[],this.collectionPolicyType=this.availableAccessConditionOptions.length>0?2:1,this.changeDetectorRef.detectChanges()}),(0,Q.z)([this.configMetadataForm$,this.bitstreamService.getUploadedFilesData(this.submissionId,this.sectionData.id)]).pipe((0,y.p)(([i,s])=>(0,c.hj)(i)&&(0,c.hj)(s)),(0,E.F)()).subscribe(([i,{primary:s,files:r}])=>{this.primaryBitstreamUUID=s,this.fileList=r,this.fileNames=Array.from(r,p=>this.getFileName(i,p)),this.changeDetectorRef.detectChanges()}))}getFileName(e,i){const s=e.rows[0].fields[0].selectableMetadata[0].metadata;let r;return r=(0,c.hj)(i.metadata)&&(0,c.hj)(i.metadata[s])?i.metadata[s][0].display:i.uuid,r}getSectionStatus(){return(0,Q.z)(this.required$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id),(e,i)=>!e||(0,c.EA)(i)&&i.length>0)}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(Xn.i),t.rXU(t.gRc),t.rXU(Ht.CollectionDataService),t.rXU($n.GroupDataService),t.rXU(An.ResourcePolicyDataService),t.rXU(M.c),t.rXU(f.E),t.rXU(Un.SubmissionUploadsConfigDataService),t.rXU(te.f),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-upload"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:5,consts:[["noFileUploaded",""],[3,"content","dismissible","type"],[4,"ngIf","ngIfElse"],["class","row",4,"ngIf"],[1,"row"],[1,"col-md-2"],[1,"text-left","font-weight-bold"],[1,"col-md-12"],[4,"ngFor","ngForOf"],[1,"col-sm-12"],[3,"type"],[4,"ngIf"],[1,"clearfix"],[3,"accessConditions"],[3,"isPrimary","availableAccessConditionOptions","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"],[1,"text-center","h3"],[1,"text-muted"]],template:function(i,s){if(1&i&&(t.nrm(0,"ds-alert",1),t.DNE(1,wn,11,5,"ng-container",2)(2,Jn,6,3,"ng-template",null,0,t.C5r)),2&i){const r=t.sdS(3);t.Y8G("content","submission.sections.upload.info")("dismissible",!0)("type",s.AlertTypeEnum.Info),t.R7$(),t.Y8G("ngIf",s.fileList.length>0)("ngIfElse",r)}},dependencies:[Vn,Gn._,u.bT,C.C,B.h,B.D9,u.Sq,u.Jj]})}}return n})();const _t=new Map;_t.set(V.l.AccessesCondition,Yt),_t.set(V.l.License,di),_t.set(V.l.CcLicense,ye),_t.set(V.l.SherpaPolicies,xn),_t.set(V.l.Upload,zn),_t.set(V.l.SubmissionForm,qe),_t.set(V.l.Identifiers,oi),_t.set(V.l.CoarNotify,xi),_t.set(V.l.Duplicates,Le);const qn=["sectionRef"],ts=n=>({"section-focus":n}),es=n=>({"text-white":n});function is(n,d){1&n&&(t.nrm(0,"i",15),t.nI1(1,"translate"),t.nI1(2,"translate")),2&n&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.warnings.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.warnings.aria")))}function ns(n,d){1&n&&(t.nrm(0,"i",16),t.nI1(1,"translate"),t.nI1(2,"translate")),2&n&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.errors.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.errors.aria")))}function ss(n,d){1&n&&(t.nrm(0,"i",17),t.nI1(1,"translate"),t.nI1(2,"translate")),2&n&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.valid.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.valid.aria")))}function os(n,d){1&n&&(t.nrm(0,"i",18),t.nI1(1,"translate"),t.nI1(2,"translate")),2&n&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.info.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.info.aria")))}function as(n,d){if(1&n){const e=t.RV6();t.j41(0,"a",19),t.bIt("click",function(s){t.eBV(e);const r=t.XpG(3);return t.Njj(r.removeSection(s))}),t.nrm(1,"i",20),t.k0s()}}function rs(n,d){if(1&n&&(t.j41(0,"span",8),t.EFF(1),t.nI1(2,"translate"),t.k0s(),t.j41(3,"div",9),t.DNE(4,is,3,6,"i",10),t.nI1(5,"async"),t.DNE(6,ns,3,6,"i",11)(7,ss,3,6,"i",12),t.nI1(8,"async"),t.DNE(9,os,3,6,"i",13)(10,as,2,0,"a",14),t.k0s()),2&n){const e=t.XpG(2),i=t.sdS(1);t.Y8G("ngClass",t.eq3(13,es,i.isInfo())),t.R7$(),t.JRh(t.bMT(2,7,"submission.sections."+e.sectionData.header)),t.R7$(3),t.Y8G("ngIf",!0!==t.bMT(5,9,i.isValid())&&!i.hasErrors()&&!i.isInfo()),t.R7$(2),t.Y8G("ngIf",i.hasErrors()&&!i.isInfo()),t.R7$(),t.Y8G("ngIf",t.bMT(8,11,i.isValid())&&!i.hasErrors()&&!i.isInfo()),t.R7$(2),t.Y8G("ngIf",i.isInfo()),t.R7$(),t.Y8G("ngIf",!i.isMandatory())}}function cs(n,d){if(1&n){const e=t.RV6();t.j41(0,"ds-alert",26),t.bIt("close",function(){const s=t.eBV(e).index;t.XpG(4);const r=t.sdS(1);return t.Njj(r.removeError(s))}),t.k0s()}if(2&n){const e=d.$implicit,i=t.XpG(4);t.Y8G("content",e)("dismissible",!0)("type",i.AlertTypeEnum.Error)}}function ls(n,d){if(1&n&&(t.j41(0,"div",24),t.DNE(1,cs,1,3,"ds-alert",25),t.k0s()),2&n){const e=t.XpG(3),i=t.sdS(1);t.Mz_("id","sectionGenericError_",e.sectionData.id,""),t.R7$(),t.Y8G("ngForOf",i.getErrors())}}function ds(n,d){1&n&&t.eu8(0)}function ms(n,d){if(1&n){const e=t.RV6();t.DNE(0,ls,2,3,"div",21),t.j41(1,"div",22),t.bIt("click",function(s){t.eBV(e),t.XpG(2);const r=t.sdS(1);return t.Njj(r.setFocus(s))}),t.DNE(2,ds,1,0,"ng-container",23),t.k0s()}if(2&n){const e=t.XpG(2),i=t.sdS(1);t.Y8G("ngIf",i.hasGenericErrors()),t.R7$(),t.Mz_("id","sectionContent_",e.sectionData.id,""),t.R7$(),t.Y8G("ngComponentOutlet",e.getSectionContent())("ngComponentOutletInjector",e.objectInjector)}}function us(n,d){if(1&n){const e=t.RV6();t.j41(0,"ngb-accordion",4,1),t.bIt("panelChange",function(s){t.eBV(e),t.XpG();const r=t.sdS(1);return t.Njj(r.sectionChange(s))}),t.j41(2,"ngb-panel",5),t.DNE(3,rs,11,15,"ng-template",6)(4,ms,3,5,"ng-template",7),t.k0s()()}if(2&n){const e=t.XpG(),i=t.sdS(1);t.FS9("activeIds",e.sectionData.id),t.Y8G("destroyOnHide",!1),t.R7$(2),t.FS9("id",e.sectionData.id),t.Y8G("type",i.isInfo()?"info":"")}}let ps=(()=>{class n{constructor(e){this.injector=e,this.AlertTypeEnum=L.v}ngOnInit(){this.objectInjector=t.zZn.create({providers:[{provide:"collectionIdProvider",useFactory:()=>this.collectionId,deps:[]},{provide:"sectionDataProvider",useFactory:()=>this.sectionData,deps:[]},{provide:"submissionIdProvider",useFactory:()=>this.submissionId,deps:[]}],parent:this.injector})}removeSection(e){e.preventDefault(),e.stopPropagation(),this.sectionRef.removeSection(this.submissionId,this.sectionData.id)}getSectionContent(){return function Zn(n){return _t.get(n)}(this.sectionData.sectionType)}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(t.zZn))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-container"]],viewQuery:function(i,s){if(1&i&&t.GBs(qn,5),2&i){let r;t.mGM(r=t.lsd())&&(s.sectionRef=r.first)}},inputs:{collectionId:"collectionId",sectionData:"sectionData",submissionId:"submissionId"},standalone:!0,features:[t.aNF],decls:4,vars:11,consts:[["sectionRef","sectionRef"],["acc","ngbAccordion"],["dsSection","",1,"mb-2",3,"ngClass","mandatory","submissionId","sectionType","sectionId"],[3,"activeIds","destroyOnHide","panelChange",4,"ngIf"],[3,"panelChange","activeIds","destroyOnHide"],[3,"id","type"],["ngbPanelTitle","",1,"d-flex"],["ngbPanelContent",""],["tabindex","0",1,"flex-grow-1","section-title",3,"ngClass"],[1,"d-inline-block"],["class","fas fa-exclamation-circle text-warning me-3","role","img",3,"title",4,"ngIf"],["class","fas fa-exclamation-circle text-danger me-3","role","img",3,"title",4,"ngIf"],["class","fas fa-check-circle text-success me-3","role","img",3,"title",4,"ngIf"],["class","fas fa-info-circle me-3 text-white","role","img",3,"title",4,"ngIf"],["href","javascript:void(0);","class","me-3",3,"click",4,"ngIf"],["role","img",1,"fas","fa-exclamation-circle","text-warning","me-3",3,"title"],["role","img",1,"fas","fa-exclamation-circle","text-danger","me-3",3,"title"],["role","img",1,"fas","fa-check-circle","text-success","me-3",3,"title"],["role","img",1,"fas","fa-info-circle","me-3","text-white",3,"title"],["href","javascript:void(0);",1,"me-3",3,"click"],["aria-hidden","true","tabindex","0",1,"fas","fa-trash-o"],[3,"id",4,"ngIf"],[3,"click","id"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"id"],[3,"content","dismissible","type","close",4,"ngFor","ngForOf"],[3,"close","content","dismissible","type"]],template:function(i,s){if(1&i&&(t.j41(0,"div",2,0),t.DNE(2,us,5,4,"ngb-accordion",3),t.nI1(3,"async"),t.k0s()),2&i){const r=t.sdS(1);t.Y8G("ngClass",t.eq3(9,ts,r.isSectionActive()))("mandatory",s.sectionData.mandatory)("submissionId",s.submissionId)("sectionType",s.sectionData.sectionType)("sectionId",s.sectionData.id),t.BMQ("id","section_"+s.sectionData.id),t.R7$(2),t.Y8G("ngIf",t.bMT(3,7,r.isEnabled()))}},dependencies:[C.C,u.Sq,D._f,D.W1,D.CT,D.sb,D.t3,u.OI,B.h,B.D9,u.YU,u.bT,u.Jj,Y],styles:["[_nghost-%COMP%]     .card{margin-bottom:var(--ds-submission-sections-margin-bottom);overflow:unset}.section-focus[_ngcontent-%COMP%]{border-radius:var(--bs-border-radius);box-shadow:var(--bs-btn-focus-box-shadow)}[_nghost-%COMP%]     .card:first-of-type{border-bottom:var(--bs-card-border-width) solid var(--bs-card-border-color)!important;border-bottom-left-radius:var(--bs-card-border-radius)!important;border-bottom-right-radius:var(--bs-card-border-radius)!important}[_nghost-%COMP%]     .card-header button{box-shadow:none!important;width:100%}"]})}}return n})();var xt=o(14723),_s=o(14860),hs=o(90934);function fs(n,d){if(1&n&&(t.j41(0,"div",3)(1,"span",4),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"span",4),t.EFF(5),t.nI1(6,"async"),t.k0s()()),2&n){const e=t.XpG();t.R7$(2),t.JRh(t.bMT(3,2,"submission.sections.general.collection")),t.R7$(3),t.JRh(t.bMT(6,4,e.selectedCollectionName$))}}function bs(n,d){1&n&&(t.j41(0,"span"),t.nrm(1,"i",11),t.k0s())}function gs(n,d){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(t.bMT(2,1,e.selectedCollectionName$))}}function vs(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",5,0),t.bIt("openChange",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.toggled(s))}),t.j41(2,"span",6),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"button",7),t.nI1(6,"async"),t.bIt("blur",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.onClose())})("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.onClose())}),t.DNE(7,bs,2,0,"span",8),t.nI1(8,"async"),t.DNE(9,gs,3,3,"span",8),t.nI1(10,"async"),t.k0s(),t.j41(11,"div",9)(12,"ds-collection-dropdown",10),t.bIt("selectionChange",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onSelect(s))}),t.k0s()()()}if(2&n){const e=t.XpG();t.R7$(3),t.SpI(" ",t.bMT(4,4,"submission.sections.general.collection")," "),t.R7$(2),t.Y8G("dsBtnDisabled",t.bMT(6,6,e.processingChange$)||!1===e.collectionModifiable||e.isReadonly),t.R7$(2),t.Y8G("ngIf",t.bMT(8,8,e.processingChange$)),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(10,10,e.processingChange$))}}let Ss=(()=>{class n{constructor(e,i,s,r,p,h,P){this.cdr=e,this.collectionDataService=i,this.operationsBuilder=s,this.operationsService=r,this.submissionService=p,this.sectionsService=h,this.dsoNameService=P,this.collectionModifiable=null,this.isReadonly=!1,this.collectionChange=new t.bkB,this.processingChange$=new Qt.t(!1),this.subs=[]}ngOnChanges(e){(0,c.a4)(e.currentCollectionId)&&(0,c.a4)(e.currentCollectionId.currentValue)&&(this.selectedCollectionId=this.currentCollectionId,this.selectedCollectionName$=this.collectionDataService.findById(this.currentCollectionId).pipe((0,Wt.I)(i=>(0,c.hj)(i.payload)),(0,a.T)(i=>this.dsoNameService.getName(i.payload))))}ngOnInit(){this.pathCombiner=new rt.S("sections","collection"),this.available$=this.sectionsService.isSectionTypeAvailable(this.submissionId,V.l.Collection)}ngOnDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}onSelect(e){this.processingChange$.next(!0),this.operationsBuilder.replace(this.pathCombiner.getPath(),e.collection.id,!0),this.subs.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections","collection").pipe((0,Z.Z)(i=>this.submissionService.retrieveSubmission(i[0].id).pipe((0,et.ak)()))).subscribe(i=>{this.selectedCollectionId=e.collection.id,this.selectedCollectionName$=(0,I.of)(e.collection.name),this.collectionChange.emit(i),this.submissionService.changeSubmissionCollection(this.submissionId,e.collection.id),this.processingChange$.next(!1),this.cdr.detectChanges()}))}onClose(){this.collectionDropdown?.reset()}toggled(e){e||this.collectionDropdown?.reset()}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(t.gRc),t.rXU(Ht.CollectionDataService),t.rXU(ot.C),t.rXU(gt.U),t.rXU(f.E),t.rXU(M.c),t.rXU(te.f))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-form-collection"]],viewQuery:function(i,s){if(1&i&&t.GBs(_s.CollectionDropdownComponent,5),2&i){let r;t.mGM(r=t.lsd())&&(s.collectionDropdown=r.first)}},inputs:{currentCollectionId:"currentCollectionId",currentDefinition:"currentDefinition",collectionModifiable:"collectionModifiable",submissionId:"submissionId",isReadonly:"isReadonly"},outputs:{collectionChange:"collectionChange"},standalone:!0,features:[t.OA$,t.aNF],decls:5,vars:6,consts:[["collectionControls","ngbDropdown"],["class","input-group mb-3",4,"ngIf"],["ngbDropdown","","class","btn-group input-group",3,"openChange",4,"ngIf"],[1,"input-group","mb-3"],[1,"input-group-text"],["ngbDropdown","",1,"btn-group","input-group",3,"openChange"],["id","collectionControlsMenuLabel",1,"input-group-text"],["aria-describedby","collectionControlsMenuLabel","id","collectionControlsMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary",3,"blur","click","dsBtnDisabled"],[4,"ngIf"],["ngbDropdownMenu","","id","collectionControlsDropdownMenu","aria-labelledby","collectionControlsMenuButton",1,"dropdown-menu","p-0"],[3,"selectionChange"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(i,s){1&i&&(t.j41(0,"div"),t.DNE(1,fs,7,6,"div",1),t.nI1(2,"async"),t.DNE(3,vs,13,12,"div",2),t.nI1(4,"async"),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",!0!==t.bMT(2,2,s.available$)),t.R7$(2),t.Y8G("ngIf",t.bMT(4,4,s.available$)))},dependencies:[u.MD,u.bT,u.Jj,B.h,B.D9,D.zH,D.tg,D.do,D.U0,hs.m,jt.A],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{outline:0;left:0!important;box-shadow:var(--bs-btn-focus-box-shadow)}"]})}}return n})();var Is=o(67625),Cs=o(75465);function Es(n,d){if(1&n){const e=t.RV6();t.j41(0,"button",13),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"dsBrowserOnly"),t.bIt("click",function(s){t.eBV(e);const r=t.XpG(2),p=t.sdS(2);return s.preventDefault(),t.Njj(r.confirmDiscard(p))}),t.nrm(4,"i",14),t.EFF(5),t.nI1(6,"translate"),t.k0s()}if(2&n){const e=t.XpG(2);t.Y8G("dsBtnDisabled",t.bMT(1,3,e.processingSaveStatus)||t.bMT(2,5,e.processingDepositStatus)),t.BMQ("data-test",t.bMT(3,7,"discard")),t.R7$(5),t.SpI(" ",t.bMT(6,9,"submission.general.discard.submit")," ")}}function Ds(n,d){1&n&&(t.j41(0,"span"),t.nrm(1,"i",15),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.general.info.saved")," "))}function Ts(n,d){1&n&&(t.j41(0,"span"),t.nrm(1,"i",16),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.general.info.pending-changes")," "))}function Ms(n,d){1&n&&(t.j41(0,"div",20),t.EFF(1,"Saving..."),t.k0s()),2&n&&t.xc7("width","100%")}function Os(n,d){1&n&&(t.j41(0,"div",20),t.EFF(1,"Depositing..."),t.k0s()),2&n&&t.xc7("width","100%")}function ys(n,d){if(1&n&&(t.j41(0,"div",17)(1,"div",18),t.DNE(2,Ms,2,2,"div",19),t.nI1(3,"async"),t.DNE(4,Os,2,2,"div",19),t.nI1(5,"async"),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(2),t.Y8G("ngIf",t.bMT(3,2,e.processingSaveStatus)),t.R7$(2),t.Y8G("ngIf",t.bMT(5,4,e.processingDepositStatus))}}function Fs(n,d){if(1&n){const e=t.RV6();t.j41(0,"button",21),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"dsBrowserOnly"),t.bIt("click",function(s){t.eBV(e);const r=t.XpG(2);return t.Njj(r.deposit(s))}),t.j41(4,"span"),t.nrm(5,"i",22),t.EFF(6),t.nI1(7,"translate"),t.k0s()()}if(2&n){const e=t.XpG(2);t.Y8G("dsBtnDisabled",t.bMT(1,3,e.processingSaveStatus)||t.bMT(2,5,e.processingDepositStatus)),t.BMQ("data-test",t.bMT(3,7,"deposit")),t.R7$(6),t.SpI(" ",t.bMT(7,9,"submission.general.deposit"),"")}}function Rs(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",2)(1,"div",3),t.DNE(2,Es,7,11,"button",4),t.nI1(3,"async"),t.k0s(),t.j41(4,"div",5),t.DNE(5,Ds,4,3,"span",6),t.nI1(6,"async"),t.nI1(7,"async"),t.nI1(8,"async"),t.DNE(9,Ts,4,3,"span",6),t.nI1(10,"async"),t.nI1(11,"async"),t.nI1(12,"async"),t.DNE(13,ys,6,6,"div",7),t.nI1(14,"async"),t.nI1(15,"async"),t.j41(16,"div",8)(17,"button",9),t.nI1(18,"async"),t.nI1(19,"async"),t.nI1(20,"dsBrowserOnly"),t.bIt("click",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.save(s))}),t.j41(21,"span"),t.nrm(22,"i",10),t.EFF(23),t.nI1(24,"translate"),t.k0s()(),t.j41(25,"button",11),t.nI1(26,"async"),t.nI1(27,"async"),t.nI1(28,"async"),t.nI1(29,"async"),t.nI1(30,"dsBrowserOnly"),t.bIt("click",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.saveLater(s))}),t.j41(31,"span"),t.nrm(32,"i",10),t.EFF(33),t.nI1(34,"translate"),t.k0s()(),t.DNE(35,Fs,8,11,"button",12),t.nI1(36,"async"),t.k0s()()()}if(2&n){const e=t.XpG();t.R7$(2),t.Y8G("ngIf",t.bMT(3,15,e.showDepositAndDiscard)),t.R7$(3),t.Y8G("ngIf",!0!==t.bMT(6,17,e.hasUnsavedModification)&&!0!==t.bMT(7,19,e.processingSaveStatus)&&!0!==t.bMT(8,21,e.processingDepositStatus)),t.R7$(4),t.Y8G("ngIf",t.bMT(10,23,e.hasUnsavedModification)&&!0!==t.bMT(11,25,e.processingSaveStatus)&&!0!==t.bMT(12,27,e.processingDepositStatus)),t.R7$(4),t.Y8G("ngIf",t.bMT(14,29,e.processingSaveStatus)||t.bMT(15,31,e.processingDepositStatus)),t.R7$(4),t.Y8G("dsBtnDisabled",t.bMT(18,33,e.processingSaveStatus)||!0!==t.bMT(19,35,e.hasUnsavedModification)),t.BMQ("data-test",t.bMT(20,37,"save")),t.R7$(6),t.SpI(" ",t.bMT(24,39,"submission.general.save"),""),t.R7$(2),t.AVh("btn-primary",!0!==t.bMT(26,41,e.showDepositAndDiscard))("btn-secondary",t.bMT(27,43,e.showDepositAndDiscard)),t.Y8G("dsBtnDisabled",t.bMT(28,45,e.processingSaveStatus)||t.bMT(29,47,e.processingDepositStatus)),t.BMQ("data-test",t.bMT(30,49,"save-for-later")),t.R7$(8),t.SpI(" ",t.bMT(34,51,"submission.general.save-later"),""),t.R7$(2),t.Y8G("ngIf",t.bMT(36,53,e.showDepositAndDiscard))}}function Ps(n,d){if(1&n){const e=t.RV6();t.j41(0,"div",23)(1,"h4",24),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",25),t.bIt("click",function(){const s=t.eBV(e).dismiss;return t.Njj(s("cancel"))}),t.k0s()(),t.j41(5,"div",26)(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s()(),t.j41(9,"div",27)(10,"button",28),t.bIt("click",function(){const s=t.eBV(e).close;return t.Njj(s("cancel"))}),t.EFF(11),t.nI1(12,"translate"),t.k0s(),t.j41(13,"button",29),t.bIt("click",function(){const s=t.eBV(e).close;return t.Njj(s("ok"))}),t.EFF(14),t.nI1(15,"translate"),t.k0s()()}2&n&&(t.R7$(2),t.JRh(t.bMT(3,4,"submission.general.discard.confirm.title")),t.R7$(5),t.JRh(t.bMT(8,6,"submission.general.discard.confirm.info")),t.R7$(4),t.JRh(t.bMT(12,8,"submission.general.discard.confirm.cancel")),t.R7$(3),t.JRh(t.bMT(15,10,"submission.general.discard.confirm.submit")))}let js=(()=>{class n{constructor(e,i,s){this.modalService=e,this.restService=i,this.submissionService=s,this.submissionIsInvalid=(0,I.of)(!0)}ngOnChanges(e){(0,c.hj)(this.submissionId)&&(this.submissionIsInvalid=this.submissionService.getSubmissionStatus(this.submissionId).pipe((0,a.T)(i=>!1===i)),this.processingSaveStatus=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.processingDepositStatus=this.submissionService.getSubmissionDepositProcessingStatus(this.submissionId),this.showDepositAndDiscard=(0,I.of)(this.submissionService.getSubmissionScope()===wt.L.WorkspaceItem),this.hasUnsavedModification=this.submissionService.hasUnsavedModification())}save(e){this.submissionService.dispatchSave(this.submissionId,!0)}saveLater(e){this.submissionService.dispatchSaveForLater(this.submissionId)}deposit(e){this.submissionService.dispatchDeposit(this.submissionId)}confirmDiscard(e){this.modalService.open(e).result.then(i=>{"ok"===i&&this.submissionService.dispatchDiscard(this.submissionId)})}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(D.Bq),t.rXU(Is.O),t.rXU(f.E))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-form-footer"]],inputs:{submissionId:"submissionId"},standalone:!0,features:[t.OA$,t.aNF],decls:3,vars:1,consts:[["content",""],["class","row",4,"ngIf"],[1,"row"],[1,"col"],["type","button","id","discard","class","btn btn-danger",3,"dsBtnDisabled","click",4,"ngIf"],[1,"col","text-end","d-flex","justify-content-end","align-items-center"],[4,"ngIf"],["class","col d-flex justify-content-end align-items-center",4,"ngIf"],[1,"ms-2","space-children-mr"],["type","button","id","save",1,"btn","btn-secondary",3,"click","dsBtnDisabled"],[1,"fas","fa-save"],["type","button","id","saveForLater",1,"btn",3,"click","dsBtnDisabled"],["type","button","id","deposit","class","btn btn-success",3,"dsBtnDisabled","click",4,"ngIf"],["type","button","id","discard",1,"btn","btn-danger",3,"click","dsBtnDisabled"],[1,"fas","fa-trash"],[1,"fas","fa-check-circle"],[1,"fas","fa-exclamation-circle"],[1,"col","d-flex","justify-content-end","align-items-center"],[1,"progress","w-75"],["class","progress-bar progress-bar-striped progress-bar-animated bg-info","role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",3,"width",4,"ngIf"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated","bg-info"],["type","button","id","deposit",1,"btn","btn-success",3,"click","dsBtnDisabled"],[1,"fas","fa-plus"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer","space-children-mr"],["type","button","id","discard_cancel",1,"btn","btn-secondary",3,"click"],["type","button","id","discard_submit",1,"btn","btn-danger",3,"click"]],template:function(i,s){1&i&&t.DNE(0,Rs,37,55,"div",1)(1,Ps,16,12,"ng-template",null,0,t.C5r),2&i&&t.Y8G("ngIf",!!s.submissionId)},dependencies:[u.MD,u.bT,u.Jj,Cs.L,B.h,B.D9,jt.A]})}}return n})();var Bs=o(57538);const zt=n=>({"w-100":n});function xs(n,d){if(1&n&&(t.qex(0),t.j41(1,"button",6),t.nI1(2,"async"),t.nI1(3,"async"),t.EFF(4),t.nI1(5,"translate"),t.nrm(6,"i",7),t.k0s(),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("dsBtnDisabled",!0!==t.bMT(2,3,e.hasSections$))("ngClass",t.eq3(9,zt,t.bMT(3,5,e.windowService.isXs()))),t.R7$(3),t.SpI(" ",t.bMT(5,7,"submission.sections.general.add-more")," ")}}function Us(n,d){1&n&&(t.j41(0,"button",8),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections.general.no-sections")," "))}function $s(n,d){if(1&n){const e=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.addSection(s.id))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&n){const e=d.$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections."+e.header)," ")}}let As=(()=>{class n{constructor(e,i,s){this.sectionService=e,this.submissionService=i,this.windowService=s}ngOnInit(){this.sectionList$=this.submissionService.getDisabledSectionsList(this.submissionId),this.hasSections$=this.sectionList$.pipe((0,a.T)(e=>e.length>0))}addSection(e){this.sectionService.addSection(this.submissionId,e)}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(M.c),t.rXU(f.E),t.rXU(Bs.CV))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-form-section-add"]],inputs:{collectionId:"collectionId",submissionId:"submissionId"},standalone:!0,features:[t.aNF],decls:10,vars:17,consts:[["sectionAdd","ngbDropdown"],["ngbDropdown","","placement","bottom-right",1,"d-inline-block",3,"ngClass"],[4,"ngIf"],["ngbDropdownMenu","","aria-labelledby","sectionControls",1,"sections-dropdown-menu",3,"ngClass"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["id","sectionControls","ngbDropdownToggle","",1,"btn","btn-outline-primary","dropdown-toggle",3,"dsBtnDisabled","ngClass"],["aria-hidden","true",1,"fa","fa-plus"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"]],template:function(i,s){1&i&&(t.j41(0,"div",1,0),t.DNE(2,xs,7,11,"ng-container",2),t.nI1(3,"async"),t.j41(4,"div",3),t.nI1(5,"async"),t.DNE(6,Us,3,3,"button",4),t.nI1(7,"async"),t.DNE(8,$s,3,3,"button",5),t.nI1(9,"async"),t.k0s()()),2&i&&(t.Y8G("ngClass",t.eq3(13,zt,s.windowService.isXs())),t.R7$(2),t.Y8G("ngIf",t.bMT(3,5,s.hasSections$)),t.R7$(2),t.Y8G("ngClass",t.eq3(15,zt,t.bMT(5,7,s.windowService.isXs()))),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(7,9,s.hasSections$)),t.R7$(2),t.Y8G("ngForOf",t.bMT(9,11,s.sectionList$)))},dependencies:[u.MD,u.YU,u.Sq,u.bT,u.Jj,B.h,B.D9,D.zH,D.tg,D.do,D.U0,jt.A],styles:[".dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.sections-dropdown-menu[_ngcontent-%COMP%]{z-index:var(--ds-submission-header-z-index)}"]})}}return n})();o(93256);const Gs=["*"];function Ls(n,d){}let Ns=(()=>{class n extends ee.J{constructor(){super(...arguments),this.inAndOutputNames=["collectionId","submissionId","uploadFilesOptions"]}getComponentName(){return"SubmissionUploadFilesComponent"}importThemedComponent(e){return o(28767)(`./${e}/app/submission/form/submission-upload-files/submission-upload-files.component.ts`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,93256))}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=t.xGo(n)))(s||n)}})()}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},standalone:!0,features:[t.Vt3,t.aNF],ngContentSelectors:Gs,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(i,s){1&i&&(t.NAR(),t.DNE(0,Ls,0,0,"ng-template",null,0,t.C5r),t.j41(2,"div",null,1),t.SdG(4),t.k0s())},encapsulation:2})}}return n})();function Vs(n,d){if(1&n&&(t.j41(0,"div",12),t.nrm(1,"ds-submission-upload-files",13)(2,"div",14),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.Y8G("submissionId",e.submissionId)("collectionId",e.collectionId)("uploadFilesOptions",e.uploadFilesOptions)}}function Xs(n,d){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"ds-submission-form-collection",15),t.bIt("collectionChange",function(s){t.eBV(e);const r=t.XpG(2);return t.Njj(r.onCollectionChange(s))}),t.k0s(),t.bVm()}if(2&n){const e=t.XpG(2);t.R7$(),t.Y8G("currentCollectionId",e.collectionId)("currentDefinition",e.definitionId)("submissionId",e.submissionId)("collectionModifiable",e.collectionModifiable)("isReadonly",e.isSectionReadonly)}}function Ys(n,d){if(1&n&&(t.j41(0,"div",6),t.DNE(1,Vs,3,3,"div",7),t.nI1(2,"async"),t.j41(3,"div",8),t.DNE(4,Xs,2,5,"ng-container",9),t.k0s(),t.j41(5,"div",10),t.nrm(6,"ds-submission-form-section-add",11),t.k0s()()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,4,e.uploadEnabled$)),t.R7$(3),t.Y8G("ngIf",!e.isSectionHidden),t.R7$(2),t.Y8G("collectionId",e.collectionId)("submissionId",e.submissionId)}}function ks(n,d){1&n&&t.nrm(0,"ds-loading",16)}function Ks(n,d){if(1&n&&(t.qex(0),t.nrm(1,"ds-submission-section-container",17),t.bVm()),2&n){const e=d.$implicit,i=t.XpG();t.R7$(),t.Y8G("collectionId",i.collectionId)("submissionId",i.submissionId)("sectionData",e)}}function Ws(n,d){if(1&n&&(t.j41(0,"div",18),t.nrm(1,"ds-submission-form-footer",19),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("submissionId",e.submissionId)}}let ws=(()=>{class n{constructor(e,i,s,r,p){this.authService=e,this.changeDetectorRef=i,this.halService=s,this.submissionService=r,this.sectionsService=p,this.collectionModifiable=null,this.loading=(0,I.of)(!0),this.uploadFilesOptions=new _.H,this.subs=[],this.isActive=!0}ngOnChanges(e){e.collectionId&&this.collectionId&&e.submissionId&&this.submissionId&&(this.isActive=!0,this.submissionSections=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,y.p)(()=>this.isActive),(0,a.T)(i=>i.isLoading),(0,a.T)(i=>i),(0,E.F)(),(0,R.n)(i=>i?(0,I.of)([]):this.getSectionsList())),this.uploadEnabled$=this.sectionsService.isSectionTypeAvailable(this.submissionId,V.l.Upload),this.loading=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,y.p)(()=>this.isActive),(0,a.T)(i=>i.isLoading),(0,a.T)(i=>i),(0,E.F)()),this.subs.push(this.halService.getEndpoint(this.submissionService.getSubmissionObjectLinkName()).pipe((0,y.p)(i=>(0,c.hj)(i)),(0,E.F)()).subscribe(i=>{this.uploadFilesOptions.authToken=this.authService.buildAuthHeader(),this.uploadFilesOptions.url=i.concat(`/${this.submissionId}`),this.definitionId=this.submissionDefinition.name,this.submissionService.dispatchInit(this.collectionId,this.submissionId,this.selfUrl,this.submissionDefinition,this.sections,this.item,this.submissionErrors),this.changeDetectorRef.detectChanges()})),this.submissionService.startAutoSave(this.submissionId))}getCollectionVisibility(){const e=this.submissionDefinition.sections.page.find(i=>S()(i.sectionType,V.l.Collection));return(0,c.EA)(e.visibility)?e.visibility:null}get isSectionHidden(){const e=this.getCollectionVisibility();return(0,c.a4)(e)&&S()(e.main,xt.x.HIDDEN)&&S()(e.other,xt.x.HIDDEN)}get isSectionReadonly(){const e=this.getCollectionVisibility();return(0,c.a4)(e)&&S()(e.main,xt.x.READONLY)&&S()(e.other,xt.x.READONLY)}ngOnDestroy(){this.isActive=!1,this.submissionService.stopAutoSave(),this.submissionService.resetAllSubmissionObjects(),this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}onCollectionChange(e){this.collectionId=e.collection.id,this.definitionId!==e.submissionDefinition.name?(this.sections=e.sections,this.submissionDefinition=e.submissionDefinition,this.definitionId=this.submissionDefinition.name,this.submissionService.resetSubmissionObject(this.collectionId,this.submissionId,e._links.self.href,this.submissionDefinition,this.sections,this.item)):this.changeDetectorRef.detectChanges()}isLoading(){return this.loading}getSectionsList(){return this.submissionService.getSubmissionSections(this.submissionId).pipe((0,y.p)(e=>(0,c.hj)(e)),(0,a.T)(e=>e.filter(i=>!S()(i.sectionType,V.l.Collection))))}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(G.uR),t.rXU(t.gRc),t.rXU(b.Y),t.rXU(f.E),t.rXU(M.c))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-form"]],inputs:{collectionId:"collectionId",item:"item",collectionModifiable:"collectionModifiable",sections:"sections",submissionErrors:"submissionErrors",selfUrl:"selfUrl",submissionDefinition:"submissionDefinition",submissionId:"submissionId"},standalone:!0,features:[t.OA$,t.aNF],decls:10,vars:12,consts:[[1,"container-fluid"],["class","submission-form-header mb-3 d-flex flex-wrap position-sticky",4,"ngIf"],[1,"submission-form-content"],["message","Loading...",4,"ngIf"],[4,"ngFor","ngForOf"],["class","submission-form-footer mt-3 mb-3 position-sticky",4,"ngIf"],[1,"submission-form-header","mb-3","d-flex","flex-wrap","position-sticky"],["class","w-100",4,"ngIf"],[1,"submission-form-header-item","mb-3","mb-sm-0","flex-sm-grow-1","flex-md-grow-0"],[4,"ngIf"],[1,"submission-form-header-item","text-end"],[3,"collectionId","submissionId"],[1,"w-100"],[3,"submissionId","collectionId","uploadFilesOptions"],[1,"clearfix"],[3,"collectionChange","currentCollectionId","currentDefinition","submissionId","collectionModifiable","isReadonly"],["message","Loading..."],[3,"collectionId","submissionId","sectionData"],[1,"submission-form-footer","mt-3","mb-3","position-sticky"],[3,"submissionId"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,Ys,7,6,"div",1),t.nI1(2,"async"),t.j41(3,"div",2),t.DNE(4,ks,1,0,"ds-loading",3),t.nI1(5,"async"),t.DNE(6,Ks,2,3,"ng-container",4),t.nI1(7,"async"),t.k0s(),t.DNE(8,Ws,2,1,"div",5),t.nI1(9,"async"),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",!0!==t.bMT(2,4,s.isLoading())),t.R7$(3),t.Y8G("ngIf",t.bMT(5,6,s.isLoading())),t.R7$(2),t.Y8G("ngForOf",t.bMT(7,8,s.submissionSections)),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(9,10,s.isLoading())))},dependencies:[u.MD,u.Sq,u.bT,u.Jj,g.v,ps,js,Ns,Ss,As],styles:[".submission-form-header[_ngcontent-%COMP%]{background-color:#fffffff7;padding:calc(var(--bs-spacer) / 2) 0 calc(var(--bs-spacer) / 2) 0;top:0;z-index:var(--ds-submission-header-z-index)}.submission-form-header-item[_ngcontent-%COMP%]{flex-grow:1}.submission-form-footer[_ngcontent-%COMP%]{border-radius:var(--bs-card-border-radius);bottom:0;background-color:var(--bs-gray-400);padding:calc(var(--bs-spacer) / 2);z-index:var(--ds-submission-footer-z-index)}.btn-link-focus[_ngcontent-%COMP%]{font-weight:400;color:#066;text-decoration:none}.btn-link-focus[_ngcontent-%COMP%]:hover{color:#001a1a;text-decoration:underline}.btn-link-focus[_ngcontent-%COMP%]:disabled, .btn-link-focus.disabled[_ngcontent-%COMP%]{color:#6c757d;pointer-events:none}.btn-link-focus[_ngcontent-%COMP%]:focus, .btn-link-focus.focus[_ngcontent-%COMP%]{text-decoration:underline}"]})}}return n})()},93256:(W,j,o)=>{"use strict";o.r(j),o.d(j,{SubmissionUploadFilesComponent:()=>B});var u=o(60177),T=o(7673),S=o(61594),I=o(96697),y=o(83203),a=o(68552),E=o(82777),R=o(39806),G=o(43095),b=(o(32979),o(72147)),m=o(88643),c=o(61010),g=o(7020),_=o(54438),t=o(41780);function D(C,L){if(1&C){const A=_.RV6();_.j41(0,"ds-uploader",1),_.bIt("onCompleteItem",function(f){_.eBV(A);const J=_.XpG();return _.Njj(J.onCompleteItem(f))})("onUploadError",function(){_.eBV(A);const f=_.XpG();return _.Njj(f.onUploadError())}),_.k0s()}if(2&C){const A=_.XpG();_.Y8G("dropMsg",A.dropMsg)("dropOverDocumentMsg",A.dropOverDocumentMsg)("enableDragOverDocument",A.enableDragOverDocument)("onBeforeUpload",A.onBeforeUpload)("uploadFilesOptions",A.uploadFilesOptions)}}let B=(()=>{class C{constructor(A,k,f,J,M){this.notificationsService=A,this.operationsService=k,this.sectionService=f,this.submissionService=J,this.translate=M,this.enableDragOverDocument=!0,this.dropOverDocumentMsg="submission.sections.upload.drop-message",this.dropMsg="submission.sections.upload.drop-message",this.subs=[],this.uploadEnabled=(0,T.of)(!1),this.onBeforeUpload=()=>{const V=this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections").subscribe();return this.subs.push(V),V}}ngOnChanges(){this.uploadEnabled=this.sectionService.isSectionTypeAvailable(this.submissionId,m.l.Upload)}onCompleteItem(A){this.subs.push(this.uploadEnabled.pipe((0,S.$)()).subscribe(k=>{if(k){const{sections:f}=A,{errors:J}=A,M=(0,g.A)(J);f&&(0,E.hj)(f)&&Object.keys(f).forEach(V=>{const Y=(0,a.Z5)(f[V]),U=M[V];this.sectionService.isSectionType(this.submissionId,V,m.l.Upload).pipe((0,I.s)(1)).subscribe(Q=>{Q&&((0,E.Im)(U)?this.notificationsService.success(null,this.translate.get("submission.sections.upload.upload-successful")):this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed")))}),this.sectionService.updateSectionData(this.submissionId,V,Y,U,U)})}}))}onUploadError(){this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed"))}ngOnDestroy(){this.subs.filter(A=>(0,E.a4)(A)).forEach(A=>A.unsubscribe())}static{this.\u0275fac=function(k){return new(k||C)(_.rXU(R.I),_.rXU(y.U),_.rXU(b.c),_.rXU(c.E),_.rXU(t.c$))}}static{this.\u0275cmp=_.VBU({type:C,selectors:[["ds-base-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},standalone:!0,features:[_.OA$,_.aNF],decls:1,vars:1,consts:[[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError",4,"ngIf"],[3,"onCompleteItem","onUploadError","dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions"]],template:function(k,f){1&k&&_.DNE(0,D,1,5,"ds-uploader",0),2&k&&_.Y8G("ngIf",f.uploadFilesOptions.url)},dependencies:[G.y,u.bT],encapsulation:2})}}return C})()},69184:(W,j,o)=>{"use strict";o.r(j),o.d(j,{CoarNotifyConfigDataService:()=>t});var u=o(96697),T=o(96354),S=o(72734),I=o(41684),y=o(39280),a=o(13617),E=o(46787),R=o(63897),G=o(87158),x=o(43052),b=o(32473),m=o(4910),c=o(45663),g=o(39806),_=o(54438);let t=(()=>{class D extends R.W{constructor(C,L,A,k,f){super("submissioncoarnotifyconfigs",C,L,A,k),this.requestService=C,this.rdbService=L,this.objectCache=A,this.halService=k,this.notificationsService=f,this.findAllData=new E.H(this.linkPath,C,L,A,k,this.responseMsToLive),this.deleteData=new a.I(this.linkPath,C,L,A,k,f,this.responseMsToLive,this.constructIdEndpoint),this.patchData=new G.n(this.linkPath,C,L,A,k,this.comparator,this.responseMsToLive,this.constructIdEndpoint),this.createData=new y.V(this.linkPath,C,L,A,k,f,this.responseMsToLive)}create(C,...L){return this.createData.create(C,...L)}patch(C,L){return this.patchData.patch(C,L)}update(C){return this.patchData.update(C)}commitUpdates(C){return this.patchData.commitUpdates(C)}createPatchFromCache(C){return this.patchData.createPatchFromCache(C)}findAll(C,L,A,...k){return this.findAllData.findAll(C,L,A,...k)}delete(C,L){return this.deleteData.delete(C,L)}deleteByHref(C,L){return this.deleteData.deleteByHref(C,L)}invoke(C,L,A){const k=this.requestService.generateRequestId();return this.getBrowseEndpoint().pipe((0,u.s)(1),(0,T.T)(f=>new c.t(f,C,"submissioncoarnotifyconfigmodel",L).toString()),(0,T.T)(f=>{const J=this.getInvocationFormData(A);return new x.E0(k,f,J)})).subscribe(f=>this.requestService.send(f)),this.rdbService.buildFromRequestUUID(k)}getInvocationFormData(C){const L=new FormData;return C.forEach(A=>{L.append("file",A)}),L}static{this.\u0275fac=function(L){return new(L||D)(_.KVO(b.B),_.KVO(S.o),_.KVO(I.$),_.KVO(m.Y),_.KVO(g.I))}}static{this.\u0275prov=_.jDH({token:D,factory:D.\u0275fac,providedIn:"root"})}}return D})()},94338:(W,j,o)=>{"use strict";o.d(j,{_:()=>b});var u=o(60177),T=o(96526),S=o(44494),I=o(80183),y=o(82777),a=o(54438);function E(m,c){if(1&m&&(a.j41(0,"span",3),a.EFF(1),a.k0s()),2&m){const g=a.XpG().$implicit;a.R7$(),a.E5c(" ",g.name," ",g.startDate," ",g.endDate," ")}}function R(m,c){if(1&m&&(a.j41(0,"span",3),a.EFF(1),a.k0s()),2&m){const g=a.XpG().$implicit;a.R7$(),a.Lme("",g.name," from ",g.endDate,"")}}function G(m,c){if(1&m&&(a.j41(0,"span",4),a.EFF(1),a.k0s()),2&m){const g=a.XpG().$implicit;a.R7$(),a.Lme("",g.name," until ",g.startDate,"")}}function x(m,c){if(1&m&&(a.qex(0),a.DNE(1,E,2,3,"span",1)(2,R,2,2,"span",1)(3,G,2,2,"span",2),a.nrm(4,"br"),a.bVm()),2&m){const g=c.$implicit;a.R7$(),a.Y8G("ngIf","DEFAULT_BITSTREAM_READ"===g.action),a.R7$(),a.Y8G("ngIf","lease"===g.name),a.R7$(),a.Y8G("ngIf","embargo"===g.name)}}let b=(()=>{class m{constructor(g,_){this.dsoNameService=g,this.groupService=_,this.accessConditionsList=[]}ngOnInit(){this.accessConditions.forEach(g=>{(0,y.Im)(g.name)?this.groupService.findByHref(g._links.group.href).pipe((0,I.qD)()).subscribe(_=>{if(_.hasSucceeded){const t=_.payload,D=Object.assign({},g);D.name=this.dsoNameService.getName(t),this.accessConditionsList.push(D)}}):this.accessConditionsList.push(g)})}static{this.\u0275fac=function(_){return new(_||m)(a.rXU(T.f),a.rXU(S.GroupDataService))}}static{this.\u0275cmp=a.VBU({type:m,selectors:[["ds-submission-section-upload-access-conditions"]],inputs:{accessConditions:"accessConditions"},standalone:!0,features:[a.aNF],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["class","badge bg-primary mt-3 me-2",4,"ngIf"],["class","badge bg-dark mt-3 me-2",4,"ngIf"],[1,"badge","bg-primary","mt-3","me-2"],[1,"badge","bg-dark","mt-3","me-2"]],template:function(_,t){1&_&&a.DNE(0,x,5,3,"ng-container",0),2&_&&a.Y8G("ngForOf",t.accessConditionsList)},dependencies:[u.Sq,u.bT],encapsulation:2})}}return m})()},9034:(W,j,o)=>{"use strict";o.r(j),o.d(j,{SubmissionSectionUploadFileComponent:()=>Nt});var u=o(60177),T=o(41780),S=o(84412),I=o(5964),a=(o(7232),o(92409)),E=o(17184),R=o(33376),G=o(83203),x=o(60456),b=o(82777),m=o(28836),c=o(54002),g=o(61010),_=o(84580),t=o(1473),D=o(96697),B=o(73028),C=o(37636),L=o(12866),A=o(33126),k=o(13143);const M={id:"metadata",group:[]},V={element:{container:"mb-3",label:"col-form-label"},grid:{label:"col-sm-3"}},Y={id:"accessConditionGroup",group:[]},U={element:{host:"mb-3 access-condition-group col",container:"ps-1 pe-1",control:"row "}},Q={id:"accessConditions",groupFactory:null},H={grid:{group:"row pt-4"}},Z={id:"name",label:"submission.sections.upload.form.access-condition-label",hint:"submission.sections.upload.form.access-condition-hint",options:[]},q={element:{host:"col-12",label:"col-form-label name-label"}},rt={element:{host:"col-12",container:"text-right"}},ot={id:"primary",name:"primary",label:"bitstream.edit.form.primaryBitstream.label"},et={id:"startDate",label:"submission.sections.upload.form.from-label",hint:"submission.sections.upload.form.from-hint",placeholder:"submission.sections.upload.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:t.AjF,operator:t.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-from"}},gt={element:{label:"col-form-label"},grid:{host:"col-6"}},ft={id:"endDate",label:"submission.sections.upload.form.until-label",hint:"submission.sections.upload.form.until-hint",placeholder:"submission.sections.upload.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:t.AjF,operator:t.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-until"}},ht={element:{label:"col-form-label"},grid:{host:"col-6"}};var l=o(54438),vt=o(58003);const $t=["formRef"];function At(K,bt){if(1&K){const v=l.RV6();l.j41(0,"ds-form",6,0),l.bIt("submitForm",function(){l.eBV(v);const F=l.XpG();return l.Njj(F.onSubmit())})("cancel",function(){l.eBV(v);const F=l.XpG();return l.Njj(F.onModalClose())})("dfChange",function(F){l.eBV(v);const X=l.XpG();return l.Njj(X.onChange(F))}),l.k0s()}if(2&K){const v=l.XpG();l.Y8G("formId",v.formId)("formModel",v.formModel)("displaySubmit",!v.isSaving)("displayCancel",!v.isSaving)}}let Ft=(()=>{class K{constructor(v,O,F,X,$,w,z,ut){this.activeModal=v,this.cdr=O,this.formBuilderService=F,this.formService=X,this.submissionService=$,this.operationsBuilder=w,this.operationsService=z,this.uploadService=ut,this.formMetadata=[],this.isSaving=!1,this.subscriptions=[]}initModelData(v){this.formBuilderService.findById("primary",v,this.fileIndex).value=this.isPrimary||!1,this.fileData.accessConditions.forEach((F,X)=>{Array.of("name","startDate","endDate").filter($=>F.hasOwnProperty($)&&(0,b.hj)(F[$])).forEach($=>{const w=this.formBuilderService.findById($,v,X);if(w)if(w.type===t.fQD){const z=new Date(F[$]);w.value={year:z.getUTCFullYear(),month:z.getUTCMonth()+1,day:z.getUTCDate()}}else w.value=F[$]})})}onChange(v){"name"===v.model.id&&this.setOptions(v.model,v.control)}onModalClose(){this.activeModal.dismiss()}onSubmit(){this.isSaving=!0,this.saveBitstreamData()}setOptions(v,O){let F=null;if(this.availableAccessConditionOptions.filter(X=>X.name===O.value).forEach(X=>F=X),(0,b.hj)(F)){const X=O.parent.get("startDate"),$=O.parent.get("endDate");X?.markAsUntouched(),$?.markAsUntouched(),X?.setValue(null),O.parent.markAsDirty(),$?.setValue(null)}}ngOnInit(){this.fileData&&this.formId&&(this.formModel=this.buildFileEditForm(),this.cdr.detectChanges())}ngOnDestroy(){this.unsubscribeAll()}retrieveValueFromField(v){const O=Array.isArray(v)?v[0]:v;return O?O.value:void 0}buildFileEditForm(){const v=Object.assign({},this.configMetadataForm.rows[0].fields[0]);v.repeatable=!1;const O=Object.assign({},this.configMetadataForm,{fields:Object.assign([],this.configMetadataForm.rows[0].fields[0],[this.configMetadataForm.rows[0].fields[0],v])}),F=[];F.push(new C.i(ot,rt));const X=Object.assign({},M);X.group=this.formBuilderService.modelFromConfiguration(this.submissionId,O,this.collectionId,this.fileData.metadata,this.submissionService.getSubmissionScope()),F.push(new t.iO5(X,V));const $=Object.assign({},Z),w=Object.assign({},Q),z=[];if(2===this.collectionPolicyType){for(const it of this.availableAccessConditionOptions)z.push({label:it.name,value:it.name});$.options=z;const ut=[],ct=[];let pt,Ot;this.availableAccessConditionOptions.forEach(it=>{if(it.hasStartDate&&(ut.push({id:"name",value:it.name}),it.maxStartDate)){const st=new Date(it.maxStartDate);pt={year:st.getUTCFullYear(),month:st.getUTCMonth()+1,day:st.getUTCDate()}}if(it.hasEndDate&&(ct.push({id:"name",value:it.name}),it.maxEndDate)){const st=new Date(it.maxEndDate);Ot={year:st.getUTCFullYear(),month:st.getUTCMonth()+1,day:st.getUTCDate()}}});const Vt={relations:[{match:t.AjF,operator:t.fXj,when:ut}]},Xt={relations:[{match:t.AjF,operator:t.fXj,when:ct}]},Yt=ut.length>0,It=ct.length>0;w.groupFactory=()=>{const it=new t.z4z($,q),st=Object.assign({},et,Vt);pt&&(st.max=pt);const Pt=Object.assign({},ft,Xt);Ot&&(Pt.max=Ot);const kt=new t.dku(st,gt),Kt=new t.dku(Pt,ht),Ct=Object.assign({},Y);return Ct.group=[it],Yt&&Ct.group.push(kt),It&&Ct.group.push(Kt),[new t.iO5(Ct,U)]},w.initialCount=(0,b.hj)(this.fileData.accessConditions)?this.fileData.accessConditions.length:1,F.push(new t.UqU(w,H))}return this.initModelData(F),F}saveBitstreamData(){const v=["files",this.fileIndex];this.formService.validateAllFormFields(this.formRef.formGroup);const O=this.formService.isValid(this.formId).pipe((0,D.s)(1),(0,I.p)(F=>F),(0,B.Z)(()=>this.formService.getFormData(this.formId)),(0,D.s)(1),(0,B.Z)(F=>{this.uploadService.updatePrimaryBitstreamOperation(this.pathCombiner.getPath("primary"),this.isPrimary,F.primary[0],this.fileId),Object.keys(F.metadata).filter($=>(0,b.hj)(F.metadata[$])).forEach($=>{const z=`metadata/${$.replace(/_/g,".")}`;this.operationsBuilder.add(this.pathCombiner.getPath([...v,z]),F.metadata[$],!0)}),Object.keys(this.fileData.metadata).filter($=>(0,b.hj)(this.fileData.metadata[$])).filter($=>(0,b.Tn)(F.metadata[$])).filter($=>this.formMetadata.includes($)).forEach($=>{const z=`metadata/${$.replace(/_/g,".")}`;this.operationsBuilder.remove(this.pathCombiner.getPath([...v,z]))});const X=[];return F.hasOwnProperty("accessConditions")&&F.accessConditions.filter($=>(0,b.Pe)($)).map($=>$.accessConditionGroup).filter($=>(0,b.hj)($)).forEach($=>{let w;if(this.availableAccessConditionOptions.filter(z=>(0,b.Pe)($.name)&&z.name===$.name[0].value).forEach(z=>w=z),w){const z=Object.assign({},$);if(z.name=this.retrieveValueFromField($.name),w.hasStartDate){if($.startDate){const ut=this.retrieveValueFromField($.startDate);let ct=new Date(ut);if(w.maxStartDate){const pt=new Date(w.maxStartDate);ct>pt&&(ct=pt)}z.startDate=(0,L.Sd)(ct)}}else delete z.startDate;if(w.hasEndDate){if($.endDate){const ut=this.retrieveValueFromField($.endDate);let ct=new Date(ut);if(w.maxEndDate){const pt=new Date(w.maxEndDate);ct>pt&&(ct=pt)}z.endDate=(0,L.Sd)(ct)}}else delete z.endDate;X.push(z)}}),(0,b.hj)(X)&&this.operationsBuilder.add(this.pathCombiner.getPath([...v,"accessConditions"]),X,!0),this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement)})).subscribe(F=>{const X=F[0].sections[this.sectionId];if(!X)return;const $=X;this.uploadService.updateFilePrimaryBitstream(this.submissionId,this.sectionId,$.primary),Object.keys($.files).filter(w=>$.files[w].uuid===this.fileId).forEach(w=>this.uploadService.updateFileData(this.submissionId,this.sectionId,this.fileId,$.files[w])),this.isSaving=!1,this.activeModal.close()});this.subscriptions.push(O)}unsubscribeAll(){this.subscriptions.filter(v=>(0,b.a4)(v)).forEach(v=>v.unsubscribe())}static{this.\u0275fac=function(O){return new(O||K)(l.rXU(vt.Lw),l.rXU(l.gRc),l.rXU(A.j),l.rXU(c.u),l.rXU(g.E),l.rXU(E.C),l.rXU(G.U),l.rXU(_.i))}}static{this.\u0275cmp=l.VBU({type:K,selectors:[["ds-submission-section-upload-file-edit"]],viewQuery:function(O,F){if(1&O&&l.GBs($t,5),2&O){let X;l.mGM(X=l.lsd())&&(F.formRef=X.first)}},standalone:!0,features:[l.aNF],decls:8,vars:5,consts:[["formRef","formComponent"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click","dsBtnDisabled"],[1,"modal-body"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange",4,"ngIf"],[3,"submitForm","cancel","dfChange","formId","formModel","displaySubmit","displayCancel"]],template:function(O,F){1&O&&(l.j41(0,"div")(1,"div",1)(2,"h4",2),l.EFF(3),l.nI1(4,"translate"),l.k0s(),l.j41(5,"button",3),l.bIt("click",function(){return F.onModalClose()}),l.k0s()(),l.j41(6,"div",4),l.DNE(7,At,2,4,"ds-form",5),l.k0s()()),2&O&&(l.R7$(3),l.JRh(l.bMT(4,3,"submission.sections.upload.edit.title")),l.R7$(2),l.Y8G("dsBtnDisabled",F.isSaving),l.R7$(2),l.Y8G("ngIf",F.formModel))},dependencies:[k.s,u.bT,T.h,T.D9,x.A],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]})}}return K})();var Dt=o(21950);const Rt=K=>({fileName:K});function Gt(K,bt){if(1&K&&(l.j41(0,"span",20),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&K){const v=l.XpG(2);l.R7$(),l.JRh(l.i5U(2,1,"submission.sections.upload.primary.make",l.eq3(4,Rt,v.fileName)))}}function St(K,bt){if(1&K&&(l.j41(0,"span",20),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&K){const v=l.XpG(2);l.R7$(),l.JRh(l.i5U(2,1,"submission.sections.upload.primary.remove",l.eq3(4,Rt,v.fileName)))}}function Tt(K,bt){1&K&&l.nrm(0,"i",21)}function Mt(K,bt){1&K&&l.nrm(0,"i",22)}function mt(K,bt){if(1&K){const v=l.RV6();l.qex(0),l.j41(1,"div",2)(2,"div",3)(3,"div",4)(4,"input",5),l.nI1(5,"async"),l.bIt("change",function(F){l.eBV(v);const X=l.XpG();return l.Njj(X.togglePrimaryBitstream(F))}),l.k0s(),l.j41(6,"label",6),l.DNE(7,Gt,3,6,"span",7)(8,St,3,6,"span",7),l.k0s()()(),l.j41(9,"div",8)(10,"div",9),l.nrm(11,"ds-submission-section-upload-file-view",10),l.k0s(),l.j41(12,"div",11),l.qex(13),l.j41(14,"ds-file-download-link",12),l.nrm(15,"i",13),l.k0s(),l.j41(16,"button",14),l.nI1(17,"translate"),l.nI1(18,"translate"),l.bIt("click",function(F){l.eBV(v);const X=l.XpG();return F.preventDefault(),l.Njj(X.editBitstreamData())}),l.nrm(19,"i",15),l.k0s(),l.j41(20,"button",16),l.nI1(21,"translate"),l.nI1(22,"async"),l.nI1(23,"translate"),l.bIt("click",function(F){l.eBV(v);const X=l.XpG(),$=l.sdS(2);return F.preventDefault(),l.Njj(X.confirmDelete($))}),l.DNE(24,Tt,1,0,"i",17),l.nI1(25,"async"),l.DNE(26,Mt,1,0,"i",18),l.nI1(27,"async"),l.k0s(),l.bVm(),l.k0s(),l.nrm(28,"div",19),l.k0s()(),l.bVm()}if(2&K){const v=l.XpG();l.R7$(4),l.Mz_("id","primaryBitstream",v.fileIndex,""),l.Y8G("disabled",l.bMT(5,20,v.processingSaveStatus$))("checked",v.isPrimary),l.R7$(2),l.Mz_("for","primaryBitstream",v.fileIndex,""),l.R7$(),l.Y8G("ngIf",!v.isPrimary),l.R7$(),l.Y8G("ngIf",v.isPrimary),l.R7$(3),l.Y8G("fileData",v.fileData),l.R7$(3),l.Y8G("cssClasses","btn btn-link-focus")("isBlank",!0)("bitstream",v.getBitstream())("enableRequestACopy",!1),l.R7$(2),l.FS9("title",l.bMT(17,22,"submission.sections.upload.edit.title")),l.BMQ("aria-label",l.bMT(18,24,"submission.sections.upload.edit.title")),l.R7$(4),l.FS9("title",l.bMT(21,26,"submission.sections.upload.delete.confirm.title")),l.Y8G("dsBtnDisabled",l.bMT(22,28,v.processingDelete$)),l.BMQ("aria-label",l.bMT(23,30,"submission.sections.upload.delete.confirm.title")),l.R7$(4),l.Y8G("ngIf",l.bMT(25,32,v.processingDelete$)),l.R7$(2),l.Y8G("ngIf",!0!==l.bMT(27,34,v.processingDelete$))}}function Lt(K,bt){if(1&K){const v=l.RV6();l.j41(0,"div",23)(1,"h4",24),l.EFF(2),l.nI1(3,"translate"),l.k0s(),l.j41(4,"button",25),l.bIt("click",function(){const F=l.eBV(v).dismiss;return l.Njj(F("cancel"))}),l.k0s()(),l.j41(5,"div",26)(6,"p"),l.EFF(7),l.nI1(8,"translate"),l.k0s()(),l.j41(9,"div",27)(10,"button",28),l.bIt("click",function(){const F=l.eBV(v).close;return l.Njj(F("cancel"))}),l.EFF(11),l.nI1(12,"translate"),l.k0s(),l.j41(13,"button",29),l.bIt("click",function(){const F=l.eBV(v).close;return l.Njj(F("ok"))}),l.EFF(14),l.nI1(15,"translate"),l.k0s()()}2&K&&(l.R7$(2),l.JRh(l.bMT(3,4,"submission.sections.upload.delete.confirm.title")),l.R7$(5),l.JRh(l.bMT(8,6,"submission.sections.upload.delete.confirm.info")),l.R7$(4),l.JRh(l.bMT(12,8,"submission.sections.upload.delete.confirm.cancel")),l.R7$(3),l.JRh(l.bMT(15,10,"submission.sections.upload.delete.confirm.submit")))}let Nt=(()=>{class K{constructor(v,O,F,X,$,w){this.formService=v,this.modalService=O,this.operationsBuilder=F,this.operationsService=X,this.submissionService=$,this.uploadService=w,this.processingDelete$=new S.t(!1),this.subscriptions=[],this.formMetadata=[],this.readMode=!0}ngOnChanges(v){this.availableAccessConditionOptions&&this.subscriptions.push(this.uploadService.getFileData(this.submissionId,this.sectionId,this.fileId).pipe((0,I.p)(O=>(0,b.EA)(O))).subscribe(O=>{this.fileData=O}))}ngOnInit(){this.formId=this.formService.getUniqueId(this.fileId),this.processingSaveStatus$=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.pathCombiner=new a.S("sections",this.sectionId),this.loadFormMetadata()}confirmDelete(v){this.modalService.open(v).result.then(O=>{"ok"===O&&(this.processingDelete$.next(!0),this.deleteFile())})}getBitstream(){return Object.assign(new R._,{uuid:this.fileData.uuid})}editBitstreamData(){const O=this.modalService.open(Ft,{size:"xl",backdrop:"static"});O.componentInstance.availableAccessConditionOptions=this.availableAccessConditionOptions,O.componentInstance.collectionId=this.collectionId,O.componentInstance.collectionPolicyType=this.collectionPolicyType,O.componentInstance.configMetadataForm=this.configMetadataForm,O.componentInstance.fileData=this.fileData,O.componentInstance.fileId=this.fileId,O.componentInstance.fileIndex=this.fileIndex,O.componentInstance.formId=this.formId,O.componentInstance.sectionId=this.sectionId,O.componentInstance.formMetadata=this.formMetadata,O.componentInstance.pathCombiner=this.pathCombiner,O.componentInstance.submissionId=this.submissionId,O.componentInstance.isPrimary=this.isPrimary}togglePrimaryBitstream(v){this.uploadService.updatePrimaryBitstreamOperation(this.pathCombiner.getPath("primary"),this.isPrimary,v.target.checked,this.fileId),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionId)}ngOnDestroy(){this.unsubscribeAll()}unsubscribeAll(){this.subscriptions.filter(v=>(0,b.a4)(v)).forEach(v=>v.unsubscribe())}loadFormMetadata(){this.configMetadataForm.rows.forEach(v=>{v.fields.forEach(O=>{O.selectableMetadata.forEach(F=>{this.formMetadata.push(F.metadata)})})})}deleteFile(){this.operationsBuilder.remove(this.pathCombiner.getPath(["files",this.fileIndex])),this.isPrimary&&this.operationsBuilder.remove(this.pathCombiner.getPath("primary")),this.subscriptions.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement).subscribe(()=>{this.isPrimary&&this.uploadService.updateFilePrimaryBitstream(this.submissionId,this.sectionId,null),this.uploadService.removeUploadedFile(this.submissionId,this.sectionId,this.fileId),this.processingDelete$.next(!1)}))}static{this.\u0275fac=function(O){return new(O||K)(l.rXU(c.u),l.rXU(vt.Bq),l.rXU(E.C),l.rXU(G.U),l.rXU(g.E),l.rXU(_.i))}}static{this.\u0275cmp=l.VBU({type:K,selectors:[["ds-base-submission-upload-section-file"]],viewQuery:function(O,F){if(1&O&&l.GBs(Ft,5),2&O){let X;l.mGM(X=l.lsd())&&(F.fileEditComp=X.first)}},inputs:{isPrimary:"isPrimary",availableAccessConditionOptions:"availableAccessConditionOptions",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},standalone:!0,features:[l.OA$,l.aNF],decls:3,vars:1,consts:[["content",""],[4,"ngIf"],[1,"row"],[1,"col-md-2","d-flex","justify-content-center","align-items-center"],[1,"custom-control","custom-switch"],["type","checkbox",1,"custom-control-input",3,"change","id","disabled","checked"],[1,"custom-control-label",3,"for"],["class","sr-only",4,"ngIf"],[1,"col-md-10"],[1,"float-start","w-75"],[3,"fileData"],[1,"float-end","w-15"],[3,"cssClasses","isBlank","bitstream","enableRequestACopy"],["aria-hidden","true",1,"fa","fa-download","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"click","title"],[1,"fa","fa-edit","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"click","title","dsBtnDisabled"],["class","fas fa-circle-notch fa-spin fa-2x link-danger",4,"ngIf"],["class","fa fa-trash fa-2x link-danger",4,"ngIf"],[1,"clearfix"],[1,"sr-only"],[1,"fas","fa-circle-notch","fa-spin","fa-2x","link-danger"],[1,"fa","fa-trash","fa-2x","link-danger"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(O,F){1&O&&l.DNE(0,mt,29,36,"ng-container",1)(1,Lt,16,12,"ng-template",null,0,l.C5r),2&O&&l.Y8G("ngIf",F.fileData)},dependencies:[T.h,T.D9,Dt.h,u.bT,u.Jj,m.z,x.A]})}}return K})()},21950:(W,j,o)=>{"use strict";o.d(j,{h:()=>k});var u=o(60177),T=o(41780),S=o(39552),I=o(82777),y=o(43525),a=o(54438);let E=(()=>{class f{transform(M,V){if((0,I.a4)(M)){const Y=V&&V.length>0?parseInt(V[0],10):10;return M.length>Y?M.substring(0,Y)+"...":M}return M}static{this.\u0275fac=function(V){return new(V||f)}}static{this.\u0275pipe=a.EJ8({name:"dsTruncate",type:f,pure:!0,standalone:!0})}}return f})();var R=o(94338);const G=()=>["150"],x=f=>({format:f});function b(f,J){if(1&f&&(a.qex(0),a.j41(1,"h3"),a.EFF(2),a.j41(3,"span",5),a.EFF(4),a.nI1(5,"dsFileSize"),a.k0s()(),a.bVm()),2&f){const M=a.XpG().$implicit,V=a.XpG(2);a.R7$(2),a.SpI(" ",M.value," "),a.R7$(2),a.SpI("(",a.bMT(5,2,null==V.fileData?null:V.fileData.sizeBytes),")")}}function m(f,J){if(1&f&&(a.j41(0,"h5")(1,"span",5),a.EFF(2),a.nI1(3,"translate"),a.k0s()()),2&f){const M=a.XpG(4);a.R7$(2),a.Lme("",a.bMT(3,2,"submission.sections.upload.no-entry")," ",M.fileTitleKey,"")}}function c(f,J){if(1&f&&(a.qex(0),a.DNE(1,m,4,4,"h5",0),a.bVm()),2&f){const M=a.XpG().$implicit,V=a.XpG(2);a.R7$(),a.Y8G("ngIf",0===V.metadata[V.fileTitleKey].indexOf(M))}}function g(f,J){if(1&f&&(a.qex(0),a.DNE(1,b,6,4,"ng-container",0)(2,c,2,1,"ng-container",0),a.nrm(3,"span",2),a.bVm()),2&f){const M=J.$implicit;a.R7$(),a.Y8G("ngIf",""!==M.value),a.R7$(),a.Y8G("ngIf",""===M.value)}}function _(f,J){if(1&f&&(a.qex(0),a.EFF(1),a.nI1(2,"dsTruncate"),a.bVm()),2&f){const M=a.XpG().$implicit;a.R7$(),a.SpI(" ",a.i5U(2,1,M.value,a.lJ4(4,G))," ")}}function t(f,J){if(1&f&&(a.j41(0,"span",5),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&f){const M=a.XpG(4);a.R7$(),a.Lme("",a.bMT(2,2,"submission.sections.upload.no-entry")," ",M.fileDescrKey,"")}}function D(f,J){if(1&f&&(a.qex(0),a.DNE(1,t,3,4,"span",6),a.bVm()),2&f){const M=a.XpG().$implicit,V=a.XpG(2);a.R7$(),a.Y8G("ngIf",0===V.metadata[V.fileDescrKey].indexOf(M))}}function B(f,J){if(1&f&&(a.qex(0),a.DNE(1,_,3,5,"ng-container",0)(2,D,2,1,"ng-container",0),a.nrm(3,"span",2),a.bVm()),2&f){const M=J.$implicit;a.R7$(),a.Y8G("ngIf",""!==M.value),a.R7$(),a.Y8G("ngIf",""===M.value)}}function C(f,J){if(1&f&&(a.qex(0),a.DNE(1,g,4,2,"ng-container",4)(2,B,4,2,"ng-container",4),a.bVm()),2&f){const M=a.XpG();a.R7$(),a.Y8G("ngForOf",M.getAllMetadataValue(M.fileTitleKey)),a.R7$(),a.Y8G("ngForOf",M.getAllMetadataValue(M.fileDescrKey))}}function L(f,J){if(1&f&&(a.j41(0,"div",7),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&f){const M=a.XpG();a.R7$(),a.SpI(" ",a.i5U(2,1,"admin.registries.bitstream-formats.edit.head",a.eq3(4,x,M.fileFormat))," ")}}function A(f,J){if(1&f&&(a.j41(0,"div",7),a.EFF(1),a.k0s()),2&f){const M=a.XpG();a.R7$(),a.Lme(" Checksum ",M.fileCheckSum.checkSumAlgorithm,": ",M.fileCheckSum.value," ")}}let k=(()=>{class f{constructor(){this.metadata=Object.create({}),this.fileTitleKey="Title",this.fileDescrKey="Description"}ngOnInit(){(0,I.hj)(this.fileData.metadata)&&(this.metadata[this.fileTitleKey]=S.O.all(this.fileData.metadata,"dc.title"),this.metadata[this.fileDescrKey]=S.O.all(this.fileData.metadata,"dc.description")),this.fileCheckSum=this.fileData.checkSum,this.fileFormat=this.fileData.format.shortDescription}getAllMetadataValue(M){return S.O.all(this.metadata,M)}static{this.\u0275fac=function(V){return new(V||f)}}static{this.\u0275cmp=a.VBU({type:f,selectors:[["ds-submission-section-upload-file-view"]],inputs:{fileData:"fileData"},standalone:!0,features:[a.aNF],decls:6,vars:4,consts:[[4,"ngIf"],["class","mt-1",4,"ngIf"],[1,"clearfix"],[3,"accessConditions"],[4,"ngFor","ngForOf"],[1,"text-muted"],["class","text-muted",4,"ngIf"],[1,"mt-1"]],template:function(V,Y){1&V&&(a.j41(0,"div"),a.DNE(1,C,3,2,"ng-container",0)(2,L,3,6,"div",1)(3,A,2,2,"div",1),a.nrm(4,"span",2)(5,"ds-submission-section-upload-access-conditions",3),a.k0s()),2&V&&(a.R7$(),a.Y8G("ngIf",Y.metadata),a.R7$(),a.Y8G("ngIf",Y.fileFormat),a.R7$(),a.Y8G("ngIf",Y.fileCheckSum),a.R7$(2),a.Y8G("accessConditions",Y.fileData.accessConditions))},dependencies:[R._,T.h,T.D9,E,u.bT,u.Sq,y.s],encapsulation:2})}}return f})()},84580:(W,j,o)=>{"use strict";o.d(j,{i:()=>x});var u=o(96354),T=o(23294),S=o(5964),I=o(17184),y=o(82777),a=o(93158),E=o(645),R=o(54438),G=o(25499);let x=(()=>{class b{constructor(c,g){this.store=c,this.operationsBuilder=g}updatePrimaryBitstreamOperation(c,g,_,t){if(null===g&&_)this.operationsBuilder.add(c,t,!1,!0);else if(g!==_){if(_)return void this.operationsBuilder.replace(c,t,!0);this.operationsBuilder.remove(c)}}getUploadedFilesData(c,g){return this.store.select((0,E.on)(c,g)).pipe((0,u.T)(_=>_),(0,T.F)())}getUploadedFileList(c,g){return this.store.select((0,E.Uh)(c,g)).pipe((0,u.T)(_=>_),(0,T.F)())}getFileData(c,g,_){return this.store.select((0,E.Uh)(c,g)).pipe((0,S.p)(t=>!(0,y.b0)(t)),(0,u.T)(t=>{let D;return Object.keys(t).filter(B=>t[B].uuid===_).forEach(B=>D=t[B]),D}),(0,T.F)())}getDefaultPolicies(c,g,_){return this.store.select((0,E.hi)(c,g,_)).pipe((0,u.T)(t=>t),(0,T.F)())}addUploadedFile(c,g,_,t){this.store.dispatch(new a.Bo(c,g,_,t))}updateFilePrimaryBitstream(c,g,_){this.store.dispatch(new a.w7(c,g,_))}updateFileData(c,g,_,t){this.store.dispatch(new a.nt(c,g,_,t))}removeUploadedFile(c,g,_){this.store.dispatch(new a.IE(c,g,_))}static{this.\u0275fac=function(g){return new(g||b)(R.KVO(G.il),R.KVO(I.C))}}static{this.\u0275prov=R.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}}return b})()},89488:(W,j,o)=>{var u=o(73136);W.exports=function T(S){return S&&S.length?u(S):[]}},9048:(W,j,o)=>{var u={"./custom/app/submission/edit/submission-edit.component":[20473,473]};function T(S){if(!o.o(u,S))return Promise.resolve().then(()=>{var a=new Error("Cannot find module '"+S+"'");throw a.code="MODULE_NOT_FOUND",a});var I=u[S],y=I[0];return o.e(I[1]).then(()=>o(y))}T.keys=()=>Object.keys(u),T.id=9048,W.exports=T},28767:(W,j,o)=>{var u={"./custom/app/submission/form/submission-upload-files/submission-upload-files.component.ts":[19247,9247]};function T(S){if(!o.o(u,S))return Promise.resolve().then(()=>{var a=new Error("Cannot find module '"+S+"'");throw a.code="MODULE_NOT_FOUND",a});var I=u[S],y=I[0];return o.e(I[1]).then(()=>o(y))}T.keys=()=>Object.keys(u),T.id=28767,W.exports=T},96682:(W,j,o)=>{var u={"./custom/app/submission/sections/upload/file/section-upload-file.component":[9286,6905]};function T(S){if(!o.o(u,S))return Promise.resolve().then(()=>{var a=new Error("Cannot find module '"+S+"'");throw a.code="MODULE_NOT_FOUND",a});var I=u[S],y=I[0];return o.e(I[1]).then(()=>o(y))}T.keys=()=>Object.keys(u),T.id=96682,W.exports=T}}]);