"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[5355,5521],{25521:(Z,N,s)=>{s.r(N),s.d(N,{ResourcePolicyDataService:()=>D});var P=s(21626),t=s(96354),_=s(61594),R=s(82777),S=s(39806),C=s(72734),b=s(53954),$=s(41684),W=s(39280),A=s(13617),y=s(63897),G=s(87158),V=s(35108),L=s(37419),h=s(41023),T=s(43052),F=s(32473),j=s(14410),k=s(74449),U=s(44494),B=s(4910),H=s(80183),Y=s(54438);let D=(()=>{class w extends y.W{constructor(e,a,f,E,M,m,X,K){super("resourcepolicies",e,a,f,E),this.requestService=e,this.rdbService=a,this.objectCache=f,this.halService=E,this.notificationsService=M,this.comparator=m,this.ePersonService=X,this.groupService=K,this.searchByEPersonMethod="eperson",this.searchByGroupMethod="group",this.searchByResourceMethod="resource",this.createData=new W.V(this.linkPath,e,a,f,E,M,this.responseMsToLive),this.searchData=new V.X(this.linkPath,e,a,f,E,this.responseMsToLive),this.patchData=new G.n(this.linkPath,e,a,f,E,m,this.responseMsToLive,this.constructIdEndpoint),this.deleteData=new A.I(this.linkPath,e,a,f,E,M,this.responseMsToLive,this.constructIdEndpoint)}create(e,a,f,E){const M=[];return M.push(new b.x("resource",a)),(0,R.hj)(f)?M.push(new b.x("eperson",f)):(0,R.hj)(E)&&M.push(new b.x("group",E)),this.createData.create(e,...M)}delete(e){return this.deleteData.delete(e).pipe((0,H.qD)(),(0,t.T)(a=>a.hasSucceeded))}update(e){return this.patchData.update(e)}getDefaultAccessConditionsFor(e,a){return this.findListByHref(e._links.defaultAccessConditions.href,a)}searchByEPerson(e,a,f=!0,E=!0,...M){const m=new h._;return m.searchParams=[new b.x("uuid",e)],(0,R.hj)(a)&&m.searchParams.push(new b.x("resource",a)),this.searchData.searchBy(this.searchByEPersonMethod,m,f,E,...M)}searchByGroup(e,a,f=!0,E=!0,...M){const m=new h._;return m.searchParams=[new b.x("uuid",e)],(0,R.hj)(a)&&m.searchParams.push(new b.x("resource",a)),this.searchData.searchBy(this.searchByGroupMethod,m,f,E,...M)}searchByResource(e,a,f=!0,E=!0,...M){const m=new h._;return m.searchParams=[new b.x("uuid",e)],(0,R.hj)(a)&&m.searchParams.push(new b.x("action",a)),this.searchData.searchBy(this.searchByResourceMethod,m,f,E,...M)}updateTarget(e,a,f,E){const m=("eperson"===E?this.ePersonService:this.groupService).getIDHrefObs(f),X=Object.create({});let K=new P.Lr;K=K.append("Content-Type","text/uri-list"),X.headers=K;const q=this.requestService.generateRequestId();return m.pipe((0,_.$)()).subscribe(se=>{const ee=new T.v_(q,a+"/"+E,se,X);Object.assign(ee,{getResponseParser:()=>j.M}),this.requestService.send(ee)}),this.rdbService.buildFromRequestUUIDAndAwait(q,()=>this.invalidateByHref(a))}static{this.\u0275fac=function(a){return new(a||w)(Y.KVO(F.B),Y.KVO(C.o),Y.KVO($.$),Y.KVO(B.Y),Y.KVO(S.I),Y.KVO(L.Y),Y.KVO(k.EPersonDataService),Y.KVO(U.GroupDataService))}}static{this.\u0275prov=Y.jDH({token:w,factory:w.\u0275fac,providedIn:"root"})}}return w})()},55584:(Z,N,s)=>{s.d(N,{m:()=>V});var P=s(41780),t=s(84412),_=s(96354),R=s(96697),S=s(96526),C=s(25521),b=s(80183),$=s(4436),W=s(39806),A=s(12884),y=s(54438),G=s(7901);let V=(()=>{class L{constructor(T,F,j,k,U,B){this.dsoNameService=T,this.notificationsService=F,this.resourcePolicyService=j,this.route=k,this.router=U,this.translate=B,this.processing$=new t.t(!1)}ngOnInit(){this.route.data.pipe((0,_.T)(T=>T),(0,R.s)(1)).subscribe(T=>{this.targetResourceUUID=T.resourcePolicyTarget.payload.id,this.targetResourceName=this.dsoNameService.getName(T.resourcePolicyTarget.payload)})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${$.K4}`],{relativeTo:this.route})}createResourcePolicy(T){let F;this.processing$.next(!0),F="eperson"===T.target.type?this.resourcePolicyService.create(T.object,this.targetResourceUUID,T.target.uuid):this.resourcePolicyService.create(T.object,this.targetResourceUUID,null,T.target.uuid),F.pipe((0,b.qD)()).subscribe(j=>{this.processing$.next(!1),j.hasSucceeded?(this.notificationsService.success(null,this.translate.get("resource-policies.create.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get("resource-policies.create.page.failure.content"))})}static{this.\u0275fac=function(F){return new(F||L)(y.rXU(S.f),y.rXU(W.I),y.rXU(C.ResourcePolicyDataService),y.rXU(G.nX),y.rXU(G.Ix),y.rXU(P.c$))}}static{this.\u0275cmp=y.VBU({type:L,selectors:[["ds-resource-policy-create"]],standalone:!0,features:[y.aNF],decls:5,vars:5,consts:[[1,"container"],[1,"mb-3"],[3,"reset","submit","isProcessing"]],template:function(F,j){1&F&&(y.j41(0,"div",0)(1,"h4",1),y.EFF(2),y.nI1(3,"translate"),y.k0s(),y.j41(4,"ds-resource-policy-form",2),y.bIt("reset",function(){return j.redirectToAuthorizationsPage()})("submit",function(U){return j.createResourcePolicy(U)}),y.k0s()()),2&F&&(y.R7$(2),y.Lme("",y.bMT(3,3,"resource-policies.create.page.heading")," ",j.targetResourceName,""),y.R7$(2),y.Y8G("isProcessing",j.isProcessing()))},dependencies:[A.y,P.h,P.D9],encapsulation:2})}}return L})()},84227:(Z,N,s)=>{s.d(N,{_:()=>Y});var P=s(41780),t=s(84412),_=s(7673),R=s(84572),S=s(96697),C=s(96354),b=s(25558),$=s(88985),W=s(25521),A=s(80183),y=s(4436),G=s(39806),V=s(12884),L=s(88280),h=s(54438),T=s(21626);let F=(()=>{class D{constructor(c){this.http=c}updatePermissions(c,e){const a=`${L.c.rest.baseUrl}/api/custom/resourcepolicies/${c}/update-permissions`;return console.log(`Calling API endpoint: ${a} with permissions:`,e),this.http.put(a,e)}static{this.\u0275fac=function(e){return new(e||D)(h.KVO(T.Qq))}}static{this.\u0275prov=h.jDH({token:D,factory:D.\u0275fac,providedIn:"root"})}}return D})();var j=s(32473),k=s(27468),U=s(99437);let B=(()=>{class D{constructor(c){this.http=c,this.baseUrl=L.c.rest.baseUrl}getEperson(c){return this.http.get(`${this.baseUrl}/api/authz/resourcepolicies/${c}/eperson`).pipe((0,U.W)(()=>(console.log(`No eperson found for policy ${c}`),(0,_.of)(null))))}getGroup(c){return this.http.get(`${this.baseUrl}/api/authz/resourcepolicies/${c}/group`).pipe((0,U.W)(()=>(console.log(`No group found for policy ${c}`),(0,_.of)(null))))}determineEntityType(c){return(0,k.p)({eperson:this.getEperson(c),group:this.getGroup(c)}).pipe((0,C.T)(e=>e.eperson&&e.eperson.uuid?(console.log(`Policy ${c} is associated with eperson ${e.eperson.uuid}`),{type:"eperson",uuid:e.eperson.uuid}):e.group&&e.group.uuid?(console.log(`Policy ${c} is associated with group ${e.group.uuid}`),{type:"group",uuid:e.group.uuid}):(console.log(`Policy ${c} has no associated entity, defaulting to eperson`),{type:"eperson",uuid:null})))}static{this.\u0275fac=function(e){return new(e||D)(h.KVO(T.Qq))}}static{this.\u0275prov=h.jDH({token:D,factory:D.\u0275fac,providedIn:"root"})}}return D})();var H=s(7901);let Y=(()=>{class D{constructor(c,e,a,f,E,M,m,X){this.notificationsService=c,this.resourcePolicyService=e,this.route=a,this.router=f,this.translate=E,this.resourcePolicyPermissionsService=M,this.requestService=m,this.policyEntityService=X,this.processing$=new t.t(!1),this.policyEntity=null}ngOnInit(){this.route.parent.params.pipe((0,S.s)(1)).subscribe(c=>{c.id?(this.bitstreamId=c.id,console.log("Bitstream ID from route params:",this.bitstreamId)):console.warn("Bitstream ID not found in route params")}),this.route.params.pipe((0,S.s)(1),(0,C.T)(c=>c.id),(0,b.n)(c=>(c&&this.requestService.removeByHrefSubstring(`/api/authz/resourcepolicies/${c}`),this.route.data)),(0,S.s)(1)).subscribe(c=>{this.resourcePolicy=c.resourcePolicy.payload,console.log("Loaded resource policy:",this.resourcePolicy),this.resourcePolicy&&this.resourcePolicy.id&&this.policyEntityService.determineEntityType(this.resourcePolicy.id.toString()).subscribe(e=>{this.policyEntity=e,console.log("Determined policy entity:",this.policyEntity)})})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${y.K4}`],{relativeTo:this.route})}updateResourcePolicy(c){this.processing$.next(!0);const e=Object.assign({},this.resourcePolicy,c.object);e.type=$.O,console.log("Updating resource policy with complete object:",e),console.log("Target information:",c.target);const a=c.updateTarget?this.resourcePolicyService.updateTarget(this.resourcePolicy.id,this.resourcePolicy._links.self.href,c.target.uuid,c.target.type).pipe((0,A.qD)(),(0,C.T)(m=>(m&&m.hasSucceeded&&(this.requestService.removeByHrefSubstring(`/api/authz/resourcepolicies/${this.resourcePolicy.id}`),this.requestService.removeByHrefSubstring("/api/eperson/epersons"),this.requestService.removeByHrefSubstring("/api/eperson/groups")),m&&m.hasSucceeded))):(0,_.of)(!0),f={name:e.name,description:e.description,policyType:e.policyType,action:e.action,startDate:e.startDate,endDate:e.endDate,pageStart:e.pageStart,pageEnd:e.pageEnd,print:e.print,download:e.download};c.updateTarget&&c.target&&c.target.type?"eperson"===c.target.type?f.eperson=c.target.uuid:"group"===c.target.type&&(f.group=c.target.uuid):this.policyEntity?"eperson"===this.policyEntity.type?f.eperson=this.policyEntity.uuid:"group"===this.policyEntity.type&&(f.group=this.policyEntity.uuid):f.eperson=null,console.log("Sending permissions data with eperson/group:",f);const E=this.resourcePolicyPermissionsService.updatePermissions(this.resourcePolicy.id,f).pipe((0,C.T)(()=>(this.requestService.removeByHrefSubstring(`/api/authz/resourcepolicies/${this.resourcePolicy.id}`),!0)),(0,S.s)(1)),M=this.resourcePolicyService.update(e).pipe((0,A.qD)(),(0,C.T)(m=>(m&&m.hasSucceeded&&this.requestService.removeByHrefSubstring(`/api/authz/resourcepolicies/${this.resourcePolicy.id}`),m&&m.hasSucceeded)));(0,R.z)([a,E,M]).subscribe(([m,X,K])=>{this.processing$.next(!1),m&&X&&K?(this.notificationsService.success(null,this.translate.get("resource-policies.edit.page.success.content")),this.redirectToAuthorizationsPage()):(X||this.notificationsService.error(null,"Failed to update permissions (page restrictions, print, download)"),K||this.notificationsService.error(null,this.translate.get("resource-policies.edit.page.other-failure.content")),!m&&c.updateTarget&&this.notificationsService.error(null,this.translate.get("resource-policies.edit.page.target-failure.content")),!m&&!X&&!K&&this.notificationsService.error(null,this.translate.get("resource-policies.edit.page.failure.content")))})}static{this.\u0275fac=function(e){return new(e||D)(h.rXU(G.I),h.rXU(W.ResourcePolicyDataService),h.rXU(H.nX),h.rXU(H.Ix),h.rXU(P.c$),h.rXU(F),h.rXU(j.B),h.rXU(B))}}static{this.\u0275cmp=h.VBU({type:D,selectors:[["ds-resource-policy-edit"]],standalone:!0,features:[h.aNF],decls:5,vars:6,consts:[[1,"container"],[1,"mb-3"],[3,"reset","submit","resourcePolicy","isProcessing"]],template:function(e,a){1&e&&(h.j41(0,"div",0)(1,"h1",1),h.EFF(2),h.nI1(3,"translate"),h.k0s(),h.j41(4,"ds-resource-policy-form",2),h.bIt("reset",function(){return a.redirectToAuthorizationsPage()})("submit",function(E){return a.updateResourcePolicy(E)}),h.k0s()()),2&e&&(h.R7$(2),h.Lme("",h.bMT(3,4,"resource-policies.edit.page.heading")," ",a.resourcePolicy.id,""),h.R7$(2),h.Y8G("resourcePolicy",a.resourcePolicy)("isProcessing",a.isProcessing()))},dependencies:[V.y,P.h,P.D9],encapsulation:2})}}return D})()},12884:(Z,N,s)=>{s.d(N,{y:()=>ae});var P=s(60177),t=s(54438),_=s(58003),R=s(1473),S=s(41780),C=s(7673),b=s(84412),$=s(84572),W=s(96354),A=s(5964),y=s(96697),G=s(96526),V=s(32473),L=s(74449),h=s(44494),T=s(28235),F=s(88985),j=s(80183),k=s(60456),U=s(12866),B=s(82777),H=s(50518),Y=s(66733),D=s(77485),w=s(13143),c=s(54002),e=s(46355),a=s(46251);const f=[{label:a.t.TYPE_SUBMISSION,value:a.t.TYPE_SUBMISSION},{label:a.t.TYPE_WORKFLOW,value:a.t.TYPE_WORKFLOW},{label:a.t.TYPE_INHERITED,value:a.t.TYPE_INHERITED},{label:a.t.TYPE_CUSTOM,value:a.t.TYPE_CUSTOM}],E=[{label:e.X.READ.toString(),value:e.X.READ},{label:e.X.WRITE.toString(),value:e.X.WRITE},{label:e.X.REMOVE.toString(),value:e.X.REMOVE},{label:e.X.ADMIN.toString(),value:e.X.ADMIN},{label:e.X.DELETE.toString(),value:e.X.DELETE},{label:e.X.WITHDRAWN_READ.toString(),value:e.X.WITHDRAWN_READ},{label:e.X.DEFAULT_BITSTREAM_READ.toString(),value:e.X.DEFAULT_BITSTREAM_READ},{label:e.X.DEFAULT_ITEM_READ.toString(),value:e.X.DEFAULT_ITEM_READ}],M={id:"name",label:"resource-policies.form.name.label",maxLength:30,hint:"resource-policies.form.name.hint",metadataFields:[],repeatable:!1,submissionId:"",hasSelectableMetadata:!1},m={id:"description",label:"resource-policies.form.description.label",metadataFields:[],repeatable:!1,rows:10,submissionId:"",hasSelectableMetadata:!1},X={id:"policyType",label:"resource-policies.form.policy-type.label",options:f,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.policy-type.required"}},K={id:"action",label:"resource-policies.form.action-type.label",options:E,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.action-type.required"}},q={id:"date",group:[]},se={element:{control:"row"}},re={id:"start",label:"resource-policies.form.date.start.label",placeholder:"resource-policies.form.date.start.label",inline:!1,toggleIcon:"far fa-calendar-alt"},ee={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}},oe={id:"end",label:"resource-policies.form.date.end.label",placeholder:"resource-policies.form.date.end.label",inline:!1,toggleIcon:"far fa-calendar-alt"},ie={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}};var x=s(89417);const ne=["content"];function g(v,Q){if(1&v&&t.nrm(0,"ds-form",43,2),2&v){const o=t.XpG();t.Y8G("formId",o.formId)("formModel",o.formModel)("displaySubmit",!1)("displayCancel",!1)}}function J(v,Q){if(1&v&&(t.j41(0,"li"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&v){const o=Q.$implicit;t.R7$(),t.JRh(t.bMT(2,1,o))}}function n(v,Q){if(1&v&&(t.j41(0,"div",44)(1,"p")(2,"strong"),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"ul"),t.DNE(6,J,3,3,"li",45),t.k0s()()),2&v){const o=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"resource-policies.form.validation-errors.header")),t.R7$(3),t.Y8G("ngForOf",o.validationErrors)}}function d(v,Q){if(1&v){const o=t.RV6();t.j41(0,"ds-eperson-group-list",46),t.bIt("select",function(r){t.eBV(o);const p=t.XpG();return t.Njj(p.updateObjectSelected(r,!0))}),t.k0s()}}function l(v,Q){if(1&v){const o=t.RV6();t.j41(0,"ds-eperson-group-list",47),t.bIt("select",function(r){t.eBV(o);const p=t.XpG();return t.Njj(p.updateObjectSelected(r,!1))}),t.k0s()}2&v&&t.Y8G("isListOfEPerson",!1)}function O(v,Q){1&v&&(t.j41(0,"span"),t.nrm(1,"i",48),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&v&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.workflow.tasks.generic.processing")," "))}function z(v,Q){1&v&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&v&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"form.submit")," "))}function te(v,Q){if(1&v){const o=t.RV6();t.j41(0,"div",49)(1,"h4",50),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",51),t.bIt("click",function(){const r=t.eBV(o).$implicit;return t.Njj(r.close())}),t.k0s()(),t.j41(5,"div",52)(6,"div",53)(7,"div",54),t.nrm(8,"i",55),t.k0s(),t.j41(9,"div"),t.nrm(10,"p",56),t.nI1(11,"translate"),t.nrm(12,"p",57),t.nI1(13,"translate"),t.k0s()()(),t.j41(14,"div",58)(15,"button",59),t.bIt("click",function(){const r=t.eBV(o).$implicit;return t.Njj(r.close())}),t.EFF(16),t.nI1(17,"translate"),t.k0s()()}if(2&v){const o=t.XpG();t.R7$(2),t.JRh(t.bMT(3,4,"resource-policies.form.eperson-group-list.modal.header")),t.R7$(8),t.Y8G("innerHTML",t.bMT(11,6,"eperson"===o.navActiveId?"resource-policies.form.eperson-group-list.modal.text1.toGroup":"resource-policies.form.eperson-group-list.modal.text1.toEPerson"),t.npT),t.R7$(2),t.Y8G("innerHTML",t.bMT(13,8,"resource-policies.form.eperson-group-list.modal.text2"),t.npT),t.R7$(4),t.JRh(t.bMT(17,10,"resource-policies.form.eperson-group-list.modal.close"))}}let ae=(()=>{class v{constructor(o,i,r,p,I,u){this.dsoNameService=o,this.ePersonService=i,this.formService=r,this.groupService=p,this.requestService=I,this.modalService=u,this.isProcessing=(0,C.of)(!1),this.reset=new t.bkB,this.submit=new t.bkB,this.resourcePolicyTargetName$=new b.t(""),this.subs=[],this.resourcePolicyTargetUpdated=!1,this.pageStart=null,this.pageEnd=null,this.startTime="00:00",this.endTime="23:59",this.print=!1,this.download=!1,this.validationErrors=[]}ngOnInit(){if(this.isActive=!0,this.formId=this.formService.getUniqueId("resource-policy-form"),this.formModel=this.buildResourcePolicyForm(),this.isBeingEdited()){console.log("FULL RESOURCE POLICY OBJECT:",JSON.stringify(this.resourcePolicy,null,2)),console.log("Resource Policy Links:",this.resourcePolicy._links),this.resourcePolicy._links&&this.resourcePolicy._links.self&&console.log("API ENDPOINT:",this.resourcePolicy._links.self.href);const o=this.ePersonService.findByHref(this.resourcePolicy._links.eperson.href,!1).pipe((0,j.yd)()),i=this.groupService.findByHref(this.resourcePolicy._links.group.href,!1).pipe((0,j.yd)()),r=(0,$.z)([o,i]).pipe((0,W.T)(p=>p.find(I=>(0,B.hj)(I.payload))),(0,B.Az)());this.subs.push(r.pipe((0,A.p)(()=>this.isActive)).subscribe(p=>{this.resourcePolicyGrant=p.payload,this.navActiveId=String(p.payload.type),this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())})),this.pageStart=this.resourcePolicy.pageStart||null,this.pageEnd=this.resourcePolicy.pageEnd||null,this.resourcePolicy.hasOwnProperty("print")&&(this.print=this.resourcePolicy.print,console.log("Loaded print value:",this.print)),this.resourcePolicy.hasOwnProperty("download")&&(this.download=this.resourcePolicy.download,console.log("Loaded download value:",this.download)),(0,B.a4)(this.resourcePolicy.startDate)&&(console.log("FULL START DATE VALUE:",this.resourcePolicy.startDate),console.log("START DATE TYPE:",typeof this.resourcePolicy.startDate),console.log("Start Date Object:",new Date(this.resourcePolicy.startDate)),this.extractTimeFromDate(this.resourcePolicy.startDate,!0)),(0,B.a4)(this.resourcePolicy.endDate)&&(console.log("FULL END DATE VALUE:",this.resourcePolicy.endDate),console.log("END DATE TYPE:",typeof this.resourcePolicy.endDate),console.log("End Date Object:",new Date(this.resourcePolicy.endDate)),this.extractTimeFromDate(this.resourcePolicy.endDate,!1))}}extractTimeFromDate(o,i){try{console.log(`Extracting time from ${i?"start":"end"} date:`,o);const r=new Date(o);if(isNaN(r.getTime()))throw new Error("Invalid date");const u=`${r.getHours().toString().padStart(2,"0")}:${r.getMinutes().toString().padStart(2,"0")}`;console.log(`Extracted time: ${u}`),i?(this.startTime=u,console.log("Set start time to:",this.startTime)):(this.endTime=u,console.log("Set end time to:",this.endTime))}catch(r){console.error(`Error parsing ${i?"start":"end"} date:`,r),i?(this.startTime="00:00",console.log("Using default start time:",this.startTime)):(this.endTime="23:59",console.log("Using default end time:",this.endTime))}}isFormValid(){return this.formService.isValid(this.formId).pipe((0,W.T)(o=>o&&(0,B.hj)(this.resourcePolicyGrant)&&this.validatePageRange()))}validatePageRange(){return this.validationErrors=[],null===this.pageStart&&this.validationErrors.push("resource-policies.form.date.page-start.required"),null===this.pageEnd&&this.validationErrors.push("resource-policies.form.date.page-end.required"),null!==this.pageStart&&null!==this.pageEnd&&this.pageStart>this.pageEnd&&this.validationErrors.push("resource-policies.form.date.page-range.invalid"),0===this.validationErrors.length}buildResourcePolicyForm(){const o=[],i={...M,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.name.required"}},r={...m,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.description.required"}};o.push(new Y.C(i),new D.E(r),new R.z4z(X),new R.z4z(K));const p=new R.dku({...re,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.date.start.required"}},ee),I=new R.dku({...oe,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.date.end.required"}},ie),u=Object.assign({},q,{group:[]});return u.group.push(p,I),o.push(new R.iO5(u,se)),this.initModelsValue(o),o}initModelsValue(o){return this.resourcePolicy&&o.forEach(i=>{if("date"===i.id){const r=i.get(0),p=i.get(1);r.value=(0,B.a4)(this.resourcePolicy.startDate)?(0,U.PR)(this.resourcePolicy.startDate):(0,U.PR)((new Date).toISOString()),p.value=(0,B.a4)(this.resourcePolicy.endDate)?(0,U.PR)(this.resourcePolicy.endDate):(0,U.PR)((new Date).toISOString())}else this.resourcePolicy.hasOwnProperty(i.id)&&this.resourcePolicy[i.id]&&(i.value=this.resourcePolicy[i.id])}),o}isBeingEdited(){return!(0,B.Im)(this.resourcePolicy)}getResourcePolicyTargetName(){return(0,B.hj)(this.resourcePolicyGrant)?this.dsoNameService.getName(this.resourcePolicyGrant):""}updateObjectSelected(o,i){this.resourcePolicyTargetUpdated=!0,this.resourcePolicyGrant=o,this.resourcePolicyGrantType=i?"eperson":"group",this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}onReset(){this.reset.emit()}updatePrint(o){this.print=o,console.log("Print value changed to:",this.print)}updateDownload(o){this.download=o,console.log("Download value changed to:",this.download)}onSubmit(){this.validatePageRange()?(console.log("Before submission - Print:",this.print),console.log("Before submission - Download:",this.download),console.log("Before submission - Page Start:",this.pageStart),console.log("Before submission - Page End:",this.pageEnd),this.formService.getFormData(this.formId).pipe((0,y.s)(1)).subscribe(o=>{const i=Object.create({});i.object=this.createResourcePolicyByFormData(o),console.log("Resource Policy Object to be submitted:",i.object),i.target={type:this.resourcePolicyGrantType,uuid:this.resourcePolicyGrant.id},i.updateTarget=this.resourcePolicyTargetUpdated,this.submit.emit(i)})):console.error("Validation errors:",this.validationErrors)}createResourcePolicyByFormData(o){const i=new T.h;if(i.name=o.name?o.name[0].value:null,i.description=o.description?o.description[0].value:null,i.policyType=o.policyType?o.policyType[0].value:null,i.action=o.action?o.action[0].value:null,o.date&&o.date.start&&o.date.start[0].value){const r=this.combineDateAndTime(o.date.start[0].value,this.startTime);i.startDate=r}else i.startDate=(new Date).toISOString();if(o.date&&o.date.end&&o.date.end[0].value){const r=this.combineDateAndTime(o.date.end[0].value,this.endTime);i.endDate=r}else i.endDate=(new Date).toISOString();return i.pageStart=this.pageStart,i.pageEnd=this.pageEnd,i.print=this.print,i.download=this.download,console.log("Creating resource policy with all fields:",{name:i.name,description:i.description,policyType:i.policyType,action:i.action,startDate:i.startDate,endDate:i.endDate,pageStart:i.pageStart,pageEnd:i.pageEnd,print:i.print,download:i.download}),i.type=F.O,i}combineDateAndTime(o,i){if(!o||!i)return null;try{const r=(0,U.Sd)(o),[p,I]=i.split(":").map(le=>Number.parseInt(le,10)),u=new Date(r);return u.setHours(p),u.setMinutes(I),u.setSeconds(0),u.setMilliseconds(0),u.toISOString()}catch(r){return console.error("Error combining date and time:",r),(0,U.Sd)(o)}}ngOnDestroy(){this.isActive=!1,this.formModel=null,this.subs.filter(o=>(0,B.a4)(o)).forEach(o=>o.unsubscribe())}onNavChange(o){this.isBeingEdited()&&(o.preventDefault(),this.modalService.open(this.content))}static{this.\u0275fac=function(i){return new(i||v)(t.rXU(G.f),t.rXU(L.EPersonDataService),t.rXU(c.u),t.rXU(h.GroupDataService),t.rXU(V.B),t.rXU(_.Bq))}}static{this.\u0275cmp=t.VBU({type:v,selectors:[["ds-resource-policy-form"]],viewQuery:function(i,r){if(1&i&&t.GBs(ne,5),2&i){let p;t.mGM(p=t.lsd())&&(r.content=p.first)}},inputs:{resourcePolicy:"resourcePolicy",isProcessing:"isProcessing"},outputs:{reset:"reset",submit:"submit"},standalone:!0,features:[t.aNF],decls:97,vars:49,consts:[["nav","ngbNav"],["content",""],["formRef","formComponent"],[3,"formId","formModel","displaySubmit","displayCancel",4,"ngIf"],[1,"container-fluid"],["for","ResourcePolicyObject"],["id","ResourcePolicyObject","type","text",1,"form-control","mb-3",3,"value"],[1,"form-group","row"],[1,"col-md-6"],["for","pageStart"],["id","pageStart","name","pageStart","type","number","min","1","placeholder","Enter start page","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","pageEnd"],["id","pageEnd","name","pageEnd","type","number","min","1","placeholder","Enter end page","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-group","row","mt-3"],["for","startTime"],["id","startTime","name","startTime","type","time","placeholder","HH:MM",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-text","text-muted"],["for","endTime"],["id","endTime","name","endTime","type","time","placeholder","HH:MM",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-label"],[1,"d-flex"],[1,"form-check","me-3"],["type","radio","name","print","id","printYes",1,"form-check-input",3,"ngModelChange","change","value","ngModel"],["for","printYes",1,"form-check-label"],[1,"form-check"],["type","radio","name","print","id","printNo",1,"form-check-input",3,"ngModelChange","change","value","ngModel"],["for","printNo",1,"form-check-label"],["type","radio","name","download","id","downloadYes",1,"form-check-input",3,"ngModelChange","change","value","ngModel"],["for","downloadYes",1,"form-check-label"],["type","radio","name","download","id","downloadNo",1,"form-check-input",3,"ngModelChange","change","value","ngModel"],["for","downloadNo",1,"form-check-label"],[1,"mt-2","p-2","bg-light","border","rounded"],["class","alert alert-danger mt-3",4,"ngIf"],["ngbNav","",1,"nav-pills",3,"activeIdChange","navChange","activeId"],["role","presentation",3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"mb-3","row"],[1,"col","text-end"],["type","reset",1,"btn","btn-default",3,"click","dsBtnDisabled"],["type","button",1,"btn","btn-primary",3,"click","dsBtnDisabled"],[4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel"],[1,"alert","alert-danger","mt-3"],[4,"ngFor","ngForOf"],[3,"select"],[3,"select","isListOfEPerson"],[1,"fas","fa-circle-notch","fa-spin"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"d-flex","flex-row"],[1,"me-3"],[1,"fas","fa-info-circle","fa-2x","text-info"],[1,"fw-bold",3,"innerHTML"],[3,"innerHTML"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(i,r){if(1&i){const p=t.RV6();t.j41(0,"div"),t.DNE(1,g,2,4,"ds-form",3),t.j41(2,"div",4)(3,"label",5),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.nrm(6,"input",6),t.nI1(7,"async"),t.j41(8,"div",7)(9,"div",8)(10,"label",9),t.EFF(11,"Page Start"),t.k0s(),t.j41(12,"input",10),t.mxI("ngModelChange",function(u){return t.eBV(p),t.DH7(r.pageStart,u)||(r.pageStart=u),t.Njj(u)}),t.k0s()(),t.j41(13,"div",8)(14,"label",11),t.EFF(15,"Page End"),t.k0s(),t.j41(16,"input",12),t.mxI("ngModelChange",function(u){return t.eBV(p),t.DH7(r.pageEnd,u)||(r.pageEnd=u),t.Njj(u)}),t.k0s()()(),t.j41(17,"div",13)(18,"div",8)(19,"label",14),t.EFF(20,"Start Time"),t.k0s(),t.j41(21,"input",15),t.mxI("ngModelChange",function(u){return t.eBV(p),t.DH7(r.startTime,u)||(r.startTime=u),t.Njj(u)}),t.k0s(),t.j41(22,"small",16),t.EFF(23,"Time for start date (24-hour format)"),t.k0s()(),t.j41(24,"div",8)(25,"label",17),t.EFF(26,"End Time"),t.k0s(),t.j41(27,"input",18),t.mxI("ngModelChange",function(u){return t.eBV(p),t.DH7(r.endTime,u)||(r.endTime=u),t.Njj(u)}),t.k0s(),t.j41(28,"small",16),t.EFF(29,"Time for end date (24-hour format)"),t.k0s()()(),t.j41(30,"div",13)(31,"div",8)(32,"label",19),t.EFF(33,"Print"),t.k0s(),t.j41(34,"div",20)(35,"div",21)(36,"input",22),t.mxI("ngModelChange",function(u){return t.eBV(p),t.DH7(r.print,u)||(r.print=u),t.Njj(u)}),t.bIt("change",function(){return t.eBV(p),t.Njj(r.updatePrint(!0))}),t.k0s(),t.j41(37,"label",23),t.EFF(38," Yes "),t.k0s()(),t.j41(39,"div",24)(40,"input",25),t.mxI("ngModelChange",function(u){return t.eBV(p),t.DH7(r.print,u)||(r.print=u),t.Njj(u)}),t.bIt("change",function(){return t.eBV(p),t.Njj(r.updatePrint(!1))}),t.k0s(),t.j41(41,"label",26),t.EFF(42," No "),t.k0s()()(),t.j41(43,"small",16),t.EFF(44,"Restrict printing of this item"),t.k0s()(),t.j41(45,"div",8)(46,"label",19),t.EFF(47,"Download"),t.k0s(),t.j41(48,"div",20)(49,"div",21)(50,"input",27),t.mxI("ngModelChange",function(u){return t.eBV(p),t.DH7(r.download,u)||(r.download=u),t.Njj(u)}),t.bIt("change",function(){return t.eBV(p),t.Njj(r.updateDownload(!0))}),t.k0s(),t.j41(51,"label",28),t.EFF(52," Yes "),t.k0s()(),t.j41(53,"div",24)(54,"input",29),t.mxI("ngModelChange",function(u){return t.eBV(p),t.DH7(r.download,u)||(r.download=u),t.Njj(u)}),t.bIt("change",function(){return t.eBV(p),t.Njj(r.updateDownload(!1))}),t.k0s(),t.j41(55,"label",30),t.EFF(56," No "),t.k0s()()(),t.j41(57,"small",16),t.EFF(58,"Restrict downloading of this item"),t.k0s()()(),t.j41(59,"div",31)(60,"div")(61,"strong"),t.EFF(62,"Current Values:"),t.k0s()(),t.j41(63,"div"),t.EFF(64),t.k0s(),t.j41(65,"div"),t.EFF(66),t.k0s()(),t.DNE(67,n,7,4,"div",32),t.j41(68,"ul",33,0),t.mxI("activeIdChange",function(u){return t.eBV(p),t.DH7(r.navActiveId,u)||(r.navActiveId=u),t.Njj(u)}),t.bIt("navChange",function(u){return t.eBV(p),t.Njj(r.onNavChange(u))}),t.j41(70,"li",34)(71,"a",35),t.EFF(72),t.nI1(73,"translate"),t.k0s(),t.DNE(74,d,1,0,"ng-template",36),t.k0s(),t.j41(75,"li",34)(76,"a",35),t.EFF(77),t.nI1(78,"translate"),t.k0s(),t.DNE(79,l,1,1,"ng-template",36),t.k0s()(),t.nrm(80,"div",37)(81,"hr"),t.j41(82,"div",38)(83,"div",39)(84,"button",40),t.nI1(85,"async"),t.bIt("click",function(){return t.eBV(p),t.Njj(r.onReset())}),t.EFF(86),t.nI1(87,"translate"),t.k0s(),t.j41(88,"button",41),t.nI1(89,"async"),t.nI1(90,"async"),t.bIt("click",function(){return t.eBV(p),t.Njj(r.onSubmit())}),t.DNE(91,O,4,3,"span",42),t.nI1(92,"async"),t.DNE(93,z,3,3,"span",42),t.nI1(94,"async"),t.k0s()()()()(),t.DNE(95,te,18,12,"ng-template",null,1,t.C5r)}if(2&i){const p=t.sdS(69);t.R7$(),t.Y8G("ngIf",r.formModel),t.R7$(3),t.JRh(t.bMT(5,29,"resource-policies.form.eperson-group-list.label")),t.R7$(2),t.Y8G("value",t.bMT(7,31,r.resourcePolicyTargetName$)),t.R7$(6),t.R50("ngModel",r.pageStart),t.R7$(4),t.R50("ngModel",r.pageEnd),t.R7$(5),t.R50("ngModel",r.startTime),t.R7$(6),t.R50("ngModel",r.endTime),t.R7$(9),t.Y8G("value",!0),t.R50("ngModel",r.print),t.R7$(4),t.Y8G("value",!1),t.R50("ngModel",r.print),t.R7$(10),t.Y8G("value",!0),t.R50("ngModel",r.download),t.R7$(4),t.Y8G("value",!1),t.R50("ngModel",r.download),t.R7$(10),t.SpI("Print: ",r.print?"Yes":"No",""),t.R7$(2),t.SpI("Download: ",r.download?"Yes":"No",""),t.R7$(),t.Y8G("ngIf",r.validationErrors.length>0),t.R7$(),t.R50("activeId",r.navActiveId),t.R7$(2),t.Y8G("ngbNavItem","eperson"),t.R7$(2),t.JRh(t.bMT(73,33,"resource-policies.form.eperson-group-list.tab.eperson")),t.R7$(3),t.Y8G("ngbNavItem","group"),t.R7$(2),t.JRh(t.bMT(78,35,"resource-policies.form.eperson-group-list.tab.group")),t.R7$(3),t.Y8G("ngbNavOutlet",p),t.R7$(4),t.Y8G("dsBtnDisabled",t.bMT(85,37,r.isProcessing)),t.R7$(2),t.JRh(t.bMT(87,39,"form.cancel")),t.R7$(2),t.Y8G("dsBtnDisabled",!0!==t.bMT(89,41,r.isFormValid())||t.bMT(90,43,r.isProcessing)),t.R7$(3),t.Y8G("ngIf",t.bMT(92,45,r.isProcessing)),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(94,47,r.isProcessing))}},dependencies:[x.YN,x.me,x.Q0,x.Fm,x.BC,x.YS,x.VZ,x.vS,w.s,_.Pv,_.Um,_.X9,_.sy,_.Ri,_.m_,H.T,S.h,S.D9,P.Jj,P.bT,P.pM,k.A],encapsulation:2})}}return v})()},45539:(Z,N,s)=>{s.d(N,{Q:()=>W});var P=s(54438),t=s(7901),_=s(25558),R=s(82640),S=s(4047),C=s(80183),b=s(42547),$=s(82777);const W=(A,y,G=(0,P.WQX)(R.l9),V=(0,P.WQX)(P.zZn),L=(0,P.WQX)(t.Ix))=>{const h=A.queryParamMap.get("targetType"),T=A.queryParamMap.get("policyTargetId");((0,$.Im)(h)||(0,$.Im)(T))&&L.navigateByUrl("/404",{skipLocationChange:!0});const F=new b.v(h);return(0,S.M)(G,F.value,V).pipe((0,_.n)(k=>k.findById(T)),(0,C.qD)())}},92117:(Z,N,s)=>{s.d(N,{n:()=>b});var P=s(54438),t=s(7901),_=s(25521),R=s(80183),S=s(82777),C=s(67600);const b=($,W,A=(0,P.WQX)(t.Ix),y=(0,P.WQX)(_.ResourcePolicyDataService))=>{const G=$.queryParamMap.get("policyId");return(0,S.Im)(G)&&A.navigateByUrl("/404",{skipLocationChange:!0}),y.findById(G,!0,!1,(0,C.s)("eperson"),(0,C.s)("group")).pipe((0,R.qD)())}},92772:(Z,N,s)=>{s.d(N,{e:()=>ne});var P=s(60177),t=s(7901),_=s(41780),R=s(84412),S=s(41584),C=s(22806),b=s(7673),$=s(5964),W=s(19852),A=s(96354),y=s(23294),G=s(70274),V=s(31943),L=s(96697),h=s(70980),T=s(99437),F=s(96526),j=s(32473),k=s(74449),U=s(44494),B=s(25521),H=s(80183),Y=s(60456),D=s(82777),w=s(39806),c=s(67600),e=s(54438),a=s(89417),f=s(25093),E=s(12866),M=s(93120);const m=["ds-resource-policy-entry",""];function X(g,J){if(1&g){const n=e.RV6();e.j41(0,"button",7),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(n);const l=e.XpG();return e.Njj(l.redirectToGroupEditPage())}),e.nrm(2,"i",10),e.k0s()}2&g&&e.Y8G("title",e.bMT(1,1,"resource-policies.table.headers.edit.group"))}let K=(()=>{class g{constructor(n,d,l,O){this.dsoNameService=n,this.groupService=d,this.route=l,this.router=O,this.toggleCheckbox=new e.bkB}ngOnInit(){this.epersonName$=this.getName$(this.entry.policy.eperson),this.groupName$=this.getName$(this.entry.policy.group)}getName$(n){return n.pipe((0,H.v7)(),(0,A.T)(d=>{if((0,D.a4)(d?.payload))return this.dsoNameService.getName(d.payload)}))}formatDate(n){return(0,D.hj)(n)?(0,E.$T)((0,E.PR)(n)):""}redirectToResourcePolicyEditPage(){this.router.navigate(["./edit"],{relativeTo:this.route,queryParams:{policyId:this.entry.policy.id}})}redirectToGroupEditPage(){this.groupService.findByHref(this.entry.policy._links.group.href,!1).pipe((0,H.ak)(),(0,A.T)(n=>n.id)).subscribe(n=>{this.router.navigate([(0,f.xl)(n)])})}static{this.\u0275fac=function(d){return new(d||g)(e.rXU(F.f),e.rXU(U.GroupDataService),e.rXU(t.nX),e.rXU(t.Ix))}}static{this.\u0275cmp=e.VBU({type:g,selectors:[["tr","ds-resource-policy-entry",""]],inputs:{entry:"entry"},outputs:{toggleCheckbox:"toggleCheckbox"},standalone:!0,features:[e.aNF],attrs:m,decls:33,vars:26,consts:[[1,"text-center"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"ngModelChange","id","ngModel"],[1,"custom-control-label",3,"for"],[1,"sr-only"],["scope","row"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm",3,"click","title"],["aria-hidden","true",1,"fas","fa-edit","fa-fw"],["class","btn btn-outline-primary btn-sm",3,"title","click",4,"ngIf"],["aria-hidden","true",1,"fas","fa-users","fa-fw"]],template:function(d,l){1&d&&(e.j41(0,"td",0)(1,"div",1)(2,"input",2),e.bIt("ngModelChange",function(z){return l.toggleCheckbox.emit(z)}),e.k0s(),e.j41(3,"label",3)(4,"span",4),e.EFF(5),e.nI1(6,"translate"),e.k0s()()()(),e.j41(7,"th",5),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td"),e.EFF(14),e.k0s(),e.j41(15,"td"),e.EFF(16),e.nI1(17,"async"),e.k0s(),e.j41(18,"td"),e.EFF(19),e.nI1(20,"async"),e.k0s(),e.j41(21,"td"),e.EFF(22),e.k0s(),e.j41(23,"td"),e.EFF(24),e.k0s(),e.j41(25,"td",0)(26,"div",6)(27,"button",7),e.nI1(28,"translate"),e.bIt("click",function(){return l.redirectToResourcePolicyEditPage()}),e.nrm(29,"i",8),e.k0s(),e.DNE(30,X,3,3,"button",9),e.nI1(31,"async"),e.nI1(32,"dsHasValue"),e.k0s()()),2&d&&(e.R7$(2),e.Y8G("id",l.entry.id)("ngModel",l.entry.checked),e.R7$(),e.Y8G("for",l.entry.id),e.R7$(2),e.JRh(e.bMT(6,14,l.entry.checked?"resource-policies.table.headers.deselect":"resource-policies.table.headers.select")),e.R7$(3),e.SpI(" ",l.entry.id,"\n"),e.R7$(2),e.JRh(l.entry.policy.name),e.R7$(2),e.JRh(l.entry.policy.policyType),e.R7$(2),e.JRh(l.entry.policy.action),e.R7$(2),e.SpI(" ",e.bMT(17,16,l.epersonName$),"\n"),e.R7$(3),e.SpI(" ",e.bMT(20,18,l.groupName$),"\n"),e.R7$(3),e.JRh(l.formatDate(l.entry.policy.startDate)),e.R7$(2),e.JRh(l.formatDate(l.entry.policy.endDate)),e.R7$(3),e.Y8G("title",e.bMT(28,20,"resource-policies.table.headers.edit.policy")),e.R7$(3),e.Y8G("ngIf",e.bMT(32,24,e.bMT(31,22,l.groupName$))))},dependencies:[P.Jj,_.h,_.D9,a.YN,a.Zm,a.BC,a.vS,P.bT,M.a],encapsulation:2})}}return g})();function q(g,J){if(1&g&&(e.qex(0),e.EFF(1),e.bVm()),2&g){const n=e.XpG();e.R7$(),e.SpI(" (",n.resourceUUID,") ")}}function se(g,J){1&g&&(e.j41(0,"span"),e.nrm(1,"i",14),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&g&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"submission.workflow.tasks.generic.processing")," "))}function re(g,J){1&g&&(e.j41(0,"span"),e.nrm(1,"i",15),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&g&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"resource-policies.delete.btn")," "))}function ee(g,J){if(1&g){const n=e.RV6();e.j41(0,"tr",16)(1,"th")(2,"div",17)(3,"input",18,0),e.bIt("change",function(l){e.eBV(n);const O=e.XpG();return e.Njj(O.selectAllCheckbox(l))}),e.k0s(),e.j41(5,"label",19)(6,"span",20),e.EFF(7),e.nI1(8,"translate"),e.k0s()()()(),e.j41(9,"th"),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th"),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th"),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"th"),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.j41(21,"th"),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"th"),e.EFF(25),e.nI1(26,"translate"),e.k0s(),e.j41(27,"th"),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.j41(30,"th"),e.EFF(31),e.nI1(32,"translate"),e.k0s(),e.j41(33,"th"),e.EFF(34),e.nI1(35,"translate"),e.k0s()()}if(2&g){const n=e.sdS(4),d=e.XpG();e.R7$(3),e.Y8G("id","selectAll_"+d.resourceUUID),e.R7$(2),e.Y8G("for","selectAll_"+d.resourceUUID),e.R7$(2),e.JRh(e.bMT(8,12,n.checked?"resource-policies.table.headers.deselect-all":"resource-policies.table.headers.select-all")),e.R7$(3),e.JRh(e.bMT(11,14,"resource-policies.table.headers.id")),e.R7$(3),e.JRh(e.bMT(14,16,"resource-policies.table.headers.name")),e.R7$(3),e.JRh(e.bMT(17,18,"resource-policies.table.headers.policyType")),e.R7$(3),e.JRh(e.bMT(20,20,"resource-policies.table.headers.action")),e.R7$(3),e.JRh(e.bMT(23,22,"resource-policies.table.headers.eperson")),e.R7$(3),e.JRh(e.bMT(26,24,"resource-policies.table.headers.group")),e.R7$(3),e.JRh(e.bMT(29,26,"resource-policies.table.headers.date.start")),e.R7$(3),e.JRh(e.bMT(32,28,"resource-policies.table.headers.date.end")),e.R7$(3),e.JRh(e.bMT(35,30,"resource-policies.table.headers.edit"))}}function oe(g,J){if(1&g){const n=e.RV6();e.j41(0,"tr",22),e.bIt("toggleCheckbox",function(l){const O=e.eBV(n).$implicit,z=e.XpG(2);return e.Njj(z.selectCheckbox(O,l))}),e.k0s()}2&g&&e.Y8G("entry",J.$implicit)}function ie(g,J){if(1&g&&(e.j41(0,"tbody"),e.DNE(1,oe,1,1,"tr",21),e.nI1(2,"async"),e.k0s()),2&g){const n=e.XpG();e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,n.getResourcePolicies()))}}function x(g,J){1&g&&(e.j41(0,"tbody")(1,"tr")(2,"td",23),e.EFF(3),e.nI1(4,"translate"),e.k0s()()()),2&g&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"resource-policies.table.empty")," "))}let ne=(()=>{class g{constructor(n,d,l,O,z,te,ae,v,Q,o){this.cdr=n,this.dsoNameService=d,this.ePersonService=l,this.groupService=O,this.notificationsService=z,this.requestService=te,this.resourcePolicyService=ae,this.route=v,this.router=Q,this.translate=o,this.processingDelete$=new R.t(!1),this.resourcePoliciesEntries$=new R.t([]),this.loading$=new R.t(!1),this.refreshInProgress=!1,this.subs=[],this.lastRefreshTime=null,this.refreshAttempts=0,this.maxRefreshAttempts=3}ngOnInit(){this.isActive=!0,this.clearCaches(),(0,S.O)(100).subscribe(()=>{this.loadResourcePolicies()}),this.subs.push(this.router.events.pipe((0,$.p)(n=>n instanceof t.wF)).subscribe(()=>{console.log("Navigation detected, refreshing resource policies"),this.clearCaches(),(0,S.O)(100).subscribe(()=>{this.loadResourcePolicies()})}))}clearCaches(){try{this.requestService.setStaleByHrefSubstring("/api/authz/resourcepolicies"),this.requestService.setStaleByHrefSubstring("/api/eperson/epersons"),this.requestService.setStaleByHrefSubstring("/api/eperson/groups"),console.log("Cleared caches for resource policies, epersons, and groups")}catch(n){console.error("Error clearing caches:",n)}}canDelete(){return(0,C.H)(this.resourcePoliciesEntries$.value).pipe((0,$.p)(n=>n.checked),(0,W.T)((n,d)=>[...n,d],[]),(0,A.T)(n=>(0,D.hj)(n)),(0,y.F)())}deleteSelectedResourcePolicies(){this.processingDelete$.next(!0);const n=this.resourcePoliciesEntries$.value.filter(d=>d.checked);this.subs.push((0,C.H)(n).pipe((0,G.H)(d=>this.resourcePolicyService.delete(d.policy.id)),(0,V.S)((d,l)=>[...d,l],[]),(0,$.p)(d=>d.length===n.length),(0,L.s)(1),(0,h.j)(()=>this.processingDelete$.next(!1))).subscribe({next:d=>{const l=d.filter(O=>!O);(0,D.Im)(l)?(this.notificationsService.success(null,this.translate.get("resource-policies.delete.success.content")),this.refreshResourcePolicies()):this.notificationsService.error(null,this.translate.get("resource-policies.delete.failure.content"))},error:d=>{console.error("Error deleting policies:",d),this.notificationsService.error(null,this.translate.get("resource-policies.delete.error.content"))}}))}getResourcePolicies(){return this.resourcePoliciesEntries$.asObservable()}isLoading(){return this.loading$.asObservable()}loadResourcePolicies(){if(this.refreshInProgress)return void console.log("Refresh already in progress, skipping");console.log("Loading resource policies with fresh data"),this.loading$.next(!0),this.refreshInProgress=!0;const n=this.resourcePolicyService.searchByResource(this.resourceUUID,null,!1,!0,(0,c.s)("eperson"),(0,c.s)("group")).pipe((0,$.p)(()=>this.isActive),(0,H.v7)(),(0,L.s)(1),(0,T.W)(d=>(console.error("Error loading resource policies:",d),this.refreshAttempts++,this.refreshAttempts<this.maxRefreshAttempts?(console.log(`Retry attempt ${this.refreshAttempts} of ${this.maxRefreshAttempts}`),(0,S.O)(1e3).subscribe(()=>{this.refreshInProgress=!1,this.loadResourcePolicies()}),(0,b.of)({payload:{page:[]}})):(this.refreshAttempts=0,this.notificationsService.error(null,this.translate.get("resource-policies.load.error.content")),(0,b.of)({payload:{page:[]}})))),(0,h.j)(()=>{this.loading$.next(!1),this.refreshInProgress=!1,this.refreshAttempts=0})).subscribe(d=>{console.log("Resource policies loaded:",d.payload.page.length);const l=d.payload.page.map(O=>({id:O.id,policy:O,checked:!1}));this.resourcePoliciesEntries$.next(l),this.lastRefreshTime=new Date,this.cdr.detectChanges(),console.log("Resource policies view updated at",this.lastRefreshTime)});this.subs.push(n)}initResourcePolicyList(){this.refreshResourcePolicies()}isProcessingDelete(){return this.processingDelete$.asObservable()}redirectToResourcePolicyCreatePage(){this.router.navigate(["./create"],{relativeTo:this.route,queryParams:{policyTargetId:this.resourceUUID,targetType:this.resourceType}})}redirectToBitstreamEditPage(){"bitstream"===this.resourceType&&this.resourceUUID&&this.router.navigate([`/bitstreams/${this.resourceUUID}/edit`])}selectAllCheckbox(n){const d=n.target.checked;this.resourcePoliciesEntries$.value.forEach(l=>l.checked=d)}selectCheckbox(n,d){n.checked=d}refreshResourcePolicies(){console.log("Refreshing resource policies"),this.clearCaches(),(0,S.O)(100).subscribe(()=>{this.loadResourcePolicies()})}ngOnDestroy(){this.isActive=!1,this.resourcePoliciesEntries$=null,this.loading$.next(!1),this.refreshInProgress=!1,this.subs.filter(n=>(0,D.a4)(n)).forEach(n=>n.unsubscribe())}static{this.\u0275fac=function(d){return new(d||g)(e.rXU(e.gRc),e.rXU(F.f),e.rXU(k.EPersonDataService),e.rXU(U.GroupDataService),e.rXU(w.I),e.rXU(j.B),e.rXU(B.ResourcePolicyDataService),e.rXU(t.nX),e.rXU(t.Ix),e.rXU(_.c$))}}static{this.\u0275cmp=e.VBU({type:g,selectors:[["ds-resource-policies"]],inputs:{resourceUUID:"resourceUUID",resourceType:"resourceType",resourceName:"resourceName"},standalone:!0,features:[e.aNF],decls:38,vars:43,consts:[["selectAllBtn",""],[1,"table-responsive"],[1,"table","table-striped","table-bordered","table-hover"],["colspan","10"],[1,"d-flex","justify-content-between","align-items-center","m-0"],[1,"text-info"],[4,"ngIf"],[1,"space-children-mr","flex-shrink-0"],[1,"btn","btn-outline-primary","p-1","mr-1",3,"click","title"],["aria-hidden","true",1,"fas","fa-sync-alt","fa-fw"],[1,"btn","btn-danger","p-1",3,"click","dsBtnDisabled","title"],[1,"btn","btn-success","p-1",3,"click","dsBtnDisabled","title"],["aria-hidden","true",1,"fas","fa-plus"],["class","text-center",4,"ngIf"],["aria-hidden","true",1,"fas","fa-circle-notch","fa-spin"],["aria-hidden","true",1,"fas","fa-trash-alt","fa-fw"],[1,"text-center"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"change","id"],[1,"custom-control-label",3,"for"],[1,"sr-only"],["ds-resource-policy-entry","",3,"entry","toggleCheckbox",4,"ngFor","ngForOf"],["ds-resource-policy-entry","",3,"toggleCheckbox","entry"],["colspan","10",1,"text-center"]],template:function(d,l){if(1&d&&(e.j41(0,"div",1)(1,"table",2)(2,"thead")(3,"tr")(4,"th",3)(5,"div",4)(6,"span"),e.EFF(7),e.nI1(8,"translate"),e.j41(9,"span",5),e.EFF(10),e.k0s(),e.DNE(11,q,2,1,"ng-container",6),e.k0s(),e.j41(12,"div",7)(13,"button",8),e.nI1(14,"translate"),e.bIt("click",function(){return l.refreshResourcePolicies()}),e.nrm(15,"i",9),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"button",10),e.nI1(19,"async"),e.nI1(20,"async"),e.nI1(21,"translate"),e.bIt("click",function(){return l.deleteSelectedResourcePolicies()}),e.DNE(22,se,4,3,"span",6),e.nI1(23,"async"),e.DNE(24,re,4,3,"span",6),e.nI1(25,"async"),e.k0s(),e.j41(26,"button",11),e.nI1(27,"async"),e.nI1(28,"translate"),e.bIt("click",function(){return l.redirectToResourcePolicyCreatePage()}),e.nrm(29,"i",12),e.EFF(30),e.nI1(31,"translate"),e.k0s()()()()(),e.DNE(32,ee,36,32,"tr",13),e.nI1(33,"async"),e.k0s(),e.DNE(34,ie,3,3,"tbody",6),e.nI1(35,"async"),e.DNE(36,x,5,3,"tbody",6),e.nI1(37,"async"),e.k0s()()),2&d){let O,z,te;e.R7$(7),e.SpI(" ",e.bMT(8,15,"resource-policies.table.headers.title.for."+l.resourceType)," "),e.R7$(3),e.SpI(" ",l.resourceName," "),e.R7$(),e.Y8G("ngIf","item"!==l.resourceType),e.R7$(2),e.Y8G("title",e.bMT(14,17,"resource-policies.refresh.btn.title")),e.R7$(3),e.SpI(" ",e.bMT(17,19,"refresh")," "),e.R7$(2),e.Y8G("dsBtnDisabled",!0!==e.bMT(19,21,l.canDelete())||e.bMT(20,23,l.isProcessingDelete()))("title",e.bMT(21,25,"resource-policies.delete.btn.title")),e.R7$(4),e.Y8G("ngIf",e.bMT(23,27,l.isProcessingDelete())),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(25,29,l.isProcessingDelete())),e.R7$(2),e.Y8G("dsBtnDisabled",e.bMT(27,31,l.isProcessingDelete()))("title",e.bMT(28,33,"resource-policies.add.for."+l.resourceType)),e.R7$(4),e.SpI(" ",e.bMT(31,35,"resource-policies.add.button")," "),e.R7$(2),e.Y8G("ngIf",(null==(O=e.bMT(33,37,l.getResourcePolicies()))?null:O.length)>0),e.R7$(2),e.Y8G("ngIf",(null==(z=e.bMT(35,39,l.getResourcePolicies()))?null:z.length)>0),e.R7$(2),e.Y8G("ngIf",0===(null==(te=e.bMT(37,41,l.getResourcePolicies()))?null:te.length))}},dependencies:[K,_.h,_.D9,P.bT,P.Jj,P.Sq,Y.A],styles:["td[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]:focus{box-shadow:none!important}"]})}}return g})()},93120:(Z,N,s)=>{s.d(N,{a:()=>_});var P=s(82777),t=s(54438);let _=(()=>{class R{transform(C){return(0,P.a4)(C)}static{this.\u0275fac=function(b){return new(b||R)}}static{this.\u0275pipe=t.EJ8({name:"dsHasValue",type:R,pure:!0,standalone:!0})}}return R})()}}]);