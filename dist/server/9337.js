"use strict";exports.id=9337,exports.ids=[9337],exports.modules={60350:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Q:()=>Breadcrumb});class Breadcrumb{constructor(text,url){this.text=text,this.url=url}}},39337:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ROUTES:()=>ROUTES});var i18n_breadcrumb_resolver=__webpack_require__(75801),cjs=__webpack_require__(9238),operators=__webpack_require__(60444),api_urls=__webpack_require__(77140),core=__webpack_require__(11201),http=__webpack_require__(98465),router=__webpack_require__(18134),common=__webpack_require__(87514);const _c0=a0=>({nodes:a0});function RepositoryTreeComponent_div_6_Template(rf,ctx){1&rf&&(core.j41(0,"div",9)(1,"div",10)(2,"span",11),core.EFF(3,"Loading..."),core.k0s()(),core.j41(4,"span",12),core.EFF(5,"Loading repository structure..."),core.k0s()())}function RepositoryTreeComponent_div_7_Template(rf,ctx){if(1&rf&&(core.j41(0,"div",13),core.EFF(1),core.k0s()),2&rf){const ctx_r1=core.XpG();core.R7$(),core.SpI(" ",ctx_r1.error," ")}}function RepositoryTreeComponent_ng_container_10_span_3_Template(rf,ctx){if(1&rf){const _r4=core.RV6();core.j41(0,"span",24),core.bIt("click",function($event){core.eBV(_r4);const node_r5=core.XpG().$implicit,ctx_r1=core.XpG();return core.Njj(ctx_r1.toggleNode(node_r5,$event))}),core.nrm(1,"i",19),core.k0s()}if(2&rf){const node_r5=core.XpG().$implicit;core.R7$(),core.Y8G("ngClass",node_r5.expanded?"fa-chevron-down":"fa-chevron-right")}}function RepositoryTreeComponent_ng_container_10_span_4_Template(rf,ctx){1&rf&&(core.j41(0,"span",25),core.nrm(1,"i",26),core.k0s())}function RepositoryTreeComponent_ng_container_10_span_9_Template(rf,ctx){1&rf&&(core.j41(0,"span",27)(1,"div",28)(2,"span",11),core.EFF(3,"Loading..."),core.k0s()()())}function RepositoryTreeComponent_ng_container_10_div_10_Template(rf,ctx){if(1&rf&&(core.j41(0,"div",29)(1,"small",30),core.EFF(2),core.k0s()()),2&rf){const node_r5=core.XpG().$implicit,ctx_r1=core.XpG();core.R7$(2),core.JRh(ctx_r1.getPaginationInfo(node_r5))}}function RepositoryTreeComponent_ng_container_10_ul_11_ng_container_1_Template(rf,ctx){1&rf&&core.eu8(0)}function RepositoryTreeComponent_ng_container_10_ul_11_Template(rf,ctx){if(1&rf&&(core.j41(0,"ul",31),core.DNE(1,RepositoryTreeComponent_ng_container_10_ul_11_ng_container_1_Template,1,0,"ng-container",32),core.k0s()),2&rf){const node_r5=core.XpG().$implicit;core.XpG();const recursiveTreeNode_r6=core.sdS(12);core.R7$(),core.Y8G("ngTemplateOutlet",recursiveTreeNode_r6)("ngTemplateOutletContext",core.eq3(2,_c0,node_r5.children))}}function RepositoryTreeComponent_ng_container_10_Template(rf,ctx){if(1&rf){const _r3=core.RV6();core.qex(0),core.j41(1,"li",14)(2,"div",15),core.DNE(3,RepositoryTreeComponent_ng_container_10_span_3_Template,2,1,"span",16)(4,RepositoryTreeComponent_ng_container_10_span_4_Template,2,0,"span",17),core.j41(5,"span",18),core.nrm(6,"i",19),core.k0s(),core.j41(7,"span",20),core.bIt("click",function($event){const node_r5=core.eBV(_r3).$implicit,ctx_r1=core.XpG();return core.Njj(ctx_r1.navigateToNode(node_r5,$event))}),core.EFF(8),core.k0s(),core.DNE(9,RepositoryTreeComponent_ng_container_10_span_9_Template,4,0,"span",21),core.k0s(),core.DNE(10,RepositoryTreeComponent_ng_container_10_div_10_Template,3,1,"div",22)(11,RepositoryTreeComponent_ng_container_10_ul_11_Template,2,4,"ul",23),core.k0s(),core.bVm()}if(2&rf){const node_r5=ctx.$implicit,ctx_r1=core.XpG();core.R7$(2),core.HbH(ctx_r1.getNodeClass(node_r5)),core.R7$(),core.Y8G("ngIf","facet"!==node_r5.type||node_r5.children.length>0),core.R7$(),core.Y8G("ngIf","facet"===node_r5.type&&0===node_r5.children.length),core.R7$(2),core.Y8G("ngClass",ctx_r1.getNodeIcon(node_r5)),core.R7$(2),core.JRh(node_r5.name),core.R7$(),core.Y8G("ngIf",node_r5.loading),core.R7$(),core.Y8G("ngIf",node_r5.expanded&&"collection"===node_r5.type),core.R7$(),core.Y8G("ngIf",node_r5.expanded&&node_r5.children.length>0)}}function RepositoryTreeComponent_ng_template_11_li_0_span_2_Template(rf,ctx){if(1&rf){const _r8=core.RV6();core.j41(0,"span",24),core.bIt("click",function($event){core.eBV(_r8);const node_r9=core.XpG().$implicit,ctx_r1=core.XpG(2);return core.Njj(ctx_r1.toggleNode(node_r9,$event))}),core.nrm(1,"i",19),core.k0s()}if(2&rf){const node_r9=core.XpG().$implicit;core.R7$(),core.Y8G("ngClass",node_r9.expanded?"fa-chevron-down":"fa-chevron-right")}}function RepositoryTreeComponent_ng_template_11_li_0_span_3_Template(rf,ctx){1&rf&&(core.j41(0,"span",25),core.nrm(1,"i",34),core.k0s())}function RepositoryTreeComponent_ng_template_11_li_0_span_8_Template(rf,ctx){1&rf&&(core.j41(0,"span",27)(1,"div",28)(2,"span",11),core.EFF(3,"Loading..."),core.k0s()()())}function RepositoryTreeComponent_ng_template_11_li_0_ul_9_ng_container_1_Template(rf,ctx){1&rf&&core.eu8(0)}function RepositoryTreeComponent_ng_template_11_li_0_ul_9_Template(rf,ctx){if(1&rf&&(core.j41(0,"ul",31),core.DNE(1,RepositoryTreeComponent_ng_template_11_li_0_ul_9_ng_container_1_Template,1,0,"ng-container",32),core.k0s()),2&rf){const node_r9=core.XpG().$implicit;core.XpG(2);const recursiveTreeNode_r6=core.sdS(12);core.R7$(),core.Y8G("ngTemplateOutlet",recursiveTreeNode_r6)("ngTemplateOutletContext",core.eq3(2,_c0,node_r9.children))}}function RepositoryTreeComponent_ng_template_11_li_0_Template(rf,ctx){if(1&rf){const _r7=core.RV6();core.j41(0,"li",14)(1,"div",15),core.DNE(2,RepositoryTreeComponent_ng_template_11_li_0_span_2_Template,2,1,"span",16)(3,RepositoryTreeComponent_ng_template_11_li_0_span_3_Template,2,0,"span",17),core.j41(4,"span",18),core.nrm(5,"i",19),core.k0s(),core.j41(6,"span",20),core.bIt("click",function($event){const node_r9=core.eBV(_r7).$implicit,ctx_r1=core.XpG(2);return core.Njj(ctx_r1.navigateToNode(node_r9,$event))}),core.EFF(7),core.k0s(),core.DNE(8,RepositoryTreeComponent_ng_template_11_li_0_span_8_Template,4,0,"span",21),core.k0s(),core.DNE(9,RepositoryTreeComponent_ng_template_11_li_0_ul_9_Template,2,4,"ul",23),core.k0s()}if(2&rf){const node_r9=ctx.$implicit,ctx_r1=core.XpG(2);core.R7$(),core.HbH(ctx_r1.getNodeClass(node_r9)),core.R7$(),core.Y8G("ngIf","facet"!==node_r9.type||node_r9.children.length>0),core.R7$(),core.Y8G("ngIf","facet"===node_r9.type&&0===node_r9.children.length),core.R7$(2),core.Y8G("ngClass",ctx_r1.getNodeIcon(node_r9)),core.R7$(2),core.JRh(node_r9.name),core.R7$(),core.Y8G("ngIf",node_r9.loading),core.R7$(),core.Y8G("ngIf",node_r9.expanded&&node_r9.children.length>0)}}function RepositoryTreeComponent_ng_template_11_Template(rf,ctx){if(1&rf&&core.DNE(0,RepositoryTreeComponent_ng_template_11_li_0_Template,10,8,"li",33),2&rf){const nodes_r10=ctx.nodes,ctx_r1=core.XpG();core.Y8G("ngForOf",nodes_r10)("ngForTrackBy",ctx_r1.trackByNodeId)}}const ROUTES=[{path:"",component:(()=>{class RepositoryTreeComponent2{constructor(http2,cdr,router2){this.http=http2,this.cdr=cdr,this.router=router2,this.treeNodes=[],this.loading=!0,this.error=null,this.baseUrl=`${api_urls.$}/server/api`,this.defaultPageSize=20}ngOnInit(){this.loadRepositoryStructure()}loadRepositoryStructure(){this.loading=!0,this.cdr.detectChanges(),this.http.get(`${this.baseUrl}/core/communities/search/top?page=0&size=20&sort=dc.title,ASC&embed.size=subcommunities=20&embed=subcommunities&embed.size=collections=20&embed=collections`).pipe((0,operators.Tj)(response=>response._embedded&&response._embedded.communities?this.parseCommunitiesResponse(response._embedded.communities):[]),(0,operators.WL)(error=>(this.error=`Error loading repository structure: ${error.message}`,this.loading=!1,this.cdr.detectChanges(),(0,cjs.of)([])))).subscribe(nodes=>{this.treeNodes=nodes,this.loading=!1,this.cdr.detectChanges()})}parseCommunitiesResponse(communities){return communities.map(community=>{const node={id:community.id,uuid:community.uuid,name:community.name,handle:community.handle,type:"community",expanded:!1,loading:!1,children:[]};return community._embedded&&community._embedded.subcommunities&&community._embedded.subcommunities._embedded&&community._embedded.subcommunities._embedded.subcommunities&&node.children.push(...this.parseSubcommunitiesResponse(community._embedded.subcommunities._embedded.subcommunities)),community._embedded&&community._embedded.collections&&community._embedded.collections._embedded&&community._embedded.collections._embedded.collections&&node.children.push(...this.parseCollectionsResponse(community._embedded.collections._embedded.collections)),node})}parseSubcommunitiesResponse(subcommunities){return subcommunities.map(subcommunity=>({id:subcommunity.id,uuid:subcommunity.uuid,name:subcommunity.name,handle:subcommunity.handle,type:"subcommunity",expanded:!1,loading:!1,children:[]}))}parseCollectionsResponse(collections){return collections.map(collection=>({id:collection.id,uuid:collection.uuid,name:collection.name,handle:collection.handle,type:"collection",expanded:!1,loading:!1,children:[],currentPage:0,totalPages:0,totalElements:0,pageSize:this.defaultPageSize,hasMoreItems:!1}))}toggleNode(node,event){event.stopPropagation(),node.expanded=!node.expanded,"subcommunity"===node.type&&node.expanded&&0===node.children.length&&this.loadSubcommunityChildren(node),"collection"===node.type&&node.expanded&&0===node.children.length&&this.loadCollectionFacets(node)}loadSubcommunityChildren(node){node.loading=!0,this.cdr.detectChanges(),this.http.get(`${this.baseUrl}/core/communities/${node.id}?embed.size=collections=20&embed=collections&embed.size=subcommunities=20&embed=subcommunities`).pipe((0,operators.WL)(error=>(console.error(`Error loading subcommunity children: ${error.message}`),node.loading=!1,this.cdr.detectChanges(),(0,cjs.of)(null)))).subscribe(response=>{response&&response._embedded&&(response._embedded.subcommunities&&response._embedded.subcommunities._embedded&&response._embedded.subcommunities._embedded.subcommunities&&node.children.push(...this.parseSubcommunitiesResponse(response._embedded.subcommunities._embedded.subcommunities)),response._embedded.collections&&response._embedded.collections._embedded&&response._embedded.collections._embedded.collections&&node.children.push(...this.parseCollectionsResponse(response._embedded.collections._embedded.collections))),node.loading=!1,this.cdr.detectChanges()})}loadCollectionFacets(node){node.loading=!0,this.cdr.detectChanges(),this.http.get(`${this.baseUrl}/discover/search/objects?dsoType=item&scope=${node.uuid}`).pipe((0,operators.WL)(error=>(console.error(`Error loading collection facets: ${error.message}`),node.loading=!1,this.cdr.detectChanges(),(0,cjs.of)(null)))).subscribe(response=>{response&&response._embedded&&response._embedded.facets&&this.parseFacetsResponse(response._embedded.facets,node),node.loading=!1,this.cdr.detectChanges()})}parseFacetsResponse(facets,parentNode){const caseTypeFacet=facets.find(facet=>"dc_case_type"===facet.name);caseTypeFacet&&caseTypeFacet._embedded&&caseTypeFacet._embedded.values&&caseTypeFacet._embedded.values.length>0&&caseTypeFacet._embedded.values.forEach((value,index)=>{parentNode.children.push({id:`${parentNode.id}_case_type_${index}`,uuid:`${parentNode.uuid}_case_type_${index}`,name:`${value.label} (${value.count})`,handle:parentNode.uuid,type:"facet",expanded:!1,loading:!1,children:[],count:value.count,facetType:"dc_case_type",searchLink:value._links?.search?.href})})}getNodeIcon(node){switch(node.type){case"community":case"subcommunity":return node.expanded?"fa-folder-open":"fa-folder";case"collection":return"fa-archive";case"facet":return"fa-tag";default:return"fa-circle"}}getNodeClass(node){return`node-${node.type}`}getPaginationInfo(node){return"collection"===node.type&&node.children.length>0?`Case types: ${node.children.length}`:""}trackByNodeId(index,node){return node.id}refreshView(){this.cdr.detectChanges()}navigateToNode(node,event){switch(event.stopPropagation(),node.type){case"community":case"subcommunity":this.router.navigate(["/communities",node.uuid]);break;case"collection":this.router.navigate(["/collections",node.uuid]);break;case"facet":if("dc_case_type"===node.facetType){const caseTypeValue=node.name.split(" (")[0],collectionUuid=node.handle;if(collectionUuid){const filterUrl=`http://localhost:4000/collections/${collectionUuid}?f.dc_case_type=${encodeURIComponent(caseTypeValue)},equals&spc.page=1`;window.location.href=filterUrl}}}}static{this.\u0275fac=function(t){return new(t||RepositoryTreeComponent2)(core.rXU(http.Qq),core.rXU(core.gRc),core.rXU(router.Ix))}}static{this.\u0275cmp=core.VBU({type:RepositoryTreeComponent2,selectors:[["app-tree-view"]],decls:13,vars:4,consts:[["recursiveTreeNode",""],[1,"repository-tree-container","container"],[1,"header-section"],[1,"btn","btn-sm","btn-secondary",3,"click"],["class","loading-indicator",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"tree-view"],[1,"tree-root"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"loading-indicator"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"loading-text"],[1,"alert","alert-danger"],[1,"tree-node"],[1,"node-content"],["class","toggle-icon",3,"click",4,"ngIf"],["class","toggle-icon",4,"ngIf"],[1,"node-icon"],[1,"fa",3,"ngClass"],[1,"node-name",3,"click"],["class","node-loading-inline",4,"ngIf"],["class","pagination-info",4,"ngIf"],["class","tree-children",4,"ngIf"],[1,"toggle-icon",3,"click"],[1,"toggle-icon"],[1,"fa","fa-circle-o"],[1,"node-loading-inline"],["role","status",1,"spinner-border","spinner-border-sm"],[1,"pagination-info"],[1,"text-muted"],[1,"tree-children"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","tree-node",4,"ngFor","ngForOf","ngForTrackBy"],[1,"fa","fa-tag"]],template:function(rf,ctx){if(1&rf){const _r1=core.RV6();core.j41(0,"div",1)(1,"div",2)(2,"h2"),core.EFF(3,"List of Communities"),core.k0s(),core.j41(4,"button",3),core.bIt("click",function(){return core.eBV(_r1),core.Njj(ctx.refreshView())}),core.EFF(5,"Refresh View"),core.k0s()(),core.DNE(6,RepositoryTreeComponent_div_6_Template,6,0,"div",4)(7,RepositoryTreeComponent_div_7_Template,2,1,"div",5),core.j41(8,"div",6)(9,"ul",7),core.DNE(10,RepositoryTreeComponent_ng_container_10_Template,12,9,"ng-container",8),core.k0s()()(),core.DNE(11,RepositoryTreeComponent_ng_template_11_Template,1,2,"ng-template",null,0,core.C5r)}2&rf&&(core.R7$(6),core.Y8G("ngIf",ctx.loading),core.R7$(),core.Y8G("ngIf",ctx.error),core.R7$(3),core.Y8G("ngForOf",ctx.treeNodes)("ngForTrackBy",ctx.trackByNodeId))},dependencies:[common.YU,common.Sq,common.bT,common.T3],styles:[".repository-tree-container[_ngcontent-%COMP%]{padding:20px 0;font-family:Arial,sans-serif;max-width:1200px;margin:0 auto}.repository-tree-container[_ngcontent-%COMP%]{margin-left:15px;margin-right:15px}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.tree-view[_ngcontent-%COMP%]{margin-top:20px}.tree-root[_ngcontent-%COMP%], .tree-children[_ngcontent-%COMP%]{list-style-type:none;padding-left:0}.tree-children[_ngcontent-%COMP%]{padding-left:20px;margin-top:5px}.tree-node[_ngcontent-%COMP%]{margin:5px 0}.node-content[_ngcontent-%COMP%]{display:flex;align-items:center;padding:5px;border-radius:4px}.node-content[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.toggle-icon[_ngcontent-%COMP%]{width:20px;text-align:center;cursor:pointer}.node-icon[_ngcontent-%COMP%]{margin-right:8px;width:20px;text-align:center}.node-name[_ngcontent-%COMP%]{flex-grow:1;cursor:pointer;color:#0056b3}.node-name[_ngcontent-%COMP%]:hover{text-decoration:underline}.node-loading-inline[_ngcontent-%COMP%]{margin-left:10px}.node-community[_ngcontent-%COMP%]{font-weight:700}.node-subcommunity[_ngcontent-%COMP%]{font-weight:700;color:#2c5282}.node-collection[_ngcontent-%COMP%]{color:#2b6cb0}.node-item[_ngcontent-%COMP%]{color:#4a5568;font-size:.95em}.loading-indicator[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:40px 0}.loading-indicator[_ngcontent-%COMP%]   .loading-text[_ngcontent-%COMP%]{margin-top:10px;color:#6c757d}.pagination-info[_ngcontent-%COMP%]{margin-left:40px;margin-top:5px;margin-bottom:10px}.load-more-container[_ngcontent-%COMP%]{margin:10px 0;padding-left:40px}.load-more-btn[_ngcontent-%COMP%]{display:flex;align-items:center}.load-more-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.spinner-border[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spinner-border .75s linear infinite}@keyframes _ngcontent-%COMP%_spinner-border{to{transform:rotate(360deg)}}@media (max-width: 768px){.repository-tree-container[_ngcontent-%COMP%]{padding:10px}.tree-children[_ngcontent-%COMP%]{padding-left:15px}.pagination-info[_ngcontent-%COMP%]{margin-left:30px}.load-more-container[_ngcontent-%COMP%]{padding-left:30px}}"]})}}return RepositoryTreeComponent2})(),pathMatch:"full",resolve:{breadcrumb:i18n_breadcrumb_resolver.S},data:{title:"communityList.tabTitle",breadcrumbKey:"communityList"}}]},75801:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>i18nBreadcrumbResolver});var core=__webpack_require__(11201),empty_util=__webpack_require__(88500),route_utils=__webpack_require__(7625),cjs=__webpack_require__(9238),breadcrumb_model=__webpack_require__(60350);let I18nBreadcrumbsService=(()=>{class I18nBreadcrumbsService2{getBreadcrumbs(key,url){return(0,cjs.of)([new breadcrumb_model.Q(key+".breadcrumbs",url)])}static{this.\u0275fac=function(t){return new(t||I18nBreadcrumbsService2)}}static{this.\u0275prov=core.jDH({token:I18nBreadcrumbsService2,factory:I18nBreadcrumbsService2.\u0275fac,providedIn:"root"})}}return I18nBreadcrumbsService2})();const i18nBreadcrumbResolver=(route,state,breadcrumbService=(0,core.WQX)(I18nBreadcrumbsService))=>{const key=route.data.breadcrumbKey;if((0,empty_util.Tn)(key))throw new Error('You provided an i18nBreadcrumbResolver for url "'+route.url+"\" but no breadcrumbKey in the route's data");return{provider:breadcrumbService,key,url:(0,route_utils.F)(route)}}}};