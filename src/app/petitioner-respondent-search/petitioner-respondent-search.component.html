<!-- petitioner-respondent-search.component.html -->
<div class="container">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4">By Petitioner / Respondent</h2>

      <form [formGroup]="searchForm" class="mb-4">
        <div class="row"> 

          <!-- Petitioner Section -->
<!-- Petitioner Input & Dropdown -->
<div class="col-md-6 mb-3 position-relative">
  <label class="form-label">Petitioner Name
    <button type="button" class="btn btn-sm ms-2"
      [ngClass]="showPetitionerInput ? 'btn-danger' : 'btn-success'"
      (click)="togglePetitionerInput()">
      {{ showPetitionerInput ? '-' : '+' }}
    </button>
  </label>

  <div *ngIf="showPetitionerInput">
    <input type="text" class="form-control" formControlName="petitionerName"
           (input)="searchPetitioner()" placeholder="Enter Petitioner Name">

    <ul *ngIf="petitionerResults.length"
        class="suggestion-dropdown">
      <li *ngFor="let result of petitionerResults"
          (mousedown)="selectPetitioner(result.value)">
        {{ result.value }}
      </li>
    </ul>
  </div>
</div>

<!-- Respondent Input & Dropdown -->
<div class="col-md-6 mb-3 position-relative">
  <label class="form-label">Respondent Name
    <button type="button" class="btn btn-sm ms-2"
      [ngClass]="showRespondentInput ? 'btn-danger' : 'btn-success'"
      (click)="toggleRespondentInput()">
      {{ showRespondentInput ? '-' : '+' }}
    </button>
  </label>

  <div *ngIf="showRespondentInput">
    <input type="text" class="form-control" formControlName="respondentName"
           (input)="searchRespondent()" placeholder="Enter Respondent Name">

    <ul *ngIf="respondentResults.length"
        class="suggestion-dropdown">
      <li *ngFor="let result of respondentResults"
          (mousedown)="selectRespondent(result.value)">
        {{ result.value }}
      </li>
    </ul>
  </div>
</div>



          <!-- <div class="col-md-6 mb-3">
            <label class="form-label">Petitioner Name
              <button type="button" class="btn btn-sm ms-2" 
                [ngClass]="showPetitionerInput ? 'btn-danger' : 'btn-success'"
                (click)="togglePetitionerInput()">
                {{ showPetitionerInput ? '-' : '+' }}
              </button>
            </label>

            <div *ngIf="showPetitionerInput">
              <input type="text" class="form-control" formControlName="petitionerName" placeholder="Enter Petitioner Name" (input)="searchPetitioner()">
            </div>
          </div>
 
          <div class="col-md-6 mb-3">
            <label class="form-label">Respondent Name
              <button type="button" class="btn btn-sm ms-2" 
                [ngClass]="showRespondentInput ? 'btn-danger' : 'btn-success'"
                (click)="toggleRespondentInput()">
                {{ showRespondentInput ? '-' : '+' }}
              </button>
            </label>

            <div *ngIf="showRespondentInput">
              <input type="text" class="form-control" formControlName="respondentName" placeholder="Enter Respondent Name" (input)="searchRespondent()">
            </div>
          </div> -->
        </div>

        <!-- Search Results List -->
        <!-- <div class="row">
          <div class="col-md-12">
            <ul *ngIf="results.length" class="list-group">
              <li *ngFor="let result of results" 
                  class="list-group-item list-group-item-action"
                  style="cursor: pointer;"
                  (click)="selectSuggestion(result.value)"
                  >
                {{ result.value }}
              </li>
            </ul>
            
          </div>
        </div> -->
<!-- Sorting and Pagination Controls -->
<div class="row mb-3">
  <div class="col-md-3">
    <label for="sortBy">Sort By:</label>
    <select class="form-select" id="sortBy" (change)="onSortChange($event.target.value)">
      <option value="dc.title">Case Number</option>
      <option value="dc.casetype">Case Type</option>
      <option value="dc.caseyear">Case Year</option> 
      <option value="dc.pname">First Petitioner</option>
      <option value="dc.rname">First Respondent</option>
      <option value="dc.paname">Petitioner's Advocate Name</option>
      <option value="dc.raname">Respondent's Advocate Name</option>
    </select>
  </div>

  <div class="col-md-3">
    <label for="sortOrder">Sort Order:</label>
    <select class="form-select" id="sortOrder" (change)="onSortOrderChange($event.target.value)">
      <option value="ASC">Ascending</option>
      <option value="DESC">Descending</option>
    </select>
  </div>

 
  <div class="col-md-3">
    <label for="sortOrder">Results per page</label>
    <select id="resultsPerPage" class="form-select" [(ngModel)]="resultsPerPage" (change)="onCombinedSearchClick()">
      <option value="5">5</option>
      
      <option value="10">10</option>
      <option value="20">20</option>
      <option value="50">50</option>
      <option value="100">100</option>
    </select>
  </div>
</div>

        <!-- Search Button for Combined Search -->
        <div class="row mt-3">
          <div class="col-12 d-flex justify-content-start">
            <button type="button" class="btn btn-primary" (click)="onCombinedSearchClick1()">
              Search
            </button>
          </div>
        </div>
        
        <!-- Clear Button -->
        <div class="row mt-3">
          <div class="col-12">
            <button type="button" class="btn btn-secondary" (click)="clearSearch()">Clear</button>
          </div>
        </div>
      </form>

      <div *ngIf="(caseListSubject | async)?.length === 0 && !isLoading && !errorMessage">
        <p>No cases found for the given criteria.</p>
      </div>
      
      <!-- Search Results Table -->
      <div class="search-results mt-4" >
        <h3>Search Results</h3>
        <div class="table-responsive">
          <table class="table ">
            <thead>
              <tr>
                <th>CASE TYPE</th>
                <th>CASE NUMBER</th>
                <th>CASE YEAR</th>
                <th>DISTRICT</th>
                <th>JUDGE NAME</th>
                <th>FIRST PETITIONER</th>
                <th>FIRST RESPONDENT</th>
                <th>Disposal Date</th>
  
              </tr>
            </thead>
            <tbody>
              <!-- <ng-container> -->
                <!-- <tr *ngFor="let caseItem of caseList | async">
                  <td class="case-result-text">
                    <a [href]="caseItem?.['dc.identifier.uri']?.[0]?.value" class="case-link" target="_self">
                      {{ caseItem?.['dc.case.type']?.[0]?.value || 'N/A' }}
                    </a>
                  </td>
                  <td class="case-result-text">
                    <a [href]="caseItem?.['dc.identifier.uri']?.[0]?.value" class="case-link" target="_self">
                      {{ caseItem?.['dc.case.number']?.[0]?.value || 'N/A' }}
                    </a>
                  </td>
                  <td class="case-result-text">
                    <a [href]="caseItem?.['dc.identifier.uri']?.[0]?.value" class="case-link" target="_self">
                      {{ caseItem?.['dc.case.year']?.[0]?.value || 'N/A' }}
                    </a>
                  </td>
                  <td class="case-result-text">
                    <a [href]="caseItem?.['dc.identifier.uri']?.[0]?.value" class="case-link" target="_self">
                      {{ caseItem?.['dc.case.district']?.[0]?.value || 'N/A' }}
                    </a>
                  </td>
                  <td class="case-result-text">
                    <a [href]="caseItem?.['dc.identifier.uri']?.[0]?.value" class="case-link" target="_self">
                      {{ caseItem?.['dc.judge.name']?.[0]?.value || 'N/A' }}
                    </a>
                  </td>
                  <td class="case-result-text">
                    <a [href]="caseItem?.['dc.identifier.uri']?.[0]?.value" class="case-link" target="_self">
                      {{ caseItem?.['dc.party.firstpetitioner']?.[0]?.value || 'N/A' }}
                    </a>
                  </td>
                  <td class="case-result-text">
                    <a [href]="caseItem?.['dc.identifier.uri']?.[0]?.value" class="case-link" target="_self">
                      {{ caseItem?.['dc.party.firstrespondent']?.[0]?.value || 'N/A' }}
                    </a>
                  </td>
                  <td class="case-result-text">
                    <a [href]="caseItem?.['dc.identifier.uri']?.[0]?.value" class="case-link" target="_self">
                      {{ caseItem?.['dc.date.issued']?.[0]?.value || 'N/A' }}
                    </a>
                  </td>
                </tr>
                 -->
                
                 <ng-container *ngIf="(caseList$ | async) as caseList">
                  <tr *ngFor="let caseItem of caseList">
                    <td class="case-result-text">
                      <a [routerLink]="['/items', caseItem.uuid]" class="case-link">
                        {{ caseItem.metadata?.['dc.casetype']?.[0]?.value || 'N/A' }}
                      </a>
                    </td>
                    <td class="case-result-text">
                      <a [routerLink]="['/items', caseItem.uuid]" class="case-link">
                        {{ caseItem.metadata?.['dc.title']?.[0]?.value || 'N/A' }}
                      </a>
                    </td>
                    <td class="case-result-text">
                      <a [routerLink]="['/items', caseItem.uuid]" class="case-link">
                        {{ caseItem.metadata?.['dc.caseyear']?.[0]?.value || 'N/A' }}
                      </a>
                    </td>
                    <td class="case-result-text">
                      <a [routerLink]="['/items', caseItem.uuid]" class="case-link">
                        {{ caseItem.metadata?.['dc.district']?.[0]?.value || 'N/A' }}
                      </a>
                    </td>
                    <td class="case-result-text">
                      <a [routerLink]="['/items', caseItem.uuid]" class="case-link">
                        {{ caseItem.metadata?.['dc.contributor.author']?.[0]?.value || 'N/A' }}
                      </a>
                    </td>
                    <td class="case-result-text">
                      <a [routerLink]="['/items', caseItem.uuid]" class="case-link">
                        {{ caseItem.metadata?.['dc.pname']?.[0]?.value || 'N/A' }}
                      </a>
                    </td>
                    <td class="case-result-text">
                      <a [routerLink]="['/items', caseItem.uuid]" class="case-link">
                        {{ caseItem.metadata?.['dc.rname']?.[0]?.value || 'N/A' }}
                      </a>
                    </td>
                    <td class="case-result-text">
                      <a [routerLink]="['/items', caseItem.uuid]" class="case-link">
                        {{ caseItem.metadata?.['dc.date.disposal']?.[0]?.value || 'N/A' }}
                      </a>
                    </td>
                  </tr>     
                </ng-container>
              <!-- </ng-container> -->
            </tbody>
          </table>
        </div>
      </div>

      

      <!-- Error Handling -->
      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="isLoading" class="d-flex justify-content-center">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

    </div>
  </div>
</div>
